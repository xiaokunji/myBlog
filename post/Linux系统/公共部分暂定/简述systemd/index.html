<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <script type="application/ld+json">

{  
  "@context":"http://schema.org",
  "@type":"Website",
  "@id":"https:\/\/xiaokunji.github.io\/myBlog\/",
  "author": {
    "@type": "Person",
    "name": "Firstname Lastname",
    
    "image": "https://www.gravatar.com/avatar/d09dc2d7aa5c467519e8af89f7b3d94c"
    
  },
  "name":"Hugo tranquilpeak theme",
  "description":"[toc]\nSystemd 概述 Systemd 简介 历史上，Linux 的启动一直采用 init 进程。这种方法有两个缺点。\n一是启动时间长。init进程是串行启动，只有前一个进程启动完，才会启动下一个进程。\n二是启动脚本复杂。init进程只是执行启动脚本，不管其他事情。脚本需要自己处理各种情况，这往往使得脚本变得很长。\n下面的命令用来启动服务。\n$ sudo \/etc\/init.d\/apache2 start # 或者 $ service apache2 start Systemd 就是为了解决这些问题而诞生的,字母d是守护进程（daemon）的缩写\nSystemd 是一系列工具的集合，其作用也远远不仅是启动操作系统，它还接管了后台服务、结束、状态查询，以及日志归档、设备管理、电源管理、定时任务等许多职责，并支持通过特定事件（如插入特定 USB 设备）和特定端口数据触发的 On-demand（按需）任务。\nSystemd 的后台服务还有一个特殊的身份——它是系统中 PID 值为 1 的进程。\n更少的进程 Systemd 提供了 服务按需启动 的能力，使得特定的服务只有在真定被请求时才启动。\n允许更多的进程并行启动 在 SysV-init 时代，将每个服务项目编号依次执行启动脚本。Ubuntu 的 Upstart 解决了没有直接依赖的启动之间的并行启动。而 Systemd 通过 Socket 缓存、DBus 缓存和建立临时挂载点等方法进一步解决了启动进程之间的依赖，做到了所有系统服务并发启动。对于用户自定义的服务，Systemd 允许配置其启动依赖项目，从而确保服务按必要的顺序运行。\n使用 CGroup 跟踪和管理进程的生命周期 在 Systemd 之间的主流应用管理服务都是使用 进程树 来跟踪应用的继承关系的，而进程的父子关系很容易通过 两次 fork 的方法脱离。\n而 Systemd 则提供通过 CGroup 跟踪进程关系，引补了这个缺漏。通过 CGroup 不仅能够实现服务之间访问隔离，限制特定应用程序对系统资源的访问配额，还能更精确地管理服务的生命周期。",
  "url":"https:\/\/xiaokunji.github.io\/myBlog\/post\/linux%E7%B3%BB%E7%BB%9F\/%E5%85%AC%E5%85%B1%E9%83%A8%E5%88%86%E6%9A%82%E5%AE%9A\/%E7%AE%80%E8%BF%B0systemd\/",
  "keywords":"[]"
}

</script>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.116.1 with theme Tranquilpeak 0.5.3-BETA">
<meta name="author" content="Firstname Lastname">
<meta name="keywords" content="">
<meta name="description" content="[toc]
Systemd 概述 Systemd 简介 历史上，Linux 的启动一直采用 init 进程。这种方法有两个缺点。
一是启动时间长。init进程是串行启动，只有前一个进程启动完，才会启动下一个进程。
二是启动脚本复杂。init进程只是执行启动脚本，不管其他事情。脚本需要自己处理各种情况，这往往使得脚本变得很长。
下面的命令用来启动服务。
$ sudo /etc/init.d/apache2 start # 或者 $ service apache2 start Systemd 就是为了解决这些问题而诞生的,字母d是守护进程（daemon）的缩写
Systemd 是一系列工具的集合，其作用也远远不仅是启动操作系统，它还接管了后台服务、结束、状态查询，以及日志归档、设备管理、电源管理、定时任务等许多职责，并支持通过特定事件（如插入特定 USB 设备）和特定端口数据触发的 On-demand（按需）任务。
Systemd 的后台服务还有一个特殊的身份——它是系统中 PID 值为 1 的进程。
更少的进程 Systemd 提供了 服务按需启动 的能力，使得特定的服务只有在真定被请求时才启动。
允许更多的进程并行启动 在 SysV-init 时代，将每个服务项目编号依次执行启动脚本。Ubuntu 的 Upstart 解决了没有直接依赖的启动之间的并行启动。而 Systemd 通过 Socket 缓存、DBus 缓存和建立临时挂载点等方法进一步解决了启动进程之间的依赖，做到了所有系统服务并发启动。对于用户自定义的服务，Systemd 允许配置其启动依赖项目，从而确保服务按必要的顺序运行。
使用 CGroup 跟踪和管理进程的生命周期 在 Systemd 之间的主流应用管理服务都是使用 进程树 来跟踪应用的继承关系的，而进程的父子关系很容易通过 两次 fork 的方法脱离。
而 Systemd 则提供通过 CGroup 跟踪进程关系，引补了这个缺漏。通过 CGroup 不仅能够实现服务之间访问隔离，限制特定应用程序对系统资源的访问配额，还能更精确地管理服务的生命周期。">


<meta property="og:description" content="[toc]
Systemd 概述 Systemd 简介 历史上，Linux 的启动一直采用 init 进程。这种方法有两个缺点。
一是启动时间长。init进程是串行启动，只有前一个进程启动完，才会启动下一个进程。
二是启动脚本复杂。init进程只是执行启动脚本，不管其他事情。脚本需要自己处理各种情况，这往往使得脚本变得很长。
下面的命令用来启动服务。
$ sudo /etc/init.d/apache2 start # 或者 $ service apache2 start Systemd 就是为了解决这些问题而诞生的,字母d是守护进程（daemon）的缩写
Systemd 是一系列工具的集合，其作用也远远不仅是启动操作系统，它还接管了后台服务、结束、状态查询，以及日志归档、设备管理、电源管理、定时任务等许多职责，并支持通过特定事件（如插入特定 USB 设备）和特定端口数据触发的 On-demand（按需）任务。
Systemd 的后台服务还有一个特殊的身份——它是系统中 PID 值为 1 的进程。
更少的进程 Systemd 提供了 服务按需启动 的能力，使得特定的服务只有在真定被请求时才启动。
允许更多的进程并行启动 在 SysV-init 时代，将每个服务项目编号依次执行启动脚本。Ubuntu 的 Upstart 解决了没有直接依赖的启动之间的并行启动。而 Systemd 通过 Socket 缓存、DBus 缓存和建立临时挂载点等方法进一步解决了启动进程之间的依赖，做到了所有系统服务并发启动。对于用户自定义的服务，Systemd 允许配置其启动依赖项目，从而确保服务按必要的顺序运行。
使用 CGroup 跟踪和管理进程的生命周期 在 Systemd 之间的主流应用管理服务都是使用 进程树 来跟踪应用的继承关系的，而进程的父子关系很容易通过 两次 fork 的方法脱离。
而 Systemd 则提供通过 CGroup 跟踪进程关系，引补了这个缺漏。通过 CGroup 不仅能够实现服务之间访问隔离，限制特定应用程序对系统资源的访问配额，还能更精确地管理服务的生命周期。">
<meta property="og:type" content="article">
<meta property="og:title" content="Hugo tranquilpeak theme">
<meta name="twitter:title" content="Hugo tranquilpeak theme">
<meta property="og:url" content="https://xiaokunji.github.io/myBlog/post/linux%E7%B3%BB%E7%BB%9F/%E5%85%AC%E5%85%B1%E9%83%A8%E5%88%86%E6%9A%82%E5%AE%9A/%E7%AE%80%E8%BF%B0systemd/">
<meta property="twitter:url" content="https://xiaokunji.github.io/myBlog/post/linux%E7%B3%BB%E7%BB%9F/%E5%85%AC%E5%85%B1%E9%83%A8%E5%88%86%E6%9A%82%E5%AE%9A/%E7%AE%80%E8%BF%B0systemd/">
<meta property="og:site_name" content="Hugo tranquilpeak theme">
<meta property="og:description" content="[toc]
Systemd 概述 Systemd 简介 历史上，Linux 的启动一直采用 init 进程。这种方法有两个缺点。
一是启动时间长。init进程是串行启动，只有前一个进程启动完，才会启动下一个进程。
二是启动脚本复杂。init进程只是执行启动脚本，不管其他事情。脚本需要自己处理各种情况，这往往使得脚本变得很长。
下面的命令用来启动服务。
$ sudo /etc/init.d/apache2 start # 或者 $ service apache2 start Systemd 就是为了解决这些问题而诞生的,字母d是守护进程（daemon）的缩写
Systemd 是一系列工具的集合，其作用也远远不仅是启动操作系统，它还接管了后台服务、结束、状态查询，以及日志归档、设备管理、电源管理、定时任务等许多职责，并支持通过特定事件（如插入特定 USB 设备）和特定端口数据触发的 On-demand（按需）任务。
Systemd 的后台服务还有一个特殊的身份——它是系统中 PID 值为 1 的进程。
更少的进程 Systemd 提供了 服务按需启动 的能力，使得特定的服务只有在真定被请求时才启动。
允许更多的进程并行启动 在 SysV-init 时代，将每个服务项目编号依次执行启动脚本。Ubuntu 的 Upstart 解决了没有直接依赖的启动之间的并行启动。而 Systemd 通过 Socket 缓存、DBus 缓存和建立临时挂载点等方法进一步解决了启动进程之间的依赖，做到了所有系统服务并发启动。对于用户自定义的服务，Systemd 允许配置其启动依赖项目，从而确保服务按必要的顺序运行。
使用 CGroup 跟踪和管理进程的生命周期 在 Systemd 之间的主流应用管理服务都是使用 进程树 来跟踪应用的继承关系的，而进程的父子关系很容易通过 两次 fork 的方法脱离。
而 Systemd 则提供通过 CGroup 跟踪进程关系，引补了这个缺漏。通过 CGroup 不仅能够实现服务之间访问隔离，限制特定应用程序对系统资源的访问配额，还能更精确地管理服务的生命周期。">
<meta name="twitter:description" content="[toc]
Systemd 概述 Systemd 简介 历史上，Linux 的启动一直采用 init 进程。这种方法有两个缺点。
一是启动时间长。init进程是串行启动，只有前一个进程启动完，才会启动下一个进程。
二是启动脚本复杂。init进程只是执行启动脚本，不管其他事情。脚本需要自己处理各种情况，这往往使得脚本变得很长。
下面的命令用来启动服务。
$ sudo /etc/init.d/apache2 start # 或者 $ service apache2 start Systemd 就是为了解决这些问题而诞生的,字母d是守护进程（daemon）的缩写
Systemd 是一系列工具的集合，其作用也远远不仅是启动操作系统，它还接管了后台服务、结束、状态查询，以及日志归档、设备管理、电源管理、定时任务等许多职责，并支持通过特定事件（如插入特定 USB 设备）和特定端口数据触发的 On-demand（按需）任务。
Systemd 的后台服务还有一个特殊的身份——它是系统中 PID 值为 1 的进程。
更少的进程 Systemd 提供了 服务按需启动 的能力，使得特定的服务只有在真定被请求时才启动。
允许更多的进程并行启动 在 SysV-init 时代，将每个服务项目编号依次执行启动脚本。Ubuntu 的 Upstart 解决了没有直接依赖的启动之间的并行启动。而 Systemd 通过 Socket 缓存、DBus 缓存和建立临时挂载点等方法进一步解决了启动进程之间的依赖，做到了所有系统服务并发启动。对于用户自定义的服务，Systemd 允许配置其启动依赖项目，从而确保服务按必要的顺序运行。
使用 CGroup 跟踪和管理进程的生命周期 在 Systemd 之间的主流应用管理服务都是使用 进程树 来跟踪应用的继承关系的，而进程的父子关系很容易通过 两次 fork 的方法脱离。
而 Systemd 则提供通过 CGroup 跟踪进程关系，引补了这个缺漏。通过 CGroup 不仅能够实现服务之间访问隔离，限制特定应用程序对系统资源的访问配额，还能更精确地管理服务的生命周期。">
<meta property="og:locale" content="en-us">

  
  
  
  
  


<meta name="twitter:card" content="summary">







  <meta property="og:image" content="https://www.gravatar.com/avatar/d09dc2d7aa5c467519e8af89f7b3d94c?s=640">
  <meta property="twitter:image" content="https://www.gravatar.com/avatar/d09dc2d7aa5c467519e8af89f7b3d94c?s=640">






    <title>Hugo tranquilpeak theme</title>

    <link rel="icon" href="https://xiaokunji.github.io/myBlog/favicon.png">
    

    

    <link rel="canonical" href="https://xiaokunji.github.io/myBlog/post/linux%E7%B3%BB%E7%BB%9F/%E5%85%AC%E5%85%B1%E9%83%A8%E5%88%86%E6%9A%82%E5%AE%9A/%E7%AE%80%E8%BF%B0systemd/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha512-H9jrZiiopUdsLpg94A333EfumgUBpO9MdbxStdeITo+KEIMaNfHNvwyjjDJb+ERPaRS6DpyRlKbvPUasNItRyw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    
    
    <link rel="stylesheet" href="https://xiaokunji.github.io/myBlog/css/style-h6ccsoet3mzkbb0wngshlfbaweimexgqcxj0h5hu4h82olsdzz6wmqdkajm.min.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://xiaokunji.github.io/myBlog/" aria-label="Go to homepage">Hugo tranquilpeak theme</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://xiaokunji.github.io/myBlog/#about" aria-label="Open the link: /#about">
    
    
    
      
        <img class="header-picture" src="https://www.gravatar.com/avatar/d09dc2d7aa5c467519e8af89f7b3d94c?s=90" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://xiaokunji.github.io/myBlog/#about" aria-label="Read more about the author">
          <img class="sidebar-profile-picture" src="https://www.gravatar.com/avatar/d09dc2d7aa5c467519e8af89f7b3d94c?s=110" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Firstname Lastname</h4>
        
          <h5 class="sidebar-profile-bio">Super bio with markdown support <strong>COOL</strong></h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://xiaokunji.github.io/myBlog/" title="Home">
    
      <i class="sidebar-button-icon fas fa-lg fa-home" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://xiaokunji.github.io/myBlog/content" title="我的">
    
      <i class="sidebar-button-icon fas fa-lg fa-home" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">我的</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://xiaokunji.github.io/myBlog/categories" title="Categories">
    
      <i class="sidebar-button-icon fas fa-lg fa-bookmark" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://xiaokunji.github.io/myBlog/tags" title="Tags">
    
      <i class="sidebar-button-icon fas fa-lg fa-tags" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://xiaokunji.github.io/myBlog/archives" title="Archives">
    
      <i class="sidebar-button-icon fas fa-lg fa-archive" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://xiaokunji.github.io/myBlog/#about" title="About">
    
      <i class="sidebar-button-icon fas fa-lg fa-question" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/kakawait" target="_blank" rel="noopener" title="GitHub">
    
      <i class="sidebar-button-icon fab fa-lg fa-github" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://stackoverflow.com/users/636472/kakawait" target="_blank" rel="noopener" title="Stack Overflow">
    
      <i class="sidebar-button-icon fab fa-lg fa-stack-overflow" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Stack Overflow</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://xiaokunji.github.io/myBlog/index.xml" title="RSS">
    
      <i class="sidebar-button-icon fas fa-lg fa-rss" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post" id="top">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title">
      
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="0001-01-01T00:00:00Z">
        
  January 1, 1

      </time>
    
    
  </div>

</div>
          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              <p>[toc]</p>
<h1 id="systemd-概述">Systemd 概述</h1>
<h2 id="systemd-简介">Systemd 简介</h2>
<p>历史上，Linux 的启动一直采用 init 进程。这种方法有两个缺点。</p>
<p>一是启动时间长。<code>init</code>进程是串行启动，只有前一个进程启动完，才会启动下一个进程。</p>
<p>二是启动脚本复杂。<code>init</code>进程只是执行启动脚本，不管其他事情。脚本需要自己处理各种情况，这往往使得脚本变得很长。</p>
<blockquote>
<p>下面的命令用来启动服务。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ sudo /etc/init.d/apache2 start
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 或者</span>
</span></span><span style="display:flex;"><span>$ service apache2 start
</span></span></code></pre></div></blockquote>
<p>Systemd 就是为了解决这些问题而诞生的,字母<code>d</code>是守护进程（daemon）的缩写</p>
<p>Systemd 是一系列工具的集合，其作用也远远不仅是启动操作系统，它还接管了后台服务、结束、状态查询，以及日志归档、设备管理、电源管理、定时任务等许多职责，并支持通过特定事件（如插入特定 USB 设备）和特定端口数据触发的 On-demand（按需）任务。</p>
<p><strong>Systemd 的后台服务还有一个特殊的身份——它是系统中 PID 值为 1 的进程。</strong></p>
<ol>
<li>更少的进程</li>
</ol>
<p>Systemd 提供了 服务按需启动 的能力，使得特定的服务只有在真定被请求时才启动。</p>
<ol>
<li>允许更多的进程并行启动</li>
</ol>
<p>在 SysV-init 时代，将每个服务项目编号依次执行启动脚本。Ubuntu 的 Upstart 解决了没有直接依赖的启动之间的并行启动。而 Systemd 通过 Socket 缓存、DBus 缓存和建立临时挂载点等方法进一步解决了启动进程之间的依赖，做到了所有系统服务并发启动。对于用户自定义的服务，Systemd 允许配置其启动依赖项目，从而确保服务按必要的顺序运行。</p>
<ol>
<li>使用 CGroup 跟踪和管理进程的生命周期</li>
</ol>
<p>在 Systemd 之间的主流应用管理服务都是使用 进程树 来跟踪应用的继承关系的，而进程的父子关系很容易通过 两次 fork 的方法脱离。</p>
<p>而 Systemd 则提供通过 CGroup 跟踪进程关系，引补了这个缺漏。通过 CGroup 不仅能够实现服务之间访问隔离，限制特定应用程序对系统资源的访问配额，还能更精确地管理服务的生命周期。</p>
<ol>
<li>统一管理服务日志</li>
</ol>
<p>Systemd 是一系列工具的集合， 包括了一个专用的系统日志管理服务：Journald。这个服务的设计初衷是克服现有 Syslog 服务的日志内容易伪造和日志格式不统一等缺点，Journald 用 二进制格式 保存所有的日志信息，因而日志内容很难被手工伪造。Journald 还提供了一个 journalctl 命令来查看日志信息，这样就使得不同服务输出的日志具有相同的排版格式， 便于数据的二次处理。</p>
<h2 id="systemd-架构">Systemd 架构</h2>
<p><img src="./%E7%AE%80%E8%BF%B0systemd.assets/bg2016030703.png" alt="img"></p>
<h1 id="unit-文件">Unit 文件</h1>
<p>前面说到Systemd 可以管理所有系统资源，那它所管理不同的资源统称为 Unit（单位）。</p>
<p>在 Systemd 的生态圈中，Unit 文件统一了过去各种不同系统资源配置格式，例如服务的启/停、定时任务、设备自动挂载、网络配置、虚拟内存配置等。而 Systemd <strong>通过不同的文件后缀</strong>来区分这些配置文件。</p>
<ol>
<li><strong>Systemd 支持的 12 种 Unit 文件类型</strong></li>
</ol>
<ul>
<li>.automount：用于控制自动挂载文件系统，相当于 SysV-init 的 autofs 服务</li>
<li>.device：对于 /dev 目录下的设备，主要用于定义设备之间的依赖关系</li>
<li>.mount：定义系统结构层次中的一个挂载点，可以替代过去的 /etc/fstab 配置文件</li>
<li>.path：用于监控指定目录或文件的变化，并触发其它 Unit 运行</li>
<li>.scope：这种 Unit 文件不是用户创建的，而是 Systemd 运行时产生的，描述一些系统服务的分组信息</li>
<li>.<strong>service</strong>：封装守护进程的启动、停止、重启和重载操作，是最常见的一种 Unit 文件</li>
<li>.slice：用于表示一个 CGroup 的树，通常用户不会自己创建这样的 Unit 文件</li>
<li>.snapshot：用于表示一个由 systemctl snapshot 命令创建的 Systemd Units 运行状态快照</li>
<li>.socket：监控来自于系统或网络的数据消息，用于实现基于数据自动触发服务启动</li>
<li>.swap：定义一个用户做虚拟内存的交换分区</li>
<li>.target：用于对 Unit 文件进行逻辑分组，引导其它 Unit 的执行。它替代了 SysV-init 运行级别的作用，并提供更灵活的基于特定设备事件的启动方式</li>
<li>.timer：用于配置在特定时间触发的任务，替代了 Crontab 的功能</li>
</ul>
<ol start="2">
<li><strong>Systemd 目录</strong></li>
</ol>
<p>Unit 文件按照 Systemd 约定，应该被放置指定的三个系统目录之一中。这三个目录是有优先级的，如下所示，越靠上的优先级越高。因此，在三个目录中有同名文件的时候，只有优先级最高的目录里的那个文件会被使用。</p>
<ul>
<li>
<p><code>/etc/systemd/system</code>：系统或用户自定义的配置文件</p>
</li>
<li>
<p><code>/run/systemd/system</code>：软件运行时生成的配置文件</p>
</li>
<li>
<p><code>/usr/lib/systemd/system</code>：系统或第三方软件安装时添加的配置文件。</p>
<blockquote>
<p>CentOS 7：Unit 文件指向该目录</p>
<p>ubuntu 16：被移到了 /lib/systemd/system</p>
</blockquote>
</li>
</ul>
<p>Systemd 默认从目录 /etc/systemd/system/ 读取配置文件。但是，里面存放的大部分文件都是符号链接，指向目录 /usr/lib/systemd/system/，真正的配置文件存放在那个目录。</p>
<ol start="3">
<li><strong>Unit 和 Target</strong></li>
</ol>
<p>Unit 是 Systemd 管理系统资源的基本单元，可以认为每个系统资源就是一个 Unit，并使用一个 Unit 文件定义。在 Unit 文件中需要包含相应服务的描述、属性以及需要运行的命令。</p>
<p>Target 是 Systemd 中用于指定系统资源启动组的方式，相当于 SysV-init 中的运行级别。</p>
<p>简单说，Target 就是一个 Unit 组，包含许多相关的 Unit 。启动某个 Target 的时候，Systemd 就会启动里面所有的 Unit。从这个意义上说，Target 这个概念类似于”状态点”，启动某个 Target 就好比启动到某种状态。</p>
<h1 id="unit-内容">Unit 内容</h1>
<h2 id="unit-文件结构">Unit 文件结构</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>Unit<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Description<span style="color:#f92672">=</span>Hello World
</span></span><span style="display:flex;"><span>After<span style="color:#f92672">=</span>docker.service
</span></span><span style="display:flex;"><span>Requires<span style="color:#f92672">=</span>docker.service
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Service<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>TimeoutStartSec<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>ExecStartPre<span style="color:#f92672">=</span>-/usr/bin/docker kill busybox1
</span></span><span style="display:flex;"><span>ExecStartPre<span style="color:#f92672">=</span>-/usr/bin/docker rm busybox1
</span></span><span style="display:flex;"><span>ExecStartPre<span style="color:#f92672">=</span>/usr/bin/docker pull busybox
</span></span><span style="display:flex;"><span>ExecStart<span style="color:#f92672">=</span>/usr/bin/docker run --name busybox1 busybox /bin/ sh -c <span style="color:#e6db74">&#34;while true; do echo Hello World; sleep 1; done&#34;</span>
</span></span><span style="display:flex;"><span>ExecStop<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/usr/bin/docker stop busybox1&#34;</span>
</span></span><span style="display:flex;"><span>ExecStopPost<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/usr/bin/docker rm busybox1&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Install<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>WantedBy<span style="color:#f92672">=</span>multi-user.target
</span></span></code></pre></div><p>如上所示，Systemd 服务的 Unit 文件可以分为三个配置区段：</p>
<ul>
<li>Unit 和 Install 段：所有 Unit 文件通用，用于配置服务（或其它系统资源）的描述、依赖和随系统启动的方式</li>
<li>Service 段：服务（Service）类型的 Unit 文件（后缀为 .service）特有的，用于定义服务的具体管理和操作方法</li>
</ul>
<h3 id="unit-段">Unit 段</h3>
<ul>
<li>Description：描述这个 Unit 文件的信息</li>
<li>Documentation：指定服务的文档，可以是一个或多个文档的 URL 路径</li>
<li>Requires：依赖的其它 Unit 列表(有多个unit 用空格 隔开, 以下参数均适用)，列在其中的 Unit 模板会在这个服务启动时的同时被启动。并且，如果其中任意一个服务启动失败，这个服务也会被终止</li>
<li>Wants：与 Requires 相似，但只是在被配置的这个 Unit 启动时，触发启动列出的每个 Unit 模块，而不去考虑这些模板启动是否成功</li>
<li>After：与 Requires 相似，但是在后面列出的所有模块全部启动完成以后，才会启动当前的服务</li>
<li>Before：与 After 相反，在启动指定的任务一个模块之间，都会首先确证当前服务已经运行</li>
<li>BindsTo：与 Requires 相似，失败时失败，成功时成功，但是在这些模板中有任意一个出现意外结束或重启时，这个服务也会跟着终止或重启</li>
<li>PartOf：一个 Bind To 作用的子集，仅在列出的任务模块失败或重启时，终止或重启当前服务，而不会随列出模板的启动而启动</li>
<li>OnFailure：当这个模板启动失败时，就会自动启动列出的每个模块</li>
<li>Conflicts：与这个模块有冲突的模块，如果列出的模块中有已经在运行的，这个服务就不能启动，反之亦然</li>
</ul>
<h3 id="install-段">Install 段</h3>
<p>这部分配置的目标模块通常是特定运行目标的 .target 文件，用来使得服务在系统启动时自动运行。这个区段可以包含三种启动约束：</p>
<ul>
<li>WantedBy：和 Unit 段的 Wants 作用相似，只有后面列出的不是服务所依赖的模块，而是依赖当前服务的模块。它的值是一个或多个 Target，当前 Unit 激活时（enable）符号链接会放入 /etc/systemd/system 目录下面以 &lt;Target 名&gt; + .wants 后缀构成的子目录中，如 <code>/etc/systemd/system/multi-user.target.wants/</code></li>
<li>RequiredBy：和 Unit 段的 Wants 作用相似，只有后面列出的不是服务所依赖的模块，而是依赖当前服务的模块。它的值是一个或多个 Target，当前 Unit 激活时，符号链接会放入 /etc/systemd/system 目录下面以 &lt;Target 名&gt; + .required 后缀构成的子目录中</li>
<li>Also：当前 Unit enable/disable 时，同时 enable/disable 的其他 Unit</li>
<li>Alias：当前 Unit 可用于启动的别名</li>
</ul>
<h3 id="service-段">Service 段</h3>
<p>用来 Service 的配置，只有 Service 类型的 Unit 才有这个区块。它的主要字段分为服务生命周期和服务上下文配置两个方面。</p>
<ol>
<li><strong>服务生命周期控制相关</strong></li>
</ol>
<ul>
<li>
<p>Type：定义启动时的进程行为，它有以下几种值：</p>
<ul>
<li>
<p>Type=simple：默认值，执行ExecStart指定的命令，启动主进程</p>
</li>
<li>
<p>Type=forking：以 fork 方式从父进程创建子进程，创建后父进程会立即退出</p>
</li>
<li>
<p>Type=oneshot：一次性进程，Systemd 会等当前服务退出，再继续往下执行</p>
</li>
<li>
<p>Type=dbus：当前服务通过D-Bus启动</p>
</li>
<li>
<p>Type=notify：当前服务启动完毕，会通知Systemd，再继续往下执行</p>
</li>
<li>
<p>Type=idle：若有其他任务执行完毕，当前服务才会运行</p>
<blockquote>
<p>type 常用的是simple和forking, 他们不能混用,</p>
<p>simple适用于前台执行的命令, 例如启动Redis, RocketMQ</p>
<p>fork适用于后台执行的命令, 有守护进程的, 例如Nginx</p>
<p><a href="https://www.junmajinlong.com/linux/systemd/service_2/">systemd service 之：服务配置文件编写 (2) | 骏马金龙 (junmajinlong.com)</a></p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>RemainAfterExit：值为 true 或 false（默认）。当配置为 true 时，Systemd 只会负责启动服务进程，之后即便服务进程退出了，Systemd 也仍然会认为这个服务还在运行中。这个配置主要是提供给一些并非常驻内存，而是启动注册后立即退出，然后等待消息按需启动的特殊类型服务使用的。</p>
</li>
<li>
<p>ExecStart：启动当前服务的命令</p>
</li>
<li>
<p>ExecStartPre：启动当前服务之前执行的命令</p>
</li>
<li>
<p>ExecStartPost：启动当前服务之后执行的命令</p>
</li>
<li>
<p>ExecReload：重启当前服务时执行的命令</p>
</li>
<li>
<p>ExecStop：停止当前服务时执行的命令</p>
</li>
<li>
<p>ExecStopPost：停止当其服务之后执行的命令</p>
</li>
<li>
<p>RestartSec：自动重启当前服务间隔的秒数</p>
</li>
<li>
<p>Restart：定义何种情况 Systemd 会自动重启当前服务，可能的值包括 always（总是重启）、on-success、on-failure、on-abnormal、on-abort、on-watchdog</p>
</li>
<li>
<p>TimeoutStartSec：启动服务时等待的秒数，这一配置对于使用 Docker <a href="https://cloud.tencent.com/product/tke?from_column=20421&amp;from=20421">容器</a>而言显得尤为重要，因其第一次运行时可能需要下载镜像，严重延时会容易被 Systemd 误判为启动失败杀死。通常，对于这种服务，将此值指定为 0，从而关闭超时检测</p>
</li>
<li>
<p>TimeoutStopSec：停止服务时的等待秒数，如果超过这个时间仍然没有停止，Systemd 会使用 SIGKILL 信号强行杀死服务的进程</p>
</li>
</ul>
<ol start="2">
<li><strong>服务上下文配置相关</strong></li>
</ol>
<ul>
<li>Environment：为服务指定环境变量</li>
<li>EnvironmentFile：指定加载一个包含服务所需的环境变量的列表的文件，文件中的每一行都是一个环境变量的定义</li>
<li>Nice：服务的进程优先级，值越小优先级越高，默认为 0。其中 -20 为最高优先级，19 为最低优先级</li>
<li>WorkingDirectory：指定服务的工作目录</li>
<li>RootDirectory：指定服务进程的根目录（/ 目录）。如果配置了这个参数，服务将无法访问指定目录以外的任何文件</li>
<li>User：指定运行服务的用户</li>
<li>Group：指定运行服务的用户组</li>
<li>MountFlags：服务的 Mount Namespace 配置，会影响进程上下文中挂载点的信息，即服务是否会继承主机上已有挂载点，以及如果服务运行执行了挂载或卸载设备的操作，是否会真实地在主机上产生效果。可选值为 shared、slaved 或 private
<ul>
<li>shared：服务与主机共用一个 Mount Namespace，继承主机挂载点，且服务挂载或卸载设备会真实地反映到主机上</li>
<li>slave：服务使用独立的 Mount Namespace，它会继承主机挂载点，但服务对挂载点的操作只有在自己的 Namespace 内生效，不会反映到主机上</li>
<li>private：服务使用独立的 Mount Namespace，它在启动时没有任何任何挂载点，服务对挂载点的操作也不会反映到主机上</li>
</ul>
</li>
<li>LimitCPU / LimitSTACK / LimitNOFILE / LimitNPROC 等：限制特定服务的系统资源量，例如 CPU、程序堆栈、文件句柄数量、子进程数量等</li>
</ul>
<blockquote>
<p>注意：如果在 ExecStart、ExecStop 等属性中使用了 <strong>Linux 命令，则必须要写出完整的绝对路径</strong>。对于 ExecStartPre 和 ExecStartPost 辅助命令，若前面有个 “-” 符号，表示忽略这些命令的出错。因为有些 “辅助” 命令本来就不一定成功，比如尝试清空一个文件，但文件可能不存在。</p>
</blockquote>
<h2 id="unit-文件占位符和模板">Unit 文件占位符和模板</h2>
<h3 id="unit-模板">Unit 模板</h3>
<p>在现实中，往往有一些应用需要被复制多份运行。例如，用于同一个负载均衡器分流的多个服务实例，或者为每个 SSH 连接建立一个独立的 sshd 服务进程。它们只是一个参数的区别, 如果写很多份文件难以维护, 所以可以通过参数的方式的传入unit文件</p>
<p>Unit 模板文件的写法与普通的服务 Unit 文件基本相同，不过 Unit 模板的文件名是以 @ 符号结尾的。通过模板启动服务实例时，需要在其文件名的 @ 字符后面附加一个参数字符串。</p>
<blockquote>
<p>例如:</p>
<p>模版Unit文件: apache@.service</p>
<p>使用:  <code>systemctl start apache@8080.service</code>  # 这样就启动了一个端口是8080的服务</p>
</blockquote>
<p>apache@.service 模板, 其中 <code>%i</code> 就是占位符</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>Unit<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Description<span style="color:#f92672">=</span>My Advanced Service Template
</span></span><span style="display:flex;"><span>After<span style="color:#f92672">=</span>etcd.service docker.service
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Service<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>TimeoutStartSec<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>ExecStartPre<span style="color:#f92672">=</span>-/usr/bin/docker kill apache%i
</span></span><span style="display:flex;"><span>ExecStartPre<span style="color:#f92672">=</span>-/usr/bin/docker rm apache%i
</span></span><span style="display:flex;"><span>ExecStartPre<span style="color:#f92672">=</span>/usr/bin/docker pull coreos/apache
</span></span><span style="display:flex;"><span>ExecStart<span style="color:#f92672">=</span>/usr/bin/docker run --name apache%i -p %i:80 coreos/apache /usr/sbin/apache2ctl -D FOREGROUND
</span></span><span style="display:flex;"><span>ExecStartPost<span style="color:#f92672">=</span>/usr/bin/etcdctl set /domains/example.com/%H:%i running
</span></span><span style="display:flex;"><span>ExecStop<span style="color:#f92672">=</span>/usr/bin/docker stop apache1
</span></span><span style="display:flex;"><span>ExecStopPost<span style="color:#f92672">=</span>/usr/bin/docker rm apache1
</span></span><span style="display:flex;"><span>ExecStopPost<span style="color:#f92672">=</span>/usr/bin/etcdctl rm /domains/example.com/%H:%i
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Install<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>WantedBy<span style="color:#f92672">=</span>multi-user.target
</span></span></code></pre></div><p>Systemd 在运行服务时，<strong>总是会先尝试找到一个完整匹配的 Unit 文件，如果没有找到，才会尝试选择匹配模板</strong>。</p>
<p>例如上面的命令，System 首先会在约定的目录下寻找名为 <a href="mailto:apache@8080.service">apache@8080.service</a> 的文件，如果没有找到，而文件名中包含 @ 字符，它就会尝试去掉后缀参数匹配模板文件。对于 <a href="mailto:apache@8080.service">apache@8080.service</a>，systemd 会找到 apache@.service 模板文件，并通过这个模板文件将服务实例化。</p>
<h3 id="unit-文件占位符">Unit 文件占位符</h3>
<p>既然能传参, 有哪些占位符可以使用呢? 如下:</p>
<ul>
<li>%n：完整的 Unit 文件名字，包括 .service 后缀名</li>
<li>%p：Unit 模板文件名中 @ 符号之前的部分，不包括 @ 符号</li>
<li>%i：Unit 模板文件名中 @ 符号之后的部分，不包括 @ 符号和 .service 后缀名</li>
<li>%t：存放系统运行文件的目录，通常是 “run”</li>
<li>%u：运行服务的用户，如果 Unit 文件中没有指定，则默认为 root</li>
<li>%U：运行服务的用户 ID</li>
<li>%h：运行服务的用户 Home 目录，即 %{HOME} 环境变量的值</li>
<li>%s：运行服务的用户默认 Shell 类型，即 %{SHELL} 环境变量的值</li>
<li>%m：实际运行节点的 Machine ID，对于运行位置每个的服务比较有用</li>
<li>%b：Boot ID，这是一个随机数，每个节点各不相同，并且每次节点重启时都会改变</li>
<li>%H：实际运行节点的主机名</li>
<li>%v：内核版本，即 “uname -r” 命令输出的内容</li>
<li>%%：在 Unit 模板文件中表示一个普通的百分号</li>
</ul>
<h1 id="系统管理命令">系统管理命令</h1>
<p>前面说了这么多, 可知道Systemd 并不是一个命令，而是一组命令，涉及到系统管理的方方面面。</p>
<ul>
<li>
<p><code>systemctl</code>是 Systemd 的主命令，用于管理系统。</p>
<blockquote>
<p>几个常用命令</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>systemctl start nginx.server <span style="color:#75715e"># 依次启动定义在 Unit 文件中的 ExecStartPre、ExecStart 和 ExecStartPost 命令</span>
</span></span><span style="display:flex;"><span>systemctl status nginx.server <span style="color:#75715e"># 查看服务状态</span>
</span></span><span style="display:flex;"><span>systemctl stop nginx.server <span style="color:#75715e"># 依次停止定义在 Unit 文件中的 ExecStopPre、ExecStop 和 ExecStopPost 命令</span>
</span></span><span style="display:flex;"><span>systemctl enable nginx.server <span style="color:#75715e"># 在 /etc/systemd/system/ 建立服务的符号链接，指向 /usr/lib/systemd/system/ 中 , 并设置为服务自启动</span>
</span></span><span style="display:flex;"><span>systemctl disable nginx.server <span style="color:#75715e"># 取消服务开机启动</span>
</span></span><span style="display:flex;"><span>systemctl daemon-reload <span style="color:#75715e"># 刷新 Unit 文件, 更新unit文件后需要执行</span>
</span></span></code></pre></div></blockquote>
</li>
<li>
<p><code>systemd-analyze</code>命令用于查看启动耗时。</p>
</li>
<li>
<p><code>hostnamectl</code>命令用于查看当前主机的信息。</p>
</li>
<li>
<p><code>localectl</code>命令用于查看本地化设置。</p>
</li>
<li>
<p><code>timedatectl</code>命令用于查看当前时区设置。</p>
</li>
<li>
<p><code>loginctl</code>命令用于查看当前登录的用户。</p>
</li>
</ul>
<h2 id="日志管理">日志管理</h2>
<p>Systemd 通过其标准日志服务 Journald 提供的配套程序 journalctl 将其管理的所有后台进程打印到 std:out（即控制台）的输出重定向到了日志文件。</p>
<p>Systemd 的日志文件是二进制格式的，必须使用 Journald 提供的 journalctl 来查看，默认不带任何参数时会输出系统和所有后台进程的混合日志。</p>
<p>默认日志最大限制为所在文件系统容量的 10%，可以修改 /etc/systemd/journald.conf 中的 SystemMaxUse 来指定该最大限制。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>查看所有日志（默认情况下 ，只保存本次启动的日志）
</span></span><span style="display:flex;"><span>journalctl
</span></span></code></pre></div><p>有时候启动服务时, 报错了, 就会提示应该用什么命令查看日志</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>xiaokj01@master bin<span style="color:#f92672">]</span>$ systemctl start namesrv.service
</span></span><span style="display:flex;"><span><span style="color:#f92672">====</span> AUTHENTICATING FOR org.freedesktop.systemd1.manage-units <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>Authentication is required to manage system services or units.
</span></span><span style="display:flex;"><span>Authenticating as: xiaokj01
</span></span><span style="display:flex;"><span>Password:
</span></span><span style="display:flex;"><span><span style="color:#f92672">====</span> AUTHENTICATION COMPLETE <span style="color:#f92672">===</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Job <span style="color:#66d9ef">for</span> namesrv.service failed because a timeout was exceeded. See <span style="color:#e6db74">&#34;systemctl status namesrv.service&#34;</span> and <span style="color:#e6db74">&#34;journalctl -xe&#34;</span> <span style="color:#66d9ef">for</span> details.
</span></span></code></pre></div><h1 id="unit-案例">Unit 案例</h1>
<h2 id="nginx">nginx</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>Service<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#这里Type一定要写forking</span>
</span></span><span style="display:flex;"><span>Type<span style="color:#f92672">=</span>forking
</span></span><span style="display:flex;"><span>PIDFile<span style="color:#f92672">=</span>/usr/local/openresty/nginx/logs/nginx.pid
</span></span><span style="display:flex;"><span>ExecStartPre<span style="color:#f92672">=</span>/usr/local/openresty/nginx/sbin/nginx -t
</span></span><span style="display:flex;"><span>ExecStart<span style="color:#f92672">=</span>/usr/local/openresty/nginx/sbin/nginx
</span></span><span style="display:flex;"><span>ExecReload<span style="color:#f92672">=</span>/bin/kill -s HUP $MAINPID
</span></span><span style="display:flex;"><span>ExecStop<span style="color:#f92672">=</span>/bin/kill -s QUIT $MAINPID
</span></span><span style="display:flex;"><span>PrivateTmp<span style="color:#f92672">=</span>true
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Install<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>WantedBy<span style="color:#f92672">=</span>multi-user.target
</span></span></code></pre></div><h2 id="rocketmq">RocketMQ</h2>
<p>文件: <code>/lib/systemd/system/rocketMQ.service</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>Unit<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Description<span style="color:#f92672">=</span>rocketMq启动服务
</span></span><span style="display:flex;"><span>After<span style="color:#f92672">=</span>network.target rocketMQBroker.service
</span></span><span style="display:flex;"><span>Requires<span style="color:#f92672">=</span>rocketMQBroker.service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Service<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#这里Type一定要写simple</span>
</span></span><span style="display:flex;"><span>Type<span style="color:#f92672">=</span>simple
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ExecStart和ExecStop分别在systemctl start和systemctl stop时候调动</span>
</span></span><span style="display:flex;"><span>ExecStart<span style="color:#f92672">=</span>/home/xiaokj01/soft/rocketmq-all-4.8.0-bin-release/bin/mqnamesrv
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ExecStop<span style="color:#f92672">=</span>/home/xiaokj01/soft/rocketmq-all-4.8.0-bin-release/bin/mqshutdown namesrv
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Install<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>WantedBy<span style="color:#f92672">=</span>multi-user.target
</span></span></code></pre></div><p>文件: <code>/lib/systemd/system/rocketMQBroker.service</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>Unit<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Description<span style="color:#f92672">=</span>rocketMq的broker服务
</span></span><span style="display:flex;"><span>After<span style="color:#f92672">=</span>network.target
</span></span><span style="display:flex;"><span>BindsTo<span style="color:#f92672">=</span>rocketMQ.service
</span></span><span style="display:flex;"><span>Before<span style="color:#f92672">=</span>rocketMQ.service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Service<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#这里Type一定要写simple</span>
</span></span><span style="display:flex;"><span>Type<span style="color:#f92672">=</span>simple
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ExecStart和ExecStop分别在systemctl start和systemctl stop时候调动</span>
</span></span><span style="display:flex;"><span>ExecStart<span style="color:#f92672">=</span>/home/xiaokj01/soft/rocketmq-all-4.8.0-bin-release/bin/mqbroker -c /home/xiaokj01/soft/rocketmq-all-4.8.0-bin-release/conf/broker.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ExecStop<span style="color:#f92672">=</span>/home/xiaokj01/soft/rocketmq-all-4.8.0-bin-release/bin/mqshutdown broker
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Install<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>WantedBy<span style="color:#f92672">=</span>multi-user.target
</span></span></code></pre></div><p>这里把 broker和nameserver 做了依赖关系, 启动 <code>rocketMQ.service</code> 文件 就可以一键启动 MQ</p>
<blockquote>
<p>这里只做了 单nameserver和单broker的场景, 如果需要做集群处理, 应该可以使用模版的方式, 把参数传进去可以实现</p>
<p>如果不想一键启动, 分开使用(毕竟集群部署下, nameserver和broker不一定会放在一起), 把<code>After</code>, <code>BindsTo</code> 等限制条件删除就行</p>
</blockquote>
<p><a href="https://blog.csdn.net/ccgshigao/article/details/111879570">RocketMQ系列：使用systemd管理nameserver和broker_rocketmq systemd_公众号-测试生财的博客-CSDN博客</a></p>
<p><a href="https://cloud.tencent.com/developer/article/1516125">可能是史上最全面易懂的 Systemd 服务管理教程 &mdash;-全面但错误单词较多</a></p>
<p><a href="https://ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html">Systemd 入门教程：命令篇 - 阮一峰的网络日志 (ruanyifeng.com)</a></p>
<p><a href="https://www.junmajinlong.com/linux/systemd/service_2/">systemd service 之：服务配置文件编写 (2) | 骏马金龙 (junmajinlong.com)</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/419372683">干货分享 | Systemd 技术原理&amp;实践（上） - 知乎 (zhihu.com)</a></p>
<p>八卦: <a href="https://www.zhihu.com/question/25873473">systemd 为什么会有那么大的争议？ - 知乎 (zhihu.com)</a></p>

              


            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
            
            
<div class="post-actions-wrap">
  <nav >
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://xiaokunji.github.io/myBlog/post/linux%E7%B3%BB%E7%BB%9F/%E5%85%AC%E5%85%B1%E9%83%A8%E5%88%86%E6%9A%82%E5%AE%9A/shell/shell%E6%A1%88%E4%BE%8B/" data-tooltip="" aria-label="NEXT: ">
          
              <i class="fa fa-angle-left"></i>
              <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
            </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://xiaokunji.github.io/myBlog/post/linux%E7%B3%BB%E7%BB%9F/%E5%85%AC%E5%85%B1%E9%83%A8%E5%88%86%E6%9A%82%E5%AE%9A/%E7%B3%BB%E7%BB%9F%E7%BA%A7%E5%91%BD%E4%BB%A4/" data-tooltip="" aria-label="PREVIOUS: ">
          
              <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
              <i class="fa fa-angle-right"></i>
            </a>
        </li>
      
    </ul>
  </nav>
<ul class="post-actions post-action-share" >
  
    <li class="post-action hide-lg hide-md hide-sm">
      <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
        <i class="fa fa-share-alt" aria-hidden="true"></i>
      </a>
    </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://xiaokunji.github.io/myBlog/post/linux%E7%B3%BB%E7%BB%9F/%E5%85%AC%E5%85%B1%E9%83%A8%E5%88%86%E6%9A%82%E5%AE%9A/%E7%AE%80%E8%BF%B0systemd/" title="Share on Facebook" aria-label="Share on Facebook">
          <i class="fab fa-facebook-square" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://xiaokunji.github.io/myBlog/post/linux%E7%B3%BB%E7%BB%9F/%E5%85%AC%E5%85%B1%E9%83%A8%E5%88%86%E6%9A%82%E5%AE%9A/%E7%AE%80%E8%BF%B0systemd/" title="Share on Twitter" aria-label="Share on Twitter">
          <i class="fab fa-twitter" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/sharing/share-offsite/?url=https://xiaokunji.github.io/myBlog/post/linux%E7%B3%BB%E7%BB%9F/%E5%85%AC%E5%85%B1%E9%83%A8%E5%88%86%E6%9A%82%E5%AE%9A/%E7%AE%80%E8%BF%B0systemd/" title="Share on Linkedin" aria-label="Share on Linkedin">
          <i class="fab fa-linkedin" aria-hidden="true"></i>
        </a>
      </li>
    
  
  
    <li class="post-action">
      <a class="post-action-btn btn btn--default" href="#disqus_thread" aria-label="Leave a comment">
        <i class="far fa-comment"></i>
      </a>
    </li>
  
  <li class="post-action">
    
      <a class="post-action-btn btn btn--default" href="#top" aria-label="Back to top">
      <i class="fa fa-arrow-up" aria-hidden="true"></i>
    
    </a>
  </li>
</ul>
</div>


            
  
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
    <script type="text/javascript">
      var disqus_config = function() {
        this.page.url = 'https:\/\/xiaokunji.github.io\/myBlog\/post\/linux%E7%B3%BB%E7%BB%9F\/%E5%85%AC%E5%85%B1%E9%83%A8%E5%88%86%E6%9A%82%E5%AE%9A\/%E7%AE%80%E8%BF%B0systemd\/';
        
          this.page.identifier = '\/post\/linux%E7%B3%BB%E7%BB%9F\/%E5%85%AC%E5%85%B1%E9%83%A8%E5%88%86%E6%9A%82%E5%AE%9A\/%E7%AE%80%E8%BF%B0systemd\/'
        
      };
      (function() {
        
        
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
          document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
          return;
        }
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        var disqus_shortname = 'hugo-tranquilpeak-theme';
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
  


          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2023 Firstname Lastname. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
<div class="post-actions-wrap">
  <nav >
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://xiaokunji.github.io/myBlog/post/linux%E7%B3%BB%E7%BB%9F/%E5%85%AC%E5%85%B1%E9%83%A8%E5%88%86%E6%9A%82%E5%AE%9A/shell/shell%E6%A1%88%E4%BE%8B/" data-tooltip="" aria-label="NEXT: ">
          
              <i class="fa fa-angle-left"></i>
              <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
            </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://xiaokunji.github.io/myBlog/post/linux%E7%B3%BB%E7%BB%9F/%E5%85%AC%E5%85%B1%E9%83%A8%E5%88%86%E6%9A%82%E5%AE%9A/%E7%B3%BB%E7%BB%9F%E7%BA%A7%E5%91%BD%E4%BB%A4/" data-tooltip="" aria-label="PREVIOUS: ">
          
              <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
              <i class="fa fa-angle-right"></i>
            </a>
        </li>
      
    </ul>
  </nav>
<ul class="post-actions post-action-share" >
  
    <li class="post-action hide-lg hide-md hide-sm">
      <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
        <i class="fa fa-share-alt" aria-hidden="true"></i>
      </a>
    </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://xiaokunji.github.io/myBlog/post/linux%E7%B3%BB%E7%BB%9F/%E5%85%AC%E5%85%B1%E9%83%A8%E5%88%86%E6%9A%82%E5%AE%9A/%E7%AE%80%E8%BF%B0systemd/" title="Share on Facebook" aria-label="Share on Facebook">
          <i class="fab fa-facebook-square" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://xiaokunji.github.io/myBlog/post/linux%E7%B3%BB%E7%BB%9F/%E5%85%AC%E5%85%B1%E9%83%A8%E5%88%86%E6%9A%82%E5%AE%9A/%E7%AE%80%E8%BF%B0systemd/" title="Share on Twitter" aria-label="Share on Twitter">
          <i class="fab fa-twitter" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/sharing/share-offsite/?url=https://xiaokunji.github.io/myBlog/post/linux%E7%B3%BB%E7%BB%9F/%E5%85%AC%E5%85%B1%E9%83%A8%E5%88%86%E6%9A%82%E5%AE%9A/%E7%AE%80%E8%BF%B0systemd/" title="Share on Linkedin" aria-label="Share on Linkedin">
          <i class="fab fa-linkedin" aria-hidden="true"></i>
        </a>
      </li>
    
  
  
    <li class="post-action">
      <a class="post-action-btn btn btn--default" href="#disqus_thread" aria-label="Leave a comment">
        <i class="far fa-comment"></i>
      </a>
    </li>
  
  <li class="post-action">
    
      <a class="post-action-btn btn btn--default" href="#top" aria-label="Back to top">
      <i class="fa fa-arrow-up" aria-hidden="true"></i>
    
    </a>
  </li>
</ul>
</div>


      </div>
      
<div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-times"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fxiaokunji.github.io%2FmyBlog%2Fpost%2Flinux%25E7%25B3%25BB%25E7%25BB%259F%2F%25E5%2585%25AC%25E5%2585%25B1%25E9%2583%25A8%25E5%2588%2586%25E6%259A%2582%25E5%25AE%259A%2F%25E7%25AE%2580%25E8%25BF%25B0systemd%2F" aria-label="Share on Facebook">
          <i class="fab fa-facebook-square" aria-hidden="true"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https%3A%2F%2Fxiaokunji.github.io%2FmyBlog%2Fpost%2Flinux%25E7%25B3%25BB%25E7%25BB%259F%2F%25E5%2585%25AC%25E5%2585%25B1%25E9%2583%25A8%25E5%2588%2586%25E6%259A%2582%25E5%25AE%259A%2F%25E7%25AE%2580%25E8%25BF%25B0systemd%2F" aria-label="Share on Twitter">
          <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fxiaokunji.github.io%2FmyBlog%2Fpost%2Flinux%25E7%25B3%25BB%25E7%25BB%259F%2F%25E5%2585%25AC%25E5%2585%25B1%25E9%2583%25A8%25E5%2588%2586%25E6%259A%2582%25E5%25AE%259A%2F%25E7%25AE%2580%25E8%25BF%25B0systemd%2F" aria-label="Share on Linkedin">
          <i class="fab fa-linkedin" aria-hidden="true"></i><span>Share on Linkedin</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>


    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-times"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.gravatar.com/avatar/d09dc2d7aa5c467519e8af89f7b3d94c?s=110" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Firstname Lastname</h4>
    
      <div id="about-card-bio">Super bio with markdown support <strong>COOL</strong></div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Your job title
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker-alt"></i>
        <br/>
        France
      </div>
    
  </div>
</div>

    

    
  
    
      <div id="cover" style="background-image:url('https://xiaokunji.github.io/myBlog/images/cover.jpg');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js" integrity="sha512-z+/WWfyD5tccCukM4VvONpEtLmbAm5LDu7eKiyMQJ9m7OfPEDL7gENyDRL3Yfe8XAuGsS2fS4xSMnl6d30kqGQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script src="https://xiaokunji.github.io/js/script-yqzy9wdlzix4lbbwdnzvwx3egsne77earqmn73v9uno8aupuph8wfguccut.min.js"></script>


  
    <script async crossorigin="anonymous" defer integrity="sha512-gE8KAQyFIzV1C9+GZ8TKJHZS2s+n7EjNtC+IMRn1l5+WYJTHOODUM6JSjZhFhqXmc7bG8Av6XXpckA4tYhflnw==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/apache.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-EWROca+bote+7Oaaar1F6y74iZj1r1F9rm/ly7o+/FwJopbBaWtsFDmaKoZDd3QiGU2pGacBirHJNivmGLYrow==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/go.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-GDVzAn0wpx1yVtQsRWmFc6PhJiLBPdUic+h4GWgljBh904O3JU10fk9EKNpVyIoPqkFn54rgL2QBG4BmUTMpiQ==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/http.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-UgZlma8NzkrDb/NWgmLIcTrH7i/CSnLLDRFqCSNF5NGPpjKmzyM25qcoXGOup8+cDakKyaiTDd7N4dyH4YT+IA==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/less.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-lot9koe73sfXIrUvIPM/UEhuMciN56RPyBdOyZgfO53P2lkWyyXN7J+njcxIIBRV+nVDQeiWtiXg+bLAJZDTfg==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/nginx.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-Zd3e7XxHP00TD0Imr0PIfeM0fl0v95kMWuhyAS3Wn1UTSXTkz0OhtRgBAr4JlmADRgiXr4x7lpeUdqaGN8xIog==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/puppet.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-qtqDO052iXMSP+5d/aE/jMtL9vIIGvONgTJziC2K/ZIB1yEGa55WVxGE9/08rSQ62EoDifS9SWVGZ7ihSLhzMA==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/scss.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-1NmkjnEDnwwwcu28KoQF8vs3oaPFokQHbmbtwGhFfeDsQZtVFI8zW2aE9O8yMYdpdyKV/5blE4pSWw4Z/Sv97w==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/stylus.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-B2wSfruPjr8EJL6IIzQr1eAuDwrsfIfccNf/LCEdxELCgC/S/ZMt/Uvk80aD79m7IqOqW+Sw8nbkvha20yZpzg==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/swift.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer integrity="sha512-28oDiQZGKUVN6wQ7PSLPNipOcmkCALXKwOi7bnkyFf8QiMZQxG9EQoy/iiNx6Zxj2cG2SbVa4dXKigQhu7GiFw==" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/yaml.min.js"></script>
  


<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>




    
  </body>
</html>

