<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>MyCat | 米二</title><meta name=keywords content=" **1.前言**, **1.1 概念介绍:**, **1.1.1、分区**, **1.1.2、分片**, **1.1.3、分表**, **1.1.4、分库**, **2.介绍**, **2.1 什么是MyCat？**, **2.2 MyCat的目标**, **2.3 MyCat的关键特性**, **2.4 总体架构**, **2.5 术语**"><meta name=description content="     "><meta name=author content="xkj"><link rel=canonical href=https://xiaokunji.com/zh/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mycat.html><link crossorigin=anonymous href=/assets/css/stylesheet.b3faf608c544858ba700943ffe182cb647f38432d29a07d73234965beacb26f6.css integrity="sha256-s/r2CMVEhYunAJQ//hgstkfzhDLSmgfXMjSWW+rLJvY=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://xiaokunji.com/img/Q.svg><link rel=icon type=image/png sizes=16x16 href=https://xiaokunji.com/img/Q.svg><link rel=icon type=image/png sizes=32x32 href=https://xiaokunji.com/img/Q.svg><link rel=apple-touch-icon href=https://xiaokunji.com/Q.svg><link rel=mask-icon href=https://xiaokunji.com/Q.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://xiaokunji.com/zh/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mycat.html><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="MyCat"><meta property="og:description" content="     "><meta property="og:type" content="article"><meta property="og:url" content="https://xiaokunji.com/zh/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mycat.html"><meta property="article:section" content="数据库"><meta property="article:published_time" content="2023-08-22T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-27T17:15:13+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="MyCat"><meta name=twitter:description content="     "><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":4,"name":"MyCat","item":"https://xiaokunji.com/zh/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mycat.html"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"MyCat","name":"MyCat","description":"     ","keywords":[" **1.前言**"," **1.1 概念介绍:**"," **1.1.1、分区**"," **1.1.2、分片**"," **1.1.3、分表**"," **1.1.4、分库**"," **2.介绍**"," **2.1 什么是MyCat？**"," **2.2 MyCat的目标**"," **2.3 MyCat的关键特性**"," **2.4 总体架构**"," **2.5 术语**"],"articleBody":"[toc]\n1.前言 1.1 概念介绍: 1.1.1、分区 对业务透明，分区只不过把存放数据的文件分成了许多小块，例如mysql中的一张表对应三个文件.MYD,MYI,frm。\n根据一定的规则把数据文件(MYD)和索引文件（MYI）进行了分割，分区后的表呢，还是一张表。分区可以把表分到不同的硬盘上，但不能分配到不同服务器上。\n优点：数据不存在多个副本，不必进行数据复制，性能更高。 缺点：分区策略必须经过充分考虑，避免多个分区之间的数据存在关联关系，每个分区都是单点，如果某个分区宕机，就会影响到系统的使用。 1.1.2、分片 对业务透明，在物理实现上分成多个服务器，不同的分片在不同服务器上。如HDFS。\n1.1.3、分表 同库分表：所有的分表都在一个数据库中，由于数据库中表名不能重复，因此需要把数据表名起成不同的名字。\n优点：由于都在一个数据库中，公共表，不必进行复制，处理更简单。 缺点：由于还在一个数据库中，CPU、内存、文件IO、网络IO等瓶颈还是无法解决，只能降低单表中的数据记录数。表名不一致，会导后续的处理复杂（参照mysql meage存储引擎来处理） 不同库分表：由于分表在不同的数据库中，这个时候就可以使用同样的表名。\n优点：CPU、内存、文件IO、网络IO等瓶颈可以得到有效解决，表名相同，处理起来相对简单。 缺点：公共表由于在所有的分表都要使用，因此要进行复制、同步。一些聚合的操作，join,group by,order等难以顺利进行。 1.1.4、分库 分表和分区都是基于同一个数据库里的数据分离技巧，对数据库性能有一定提升，但是随着业务数据量的增加，原来所有的数据都是在一个数据库上的，网络IO及文件IO都集中在一个数据库上的，因此CPU、内存、文件IO、网络IO都可能会成为系统瓶颈。\n当业务系统的数据容量接近或超过单台服务器的容量、QPS/TPS接近或超过单个数据库实例的处理极限等。此时，往往是采用垂直和水平结合的数据拆分方法，把数据服务和数据存储分布到多台数据库服务器上。\n分库只是一个通俗说法，更标准名称是数据分片，采用类似分布式数据库理论指导的方法实现，对应用程序达到数据服务的全透明和数据存储的全透明\n来自: https://www.cnblogs.com/ijavanese/p/9512369.html 2.介绍 2.1 什么是MyCat？ 简单的说，MyCAT就是：\n一个新颖的数据库中间件产品； 一个彻底开源的、面向企业应用开发的“大数据库集群”； 支持事务、ACID、可以替代MySQL的加强版数据库； 一个可以视为“MySQL”集群的企业级数据库，用来替代昂贵的Oracle集群； 一个融合内存缓存技术、Nosql技术、HDFS大数据的新型SQL Server； 结合传统数据库和新型分布式数据仓库的新一代企业级数据库产品。 2.2 MyCat的目标 MyCAT的目标是：低成本的将现有的单机数据库和应用平滑迁移到“云”端，解决数据存储和业务规模迅速增长情况下的数据瓶颈问题。\n2.3 MyCat的关键特性 ​ 支持 SQL 92标准\n支持Mysql集群，可以作为Proxy使用\n支持JDBC连接ORACLE、DB2、SQL Server，将其模拟为MySQL Server使用\n支持NoSQL数据库\n支持galera for mysql集群，percona-cluster或者mariadb cluster，提供高可用性数据分片集群\n自动故障切换，高可用性\n支持读写分离，支持Mysql双主多从，以及一主多从的模式\n支持全局表，数据自动分片到多个节点，用于高效表关联查询\n支持独有的基于E-R 关系的分片策略，实现了高效的表关联查询\n支持一致性Hash分片，有效解决分片扩容难题\n多平台支持，部署和实施简单\n支持Catelet开发，类似数据库存储过程，用于跨分片复杂SQL的人工智能编码实现，143行Demo完成跨分片的两个表的JION查询。\n支持NIO与AIO两种网络通信机制，Windows下建议AIO，Linux下目前建议NIO\n支持Mysql存储过程调用\n以插件方式支持SQL拦截和改写\n支持自增长主键、支持Oracle的Sequence机制\n2.4 总体架构 MyCAT的架构如下图所示：\nMyCAT使用MySQL的通讯协议模拟成一个MySQL服务器，并建立了完整的Schema（数据库）、Table （数据表）、User（用户）的逻辑模型，并将这套逻辑模型映射到后端的存储节点DataNode（MySQL Instance）上的真实物理库中，这样一来，所有能使用MySQL的客户端以及编程语言都能将MyCAT当成是MySQLServer来使用，不必开发新的客户端协议。\n当MyCAT收到一个客户端发送的SQL请求时，会先对SQL进行语法分析和检查，分析的结果用于SQL路由，SQL路由策略支持传统的基于表格的分片字段方式进行分片，也支持独有的基于数据库E-R关系的分片策略，对于路由到多个数据节点（DataNode）的SQL，则会对收到的数据集进行“归并”然后输出到客户端。\nSQL执行的过程，简单的说，就是把SQL通过网络协议发送给后端的真正的数据库上进行执行，对于MySQL Server来说，是通过MySQL网络协议发送报文，并解析返回的结果，若SQL不涉及到多个分片节点，则直接返回结果，写入客户端的SOCKET流中，这个过程是非阻塞模式（NIO）。\nDataNode是MyCAT的逻辑数据节点，映射到后端的某一个物理数据库的一个Database，为了做到系统高可用，每个DataNode可以配置多个引用地址（DataSource），当主DataSource被检测为不可用时，系统会自动切换到下一个可用的DataSource上，这里的DataSource即可认为是Mysql的主从服务器的地址。\n2.5 术语 与任何一个传统的关系型数据库一样，MyCAT也提供了“数据库”的定义，并有用户授权的功能，下面是MyCAT逻辑库相关的一些概念：\nschema:逻辑库，与MySQL中的Database（数据库）对应，一个逻辑库中定义了所包括的Table。 table：表，即物理数据库中存储的某一张表，与传统数据库不同，这里的表格需要声明其所存储的逻辑数据节点DataNode，这是通过表格的分片规则定义来实现的，table可以定义其所属的“子表(childTable)”，子表的分片依赖于与“父表”的具体分片地址，简单的说，就是属于父表里某一条记录A的子表的所有记录都与A存储在同一个分片上。 分片规则：是一个字段与函数的捆绑定义，根据这个字段的取值来返回所在存储的分片（DataNode）的序号，每个表格可以定义一个分片规则，分片规则可以灵活扩展，默认提供了基于数字的分片规则，字符串的分片规则等。 dataNode: MyCAT的逻辑数据节点，是存放table的具体物理节点，也称之为分片节点，通过DataSource来关联到后端某个具体数据库上，一般来说，为了高可用性，每个DataNode都设置两个DataSource，一主一从，当主节点宕机，系统自动切换到从节点。 dataHost：定义某个物理库的访问地址，用于捆绑到dataNode上。 MyCAT目前通过配置文件的方式来定义逻辑库和相关配置：\nMYCAT_HOME/conf/schema.xml中定义逻辑库，表、分片节点等内容； MYCAT_HOME/conf/rule.xml中定义分片规则； MYCAT_HOME/conf/server.xml中定义用户以及系统相关变量，如端口等。下图给出了MyCAT 一个可能的逻辑库到物理库（MySQL的完整映射关系），可以看出其强大的分片能力以及灵活的Mysql集群整合能力。 ","wordCount":"3069","inLanguage":"zh","datePublished":"2023-08-22T00:00:00Z","dateModified":"2023-08-27T17:15:13.620831474Z","author":{"@type":"Person","name":"xkj"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://xiaokunji.com/zh/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/mycat.html"},"publisher":{"@type":"Organization","name":"米二","logo":{"@type":"ImageObject","url":"https://xiaokunji.com/img/Q.svg"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://xiaokunji.com/zh/ accesskey=h title="米二 (Alt + H)"><img src=https://xiaokunji.com/img/Q.svg alt aria-label=logo height=35>米二</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://xiaokunji.com/en/ title=English aria-label=English>English</a></li></ul></div></div><ul id=menu><li><a href=https://xiaokunji.com/zh/ title=🏠主页><span>🏠主页</span></a></li><li><a href=https://xiaokunji.com/zh/search.html title="🔍搜索 (Alt + /)" accesskey=/><span>🔍搜索</span></a></li><li><a href=https://xiaokunji.com/zh/post.html title=📚文章><span>📚文章</span></a></li><li><a href=https://xiaokunji.com/zh/archives.html title=⏱时间轴><span>⏱时间轴</span></a></li><li><a href=https://xiaokunji.com/zh/tags.html title=🔖标签><span>🔖标签</span></a></li><li><a href=https://xiaokunji.com/zh/categories.html title=📖分类><span>📖分类</span></a></li><li><a href=https://xiaokunji.com/zh/links.html title=🤝友链><span>🤝友链</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><nav aria-label=breadcrumb><ul><a href=https://xiaokunji.com/zh/>🏠</a> <span>></span>
<a href=https://xiaokunji.com/zh/%E6%95%B0%E6%8D%AE%E5%BA%93.html>数据库</a> <span>></span>
<a href=https://xiaokunji.com/zh/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql.html>MySQL</a> <span>></span></ul></nav><h1 class=post-title>MyCat</h1><div class=post-description></div><div class=post-meta><span title='2023-08-22 00:00:00 +0000 UTC'>2023-08-22</span>&nbsp;·&nbsp;7 分钟&nbsp;·&nbsp;xkj
&nbsp;|&nbsp;分类: &nbsp;<ul class=post-categories-meta><a href=https://xiaokunji.com/zh/categories/%E6%95%B0%E6%8D%AE%E5%BA%93.html>数据库</a></ul><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<span id=busuanzi_container_page_pv>&nbsp;| 访问: <span id=busuanzi_value_page_pv></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#1%e5%89%8d%e8%a8%80 aria-label=1.前言><strong>1.前言</strong></a><ul><li><a href=#11-%e6%a6%82%e5%bf%b5%e4%bb%8b%e7%bb%8d aria-label="1.1 概念介绍:"><strong>1.1 概念介绍:</strong></a><ul><li><a href=#111%e5%88%86%e5%8c%ba aria-label=1.1.1、分区><strong>1.1.1、分区</strong></a></li><li><a href=#112%e5%88%86%e7%89%87 aria-label=1.1.2、分片><strong>1.1.2、分片</strong></a></li><li><a href=#113%e5%88%86%e8%a1%a8 aria-label=1.1.3、分表><strong>1.1.3、分表</strong></a></li><li><a href=#114%e5%88%86%e5%ba%93 aria-label=1.1.4、分库><strong>1.1.4、分库</strong></a></li></ul></li></ul></li><li><a href=#2%e4%bb%8b%e7%bb%8d aria-label=2.介绍><strong>2.介绍</strong></a><ul><li><a href=#21-%e4%bb%80%e4%b9%88%e6%98%afmycat aria-label="2.1 什么是MyCat？"><strong>2.1 什么是MyCat？</strong></a></li><li><a href=#22-mycat%e7%9a%84%e7%9b%ae%e6%a0%87 aria-label="2.2 MyCat的目标"><strong>2.2 MyCat的目标</strong></a></li><li><a href=#23-mycat%e7%9a%84%e5%85%b3%e9%94%ae%e7%89%b9%e6%80%a7 aria-label="2.3 MyCat的关键特性"><strong>2.3 MyCat的关键特性</strong></a></li><li><a href=#24-%e6%80%bb%e4%bd%93%e6%9e%b6%e6%9e%84 aria-label="2.4 总体架构"><strong>2.4 总体架构</strong></a></li><li><a href=#25-%e6%9c%af%e8%af%ad aria-label="2.5 术语"><strong>2.5 术语</strong></a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>[toc]</p><h1 id=1前言><strong>1.前言</strong><a hidden class=anchor aria-hidden=true href=#1前言>#</a></h1><h2 id=11-概念介绍><strong>1.1 概念介绍:</strong><a hidden class=anchor aria-hidden=true href=#11-概念介绍>#</a></h2><h3 id=111分区><strong>1.1.1、分区</strong><a hidden class=anchor aria-hidden=true href=#111分区>#</a></h3><p>　　对业务透明，分区只不过把存放数据的文件分成了许多小块，例如mysql中的一张表对应三个文件.MYD,MYI,frm。</p><p>根据一定的规则把数据文件(MYD)和索引文件（MYI）进行了分割，分区后的表呢，还是一张表。分区可以把表分到不同的硬盘上，但不能分配到不同服务器上。</p><ul><li>优点：数据不存在多个副本，不必进行数据复制，性能更高。</li><li>缺点：分区策略必须经过充分考虑，避免多个分区之间的数据存在关联关系，每个分区都是单点，如果某个分区宕机，就会影响到系统的使用。</li></ul><h3 id=112分片><strong>1.1.2、分片</strong><a hidden class=anchor aria-hidden=true href=#112分片>#</a></h3><p>　　对业务透明，在物理实现上分成多个服务器，不同的分片在不同服务器上。如HDFS。</p><h3 id=113分表><strong>1.1.3、分表</strong><a hidden class=anchor aria-hidden=true href=#113分表>#</a></h3><p>同库分表：所有的分表都在一个数据库中，由于数据库中表名不能重复，因此需要把数据表名起成不同的名字。</p><ul><li>优点：由于都在一个数据库中，公共表，不必进行复制，处理更简单。</li><li>缺点：由于还在一个数据库中，CPU、内存、文件IO、网络IO等瓶颈还是无法解决，只能降低单表中的数据记录数。表名不一致，会导后续的处理复杂（参照mysql meage存储引擎来处理）</li></ul><p>不同库分表：由于分表在不同的数据库中，这个时候就可以使用同样的表名。</p><ul><li>优点：CPU、内存、文件IO、网络IO等瓶颈可以得到有效解决，表名相同，处理起来相对简单。</li><li>缺点：公共表由于在所有的分表都要使用，因此要进行复制、同步。一些聚合的操作，join,group by,order等难以顺利进行。</li></ul><h3 id=114分库><strong>1.1.4、分库</strong><a hidden class=anchor aria-hidden=true href=#114分库>#</a></h3><p>　　分表和分区都是基于同一个数据库里的数据分离技巧，对数据库性能有一定提升，但是随着业务数据量的增加，原来所有的数据都是在一个数据库上的，网络IO及文件IO都集中在一个数据库上的，因此CPU、内存、文件IO、网络IO都可能会成为系统瓶颈。</p><p>当业务系统的数据容量接近或超过单台服务器的容量、QPS/TPS接近或超过单个数据库实例的处理极限等。此时，往往是采用垂直和水平结合的数据拆分方法，把数据服务和数据存储分布到多台数据库服务器上。</p><p>分库只是一个通俗说法，更标准名称是数据分片，采用类似分布式数据库理论指导的方法实现，对应用程序达到数据服务的全透明和数据存储的全透明</p><blockquote><p>来自: <a href=https://www.cnblogs.com/ijavanese/p/9512369.html target=_blank rel=noopener>https://www.cnblogs.com/ijavanese/p/9512369.html</a></p></blockquote><h1 id=2介绍><strong>2.介绍</strong><a hidden class=anchor aria-hidden=true href=#2介绍>#</a></h1><h2 id=21-什么是mycat><strong>2.1 什么是MyCat？</strong><a hidden class=anchor aria-hidden=true href=#21-什么是mycat>#</a></h2><p>简单的说，MyCAT就是：</p><ul><li>一个新颖的数据库中间件产品；</li><li>一个彻底开源的、面向企业应用开发的“大数据库集群”；</li><li>支持事务、ACID、可以替代MySQL的加强版数据库；</li><li>一个可以视为“MySQL”集群的企业级数据库，用来替代昂贵的Oracle集群；</li><li>一个融合内存缓存技术、Nosql技术、HDFS大数据的新型SQL Server；</li><li>结合传统数据库和新型分布式数据仓库的新一代企业级数据库产品。</li></ul><h2 id=22-mycat的目标><strong>2.2 MyCat的目标</strong><a hidden class=anchor aria-hidden=true href=#22-mycat的目标>#</a></h2><p>MyCAT的目标是：低成本的将现有的单机数据库和应用平滑迁移到“云”端，解决数据存储和业务规模迅速增长情况下的数据瓶颈问题。</p><h2 id=23-mycat的关键特性><strong>2.3 MyCat的关键特性</strong><a hidden class=anchor aria-hidden=true href=#23-mycat的关键特性>#</a></h2><ul><li><p>​ 支持 SQL 92标准</p><p>支持Mysql集群，可以作为Proxy使用</p><p>支持JDBC连接ORACLE、DB2、SQL Server，将其模拟为MySQL Server使用</p><p>支持NoSQL数据库</p><p>支持galera for mysql集群，percona-cluster或者mariadb cluster，提供高可用性数据分片集群</p><p>自动故障切换，高可用性</p><p>支持读写分离，支持Mysql双主多从，以及一主多从的模式</p><p>支持全局表，数据自动分片到多个节点，用于高效表关联查询</p><p>支持独有的基于E-R 关系的分片策略，实现了高效的表关联查询</p><p>支持一致性Hash分片，有效解决分片扩容难题</p><p>多平台支持，部署和实施简单</p><p>支持Catelet开发，类似数据库存储过程，用于跨分片复杂SQL的人工智能编码实现，143行Demo完成跨分片的两个表的JION查询。</p><p>支持NIO与AIO两种网络通信机制，Windows下建议AIO，Linux下目前建议NIO</p><p>支持Mysql存储过程调用</p><p>以插件方式支持SQL拦截和改写</p><p>支持自增长主键、支持Oracle的Sequence机制</p></li></ul><h2 id=24-总体架构><strong>2.4 总体架构</strong><a hidden class=anchor aria-hidden=true href=#24-总体架构>#</a></h2><p>MyCAT的架构如下图所示：</p><p><img loading=lazy src=https://gitee.com/xiaokunji/my-images/raw/master/myMD/20210711125504.png alt=img></p><p>MyCAT使用MySQL的通讯协议模拟成一个MySQL服务器，并建立了完整的Schema（数据库）、Table （数据表）、User（用户）的逻辑模型，并将这套逻辑模型映射到后端的存储节点DataNode（MySQL Instance）上的真实物理库中，这样一来，所有能使用MySQL的客户端以及编程语言都能将MyCAT当成是MySQLServer来使用，不必开发新的客户端协议。</p><p>当MyCAT收到一个客户端发送的SQL请求时，会先对SQL进行语法分析和检查，分析的结果用于SQL路由，SQL路由策略支持传统的基于表格的分片字段方式进行分片，也支持独有的基于数据库E-R关系的分片策略，对于路由到多个数据节点（DataNode）的SQL，则会对收到的数据集进行“归并”然后输出到客户端。</p><p>SQL执行的过程，简单的说，就是把SQL通过网络协议发送给后端的真正的数据库上进行执行，对于MySQL Server来说，是通过MySQL网络协议发送报文，并解析返回的结果，若SQL不涉及到多个分片节点，则直接返回结果，写入客户端的SOCKET流中，这个过程是非阻塞模式（NIO）。</p><p>DataNode是<strong>MyCAT</strong>的逻辑数据节点，映射到后端的某一个物理数据库的一个Database，为了做到系统高可用，每个DataNode可以配置多个引用地址（DataSource），当主DataSource被检测为不可用时，系统会自动切换到下一个可用的DataSource上，这里的DataSource即可认为是Mysql的主从服务器的地址。</p><h2 id=25-术语><strong>2.5 术语</strong><a hidden class=anchor aria-hidden=true href=#25-术语>#</a></h2><p>与任何一个传统的关系型数据库一样，<strong>MyCAT</strong>也提供了“数据库”的定义，并有用户授权的功能，下面是<strong>MyCAT</strong>逻辑库相关的一些概念：</p><ul><li><strong>schema</strong>:逻辑库，与MySQL中的Database（数据库）对应，一个逻辑库中定义了所包括的Table。</li><li><strong>table</strong>：表，即物理数据库中存储的某一张表，与传统数据库不同，这里的表格需要声明其所存储的逻辑数据节点DataNode，这是通过表格的分片规则定义来实现的，table可以定义其所属的“子表(childTable)”，子表的分片依赖于与“父表”的具体分片地址，简单的说，就是属于父表里某一条记录A的子表的所有记录都与A存储在同一个分片上。</li><li><strong>分片规则</strong>：是一个字段与函数的捆绑定义，根据这个字段的取值来返回所在存储的分片（DataNode）的序号，每个表格可以定义一个分片规则，分片规则可以灵活扩展，默认提供了基于数字的分片规则，字符串的分片规则等。</li><li><strong>dataNode</strong>: MyCAT的逻辑数据节点，是存放table的具体物理节点，也称之为分片节点，通过DataSource来关联到后端某个具体数据库上，一般来说，为了高可用性，每个DataNode都设置两个DataSource，一主一从，当主节点宕机，系统自动切换到从节点。</li><li><strong>dataHost</strong>：定义某个物理库的访问地址，用于捆绑到dataNode上。</li></ul><p><strong>MyCAT</strong>目前通过配置文件的方式来定义逻辑库和相关配置：</p><ul><li>MYCAT_HOME/conf/schema.xml中定义逻辑库，表、分片节点等内容；</li><li>MYCAT_HOME/conf/rule.xml中定义分片规则；</li><li>MYCAT_HOME/conf/server.xml中定义用户以及系统相关变量，如端口等。下图给出了MyCAT 一个可能的逻辑库到物理库（MySQL的完整映射关系），可以看出其强大的分片能力以及灵活的Mysql集群整合能力。</li></ul><p><img loading=lazy src=https://gitee.com/xiaokunji/my-images/raw/master/myMD/20210711125505.png alt=img></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://xiaokunji.com/zh/tags/mysql.html>MySQL</a></li><li><a href=https://xiaokunji.com/zh/tags/%E6%95%B0%E6%8D%AE%E5%BA%93.html>数据库</a></li></ul><nav class=paginav><a class=prev href=https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/springboot/%E5%88%86%E6%94%AF/mybatis-springboot.html><span class=title>« 上一页</span><br><span>MyBatis-SpringBoot</span></a>
<a class=next href=https://xiaokunji.com/zh/%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%B7%AE%E5%BC%82/mysql%E4%B8%8Eoracle.html><span class=title>下一页 »</span><br><span>MySQL与Oracle</span></a></nav></footer></article></main><footer class=footer><span>Copyright
&copy;
-2023
<a href=https://xiaokunji.com/zh/ style=color:#939393>米二</a>
All Rights Reserved</span>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<span id=busuanzi_container><span class="fa fa-user">用户数:</span><span id=busuanzi_value_site_uv></span>
<span class="fa fa-eye">访问数:</span><span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>