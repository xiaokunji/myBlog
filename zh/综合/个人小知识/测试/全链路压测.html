<!DOCTYPE html>
<html dir="auto" lang="zh"><head><meta charset="utf-8"/><meta content="IE=edge" http-equiv="x-ua-compatible"/><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name="viewport"/><meta content="index, follow" name="robots"/><title>全链路压测 | 米二</title><meta content="全链路压测,压测" name="keywords"/><meta content="全链路压测相关知识" name="description"/><meta content="xkj" name="author"/><link href="https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/%E4%B8%AA%E4%BA%BA%E5%B0%8F%E7%9F%A5%E8%AF%86/%E6%B5%8B%E8%AF%95/%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B.html" rel="canonical"/><link as="style" crossorigin="anonymous" href="/assets/css/stylesheet.dc6bd2c841ee388e899e13872ae986c0e847e8b957d6714ad6ddc628ef2d17ff.css" integrity="sha256-3GvSyEHuOI6JnhOHKumGwOhH6LlX1nFK1t3GKO8tF/8=" rel="preload stylesheet"/><script crossorigin="anonymous" defer="" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload="hljs.initHighlightingOnLoad()" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js"></script>
<link href="https://xiaokunji.com/img/Q.svg" rel="icon"/><link href="https://xiaokunji.com/img/Q.svg" rel="icon" sizes="16x16" type="image/png"/><link href="https://xiaokunji.com/img/Q.svg" rel="icon" sizes="32x32" type="image/png"/><link href="https://xiaokunji.com/Q.svg" rel="apple-touch-icon"/><link href="https://xiaokunji.com/Q.svg" rel="mask-icon"/><meta content="#2e2e33" name="theme-color"/><meta content="#2e2e33" name="msapplication-TileColor"/><link href="https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/%E4%B8%AA%E4%BA%BA%E5%B0%8F%E7%9F%A5%E8%AF%86/%E6%B5%8B%E8%AF%95/%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B.html" hreflang="zh" rel="alternate"/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta content="全链路压测" property="og:title"/><meta content="全链路压测相关知识" property="og:description"/><meta content="article" property="og:type"/><meta content="https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/%E4%B8%AA%E4%BA%BA%E5%B0%8F%E7%9F%A5%E8%AF%86/%E6%B5%8B%E8%AF%95/%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B.html" property="og:url"/><meta content="综合" property="article:section"/><meta content="2024-07-24T00:00:00+00:00" property="article:published_time"/><meta content="2024-07-24T19:11:59+08:00" property="article:modified_time"/><meta content="summary" name="twitter:card"/><meta content="全链路压测" name="twitter:title"/><meta content="全链路压测相关知识" name="twitter:description"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":5,"name":"全链路压测","item":"https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/%E4%B8%AA%E4%BA%BA%E5%B0%8F%E7%9F%A5%E8%AF%86/%E6%B5%8B%E8%AF%95/%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B.html"}]}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"全链路压测","name":"全链路压测","description":"全链路压测相关知识","keywords":["全链路压测","压测"],"articleBody":"1. 压测基本原理介绍 1.1 压力测试定义 压测：模拟海量用户并发使用业务系统的一个或多个功能场景，测试系统性能，保障系统的稳定性。\n压力测试分类：冒烟测试、负载测试、压力测试、尖峰测试、浸泡测试； 模拟海量用户：虚拟用户(Virtual User)、多地域、多ip、行为多样； 压力模型：并发模式、RPS模式、脉冲模型； 压测用例场景构建：场景编排、单场景压测、多场景混压； 系统性能指标：RPS/QPS、TPS、平均时延、错误率、资源负载； 1.1.1 压力测试分类 冒烟测试：最小负载（通常一个并发）验证测试脚本没有错误，保证接口或者脚本能正常使用。\n负载测试：评估系统在常规负载下的系统性能表现，会有明确SLA要求。\n压力测试：评估系统在极限负载下的系统的可用性和稳定性，探测系统的容量。\n尖峰测试：相比压力测试，尖峰测试的负载梯度设置会更加激进，陡增陡降，验证服务稳定性。\n浸泡测试：验证系统长时间处于压力情况下(通常60-80%负载、以小时为单位)导致的性能和可靠性问题。\n服务等级协议 SLA（Service Level Agreement）是判定压测是否异常的重要依据。比如 失败率超过1%就警告, cpu负载超过70%就警告, 一般云厂商都提供了SLA配置的管理平台\n性能压测中的SLA，你知道吗？-阿里云开发者社区 (aliyun.com) 1.1.2 海量用户模拟 通常通过多线程来模拟用户，同时为了用户真实性，还需要带上多地域、多行为多样化等属性；\n相关要素 压测引擎：用户模拟通过压测引擎利用多线程实现；不同的引擎因为IO模型差异，启动线程模拟用户消耗的资源差异略有不同，这也是导致引擎整体性能差异的原因；\n分布式集群：提供资源给压测引擎模拟海量用户，并具备多地域部署、弹性伸缩等能力；\n压测数据：海量多样的压测数据保证用户行为多样化；\n海量用户压测执行时，核心是保障多集群多容器多线程同步执行，状态可控； 线程状态同步：所有线程（用户）需要在同一时间开始发压，保证准确模拟用户并发情况，这部分由压测引擎负责； 容器状态同步：由于高并发需要大量资源，压测任务会分布在多个pod执行，因此需要保证多个pod中的任务状态同步，这部分由各pod管理者(eks)负责； 集群状态同步：由于要支持多地域发压，压测任务会分布在不同地域的集群，因此需要保证多个集群的任务状态同步，这部分由集群的调度服务负责； 为了真实有效的模拟 , 可以采用 流量录制然后重放的方式, 来模拟真实用户,\n如果有写的操作, 可以考虑用影子表或影子库来隔离用户数据\n如果涉及到状态信息(例如登录token), 在发送流量时, 通过改写token参数,比如不会失效的压测token; 生成一个有效的用户token\n1.1.3 压力模型设置 压力模型负责描述海量虚拟用户如何给系统制造请求压力\n系统压力值两个概念 并发用户数：同时使用系统的用户数量，从用户侧视角描述系统压力值；，（适用于真实用户场景）\n系统吞吐量(RPS):系统每秒处理的请求数，从系统侧视角描述系统压力值；（适用于系统组件等场景）\n压力模型 梯度发压模型：按照设定的虚拟用户数(U)进行发压，可设置用户量梯度上升规则，防止压力突增过高影响系统稳定性；\nRPS模型：设置系统吞吐量，通过控制每个用户RPS来达到设定的压测吞吐量目标；\n1.1.4 压测场景构建 多种压测编写模式：支持简单低代码模式、脚本语法模式、JMeter原生模式及GoPlugin等多种压测方式。\n多场景混压：支持多场景并发压测，通过权重调节发压负载等\n多协议支持：http,grpc,tars/taf,websocket等\n复杂用例编排：支持复杂场景串联、可通过iffo等语句进行编排场景，高度自定义。\n多地域发压：支持北京、广州、深圳、南京等多地发压。\nSLA熔断：智能SLA熔断，避免被压服务出现问题时依旧进行大量请求。\n流量转压测：录制流量一键转换。\n根据流量自动构造大量请求数据 提升压测数据多样性保证压测数据实时性 作为一个压测平台应当具备以上能力\n1.1.5 性能指标采集分析 指标分析通常包括压测过程中SLA监控 \u0026 压测完成后问题分析\n压测过程中SLA监控：保障压测过程中不会影响系统稳定性；\n压测后问题分析：通过错误率、时延等指标分析提升系统稳定性；全链路压测不仅包含发压端数据，也包括被压服务端数据；\n服务拓扑扩散比: 当是微服务的场景下, 每个服务会受到的压力会随着服务的增多而增多, 特别是底层服务, 那在真实流量中, 每个服务的扩散值是多少呢? 这对我们知晓服务瓶颈, 预算服务节点数量有很高的价值\n2. 全链路压测介绍 全链路压测是在正式环境模拟真实流量量级的场景化压测，目标是发现系统瓶颈以及容量评估规划。\n真实的流量场景 量级、场景、特征尽可能模拟真实流量 真实的环境 在线上真实环境进行压测 提前进行 模拟活动提前实战演练，提前发现问题 常态化 周期性的小批量性能验证和问题定位 怎么不影响生产流量呢?\n流量隔离 流量可标识, 可透传 数据隔离 中间件读写隔离 过程产生数据的数据隔离 业务逻辑隔离 压测逻辑和正式逻辑隔离开 资源隔离 独立划分CPU, 内存等等 在生产环境,一般只会做前两种, 后两种成本较大, 且会一定程度上影响压测效果\n2.1 业界实现对比 公司 方案描述 特点 阿里 终端/后台流量录制+自动清洗流量打标+影子表隔离统一的RPC框架和中间件支持 数据完全隔离，服务资源复用Java技术栈，统一中间件支持，无业务侵入输出阿里云压测产品PTS 头条 终端/后台流量录制+自动清洗流量打标+影子表隔离不合规框架服务改造 数据完全隔离，服务资源复用多技术栈（go、python、java),有改造成本统一的中间件体系支持 MegaEase SpringCloud服务网格;ShadowService机制 Service复制+中间件镜像+金丝雀规则最高隔离级别JavaAgent,,无侵入设计对于复杂业务复制环境代价较大 ","wordCount":"2327","inLanguage":"zh","datePublished":"2024-07-24T00:00:00Z","dateModified":"2024-07-24T19:11:59+08:00","author":{"@type":"Person","name":"xkj"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/%E4%B8%AA%E4%BA%BA%E5%B0%8F%E7%9F%A5%E8%AF%86/%E6%B5%8B%E8%AF%95/%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B.html"},"publisher":{"@type":"Organization","name":"米二","logo":{"@type":"ImageObject","url":"https://xiaokunji.com/img/Q.svg"}}}</script></head><body class="dark" id="top"><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class="header"><nav class="nav"><div class="logo"><a accesskey="h" href="https://xiaokunji.com/zh/" title="米二 (Alt + H)"><img alt="" aria-label="logo" height="35" src="https://xiaokunji.com/img/Q.svg"/>米二</a><div class="logo-switches"><button accesskey="t" id="theme-toggle" title="(Alt + T)"><svg fill="none" height="18" id="moon" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path></svg><svg fill="none" height="18" id="sun" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="5"></circle><line x1="12" x2="12" y1="1" y2="3"></line><line x1="12" x2="12" y1="21" y2="23"></line><line x1="4.22" x2="5.64" y1="4.22" y2="5.64"></line><line x1="18.36" x2="19.78" y1="18.36" y2="19.78"></line><line x1="1" x2="3" y1="12" y2="12"></line><line x1="21" x2="23" y1="12" y2="12"></line><line x1="4.22" x2="5.64" y1="19.78" y2="18.36"></line><line x1="18.36" x2="19.78" y1="5.64" y2="4.22"></line></svg></button><ul class="lang-switch"><li>|</li><li><a aria-label="English" href="https://xiaokunji.com/en/" title="English">English</a></li></ul></div></div><ul id="menu"><li><a href="https://xiaokunji.com/zh/" title="🏠主页"><span>🏠主页</span></a></li><li><a accesskey="/" href="https://xiaokunji.com/zh/search" title="🔍搜索 (Alt + /)"><span>🔍搜索</span></a></li><li><a href="https://xiaokunji.com/zh/post.html" title="📚文章"><span>📚文章</span></a></li><li><a href="https://xiaokunji.com/zh/archives.html" title="⏱时间轴"><span>⏱时间轴</span></a></li><li><a href="https://xiaokunji.com/zh/tags.html" title="🔖标签"><span>🔖标签</span></a></li><li><a href="https://xiaokunji.com/zh/categories.html" title="📖分类"><span>📖分类</span></a></li><li><a href="https://xiaokunji.com/zh/links.html" title="🤝友链"><span>🤝友链</span></a></li></ul></nav></header><main class="main"><article class="post-single"><header class="post-header"><nav aria-label="breadcrumb"><ul><a href="https://xiaokunji.com/zh/">🏠</a> <span>&gt;</span>
<a href="https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88.html">综合</a> <span>&gt;</span>
<a href="https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/%E4%B8%AA%E4%BA%BA%E5%B0%8F%E7%9F%A5%E8%AF%86.html">个人小知识</a> <span>&gt;</span>
<a href="https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/%E4%B8%AA%E4%BA%BA%E5%B0%8F%E7%9F%A5%E8%AF%86/%E6%B5%8B%E8%AF%95.html">测试</a> <span>&gt;</span></ul></nav><h1 class="post-title">全链路压测</h1><div class="post-description">全链路压测相关知识</div><div class="post-meta">创建: <span title="2024-07-24 00:00:00 +0000 UTC">2024-07-24</span> · 更新: 2024-07-24 · xkj
 | 分类:  <ul class="post-categories-meta" style="display:inline"><a href="https://xiaokunji.com/zh/categories/%E7%BB%BC%E5%90%88.html">综合</a></ul><span id="busuanzi_container_page_pv"> | 访问: <span id="busuanzi_value_page_pv">1</span></span></div></header><aside class="toc-container wide" id="toc-container"><div class="toc"><details open=""><summary accesskey="c" title="(Alt + C)"><span class="details">目录</span></summary><div class="inner"><ul><li><a aria-label="1. 压测基本原理介绍" href="#1-%e5%8e%8b%e6%b5%8b%e5%9f%ba%e6%9c%ac%e5%8e%9f%e7%90%86%e4%bb%8b%e7%bb%8d">1. 压测基本原理介绍</a><ul><li><a aria-label="1.1 压力测试定义" href="#11-%e5%8e%8b%e5%8a%9b%e6%b5%8b%e8%af%95%e5%ae%9a%e4%b9%89">1.1 压力测试定义</a><ul><li><a aria-label="1.1.1 压力测试分类" href="#111-%e5%8e%8b%e5%8a%9b%e6%b5%8b%e8%af%95%e5%88%86%e7%b1%bb">1.1.1 压力测试分类</a></li><li><a aria-label="1.1.2  海量用户模拟" href="#112--%e6%b5%b7%e9%87%8f%e7%94%a8%e6%88%b7%e6%a8%a1%e6%8b%9f">1.1.2 海量用户模拟</a></li><li><a aria-label="1.1.3 压力模型设置" href="#113-%e5%8e%8b%e5%8a%9b%e6%a8%a1%e5%9e%8b%e8%ae%be%e7%bd%ae">1.1.3 压力模型设置</a></li><li><a aria-label="1.1.4  压测场景构建" href="#114--%e5%8e%8b%e6%b5%8b%e5%9c%ba%e6%99%af%e6%9e%84%e5%bb%ba">1.1.4 压测场景构建</a></li><li><a aria-label="1.1.5  性能指标采集分析" href="#115--%e6%80%a7%e8%83%bd%e6%8c%87%e6%a0%87%e9%87%87%e9%9b%86%e5%88%86%e6%9e%90">1.1.5 性能指标采集分析</a></li></ul></li></ul></li><li><a aria-label="2. 全链路压测介绍" href="#2-%e5%85%a8%e9%93%be%e8%b7%af%e5%8e%8b%e6%b5%8b%e4%bb%8b%e7%bb%8d">2. 全链路压测介绍</a><ul><li><a aria-label="2.1 业界实现对比" href="#21-%e4%b8%9a%e7%95%8c%e5%ae%9e%e7%8e%b0%e5%af%b9%e6%af%94">2.1 业界实现对比</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class="post-content"><h1 id="1-压测基本原理介绍">1. 压测基本原理介绍<a aria-hidden="true" class="anchor" hidden="" href="#1-压测基本原理介绍">#</a></h1><h2 id="11-压力测试定义">1.1 压力测试定义<a aria-hidden="true" class="anchor" hidden="" href="#11-压力测试定义">#</a></h2><p>压测：模拟海量用户并发使用业务系统的一个或多个功能场景，测试系统性能，保障系统的稳定性。</p><ul><li>压力测试分类：冒烟测试、负载测试、压力测试、尖峰测试、浸泡测试；</li><li>模拟海量用户：虚拟用户(Virtual User)、多地域、多ip、行为多样；</li><li>压力模型：并发模式、RPS模式、脉冲模型；</li><li>压测用例场景构建：场景编排、单场景压测、多场景混压；</li><li>系统性能指标：RPS/QPS、TPS、平均时延、错误率、资源负载；</li></ul><h3 id="111-压力测试分类">1.1.1 压力测试分类<a aria-hidden="true" class="anchor" hidden="" href="#111-压力测试分类">#</a></h3><p><strong>冒烟测试</strong>：最小负载（通常一个并发）验证测试脚本没有错误，保证接口或者脚本能正常使用。</p><p><strong>负载测试</strong>：评估系统在常规负载下的系统性能表现，会有明确SLA要求。</p><p><strong>压力测试</strong>：评估系统在极限负载下的系统的可用性和稳定性，探测系统的容量。</p><p><strong>尖峰测试</strong>：相比压力测试，尖峰测试的负载梯度设置会更加激进，陡增陡降，验证服务稳定性。</p><p><strong>浸泡测试</strong>：验证系统长时间处于压力情况下(通常60-80%负载、以小时为单位)导致的性能和可靠性问题。</p><blockquote><p>服务等级协议 SLA（Service Level Agreement）是判定压测是否异常的重要依据。比如 失败率超过1%就警告, cpu负载超过70%就警告, 一般云厂商都提供了SLA配置的管理平台</p><p><img alt="image.png" loading="lazy" src="./%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B.assets/783627501502143488.png"/></p><p><a href="https://developer.aliyun.com/article/716166" rel="noopener" target="_blank">性能压测中的SLA，你知道吗？-阿里云开发者社区 (aliyun.com)</a></p></blockquote><h3 id="112--海量用户模拟">1.1.2 海量用户模拟<a aria-hidden="true" class="anchor" hidden="" href="#112--海量用户模拟">#</a></h3><p>通常通过多线程来模拟用户，同时为了用户真实性，还需要带上多地域、多行为多样化等属性；</p><ol><li>相关要素</li></ol><ul><li><p><strong>压测引擎</strong>：用户模拟通过压测引擎利用多线程实现；不同的引擎因为IO模型差异，启动线程模拟用户消耗的资源差异略有不同，这也是导致引擎整体性能差异的原因；</p></li><li><p><strong>分布式集群</strong>：提供资源给压测引擎模拟海量用户，并具备多地域部署、弹性伸缩等能力；</p></li><li><p><strong>压测数据</strong>：海量多样的压测数据保证用户行为多样化；</p></li></ul><br/><ol start="2"><li>海量用户压测执行时，核心是保障多集群多容器多线程同步执行，状态可控；</li></ol><ul><li><strong>线程状态同步</strong>：所有线程（用户）需要在同一时间开始发压，保证准确模拟用户并发情况，这部分由压测引擎负责；</li><li><strong>容器状态同步</strong>：由于高并发需要大量资源，压测任务会分布在多个pod执行，因此需要保证多个pod中的任务状态同步，这部分由各pod管理者(eks)负责；</li><li><strong>集群状态同步</strong>：由于要支持多地域发压，压测任务会分布在不同地域的集群，因此需要保证多个集群的任务状态同步，这部分由集群的调度服务负责；</li></ul><blockquote><p>为了真实有效的模拟 , 可以采用 <strong>流量录制然后重放</strong>的方式, 来模拟真实用户,</p><p>如果有写的操作, 可以考虑用影子表或影子库来隔离用户数据</p><p>如果涉及到状态信息(例如登录token), 在发送流量时, 通过改写token参数,比如不会失效的压测token; 生成一个有效的用户token</p></blockquote><h3 id="113-压力模型设置">1.1.3 压力模型设置<a aria-hidden="true" class="anchor" hidden="" href="#113-压力模型设置">#</a></h3><p>压力模型负责描述海量虚拟用户如何给系统制造请求压力</p><ol><li><strong>系统压力值两个概念</strong></li></ol><p><strong>并发用户数</strong>：同时使用系统的用户数量，从用户侧视角描述系统压力值；，（适用于真实用户场景）</p><p><strong>系统吞吐量(RPS)</strong>:系统每秒处理的请求数，从系统侧视角描述系统压力值；（适用于系统组件等场景）</p><ol start="2"><li><strong>压力模型</strong></li></ol><p><strong>梯度发压模型</strong>：按照设定的虚拟用户数(U)进行发压，可设置用户量梯度上升规则，防止压力突增过高影响系统稳定性；</p><p><strong>RPS模型</strong>：设置系统吞吐量，通过控制每个用户RPS来达到设定的压测吞吐量目标；</p><h3 id="114--压测场景构建">1.1.4 压测场景构建<a aria-hidden="true" class="anchor" hidden="" href="#114--压测场景构建">#</a></h3><p><strong>多种压测编写模式</strong>：支持简单低代码模式、脚本语法模式、JMeter原生模式及GoPlugin等多种压测方式。</p><p><strong>多场景混压</strong>：支持多场景并发压测，通过权重调节发压负载等</p><p><strong>多协议支持</strong>：http,grpc,tars/taf,websocket等</p><p><strong>复杂用例编排</strong>：支持复杂场景串联、可通过iffo等语句进行编排场景，高度自定义。</p><p><strong>多地域发压</strong>：支持北京、广州、深圳、南京等多地发压。</p><p><strong>SLA熔断</strong>：智能SLA熔断，避免被压服务出现问题时依旧进行大量请求。</p><p><strong>流量转压测</strong>：录制流量一键转换。</p><ul><li>根据流量自动构造大量请求数据</li><li>提升压测数据多样性保证压测数据实时性</li></ul><blockquote><p>作为一个压测平台应当具备以上能力</p></blockquote><h3 id="115--性能指标采集分析">1.1.5 性能指标采集分析<a aria-hidden="true" class="anchor" hidden="" href="#115--性能指标采集分析">#</a></h3><p>指标分析通常包括压测过程中SLA监控 &amp; 压测完成后问题分析</p><ul><li><p>压测过程中SLA监控：保障压测过程中不会影响系统稳定性；</p></li><li><p>压测后问题分析：通过错误率、时延等指标分析提升系统稳定性；全链路压测不仅包含发压端数据，也包括被压服务端数据；</p><blockquote><p>服务拓扑扩散比: 当是微服务的场景下, 每个服务会受到的压力会随着服务的增多而增多, 特别是底层服务, 那在真实流量中, 每个服务的扩散值是多少呢? 这对我们知晓服务瓶颈, 预算服务节点数量有很高的价值</p></blockquote></li></ul><h1 id="2-全链路压测介绍">2. 全链路压测介绍<a aria-hidden="true" class="anchor" hidden="" href="#2-全链路压测介绍">#</a></h1><p>全链路压测是在正式环境模拟真实流量量级的场景化压测，目标是<strong>发现系统瓶颈</strong>以及<strong>容量评估规划</strong>。</p><ol><li>真实的流量场景<ul><li>量级、场景、特征尽可能模拟真实流量</li></ul></li><li>真实的环境<ul><li>在线上真实环境进行压测</li></ul></li><li>提前进行<ul><li>模拟活动提前实战演练，提前发现问题</li></ul></li><li>常态化<ul><li>周期性的小批量性能验证和问题定位</li></ul></li></ol><p><strong>怎么不影响生产流量呢?</strong></p><ol><li>流量隔离<ul><li>流量可标识, 可透传</li></ul></li><li>数据隔离<ul><li>中间件读写隔离</li><li>过程产生数据的数据隔离</li></ul></li><li>业务逻辑隔离<ul><li>压测逻辑和正式逻辑隔离开</li></ul></li><li>资源隔离<ul><li>独立划分CPU, 内存等等</li></ul></li></ol><blockquote><p>在生产环境,一般只会做前两种, 后两种成本较大, 且会一定程度上影响压测效果</p></blockquote><h2 id="21-业界实现对比">2.1 业界实现对比<a aria-hidden="true" class="anchor" hidden="" href="#21-业界实现对比">#</a></h2><table><thead><tr><th>公司</th><th>方案描述</th><th>特点</th></tr></thead><tbody><tr><td>阿里</td><td>终端/后台流量录制+自动清洗<br/>流量打标+影子表隔离<br/>统一的RPC框架和中间件支持</td><td>数据完全隔离，服务资源复用<br/>Java技术栈，统一中间件支持，无业务侵入<br/>输出阿里云压测产品PTS</td></tr><tr><td>头条</td><td>终端/后台流量录制+自动清洗<br/>流量打标+影子表隔离<br/>不合规框架服务改造</td><td>数据完全隔离，服务资源复用<br/>多技术栈（go、python、java),有改造成本<br/>统一的中间件体系支持</td></tr><tr><td>MegaEase</td><td>SpringCloud服务网格;ShadowService机制</td><td>Service复制+中间件镜像+金丝雀规则<br/>最高隔离级别<br/>JavaAgent,,无侵入设计<br/>对于复杂业务复制环境代价较大</td></tr></tbody></table></div><footer class="post-footer"><ul class="post-tags"><li><a href="https://xiaokunji.com/zh/tags/%E6%B5%8B%E8%AF%95.html">测试</a></li><li><a href="https://xiaokunji.com/zh/tags/%E7%BB%BC%E5%90%88.html">综合</a></li></ul><nav class="paginav"><a class="prev" href="https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/%E4%B8%AA%E4%BA%BA%E5%B0%8F%E7%9F%A5%E8%AF%86/%E4%BB%A3%E7%A0%81%E7%B1%BB/%E5%A6%82%E4%BD%95%E5%81%9A%E5%A5%BDCodeReview.html"><span class="title">« 上一页</span><br/><span>如何做好CodeReview</span></a>
<a class="next" href="https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/%E4%B8%AA%E4%BA%BA%E5%B0%8F%E7%9F%A5%E8%AF%86/%E7%BD%91%E7%BB%9C/RPC.html"><span class="title">下一页 »</span><br/><span>RPC</span></a></nav></footer></article></main><script async="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><footer class="footer"><span>Copyright
©
-2024
<a href="https://xiaokunji.com/zh/" style="color:#939393">米二</a>
All Rights Reserved</span>
<span id="busuanzi_container"><span class="fa fa-user">用户数:</span><span id="busuanzi_value_site_uv"></span>
<span class="fa fa-eye">访问数:</span><span id="busuanzi_value_site_pv"></span></span></footer><a accesskey="g" aria-label="go to top" class="top-link" href="#top" id="top-link" title="Go to Top (Alt + G)"><svg fill="currentcolor" viewbox="0 0 12 6" xmlns="http://www.w3.org/2000/svg"><path d="M12 6H0l6-6z"></path></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>