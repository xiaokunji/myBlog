<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>LRU | ç±³äºŒ</title><meta name=keywords content=" å‰è¨€, åŸç†, æœ´ç´ çš„LRUç®—æ³•, åŸºäºæ•°ç»„, åŸºäºé•¿åº¦æœ‰é™çš„åŒå‘é“¾è¡¨, åŸºäºåŒå‘é“¾è¡¨å’Œå“ˆå¸Œè¡¨, åŸºäºLinkedHashMapå®ç°çš„LRU, LRUç®—æ³•ä¼˜åŒ–, LRU-K, redisä¸­çš„LRUç®—æ³•"><meta name=description content="     "><meta name=author content="xkj"><link rel=canonical href=https://xiaokunji.github.io/myBlog/zh/%E7%BB%BC%E5%90%88/%E7%AE%97%E6%B3%95/lru/><link crossorigin=anonymous href=/myBlog/assets/css/stylesheet.a2492b1919558dad2b0783841b531329520921f957f354ded4c3fc4d21dcc77f.css integrity="sha256-okkrGRlVja0rB4OEG1MTKVIJIflX81Te1MP8TSHcx38=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/myBlog/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://xiaokunji.github.io/myBlog/img/Q.gif><link rel=icon type=image/png sizes=16x16 href=https://xiaokunji.github.io/myBlog/img/Q.gif><link rel=icon type=image/png sizes=32x32 href=https://xiaokunji.github.io/myBlog/img/Q.gif><link rel=apple-touch-icon href=https://xiaokunji.github.io/myBlog/Q.gif><link rel=mask-icon href=https://xiaokunji.github.io/myBlog/Q.gif><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://xiaokunji.github.io/myBlog/zh/%E7%BB%BC%E5%90%88/%E7%AE%97%E6%B3%95/lru/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="LRU"><meta property="og:description" content="     "><meta property="og:type" content="article"><meta property="og:url" content="https://xiaokunji.github.io/myBlog/zh/%E7%BB%BC%E5%90%88/%E7%AE%97%E6%B3%95/lru/"><meta property="article:section" content="ç»¼åˆ"><meta property="article:published_time" content="2023-08-22T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-22T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="LRU"><meta name=twitter:description content="     "><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":3,"name":"LRU","item":"https://xiaokunji.github.io/myBlog/zh/%E7%BB%BC%E5%90%88/%E7%AE%97%E6%B3%95/lru/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"LRU","name":"LRU","description":"     ","keywords":[" å‰è¨€"," åŸç†"," æœ´ç´ çš„LRUç®—æ³•"," åŸºäºæ•°ç»„"," åŸºäºé•¿åº¦æœ‰é™çš„åŒå‘é“¾è¡¨"," åŸºäºåŒå‘é“¾è¡¨å’Œå“ˆå¸Œè¡¨"," åŸºäºLinkedHashMapå®ç°çš„LRU"," LRUç®—æ³•ä¼˜åŒ–"," LRU-K"," redisä¸­çš„LRUç®—æ³•"],"articleBody":"[toc]\nå‰è¨€ LRUç®—æ³•å…¨ç§°æ˜¯æœ€å°‘æœ€è¿‘ä½¿ç”¨ç®—æ³•ï¼ˆLeast Recently Useï¼‰ï¼Œå¹¿æ³›çš„åº”ç”¨äºç¼“å­˜æœºåˆ¶ä¸­ã€‚å½“ç¼“å­˜ä½¿ç”¨çš„ç©ºé—´è¾¾åˆ°ä¸Šé™åï¼Œå°±éœ€è¦ä»å·²æœ‰çš„æ•°æ®ä¸­æ·˜æ±°ä¸€éƒ¨åˆ†ä»¥ç»´æŒç¼“å­˜çš„å¯ç”¨æ€§ï¼Œè€Œæ·˜æ±°æ•°æ®çš„é€‰æ‹©å°±æ˜¯é€šè¿‡LRUç®—æ³•å®Œæˆçš„ã€‚\nLRUç®—æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯åŸºäºå±€éƒ¨æ€§åŸç†çš„æ—¶é—´å±€éƒ¨æ€§ï¼š\nå¦‚æœä¸€ä¸ªä¿¡æ¯é¡¹æ­£åœ¨è¢«è®¿é—®ï¼Œé‚£ä¹ˆåœ¨è¿‘æœŸå®ƒå¾ˆå¯èƒ½è¿˜ä¼šè¢«å†æ¬¡è®¿é—®ã€‚\næ‰€ä»¥é¡¾åæ€ä¹‰ï¼ŒLRUç®—æ³•ä¼šé€‰å‡ºæœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®è¿›è¡Œæ·˜æ±°ã€‚\nåŸç† ä¸€èˆ¬æ¥è®²ï¼ŒLRUå°†è®¿é—®æ•°æ®çš„é¡ºåºæˆ–æ—¶é—´å’Œæ•°æ®æœ¬èº«ç»´æŠ¤åœ¨ä¸€ä¸ªå®¹å™¨å½“ä¸­ã€‚å½“è®¿é—®ä¸€ä¸ªæ•°æ®æ—¶ï¼š\nè¯¥æ•°æ®ä¸åœ¨å®¹å™¨å½“ä¸­ï¼Œåˆ™è®¾ç½®è¯¥æ•°æ®çš„ä¼˜å…ˆçº§ä¸ºæœ€é«˜å¹¶æ”¾å…¥å®¹å™¨ä¸­ã€‚è¯¥æ•°æ®åœ¨å®¹å™¨å½“ä¸­ï¼Œåˆ™æ›´æ–°è¯¥æ•°æ®çš„ä¼˜å…ˆçº§è‡³æœ€é«˜ã€‚å½“æ•°æ®çš„æ€»é‡è¾¾åˆ°ä¸Šé™åï¼Œåˆ™ç§»é™¤å®¹å™¨ä¸­ä¼˜å…ˆçº§æœ€ä½çš„æ•°æ®ã€‚ä¸‹å›¾æ˜¯ä¸€ä¸ªç®€å•çš„LRUåŸç†ç¤ºæ„å›¾ï¼š\nå¦‚æœæˆ‘ä»¬æŒ‰ç…§7 0 1 2 0 3 0 4çš„é¡ºåºæ¥è®¿é—®æ•°æ®ï¼Œä¸”æ•°æ®çš„æ€»é‡ä¸Šé™ä¸º3ï¼Œåˆ™å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒLRUç®—æ³•ä¼šä¾æ¬¡æ·˜æ±°7 1 2è¿™ä¸‰ä¸ªæ•°æ®ã€‚\nç”±å›¾æ„Ÿè§‰, æ²¡æœ‰ä½“ç°å‡ºæœ€å°‘çš„æ¦‚å¿µ, æ›´è´´åˆ‡çš„æè¿°åº”è¯¥æ˜¯: æœ€è¿‘ä½¿ç”¨ç®—æ³•,\næœ´ç´ çš„LRUç®—æ³• é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨å°±æŒ‰ç…§ä¸Šé¢çš„åŸç†ï¼Œå®ç°ä¸€ä¸ªæœ´ç´ çš„LRUç®—æ³•ã€‚ä¸‹é¢æœ‰ä¸‰ç§æ–¹æ¡ˆï¼š\nåŸºäºæ•°ç»„ æ–¹æ¡ˆï¼šä¸ºæ¯ä¸€ä¸ªæ•°æ®é™„åŠ ä¸€ä¸ªé¢å¤–çš„å±æ€§â€”â€”æ—¶é—´æˆ³ï¼Œå½“æ¯ä¸€æ¬¡è®¿é—®æ•°æ®æ—¶ï¼Œæ›´æ–°è¯¥æ•°æ®çš„æ—¶é—´æˆ³è‡³å½“å‰æ—¶é—´ã€‚å½“æ•°æ®ç©ºé—´å·²æ»¡åï¼Œåˆ™æ‰«ææ•´ä¸ªæ•°ç»„ï¼Œæ·˜æ±°æ—¶é—´æˆ³æœ€å°çš„æ•°æ®ã€‚\nä¸è¶³ï¼šç»´æŠ¤æ—¶é—´æˆ³éœ€è¦è€—è´¹é¢å¤–çš„ç©ºé—´ï¼Œæ·˜æ±°æ•°æ®æ—¶éœ€è¦æ‰«ææ•´ä¸ªæ•°ç»„ã€‚\nåŸºäºé•¿åº¦æœ‰é™çš„åŒå‘é“¾è¡¨ æ–¹æ¡ˆï¼šè®¿é—®ä¸€ä¸ªæ•°æ®æ—¶ï¼Œå½“æ•°æ®ä¸åœ¨é“¾è¡¨ä¸­ï¼Œåˆ™å°†æ•°æ®æ’å…¥è‡³é“¾è¡¨å¤´éƒ¨ï¼Œå¦‚æœåœ¨é“¾è¡¨ä¸­ï¼Œåˆ™å°†è¯¥æ•°æ®ç§»è‡³é“¾è¡¨å¤´éƒ¨ã€‚å½“æ•°æ®ç©ºé—´å·²æ»¡åï¼Œåˆ™æ·˜æ±°é“¾è¡¨æœ€æœ«å°¾çš„æ•°æ®ã€‚\nä¸è¶³ï¼šæ’å…¥æ•°æ®æˆ–å–æ•°æ®æ—¶ï¼Œéœ€è¦æ‰«ææ•´ä¸ªé“¾è¡¨ã€‚\nåŸºäºåŒå‘é“¾è¡¨å’Œå“ˆå¸Œè¡¨ æ–¹æ¡ˆï¼šä¸ºäº†æ”¹è¿›ä¸Šé¢éœ€è¦æ‰«æé“¾è¡¨çš„ç¼ºé™·ï¼Œé…åˆå“ˆå¸Œè¡¨ï¼Œå°†æ•°æ®å’Œé“¾è¡¨ä¸­çš„èŠ‚ç‚¹å½¢æˆæ˜ å°„ï¼ŒHashMap å­˜å‚¨ keyï¼Œè¿™æ ·å¯ä»¥åšåˆ° save å’Œ get keyçš„æ—¶é—´éƒ½æ˜¯ O(1) , è€Œ HashMap çš„ Value æŒ‡å‘åŒå‘é“¾è¡¨å®ç°çš„ LRU çš„ Node èŠ‚ç‚¹ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚\né‡ç‚¹æ˜¯hashè¡¨, ä»¥hashè¡¨ä¸ºç»´åº¦æ“ä½œ\nåŸºäºLinkedHashMapå®ç°çš„LRU JDKç»™æˆ‘ä»¬æä¾›çš„LinkedHashMapç›´æ¥å®ç°LRUã€‚å› ä¸ºLinkedHashMapçš„åº•å±‚å³ä¸ºåŒå‘é“¾è¡¨å’Œå“ˆå¸Œè¡¨çš„ç»„åˆï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æ‹¿æ¥ä½¿ç”¨ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 public class LRUCache extends LinkedHashMap { private int capacity; public LRUCache(int capacity) { // trueè¡¨ç¤º è®¿é—®çš„é¡ºåº ï¼Œ falseè¡¨ç¤ºæ’å…¥çš„é¡ºåº // æ³¨æ„è¿™é‡Œå°†LinkedHashMapçš„accessOrderè®¾ä¸ºtrue super(16, 0.75f, true); this.capacity = capacity; } @Override protected boolean removeEldestEntry(Map.Entry eldest) { return super.size() \u003e capacity; } } é»˜è®¤LinkedHashMapå¹¶ä¸ä¼šæ·˜æ±°æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡å†™äº†å®ƒçš„removeEldestEntry()æ–¹æ³•ï¼Œå½“æ•°æ®æ•°é‡è¾¾åˆ°é¢„è®¾ä¸Šé™åï¼Œæ·˜æ±°æ•°æ®ï¼ŒaccessOrderè®¾ä¸ºtrueæ„ä¸ºæŒ‰ç…§è®¿é—®çš„é¡ºåºæ’åºã€‚æ•´ä¸ªå®ç°çš„ä»£ç é‡å¹¶ä¸å¤§ï¼Œä¸»è¦éƒ½æ˜¯åº”ç”¨LinkedHashMapçš„ç‰¹æ€§ã€‚\næ­£å› ä¸ºLinkedHashMapè¿™ä¹ˆå¥½ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Dubboçš„LRUç¼“å­˜LRUCacheä¹Ÿæ˜¯åŸºäºå®ƒå®ç°çš„ã€‚\nLRUç®—æ³•ä¼˜åŒ– æœ´ç´ çš„LRUç®—æ³•å·²ç»èƒ½å¤Ÿæ»¡è¶³ç¼“å­˜çš„è¦æ±‚äº†ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€äº›ä¸è¶³ã€‚å½“çƒ­ç‚¹æ•°æ®è¾ƒå¤šæ—¶ï¼Œæœ‰è¾ƒé«˜çš„å‘½ä¸­ç‡ï¼Œä½†æ˜¯å¦‚æœæœ‰å¶å‘æ€§çš„æ‰¹é‡æ“ä½œï¼Œä¼šä½¿å¾—çƒ­ç‚¹æ•°æ®è¢«éçƒ­ç‚¹æ•°æ®æŒ¤å‡ºå®¹å™¨ï¼Œä½¿å¾—ç¼“å­˜å—åˆ°äº†â€œæ±¡æŸ“â€ã€‚æ‰€ä»¥ä¸ºäº†æ¶ˆé™¤è¿™ç§å½±å“ï¼Œåˆè¡ç”Ÿå‡ºäº†ä¸‹é¢è¿™äº›ä¼˜åŒ–æ–¹æ³•ã€‚\nLRU-K LRU-Kç®—æ³•æ˜¯å¯¹LRUç®—æ³•çš„æ”¹è¿›ï¼Œå°†åŸå…ˆè¿›å…¥ç¼“å­˜é˜Ÿåˆ—çš„è¯„åˆ¤æ ‡å‡†ä»è®¿é—®ä¸€æ¬¡æ”¹ä¸ºè®¿é—®Kæ¬¡ï¼Œå¯ä»¥è¯´æœ´ç´ çš„LRUç®—æ³•ä¸ºLRU-1ã€‚\nLRU-Kç®—æ³•æœ‰ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œä¸€ä¸ªæ˜¯ç¼“å­˜é˜Ÿåˆ—ï¼Œä¸€ä¸ªæ˜¯æ•°æ®è®¿é—®å†å²é˜Ÿåˆ—ã€‚å½“è®¿é—®ä¸€ä¸ªæ•°æ®æ—¶ï¼Œé¦–å…ˆå…ˆåœ¨è®¿é—®å†å²é˜Ÿåˆ—ä¸­ç´¯åŠ è®¿é—®æ¬¡æ•°ï¼Œå½“å†å²è®¿é—®è®°å½•è¶…è¿‡Kæ¬¡åï¼Œæ‰å°†æ•°æ®ç¼“å­˜è‡³ç¼“å­˜é˜Ÿåˆ—ï¼Œä»è€Œé¿å…ç¼“å­˜é˜Ÿåˆ—è¢«æ±¡æŸ“ã€‚åŒæ—¶è®¿é—®å†å²é˜Ÿåˆ—ä¸­çš„æ•°æ®å¯ä»¥æŒ‰ç…§LRUçš„è§„åˆ™è¿›è¡Œæ·˜æ±°ã€‚å…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nå®ç°ä¸€ä¸ªLRU-Kç¼“å­˜\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 // ç›´æ¥ç»§æ‰¿æˆ‘ä»¬å‰é¢å†™å¥½çš„LRUCache public class LRUKCache extends LRUCache { private int k; // è¿›å…¥ç¼“å­˜é˜Ÿåˆ—çš„è¯„åˆ¤æ ‡å‡† private LRUCache historyList; // è®¿é—®æ•°æ®å†å²è®°å½• public LRUKCache(int cacheSize, int historyCapacity, int k) { super(cacheSize); this.k = k; this.historyList = new LRUCache(historyCapacity); } @Override public Integer get(Integer key) { // è®°å½•æ•°æ®è®¿é—®æ¬¡æ•° Integer historyCount = historyList.get(key); historyCount = historyCount == null ? 0 : historyCount; historyList.put(key, ++historyCount); return super.get(key); } @Override public Integer put(Integer key, Integer value) { if (value == null) { return null; } // å¦‚æœå·²ç»åœ¨ç¼“å­˜é‡Œåˆ™ç›´æ¥è¿”å›ç¼“å­˜ä¸­çš„æ•°æ® if (super.get(key) != null) { return super.put(key, value);; } // å¦‚æœæ•°æ®å†å²è®¿é—®æ¬¡æ•°è¾¾åˆ°ä¸Šé™ï¼Œåˆ™åŠ å…¥ç¼“å­˜ Integer historyCount = historyList.get(key); historyCount = historyCount == null ? 0 : historyCount; if (historyCount \u003e= k) { // ç§»é™¤å†å²è®¿é—®è®°å½• historyList.remove(key); return super.put(key, value); } } } ä¸Šé¢åªæ˜¯ä¸ªç®€å•çš„æ¨¡å‹ï¼Œå¹¶æ²¡æœ‰åŠ ä¸Šå¿…è¦çš„å¹¶å‘æ§åˆ¶ã€‚\nä¸€èˆ¬æ¥è®²ï¼Œå½“Kçš„å€¼è¶Šå¤§ï¼Œåˆ™ç¼“å­˜çš„å‘½ä¸­ç‡è¶Šé«˜ï¼Œä½†æ˜¯ä¹Ÿä¼šä½¿å¾—ç¼“å­˜éš¾ä»¥è¢«æ·˜æ±°ã€‚ç»¼åˆæ¥è¯´ï¼Œä½¿ç”¨LRU-2çš„æ€§èƒ½æœ€ä¼˜ã€‚\nredisä¸­çš„LRUç®—æ³• redisæ²¡æœ‰ä½¿ç”¨æ ‡å‡†çš„LRUç®—æ³•, åªæ˜¯è¿‘ä¼¼çš„LRUç®—æ³•, å› ä¸ºå«ŒLinkedListå ç”¨çš„ç©ºé—´å¤ªå¤§äº†\nredisé€šè¿‡è®¡ç®—æ¯ä¸ªkeyçš„é—²ç½®æ—¶é—´æ¥å†³å®šæ˜¯å¦è¦é€‰å®ƒæ·˜æ±°(å…¨å±€æ—¶é’Ÿ å‡å» å½“å‰keyçš„è®¿é—®æ—¶é’Ÿ), redisä¼šéšæœºé€‰å‡ ä¸ªkey, å®ƒä»¬çš„é—²ç½®æ—¶é—´éƒ½è¦å¤§äºä¸€ä¸ªé˜ˆå€¼(å…¶å®ä¼šå­˜å…¥ä¸€ä¸ªpool, è¿™ä¸ªé˜ˆå€¼å°±æ˜¯poolä¸­æœ€å°çš„é—²ç½®æ—¶é—´), å½“å†…å­˜ä¸å¤Ÿæ—¶, å°±ä»è¿™å‡ ä¸ªkeyä¸­æ·˜æ±°é—²ç½®æ—¶é—´æœ€å¤§çš„å€¼\nRedisçš„ç¼“å­˜æ·˜æ±°ç­–ç•¥LRUä¸LFU - ç®€ä¹¦ (jianshu.com) æ›´å¤šå¯è§: Redisçš„æ·˜æ±°ç­–ç•¥LRUä¸LFU.md LRUç®—æ³•åŠå…¶ä¼˜åŒ–ç­–ç•¥â€”â€”ç®—æ³•ç¯‡ - æ˜é‡‘ (juejin.cn) å…¨é¢è®²è§£LRUç®—æ³•_Apple_Webçš„åšå®¢-CSDNåšå®¢_lru ç®—æ³• ","wordCount":"2162","inLanguage":"zh","datePublished":"2023-08-22T00:00:00Z","dateModified":"2023-08-22T00:00:00Z","author":{"@type":"Person","name":"xkj"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://xiaokunji.github.io/myBlog/zh/%E7%BB%BC%E5%90%88/%E7%AE%97%E6%B3%95/lru/"},"publisher":{"@type":"Organization","name":"ç±³äºŒ","logo":{"@type":"ImageObject","url":"https://xiaokunji.github.io/myBlog/img/Q.gif"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://xiaokunji.github.io/myBlog/zh/ accesskey=h title="ç±³äºŒ (Alt + H)"><img src=https://xiaokunji.github.io/myBlog/img/Q.gif alt aria-label=logo height=35>ç±³äºŒ</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://xiaokunji.github.io/myBlog/en/ title=English aria-label=English>English</a></li></ul></div></div><ul id=menu><li><a href=https://xiaokunji.github.io/myBlog/zh/ title=ğŸ ä¸»é¡µ><span>ğŸ ä¸»é¡µ</span></a></li><li><a href=https://xiaokunji.github.io/myBlog/zh/search title="ğŸ”æœç´¢ (Alt + /)" accesskey=/><span>ğŸ”æœç´¢</span></a></li><li><a href=https://xiaokunji.github.io/myBlog/zh/post title=ğŸ“šæ–‡ç« ><span>ğŸ“šæ–‡ç« </span></a></li><li><a href=https://xiaokunji.github.io/myBlog/zh/archives/ title=â±æ—¶é—´è½´><span>â±æ—¶é—´è½´</span></a></li><li><a href=https://xiaokunji.github.io/myBlog/zh/tags title=ğŸ”–æ ‡ç­¾><span>ğŸ”–æ ‡ç­¾</span></a></li><li><a href=https://xiaokunji.github.io/myBlog/zh/categories title=ğŸ“–åˆ†ç±»><span>ğŸ“–åˆ†ç±»</span></a></li><li><a href=https://xiaokunji.github.io/myBlog/zh/links title=ğŸ¤å‹é“¾><span>ğŸ¤å‹é“¾</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><nav aria-label=breadcrumb><ul><a href=https://xiaokunji.github.io/myBlog/zh/>content</a> <span>></span>
<a href=https://xiaokunji.github.io/myBlog/zh/%E7%BB%BC%E5%90%88/>ç»¼åˆ</a> <span>></span>
<a href=https://xiaokunji.github.io/myBlog/zh/%E7%BB%BC%E5%90%88/%E7%AE%97%E6%B3%95/>ç®—æ³•</a> <span>></span></ul></nav><h1 class=post-title>LRU</h1><div class=post-description></div><div class=post-meta><span title='2023-08-22 00:00:00 +0000 UTC'>2023-08-22</span>&nbsp;Â·&nbsp;5 åˆ†é’Ÿ&nbsp;Â·&nbsp;xkj
&nbsp;|&nbsp;åˆ†ç±»: &nbsp;<ul class=post-categories-meta><a href=https://xiaokunji.github.io/myBlog/zh/categories/%E7%BB%BC%E5%90%88/>ç»¼åˆ</a></ul><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<span id=busuanzi_container_page_pv>&nbsp;| è®¿é—®: <span id=busuanzi_value_page_pv></span></span>
<script src=https://cdn.staticfile.org/twikoo//twikoo.all.min.js></script><script>let url=document.documentURI,dnsUrl="https://xiaokunji.github.io/myBlog/",urlSplit=url.split(dnsUrl),finalUrl=urlSplit[1];finalUrl[0]!=="/"&&(finalUrl="/"+finalUrl),twikoo.getCommentsCount({envId:null,region:null,urls:[finalUrl],includeReply:!1}).then(function(e){let t=e[0].count;const n=document.getElementById("comment_count");n.innerText=t}).catch(function(e){console.error(e)})</script>&nbsp;| è¯„è®º: &nbsp; <span id=comment_count></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#%e5%89%8d%e8%a8%80 aria-label=å‰è¨€>å‰è¨€</a></li><li><a href=#%e5%8e%9f%e7%90%86 aria-label=åŸç†>åŸç†</a></li><li><a href=#%e6%9c%b4%e7%b4%a0%e7%9a%84lru%e7%ae%97%e6%b3%95 aria-label=æœ´ç´ çš„LRUç®—æ³•>æœ´ç´ çš„LRUç®—æ³•</a><ul><li><a href=#%e5%9f%ba%e4%ba%8e%e6%95%b0%e7%bb%84 aria-label=åŸºäºæ•°ç»„>åŸºäºæ•°ç»„</a></li><li><a href=#%e5%9f%ba%e4%ba%8e%e9%95%bf%e5%ba%a6%e6%9c%89%e9%99%90%e7%9a%84%e5%8f%8c%e5%90%91%e9%93%be%e8%a1%a8 aria-label=åŸºäºé•¿åº¦æœ‰é™çš„åŒå‘é“¾è¡¨>åŸºäºé•¿åº¦æœ‰é™çš„åŒå‘é“¾è¡¨</a></li><li><a href=#%e5%9f%ba%e4%ba%8e%e5%8f%8c%e5%90%91%e9%93%be%e8%a1%a8%e5%92%8c%e5%93%88%e5%b8%8c%e8%a1%a8 aria-label=åŸºäºåŒå‘é“¾è¡¨å’Œå“ˆå¸Œè¡¨>åŸºäºåŒå‘é“¾è¡¨å’Œå“ˆå¸Œè¡¨</a></li><li><a href=#%e5%9f%ba%e4%ba%8elinkedhashmap%e5%ae%9e%e7%8e%b0%e7%9a%84lru aria-label=åŸºäºLinkedHashMapå®ç°çš„LRU>åŸºäºLinkedHashMapå®ç°çš„LRU</a></li></ul></li><li><a href=#lru%e7%ae%97%e6%b3%95%e4%bc%98%e5%8c%96 aria-label=LRUç®—æ³•ä¼˜åŒ–>LRUç®—æ³•ä¼˜åŒ–</a><ul><li><a href=#lru-k aria-label=LRU-K>LRU-K</a></li></ul></li><li><a href=#redis%e4%b8%ad%e7%9a%84lru%e7%ae%97%e6%b3%95 aria-label=redisä¸­çš„LRUç®—æ³•>redisä¸­çš„LRUç®—æ³•</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>[toc]</p><h1 id=å‰è¨€>å‰è¨€<a hidden class=anchor aria-hidden=true href=#å‰è¨€>#</a></h1><p>LRUç®—æ³•å…¨ç§°æ˜¯æœ€å°‘æœ€è¿‘ä½¿ç”¨ç®—æ³•ï¼ˆLeast Recently Useï¼‰ï¼Œå¹¿æ³›çš„åº”ç”¨äºç¼“å­˜æœºåˆ¶ä¸­ã€‚å½“ç¼“å­˜ä½¿ç”¨çš„ç©ºé—´è¾¾åˆ°ä¸Šé™åï¼Œå°±éœ€è¦ä»å·²æœ‰çš„æ•°æ®ä¸­æ·˜æ±°ä¸€éƒ¨åˆ†ä»¥ç»´æŒç¼“å­˜çš„å¯ç”¨æ€§ï¼Œè€Œæ·˜æ±°æ•°æ®çš„é€‰æ‹©å°±æ˜¯é€šè¿‡LRUç®—æ³•å®Œæˆçš„ã€‚</p><p>LRUç®—æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯åŸºäºå±€éƒ¨æ€§åŸç†çš„æ—¶é—´å±€éƒ¨æ€§ï¼š</p><blockquote><p>å¦‚æœä¸€ä¸ªä¿¡æ¯é¡¹æ­£åœ¨è¢«è®¿é—®ï¼Œé‚£ä¹ˆåœ¨è¿‘æœŸå®ƒå¾ˆå¯èƒ½è¿˜ä¼šè¢«å†æ¬¡è®¿é—®ã€‚</p></blockquote><p>æ‰€ä»¥é¡¾åæ€ä¹‰ï¼ŒLRUç®—æ³•ä¼šé€‰å‡ºæœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®è¿›è¡Œæ·˜æ±°ã€‚</p><h1 id=åŸç†>åŸç†<a hidden class=anchor aria-hidden=true href=#åŸç†>#</a></h1><p>ä¸€èˆ¬æ¥è®²ï¼ŒLRUå°†è®¿é—®æ•°æ®çš„é¡ºåºæˆ–æ—¶é—´å’Œæ•°æ®æœ¬èº«ç»´æŠ¤åœ¨ä¸€ä¸ªå®¹å™¨å½“ä¸­ã€‚å½“è®¿é—®ä¸€ä¸ªæ•°æ®æ—¶ï¼š</p><p>è¯¥æ•°æ®ä¸åœ¨å®¹å™¨å½“ä¸­ï¼Œåˆ™è®¾ç½®è¯¥æ•°æ®çš„ä¼˜å…ˆçº§ä¸ºæœ€é«˜å¹¶æ”¾å…¥å®¹å™¨ä¸­ã€‚è¯¥æ•°æ®åœ¨å®¹å™¨å½“ä¸­ï¼Œåˆ™æ›´æ–°è¯¥æ•°æ®çš„ä¼˜å…ˆçº§è‡³æœ€é«˜ã€‚å½“æ•°æ®çš„æ€»é‡è¾¾åˆ°ä¸Šé™åï¼Œåˆ™ç§»é™¤å®¹å™¨ä¸­ä¼˜å…ˆçº§æœ€ä½çš„æ•°æ®ã€‚ä¸‹å›¾æ˜¯ä¸€ä¸ªç®€å•çš„LRUåŸç†ç¤ºæ„å›¾ï¼š</p><p><img loading=lazy src=LRU.assets/16fad8c17f571f16tplv-t2oaga2asx-zoom-in-crop-mark3024000.webp alt=LRUåŸç†ç¤ºæ„å›¾.jpg></p><p>å¦‚æœæˆ‘ä»¬æŒ‰ç…§<code>7 0 1 2 0 3 0 4</code>çš„é¡ºåºæ¥è®¿é—®æ•°æ®ï¼Œä¸”æ•°æ®çš„æ€»é‡ä¸Šé™ä¸º3ï¼Œåˆ™å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒLRUç®—æ³•ä¼šä¾æ¬¡æ·˜æ±°7 1 2è¿™ä¸‰ä¸ªæ•°æ®ã€‚</p><blockquote><p>ç”±å›¾æ„Ÿè§‰, æ²¡æœ‰ä½“ç°å‡ºæœ€å°‘çš„æ¦‚å¿µ, æ›´è´´åˆ‡çš„æè¿°åº”è¯¥æ˜¯: æœ€è¿‘ä½¿ç”¨ç®—æ³•,</p></blockquote><h1 id=æœ´ç´ çš„lruç®—æ³•>æœ´ç´ çš„LRUç®—æ³•<a hidden class=anchor aria-hidden=true href=#æœ´ç´ çš„lruç®—æ³•>#</a></h1><p>é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨å°±æŒ‰ç…§ä¸Šé¢çš„åŸç†ï¼Œå®ç°ä¸€ä¸ªæœ´ç´ çš„LRUç®—æ³•ã€‚ä¸‹é¢æœ‰ä¸‰ç§æ–¹æ¡ˆï¼š</p><h2 id=åŸºäºæ•°ç»„>åŸºäºæ•°ç»„<a hidden class=anchor aria-hidden=true href=#åŸºäºæ•°ç»„>#</a></h2><p>æ–¹æ¡ˆï¼šä¸ºæ¯ä¸€ä¸ªæ•°æ®é™„åŠ ä¸€ä¸ªé¢å¤–çš„å±æ€§â€”â€”æ—¶é—´æˆ³ï¼Œå½“æ¯ä¸€æ¬¡è®¿é—®æ•°æ®æ—¶ï¼Œæ›´æ–°è¯¥æ•°æ®çš„æ—¶é—´æˆ³è‡³å½“å‰æ—¶é—´ã€‚å½“æ•°æ®ç©ºé—´å·²æ»¡åï¼Œåˆ™æ‰«ææ•´ä¸ªæ•°ç»„ï¼Œæ·˜æ±°æ—¶é—´æˆ³æœ€å°çš„æ•°æ®ã€‚</p><p>ä¸è¶³ï¼šç»´æŠ¤æ—¶é—´æˆ³éœ€è¦è€—è´¹é¢å¤–çš„ç©ºé—´ï¼Œæ·˜æ±°æ•°æ®æ—¶éœ€è¦æ‰«ææ•´ä¸ªæ•°ç»„ã€‚</p><h2 id=åŸºäºé•¿åº¦æœ‰é™çš„åŒå‘é“¾è¡¨>åŸºäºé•¿åº¦æœ‰é™çš„åŒå‘é“¾è¡¨<a hidden class=anchor aria-hidden=true href=#åŸºäºé•¿åº¦æœ‰é™çš„åŒå‘é“¾è¡¨>#</a></h2><p>æ–¹æ¡ˆï¼šè®¿é—®ä¸€ä¸ªæ•°æ®æ—¶ï¼Œå½“æ•°æ®ä¸åœ¨é“¾è¡¨ä¸­ï¼Œåˆ™å°†æ•°æ®æ’å…¥è‡³é“¾è¡¨å¤´éƒ¨ï¼Œå¦‚æœåœ¨é“¾è¡¨ä¸­ï¼Œåˆ™å°†è¯¥æ•°æ®ç§»è‡³é“¾è¡¨å¤´éƒ¨ã€‚å½“æ•°æ®ç©ºé—´å·²æ»¡åï¼Œåˆ™æ·˜æ±°é“¾è¡¨æœ€æœ«å°¾çš„æ•°æ®ã€‚</p><p>ä¸è¶³ï¼šæ’å…¥æ•°æ®æˆ–å–æ•°æ®æ—¶ï¼Œéœ€è¦æ‰«ææ•´ä¸ªé“¾è¡¨ã€‚</p><h2 id=åŸºäºåŒå‘é“¾è¡¨å’Œå“ˆå¸Œè¡¨>åŸºäºåŒå‘é“¾è¡¨å’Œå“ˆå¸Œè¡¨<a hidden class=anchor aria-hidden=true href=#åŸºäºåŒå‘é“¾è¡¨å’Œå“ˆå¸Œè¡¨>#</a></h2><p>æ–¹æ¡ˆï¼šä¸ºäº†æ”¹è¿›ä¸Šé¢éœ€è¦æ‰«æé“¾è¡¨çš„ç¼ºé™·ï¼Œé…åˆå“ˆå¸Œè¡¨ï¼Œå°†æ•°æ®å’Œé“¾è¡¨ä¸­çš„èŠ‚ç‚¹å½¢æˆæ˜ å°„ï¼ŒHashMap å­˜å‚¨ keyï¼Œè¿™æ ·å¯ä»¥åšåˆ° save å’Œ get keyçš„æ—¶é—´éƒ½æ˜¯ O(1) , è€Œ HashMap çš„ Value æŒ‡å‘åŒå‘é“¾è¡¨å®ç°çš„ LRU çš„ Node èŠ‚ç‚¹ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚</p><blockquote><p>é‡ç‚¹æ˜¯hashè¡¨, ä»¥hashè¡¨ä¸ºç»´åº¦æ“ä½œ</p></blockquote><p><img loading=lazy src="LRU.assets/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2JlbG9uZ3RvY29kZQ==,size_16,color_FFFFFF,t_70.png" alt=åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°></p><h2 id=åŸºäºlinkedhashmapå®ç°çš„lru>åŸºäºLinkedHashMapå®ç°çš„LRU<a hidden class=anchor aria-hidden=true href=#åŸºäºlinkedhashmapå®ç°çš„lru>#</a></h2><p>JDKç»™æˆ‘ä»¬æä¾›çš„<code>LinkedHashMap</code>ç›´æ¥å®ç°LRUã€‚å› ä¸º<code>LinkedHashMap</code>çš„åº•å±‚å³ä¸ºåŒå‘é“¾è¡¨å’Œå“ˆå¸Œè¡¨çš„ç»„åˆï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æ‹¿æ¥ä½¿ç”¨ã€‚</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LRUCache</span> <span style=color:#66d9ef>extends</span> LinkedHashMap <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> capacity<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>LRUCache</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> capacity<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//    trueè¡¨ç¤º è®¿é—®çš„é¡ºåº ï¼Œ falseè¡¨ç¤ºæ’å…¥çš„é¡ºåº
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// æ³¨æ„è¿™é‡Œå°†LinkedHashMapçš„accessOrderè®¾ä¸ºtrue
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>(</span>16<span style=color:#f92672>,</span> 0<span style=color:#f92672>.</span><span style=color:#a6e22e>75f</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>capacity</span> <span style=color:#f92672>=</span> capacity<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>removeEldestEntry</span><span style=color:#f92672>(</span>Map<span style=color:#f92672>.</span><span style=color:#a6e22e>Entry</span> eldest<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>()</span> <span style=color:#f92672>&gt;</span> capacity<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>é»˜è®¤<code>LinkedHashMap</code>å¹¶ä¸ä¼šæ·˜æ±°æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡å†™äº†å®ƒçš„<code>removeEldestEntry()</code>æ–¹æ³•ï¼Œå½“æ•°æ®æ•°é‡è¾¾åˆ°é¢„è®¾ä¸Šé™åï¼Œæ·˜æ±°æ•°æ®ï¼ŒaccessOrderè®¾ä¸ºtrueæ„ä¸ºæŒ‰ç…§è®¿é—®çš„é¡ºåºæ’åºã€‚æ•´ä¸ªå®ç°çš„ä»£ç é‡å¹¶ä¸å¤§ï¼Œä¸»è¦éƒ½æ˜¯åº”ç”¨LinkedHashMapçš„ç‰¹æ€§ã€‚</p><p>æ­£å› ä¸º<code>LinkedHashMap</code>è¿™ä¹ˆå¥½ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>Dubbo</code>çš„LRUç¼“å­˜<code>LRUCache</code>ä¹Ÿæ˜¯åŸºäºå®ƒå®ç°çš„ã€‚</p><h1 id=lruç®—æ³•ä¼˜åŒ–>LRUç®—æ³•ä¼˜åŒ–<a hidden class=anchor aria-hidden=true href=#lruç®—æ³•ä¼˜åŒ–>#</a></h1><p>æœ´ç´ çš„LRUç®—æ³•å·²ç»èƒ½å¤Ÿæ»¡è¶³ç¼“å­˜çš„è¦æ±‚äº†ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€äº›ä¸è¶³ã€‚å½“çƒ­ç‚¹æ•°æ®è¾ƒå¤šæ—¶ï¼Œæœ‰è¾ƒé«˜çš„å‘½ä¸­ç‡ï¼Œä½†æ˜¯<u>å¦‚æœæœ‰å¶å‘æ€§çš„æ‰¹é‡æ“ä½œï¼Œä¼šä½¿å¾—çƒ­ç‚¹æ•°æ®è¢«éçƒ­ç‚¹æ•°æ®æŒ¤å‡ºå®¹å™¨ï¼Œä½¿å¾—ç¼“å­˜å—åˆ°äº†â€œæ±¡æŸ“â€</u>ã€‚æ‰€ä»¥ä¸ºäº†æ¶ˆé™¤è¿™ç§å½±å“ï¼Œåˆè¡ç”Ÿå‡ºäº†ä¸‹é¢è¿™äº›ä¼˜åŒ–æ–¹æ³•ã€‚</p><h2 id=lru-k>LRU-K<a hidden class=anchor aria-hidden=true href=#lru-k>#</a></h2><p>LRU-Kç®—æ³•æ˜¯å¯¹LRUç®—æ³•çš„æ”¹è¿›ï¼Œå°†åŸå…ˆè¿›å…¥ç¼“å­˜é˜Ÿåˆ—çš„è¯„åˆ¤æ ‡å‡†ä»è®¿é—®ä¸€æ¬¡æ”¹ä¸ºè®¿é—®Kæ¬¡ï¼Œå¯ä»¥è¯´æœ´ç´ çš„LRUç®—æ³•ä¸ºLRU-1ã€‚</p><p>LRU-Kç®—æ³•æœ‰ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œä¸€ä¸ªæ˜¯ç¼“å­˜é˜Ÿåˆ—ï¼Œä¸€ä¸ªæ˜¯æ•°æ®è®¿é—®å†å²é˜Ÿåˆ—ã€‚å½“è®¿é—®ä¸€ä¸ªæ•°æ®æ—¶ï¼Œé¦–å…ˆå…ˆåœ¨è®¿é—®å†å²é˜Ÿåˆ—ä¸­ç´¯åŠ è®¿é—®æ¬¡æ•°ï¼Œå½“å†å²è®¿é—®è®°å½•è¶…è¿‡Kæ¬¡åï¼Œæ‰å°†æ•°æ®ç¼“å­˜è‡³ç¼“å­˜é˜Ÿåˆ—ï¼Œä»è€Œé¿å…ç¼“å­˜é˜Ÿåˆ—è¢«æ±¡æŸ“ã€‚åŒæ—¶è®¿é—®å†å²é˜Ÿåˆ—ä¸­çš„æ•°æ®å¯ä»¥æŒ‰ç…§LRUçš„è§„åˆ™è¿›è¡Œæ·˜æ±°ã€‚å…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img loading=lazy src=LRU.assets/16fad8c17ddbff64tplv-t2oaga2asx-zoom-in-crop-mark3024000.webp alt=LRU-K.png></p><p>å®ç°ä¸€ä¸ªLRU-Kç¼“å­˜</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// ç›´æ¥ç»§æ‰¿æˆ‘ä»¬å‰é¢å†™å¥½çš„LRUCache
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LRUKCache</span> <span style=color:#66d9ef>extends</span> LRUCache <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> k<span style=color:#f92672>;</span> <span style=color:#75715e>// è¿›å…¥ç¼“å­˜é˜Ÿåˆ—çš„è¯„åˆ¤æ ‡å‡†
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> LRUCache historyList<span style=color:#f92672>;</span> <span style=color:#75715e>// è®¿é—®æ•°æ®å†å²è®°å½•
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>LRUKCache</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> cacheSize<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> historyCapacity<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> k<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>(</span>cacheSize<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>k</span> <span style=color:#f92672>=</span> k<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>historyList</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> LRUCache<span style=color:#f92672>(</span>historyCapacity<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Integer <span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>Integer key<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// è®°å½•æ•°æ®è®¿é—®æ¬¡æ•°
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        Integer historyCount <span style=color:#f92672>=</span> historyList<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>key<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        historyCount <span style=color:#f92672>=</span> historyCount <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span> 0 <span style=color:#f92672>:</span> historyCount<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        historyList<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>key<span style=color:#f92672>,</span> <span style=color:#f92672>++</span>historyCount<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>key<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Integer <span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>Integer key<span style=color:#f92672>,</span> Integer value<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>value <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// å¦‚æœå·²ç»åœ¨ç¼“å­˜é‡Œåˆ™ç›´æ¥è¿”å›ç¼“å­˜ä¸­çš„æ•°æ®
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>key<span style=color:#f92672>)</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>key<span style=color:#f92672>,</span> value<span style=color:#f92672>);;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// å¦‚æœæ•°æ®å†å²è®¿é—®æ¬¡æ•°è¾¾åˆ°ä¸Šé™ï¼Œåˆ™åŠ å…¥ç¼“å­˜
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        Integer historyCount <span style=color:#f92672>=</span> historyList<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>key<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        historyCount <span style=color:#f92672>=</span> historyCount <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span> 0 <span style=color:#f92672>:</span> historyCount<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>historyCount <span style=color:#f92672>&gt;=</span> k<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// ç§»é™¤å†å²è®¿é—®è®°å½•
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            historyList<span style=color:#f92672>.</span><span style=color:#a6e22e>remove</span><span style=color:#f92672>(</span>key<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>super</span><span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>key<span style=color:#f92672>,</span> value<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ä¸Šé¢åªæ˜¯ä¸ªç®€å•çš„æ¨¡å‹ï¼Œå¹¶æ²¡æœ‰åŠ ä¸Šå¿…è¦çš„å¹¶å‘æ§åˆ¶ã€‚</p><p>ä¸€èˆ¬æ¥è®²ï¼Œå½“Kçš„å€¼è¶Šå¤§ï¼Œåˆ™ç¼“å­˜çš„å‘½ä¸­ç‡è¶Šé«˜ï¼Œä½†æ˜¯ä¹Ÿä¼šä½¿å¾—ç¼“å­˜éš¾ä»¥è¢«æ·˜æ±°ã€‚ç»¼åˆæ¥è¯´ï¼Œä½¿ç”¨LRU-2çš„æ€§èƒ½æœ€ä¼˜ã€‚</p><h1 id=redisä¸­çš„lruç®—æ³•>redisä¸­çš„LRUç®—æ³•<a hidden class=anchor aria-hidden=true href=#redisä¸­çš„lruç®—æ³•>#</a></h1><p>redisæ²¡æœ‰ä½¿ç”¨æ ‡å‡†çš„LRUç®—æ³•, åªæ˜¯è¿‘ä¼¼çš„LRUç®—æ³•, å› ä¸ºå«ŒLinkedListå ç”¨çš„ç©ºé—´å¤ªå¤§äº†</p><p>redisé€šè¿‡è®¡ç®—æ¯ä¸ªkeyçš„é—²ç½®æ—¶é—´æ¥å†³å®šæ˜¯å¦è¦é€‰å®ƒæ·˜æ±°(å…¨å±€æ—¶é’Ÿ å‡å» å½“å‰keyçš„è®¿é—®æ—¶é’Ÿ), redisä¼šéšæœºé€‰å‡ ä¸ªkey, å®ƒä»¬çš„é—²ç½®æ—¶é—´éƒ½è¦å¤§äºä¸€ä¸ªé˜ˆå€¼(å…¶å®ä¼šå­˜å…¥ä¸€ä¸ªpool, è¿™ä¸ªé˜ˆå€¼å°±æ˜¯poolä¸­æœ€å°çš„é—²ç½®æ—¶é—´), å½“å†…å­˜ä¸å¤Ÿæ—¶, å°±<strong>ä»è¿™å‡ ä¸ªkeyä¸­æ·˜æ±°é—²ç½®æ—¶é—´æœ€å¤§çš„å€¼</strong></p><p><a href=https://www.jianshu.com/p/c8aeb3eee6bc target=_blank rel=noopener>Redisçš„ç¼“å­˜æ·˜æ±°ç­–ç•¥LRUä¸LFU - ç®€ä¹¦ (jianshu.com)</a></p><p>æ›´å¤šå¯è§: <a href=..%5cRedis%5cRedis%e7%9a%84%e6%b7%98%e6%b1%b0%e7%ad%96%e7%95%a5LRU%e4%b8%8eLFU.md>Redisçš„æ·˜æ±°ç­–ç•¥LRUä¸LFU.md</a></p><p><a href=https://juejin.cn/post/6844904049263771662#heading-1 target=_blank rel=noopener>LRUç®—æ³•åŠå…¶ä¼˜åŒ–ç­–ç•¥â€”â€”ç®—æ³•ç¯‡ - æ˜é‡‘ (juejin.cn)</a></p><p><a href=https://blog.csdn.net/belongtocode/article/details/102989685 target=_blank rel=noopener>å…¨é¢è®²è§£LRUç®—æ³•_Apple_Webçš„åšå®¢-CSDNåšå®¢_lru ç®—æ³•</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://xiaokunji.github.io/myBlog/zh/tags/%E7%AE%97%E6%B3%95/>ç®—æ³•</a></li><li><a href=https://xiaokunji.github.io/myBlog/zh/tags/%E7%BB%BC%E5%90%88/>ç»¼åˆ</a></li></ul><nav class=paginav><a class=prev href=https://xiaokunji.github.io/myBlog/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/java%E5%9F%BA%E7%A1%80/lombok/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>lombok</span></a>
<a class=next href=https://xiaokunji.github.io/myBlog/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/maven/maven%E6%89%93%E5%8C%85%E6%8F%92%E4%BB%B6/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>mavenæ‰“åŒ…æ’ä»¶</span></a></nav></footer></article></main><footer class=footer><span>Copyright
&copy;
-2023
<a href=https://xiaokunji.github.io/myBlog/zh/ style=color:#939393>ç±³äºŒ</a>
All Rights Reserved</span>
<span id=busuanzi_container><span class="fa fa-user">ç”¨æˆ·æ•°:</span><span id=busuanzi_value_site_uv></span>
<span class="fa fa-eye">è®¿é—®æ•°:</span><span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="å¤åˆ¶";function s(){t.innerHTML="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerHTML="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>