<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>å‘½ä»¤ | ç±³äºŒ</title><meta name=keywords content=" å‰è¨€, 1. åŸºæœ¬æ ¼å¼, 2. å‘½ä»¤, 2.1 åˆ›å»ºç´¢å¼•, 2.2 æ’å…¥æ•°æ®, 2.3 ä¿®æ”¹æ•°æ®, 2.4 æŸ¥çœ‹, 2.5 åˆ é™¤, 2.6 ç®€å•æ’åº, 3. å¤æ‚æŸ¥è¯¢, 3.1 Query and filter context, 3.1.1 Query context, 3.1.2 Filter context, 3.2 å…¨æ–‡æŸ¥è¯¢( Full text), 3.1.1  match  query, 3.1.2 Match Phrase Query, 3.1.3 Multi Match Query, 3.1.4 Query String Query, 3.2 å•è¯çº§æŸ¥è¯¢(term text), 3.2.1  Term Query, 3.2.2  Terms Query, 3.2.3 Range Query, 3.2.4 Exsit Query, 3.2.5 Prefix Query, 3.2.6 Wildcard Query, 3.2.7 Regexp Query, 3.3 èšåˆæŸ¥è¯¢, 3.3.1  Metrics aggregations, 3.3.1.1 Min Aggregation, 3.3.1.2 Max Aggregation, 3.3.1.3 Avg Aggregation, 3.3.1.4  Sum Aggregation, 3.3.1.5  Count Aggregation, 3.3.1.6 Cardinality Aggregation, 3.3.1.7 Stats Aggregation, 3.3.1.8  Extended Stats Aggregation, 3.3.1.9 Percentiles Aggregation, 3.3.1.10 Percentiles Ranks Aggregation, 3.3.2  bucket aggregations, 3.3.2.1 Terms Aggregation, 3.2.2.2  Filter Aggregation, 3.2.2.3 Filters Aggregation, 3.2.2.4 Range Aggregation, 3.2.2.5 Date Range Aggr,  3.2.2.6 Range Aggr, 3.4 å¤åˆæŸ¥è¯¢, 3.4.1 Bool query, 3.4.2  boosting query"><meta name=description content="     "><meta name=author content="xkj"><link rel=canonical href=https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/ELK/ElasticSearch/%E5%91%BD%E4%BB%A4.html><link crossorigin=anonymous href=/assets/css/stylesheet.b3faf608c544858ba700943ffe182cb647f38432d29a07d73234965beacb26f6.css integrity="sha256-s/r2CMVEhYunAJQ//hgstkfzhDLSmgfXMjSWW+rLJvY=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://xiaokunji.com/img/Q.svg><link rel=icon type=image/png sizes=16x16 href=https://xiaokunji.com/img/Q.svg><link rel=icon type=image/png sizes=32x32 href=https://xiaokunji.com/img/Q.svg><link rel=apple-touch-icon href=https://xiaokunji.com/Q.svg><link rel=mask-icon href=https://xiaokunji.com/Q.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/ELK/ElasticSearch/%E5%91%BD%E4%BB%A4.html><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="å‘½ä»¤"><meta property="og:description" content="     "><meta property="og:type" content="article"><meta property="og:url" content="https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/ELK/ElasticSearch/%E5%91%BD%E4%BB%A4.html"><meta property="article:section" content="ç»¼åˆ"><meta property="article:published_time" content="2023-08-22T00:00:00+00:00"><meta property="article:modified_time" content="2023-09-11T17:02:27+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="å‘½ä»¤"><meta name=twitter:description content="     "><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":5,"name":"å‘½ä»¤","item":"https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/ELK/ElasticSearch/%E5%91%BD%E4%BB%A4.html"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"å‘½ä»¤","name":"å‘½ä»¤","description":"     ","keywords":[" å‰è¨€"," 1. åŸºæœ¬æ ¼å¼"," 2. å‘½ä»¤"," 2.1 åˆ›å»ºç´¢å¼•"," 2.2 æ’å…¥æ•°æ®"," 2.3 ä¿®æ”¹æ•°æ®"," 2.4 æŸ¥çœ‹"," 2.5 åˆ é™¤"," 2.6 ç®€å•æ’åº"," 3. å¤æ‚æŸ¥è¯¢"," 3.1 Query and filter context"," 3.1.1 Query context"," 3.1.2 Filter context"," 3.2 å…¨æ–‡æŸ¥è¯¢( Full text)"," 3.1.1  match  query"," 3.1.2 Match Phrase Query"," 3.1.3 Multi Match Query"," 3.1.4 Query String Query"," 3.2 å•è¯çº§æŸ¥è¯¢(term text)"," 3.2.1  Term Query"," 3.2.2  Terms Query"," 3.2.3 Range Query"," 3.2.4 Exsit Query"," 3.2.5 Prefix Query"," 3.2.6 Wildcard Query"," 3.2.7 Regexp Query"," 3.3 èšåˆæŸ¥è¯¢"," 3.3.1  Metrics aggregations"," 3.3.1.1 Min Aggregation"," 3.3.1.2 Max Aggregation"," 3.3.1.3 Avg Aggregation"," 3.3.1.4  Sum Aggregation"," 3.3.1.5  Count Aggregation"," 3.3.1.6 Cardinality Aggregation"," 3.3.1.7 Stats Aggregation"," 3.3.1.8  Extended Stats Aggregation"," 3.3.1.9 Percentiles Aggregation"," 3.3.1.10 Percentiles Ranks Aggregation"," 3.3.2  bucket aggregations"," 3.3.2.1 Terms Aggregation"," 3.2.2.2  Filter Aggregation"," 3.2.2.3 Filters Aggregation"," 3.2.2.4 Range Aggregation"," 3.2.2.5 Date Range Aggr","  3.2.2.6 Range Aggr"," 3.4 å¤åˆæŸ¥è¯¢"," 3.4.1 Bool query"," 3.4.2  boosting query"],"articleBody":"[toc]\nå‰è¨€ æœ¬æ–‡ä»¥å‘½ä»¤è¡Œä¸ºä¸»\nå…¶æœ¬è´¨è¿˜æ˜¯å‘é€httpè¯·æ±‚å»æ“ä½œæ•°æ®\n1. åŸºæœ¬æ ¼å¼ esæ˜¯ä»¥RESTFulé£æ ¼æ¥å‘½åAPIçš„ï¼Œå…¶APIçš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š\nhttp://:/\u003cç´¢å¼•\u003e/\u003cç±»å‹\u003e/\u003cæ–‡æ¡£id\u003e\nè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥æ ¼å¼ä»es7.0.0å¼€å§‹ï¼Œç§»é™¤Typeï¼ˆç±»å‹ï¼‰è¿™ä¸ªæ¦‚å¿µï¼Œæ–°çš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š\nhttp://:/\u003cç´¢å¼•\u003e/_doc/\u003cæ–‡æ¡£id\u003e\nTypeï¼ˆç±»å‹ï¼‰å­—æ®µé‚£é‡Œå˜ä¸ºå›ºå®šå€¼ _doc\nesçš„åŠ¨ä½œæ˜¯ä»¥httpæ–¹æ³•æ¥å†³å®šçš„: å¸¸ç”¨çš„httpæ–¹æ³•: GET/PUT/POST/DELETE\npost ä¸»åšä¿®æ”¹, putä¸»åšåˆ›å»º\npostä¹Ÿæœ‰åˆ›å»ºçš„åŠŸèƒ½,ç‰¹åˆ«æ˜¯æ’å…¥æ•°æ®ç”Ÿæˆéšæœºidæ—¶\n2. å‘½ä»¤ 2.1 åˆ›å»ºç´¢å¼• curl -XPUT http://localhost:9200/xkj_test æ²¡æœ‰æŒ‡å®šmappings,æ•…ä¸ºéç»“æ„åŒ–ç´¢å¼•,ä¹Ÿæ²¡æœ‰å­—æ®µ\n// ç»“æ„åŒ–ç´¢å¼•: æŒ‡å®šäº†mappings curl -X PUT 'localhost:9200/accounts' -d ' { \"mappings\": { // mappings æ˜ å°„ \"man\": { // type \"properties\": { // å…·ä½“å±æ€§ \"name\": { // å­—æ®µå \"type\":\"text\" // å­—æ®µç±»å‹ // ....è¿˜æœ‰å…¶ä»–å¯ä»¥é€‰,æ¯”å¦‚æ‹†åˆ†è§„åˆ™,æƒé‡å€¼ }, \"country\": { \"type\":\"keyword\" }, \"age\": { \"type\":\"integer\" }, \"date\": { \"type\": \"date\", \"format\": \"yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis\" } } }, // \"worman\": {} // 6.xç‰ˆæœ¬åªæ”¯æŒä¸€ä¸ªtype } } }' å…¶æ ¸å¿ƒæ˜¯é‡Œé¢çš„jsonå­—ç¬¦ä¸²\n2.2 æ’å…¥æ•°æ® curl -X POST 'localhost:9200/accounts/person/1000' -d ' // è¿™ä¸ª1000è¡¨ç¤ºid,å¦‚æœä¸å†™esä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª,å¦‚æœè¿ç´¢å¼•å’Œç±»å‹ä¹Ÿæ²¡æœ‰ä¹Ÿä¼šä¸€å¹¶åˆ›å»º,å¦‚æœidå·²å­˜åœ¨åˆ™ä¿®æ”¹ { \"user\": \"å¼ ä¸‰\", \"title\": \"å·¥ç¨‹å¸ˆ\", \"desc\": \"æ•°æ®åº“ç®¡ç†\" }' æ ¼å¼æ˜¯ ip:port/ç´¢å¼•/ç±»å‹/id, å‚æ•°æ˜¯å„å±æ€§çš„jsonå­—ç¬¦ä¸²\n2.3 ä¿®æ”¹æ•°æ® post http://localhost:9200/test/_doc/1/_update { \"script\": { \"lang\": \"painless\", \"inline\": \"ctx._source.age += 30\" } } å…³é”®å­—â€scriptâ€: æ ‡å¿—ä»¥è„šæœ¬çš„æ–¹å¼ä¿®æ”¹æ–‡æ¡£\nâ€œlangâ€ï¼šè¡¨ç¤ºä»¥ä½•ç§è„šæœ¬è¯­è¨€è¿›è¡Œä¿®æ”¹ï¼Œâ€œpainlessâ€è¡¨ç¤ºä»¥eså†…ç½®çš„è„šæœ¬è¯­è¨€è¿›è¡Œä¿®æ”¹ã€‚æ­¤å¤–esè¿˜æ”¯æŒå¤šç§è„šæœ¬è¯­è¨€ï¼Œå¦‚Pythonï¼Œjsç­‰ç­‰\nâ€œinlineâ€ï¼šæŒ‡å®šè„šæœ¬å†…å®¹ â€œctxâ€ä»£è¡¨esä¸Šä¸‹æ–‡ï¼Œ_source ä»£è¡¨æ–‡æ¡£\næ ¹æ®æ¡ä»¶ä¿®æ”¹ä¿¡æ¯:\nPOST my_index/_update_by_query { \"script\": { \"source\": \"ctx._source['ipsub']=0\" }, \"query\": { \"bool\": { \"must_not\": [ { \"exists\": { \"field\": \"ipsub\" } } ] } } ä¸Šé¢è¯­å¥æ˜¯æ ¹æ®æ˜¯å¦å­˜åœ¨\"ipsub\"å­—æ®µï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œç»™ä¿¡æ¯å¢åŠ å­—æ®µ\"ipsub\"ï¼Œå¹¶ä¸”èµ‹å€¼0\n2.4 æŸ¥çœ‹ æŸ¥çœ‹xkj_testç´¢å¼•æ•°æ®æ ¼å¼ curl -X GET http://localhost:9200/xkj_test/ æŸ¥çœ‹xkj_testç´¢å¼•ä¸‹æŒ‡å®šidæŸ¥çœ‹ curl -X GET 'localhost:9200/xkj_test/person/1000?pretty=true' æ ¹æ®æ¡ä»¶æŸ¥è¯¢ curl -X POST 'localhost:9200/accounts/person/_search' -d ' // è¦å¸¦ä¸Š _search å…³é”®å­— { \"query\" : { \"match\" : [{ \"desc\" : \"è½¯ä»¶\" },{ \"desc\" : \"è½¯ä»¶ å·¥ç¨‹\" }]} }' and æŸ¥è¯¢: matchå†™å¤šä¸ªæ¡ä»¶\nor æŸ¥è¯¢: åˆ©ç”¨ç©ºæ ¼çš„åˆ†è¯,è¾¾åˆ°orçš„æ•ˆæœ(æˆ‘çŒœçš„)\n_score ï¼šåŒ¹é…åº¦\n_sourceï¼šæ–‡æ¡£çš„å­—æ®µ\næ¥æº: https://www.jianshu.com/p/083d99a1db6e esçš„æŸ¥è¯¢äº”èŠ±å…«é—¨,æœ€å¥½çš„æŠ€æœ¯ä¹¦ç±å°±æ˜¯å®˜ç½‘,ä»¥åå¥½å¥½çœ‹,å¦‚æœè¦æŸ¥æ•°æ®,å€ŸåŠ©å¯è§†åŒ–ç•Œé¢å°±å¤Ÿç”¨äº†\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/index.html 2.5 åˆ é™¤ åˆ é™¤xkj_testç´¢å¼•\ndelete http://localhost:9200/xkj_test/ åˆ é™¤xkj_testç´¢å¼•ä¸‹çš„æ•°æ®(æŒ‡å®šid)\ndelete http://localhost:9200/xkj_test/_doc/1 æ ¹æ®æ¡ä»¶åˆ é™¤xkj_testç´¢å¼•ä¸‹test1ç±»å‹çš„æ•°æ®\npost http://localhost:9200/xkj_test/test1/_delete_by_query { \"query\": { \"range\": { \"createDate\": { \"lt\": \"now-31d\" } } } } è§£é‡Š: åˆ é™¤ createDate å­—æ®µä¸‹31å¤©å‰çš„æ•°æ®\nåˆ©ç”¨_delete_by_queryæ’ä»¶å»æ‰¹é‡åˆ é™¤\nhttps://blog.csdn.net/weixin_44034192/article/details/89372934 2.6 ç®€å•æ’åº æŒ‰ç…§æŒ‡å®šå­—æ®µæ’åº,(é»˜è®¤æŒ‰ç…§åˆ†æ•°æ’åº)\nGET books/_search { \"sort\": [ \"price\": { \"order\": \"desc\" }, \"age\": { \"order\": \"desc\" } ] } // æŒ‰ç…§ä»·æ ¼é™åºæ’,å†æŒ‰å¹´é¾„æ’ åœ¨ Elasticsearch ä¸­ï¼Œé»˜è®¤æ’åºæ˜¯æŒ‰ç…§ç›¸å…³æ€§çš„è¯„åˆ†ï¼ˆ_scoreï¼‰è¿›è¡Œé™åºæ’åºï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§å­—æ®µçš„å€¼æ’åºã€å¤šçº§æ’åºã€å¤šå€¼å­—æ®µæ’åºã€åŸºäº geoï¼ˆåœ°ç†ä½ç½®ï¼‰æ’åºä»¥åŠè‡ªå®šä¹‰è„šæœ¬æ’åºï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå¯¹äºç›¸å…³æ€§çš„è¯„åˆ†ä¹Ÿå¯ä»¥ç”¨ rescore äºŒæ¬¡ã€ä¸‰æ¬¡æ‰“åˆ†ï¼Œå®ƒå¯ä»¥é™å®šé‡æ–°æ‰“åˆ†çš„çª—å£å¤§å°ï¼ˆwindow sizeï¼‰ï¼Œå¹¶é’ˆå¯¹ä½œç”¨èŒƒå›´å†…çš„æ–‡æ¡£ä¿®æ”¹å…¶å¾—åˆ†ï¼Œä»è€Œè¾¾åˆ°ç²¾ç»†åŒ–æ§åˆ¶ç»“æœç›¸å…³æ€§çš„ç›®çš„ã€‚\n3. å¤æ‚æŸ¥è¯¢ 3.1 Query and filter context æŸ¥è¯¢å­å¥çš„è¡Œä¸ºå–å†³äºå®ƒæ˜¯ç”¨åœ¨æŸ¥è¯¢ä¸Šä¸‹æ–‡ï¼ˆquery contextï¼‰è¿˜æ˜¯ç”¨åœ¨è¿‡æ»¤å™¨ä¸Šä¸‹æ–‡ï¼ˆfilter contextï¼‰ï¼š\n3.1.1 Query context åœ¨æŸ¥è¯¢ä¸Šä¸‹æ–‡ä¸­çš„æŸ¥è¯¢å­å¥å›ç­”äº†â€œè¿™ä¸ªæ–‡æ¡£ä¸è¿™ä¸ªæŸ¥è¯¢å­å¥çš„åŒ¹é…ç¨‹åº¦æ˜¯æ€æ ·çš„ï¼Ÿâ€é—®é¢˜ã€‚é™¤äº†å†³å®šæ–‡æ¡£æ˜¯å¦åŒ¹é…ä»¥å¤–ï¼ŒæŸ¥è¯¢å­å¥è¿˜ä¼šè®¡ç®—ä¸€ä¸ªâ€œ_scoreâ€ï¼Œå®ƒè¡¨ç¤ºæ–‡æ¡£ä¸å…¶ä»–æ–‡æ¡£çš„ç›¸å…³ç¨‹åº¦(åˆ†æ•°)ã€‚\n3.1.2 Filter context åœ¨è¿‡æ»¤å™¨ä¸Šä¸‹æ–‡ä¸­ï¼Œä¸€ä¸ªæŸ¥è¯¢å­å¥å›ç­”äº†â€œè¿™ä¸ªæ–‡æ¡£ä¸æŸ¥è¯¢å­å¥åŒ¹é…å—ï¼Ÿâ€çš„é—®é¢˜ã€‚è¿™ä¸ªç­”æ¡ˆæ˜¯ç®€å•çš„Yesæˆ–è€…Noï¼Œä¹Ÿä¸ä¼šè®¡ç®—åˆ†æ•°ã€‚è¿‡æ»¤ä¸Šä¸‹æ–‡ä¸»è¦ç”¨äºè¿‡æ»¤ç»“æ„åŒ–æ•°æ®\nPSï¼šQuery VS Filter\næŸ¥è¯¢ååº”çš„æ˜¯æ–‡æ¡£ä¸æŸ¥è¯¢å­å¥çš„åŒ¹é…ç¨‹åº¦ï¼Œè€Œè¿‡æ»¤ååº”çš„æ˜¯æ–‡æ¡£æ˜¯å¦åŒ¹é…æŸ¥è¯¢å­å¥ ä¸€ä¸ªæ˜¯ç­›é€‰æ˜¯å¦æ»¡è¶³æ¡ä»¶ï¼Œæƒ…å†µæ— éä¸¤ç§ï¼šæ˜¯æˆ–ä¸æ˜¯ï¼›ä¸€ä¸ªæ˜¯çœ‹æ»¡è¶³æ¡ä»¶çš„è®°å½•ä¸æŸ¥è¯¢æ¡ä»¶çš„åŒ¹é…ç¨‹åº¦ å“ªäº›æ»¡è¶³æ¡ä»¶ï¼Œè¿™æ˜¯è¿‡æ»¤ï¼›æ»¡è¶³æ¡ä»¶çš„è¿™äº›è®°å½•ä¸æ¡ä»¶çš„åŒ¹é…ç¨‹åº¦ï¼Œè¿™æ˜¯æŸ¥è¯¢ è¿‡æ»¤ä¸ä¼šè®¡ç®—è¯„åˆ†ï¼ŒæŸ¥è¯¢ä¼šè®¡ç®—è¯„åˆ† 3.2 å…¨æ–‡æŸ¥è¯¢( Full text) 3.1.1 match query matchæŸ¥è¯¢æ¥å—æ–‡æœ¬/æ•°å€¼/æ—¥æœŸç±»å‹çš„æ•°æ®ï¼Œåˆ†æå®ƒä»¬ï¼Œå¹¶æ„é€ ä¸€ä¸ªæŸ¥è¯¢ã€‚\nç›¸å½“äºæ¨¡ç³ŠæŸ¥è¯¢\nmatchæ˜¯ä¸€ç§å¸ƒå°”ç±»å‹çš„æŸ¥è¯¢ã€‚è¿™æ„å‘³ç€å®ƒå¯¹æä¾›çš„æ–‡æœ¬è¿›è¡Œåˆ†æï¼Œå¹¶åœ¨åˆ†æçš„è¿‡ç¨‹ä¸­ä¸ºæä¾›çš„æ–‡æœ¬æ„é€ ä¸€ä¸ªå¸ƒå°”æŸ¥è¯¢ã€‚operator é€‰é¡¹å¯ä»¥è®¾ç½®ä¸º or æˆ–è€… and ä»¥æ­¤æ¥æ§åˆ¶å¸ƒå°”å­å¥ï¼ˆé»˜è®¤æ˜¯ or ï¼‰ã€‚ä¾‹å¦‚\ncurl -X GET \"localhost:9200/_search\" -H 'Content-Type: application/json' -d' { \"query\": { \"match\" : { \"skuName\" : \"ç©ºè°ƒ\" } } }' 3.1.2 Match Phrase Query match_phrase æŸ¥è¯¢ä¸ matchç±»ä¼¼ï¼Œä½†æ˜¯å®ƒæ˜¯ç”¨äºç²¾ç¡®åŒ¹é…æˆ–å•è¯æ¥è¿‘åŒ¹é…çš„ã€‚ä¾‹å¦‚ï¼š\ncurl -X GET \"localhost:9200/_search\" -H 'Content-Type: application/json' -d' { \"query\": { \"match_phrase\" : { \"skuName\" : \"this is a test\" } } }' 3.1.3 Multi Match Query multi_match ç›¸å½“äº match çš„å¤šå­—æ®µç‰ˆæœ¬, multi_matchå¯ä»¥æŒ‡å®šå¤šä¸ªå­—æ®µï¼Œè€Œmatchåªèƒ½é’ˆå¯¹ä¸€ä¸ªå­—æ®µ\ncurl -X GET \"localhost:9200/_search\" -H 'Content-Type: application/json' -d' { \"query\": { \"multi_match\" : { \"query\": \"this is a test\", \"fields\": [ \"subject\", \"skuName\" ] } } } ' fields é‡Œçš„å­—æ®µç”¨ * æ”¯æŒæ¨¡ç³ŠåŒ¹é…, å†™æˆè¿™ç§ [ \"subject^3\", \"skuName\" ] è¡¨ç¤ºsubjectæ¯”skuNameé‡è¦3å€ 3.1.4 Query String Query æ”¯æŒLuceneæŸ¥è¯¢å­—ç¬¦ä¸²è¯­æ³•ï¼Œå…è®¸æŒ‡å®š AND | OR | NOT ï¼Œå¹¶ä¸”åœ¨å•ä¸ªæŸ¥è¯¢å­—ç¬¦ä¸²ä¸­è¿›è¡Œå¤šå­—æ®µæŸ¥è¯¢, åˆ†è¯åå¯¹æ¯ä¸ªè¯éƒ½æŸ¥è¯¢\ncurl -X GET \"localhost:9200/_search\" -H 'Content-Type: application/json' -d' { \"query\": { \"query_string\" : { \"default_field\" : \"skuName\", \"query\" : \"this that thus\" } } } ' // åœ¨skuNameä¸­æŸ¥è¯¢ this , that , thus ä¸‰ä¸ªè¯ , å…¶å®è´¨è§£ææˆ: \" this OR that OR thus\", ä½ å¯ä»¥æ›¿æ¢ORä¸ºAND/NOT // è¿˜å¯ä»¥æŒ‡å®šå¿« ä¾‹å¦‚: \"query\" : \"(new york city) OR (big apple)\" è¿™æ ·å°†è¢«æ‹†åˆ†æˆ â€œnew york cityâ€ å’Œ â€œbig appleâ€ ä¸¤éƒ¨åˆ†ï¼Œå¹¶ä¸”æ¯ä¸€éƒ¨åˆ†éƒ½è¢«åˆ†æå™¨ç‹¬ç«‹åˆ†æ curl -X GET \"localhost:9200/_search\" -H 'Content-Type: application/json' -d' { \"query\": { \"query_string\" : { \"fields\" : [\"content\", \"name\"], \"query\" : \"this AND that\" } } } ' // ç­‰ä»·äº curl -X GET \"localhost:9200/_search\" -H 'Content-Type: application/json' -d' { \"query\": { \"query_string\": { \"query\": \"(content:this OR name:this) AND (content:that OR name:that)\" } } } ' æ³¨æ„ï¼ŒæŒ‰æ“ä½œç¬¦æ‹†åˆ†\nquery_stringçš„å‚æ•°åŒ…æ‹¬ï¼š\nqueryã€€å®ä¾‹è¢«è§£æçš„æŸ¥è¯¢æ–‡æœ¬\ndefault_fieldã€€å¦‚æœæ²¡æœ‰æŒ‡å®šå‰ç¼€å­—æ®µçš„è¯ï¼Œè¿™æ˜¯é»˜è®¤çš„æŸ¥è¯¢å­—æ®µã€‚ï¼ˆé»˜è®¤æŸ¥è¯¢æ‰€æœ‰å­—æ®µï¼‰\ndefault_operatorã€€å¦‚æœæ²¡æœ‰æ˜ç¡®æŒ‡å®šæ“ä½œç¬¦çš„è¯ï¼Œé‚£ä¹ˆè¿™æ˜¯é»˜è®¤çš„æ“ä½œç¬¦ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé»˜è®¤æ“ä½œç¬¦æ˜¯ORçš„è¯ï¼Œé‚£ä¹ˆâ€œmy name is jackâ€å°†è¢«ç¿»è¯‘æˆâ€œmy OR name OR is OR jackâ€ï¼ŒåŒç†ï¼Œå¦‚æœæ˜¯ANDï¼Œåˆ™è¢«ç¿»è¯‘æˆâ€œmy AND name AND is AND jackâ€\nanalyzerã€€ç”¨æ¥è§£ææŸ¥è¯¢å­—ç¬¦ä¸²çš„è§£æå™¨çš„åå­—\nallow_leading_wildcardã€€å¦‚æœè®¾ç½®äº†ï¼Œé‚£ä¹ˆ * æˆ– ? å…è®¸ä½œä¸ºç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚é»˜è®¤æ˜¯true\nlenientã€€å¦‚æœè®¾ç½®ä¸ºtrueï¼Œåˆ™æ ¼å¼å¤±è´¥å°†è¢«å¿½ç•¥\n3.2 å•è¯çº§æŸ¥è¯¢(term text) å…¨æ–‡æœ¬æŸ¥è¯¢ä¼šåœ¨æ‰§è¡Œä¹‹å‰å¯¹æŸ¥è¯¢å­—ç¬¦ä¸²è¿›è¡Œåˆ†æï¼Œè€Œå•è¯çº§åˆ«æŸ¥è¯¢ä¼šå¯¹å­˜å‚¨åœ¨åå‘ç´¢å¼•ä¸­çš„ç²¾ç¡®çš„termè¿›è¡Œæ“ä½œã€‚\nè¿™äº›æŸ¥è¯¢é€šå¸¸ç”¨äºç»“æ„åŒ–çš„æ•°æ®ï¼Œæ¯”å¦‚ï¼šnumbers ï¼Œ dates ï¼Œenums ç­‰ï¼Œè€Œä¸æ˜¯å¯¹å…¨æ–‡æœ¬å­—æ®µã€‚\nï¼ˆPSï¼šä¹Ÿå°±æ˜¯è¯´ï¼Œå…¨æ–‡æœ¬æŸ¥è¯¢ä¹‹å‰è¦å…ˆå¯¹æ–‡æœ¬å†…å®¹è¿›è¡Œåˆ†è¯ï¼Œè€Œå•è¯çº§åˆ«çš„æŸ¥è¯¢ç›´æ¥åœ¨ç›¸åº”å­—æ®µçš„åå‘ç´¢å¼•ä¸­ç²¾ç¡®æŸ¥æ‰¾ï¼Œå•è¯çº§åˆ«çš„æŸ¥è¯¢ä¸€èˆ¬ç”¨äºæ•°å€¼ã€æ—¥æœŸç­‰ç±»å‹çš„å­—æ®µä¸Šï¼‰\n3.2.1 Term Query åœ¨æŒ‡å®šçš„å­—æ®µä¸­æŸ¥æ‰¾åŒ…å«æŒ‡å®šçš„ç²¾ç¡®çš„termçš„æ–‡æ¡£\ntermæŸ¥è¯¢å°†åœ¨åå‘ç´¢å¼•ï¼ˆæˆ–è€…å«å€’æ’ç´¢å¼•ï¼‰ä¸­æŸ¥æ‰¾åŒ…å«ç‰¹å®šçš„ç²¾ç¡®çš„termçš„æ–‡æ¡£ã€‚ä¾‹å¦‚ï¼š\ncurl -X POST \"localhost:9200/_search\" -H 'Content-Type: application/json' -d' { \"query\": { \"term\" : { \"user\" : \"Kimchy\" } } } ' // æŸ¥è¯¢å€’æ’ç´¢å¼•(åˆ‡è¯å)ä¸­useråŒ…å«\"kimchy\"å­—ç¬¦ä¸²çš„å€¼, 3.2.2 Terms Query æŸ¥æ‰¾åŒ…å«æŒ‡å®šå­—æ®µä¸­æŒ‡å®šçš„ä»»ä½•ç¡®åˆ‡termçš„æ–‡æ¡£\nç­›é€‰å‡ºä¸æ‰€æä¾›çš„termsä¸­ä»»ä½•ä¸€ä¸ªåŒ¹é…çš„æ–‡æ¡£\ncurl -X GET \"localhost:9200/_search\" -H 'Content-Type: application/json' -d' { \"query\": { \"terms\" : { \"user\" : [\"kimchy\", \"elasticsearch\"]} } } ' // æŸ¥è¯¢ åˆ‡è¯ååŒ…å«\"kimchy\"æˆ–è€… \"elasticsearch\"æ–‡æ¡£ 3.2.3 Range Query æŸ¥æ‰¾æŒ‡å®šå­—æ®µåœ¨æŒ‡å®šèŒƒå›´å†…åŒ…å«å€¼ï¼ˆæ—¥æœŸã€æ•°å­—æˆ–å­—ç¬¦ä¸²ï¼‰çš„æ–‡æ¡£ã€‚\nä¸‹é¢çš„ä¾‹å­è¿”å›ageå­—æ®µçš„å€¼åœ¨10åˆ°20ä¹‹é—´çš„æ–‡æ¡£ï¼š\ncurl -X GET \"localhost:9200/_search\" -H 'Content-Type: application/json' -d' { \"query\": { \"range\" : { \"age\" : { \"gte\" : 10, \"lte\" : 20, \"boost\" : 2.0 } } } } ' rangeæŸ¥è¯¢å¯ä»¥æ¥å—ä¸‹åˆ—å‚æ•°ï¼š\ngteã€€å¤§äºæˆ–ç­‰äº\ngtã€€å¤§äº\nlteã€€å°äºæˆ–ç­‰äº\nltã€€å°äº\nboostã€€è®¾ç½®boostå€¼ï¼Œé»˜è®¤æ˜¯1.0\nåœ¨æ—¥æœŸèŒƒå›´æŸ¥è¯¢çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šæ—¥æœŸæ ¼å¼ã€‚ä¾‹å¦‚ï¼š(æ—¶é—´æ ¼å¼esä¼šè‡ªåŠ¨è½¬åŒ–,ç”¨å­—ç¬¦ä¸²å»æŸ¥æ—¶é—´æ ¼å¼ä¹Ÿèƒ½è¡Œ)\ncurl -X GET \"localhost:9200/_search\" -H 'Content-Type: application/json' -d' { \"query\": { \"range\" : { \"born\" : { \"gte\": \"01/01/2012\", \"lte\": \"2013\", \"format\": \"dd/MM/yyyy||yyyy\" } } } } ' // è¿™ä¸ªä¾‹å­æ˜¯æŸ¥è¯¢åœ¨2012-01-01åˆ°2013-12-31ä¹‹é—´å‡ºç”Ÿçš„äºº curl -X GET \"localhost:9200/_search\" -H 'Content-Type: application/json' -d' { \"query\": { \"range\" : { \"timestamp\" : { \"gte\": \"2015-01-01 00:00:00\", \"lte\": \"now\", \"time_zone\": \"+01:00\" } } } } ' 3.2.4 Exsit Query åœ¨ç‰¹å®šçš„å­—æ®µä¸­æŸ¥æ‰¾éç©ºå€¼çš„æ–‡æ¡£\ncurl -X GET \"localhost:9200/_search\" -H 'Content-Type: application/json' -d' { \"query\": { \"exists\" : { \"field\" : \"user\" } } } ' 3.2.5 Prefix Query æŸ¥æ‰¾åŒ…å«å¸¦æœ‰æŒ‡å®šå‰ç¼€çš„termçš„æ–‡æ¡£\ncurl -X GET \"localhost:9200/_search\" -H 'Content-Type: application/json' -d' { \"query\": { \"prefix\" : { \"user\" : \"ki\" } } } ' 3.2.6 Wildcard Query æ”¯æŒé€šé…ç¬¦æŸ¥è¯¢ï¼Œ*è¡¨ç¤ºä»»æ„å­—ç¬¦ï¼Œ?è¡¨ç¤ºä»»æ„å•ä¸ªå­—ç¬¦\nè¿™ä¸ªæŸ¥è¯¢æ•ˆç‡æ¯”è¾ƒæ…¢\ncurl -X GET \"localhost:9200/_search\" -H 'Content-Type: application/json' -d' { \"query\": { \"wildcard\" : { \"user\" : \"ki*y\" } } } ' 3.2.7 Regexp Query curl -X GET \"localhost:9200/_search\" -H 'Content-Type: application/json' -d' { \"query\": { \"regexp\":{ \"name.first\": \"s.*y\" } } } ' prefix å’Œ wildcard å’Œ regexp ä¸‰è€…å·¥ä½œæ–¹å¼æ˜¯ä¸€æ ·çš„ ,éœ€è¦æ‰«æå€’æ’ç´¢å¼•ä¸­çš„è¯åˆ—è¡¨æ‰èƒ½æ‰¾åˆ°æ‰€æœ‰åŒ¹é…çš„è¯ï¼Œç„¶åä¾æ¬¡è·å–æ¯ä¸ªè¯ç›¸å…³çš„æ–‡æ¡£ ID\næ€§èƒ½å¯¹æ¯”: prefix \u003e wildcard \u003e regexp\nwildcard å’Œ regexpè¦é¿å…å·¦æ¨¡ç³ŠæŸ¥è¯¢\nå®˜ç½‘ 3.3 èšåˆæŸ¥è¯¢ Elasticsearch çš„èšåˆï¼ˆAggregationsï¼‰åŠŸèƒ½ååˆ†å¼ºå¤§ï¼Œå…è®¸åœ¨æ•°æ®ä¸Šåšå¤æ‚çš„åˆ†æç»Ÿè®¡ã€‚Elasticsearch æä¾›çš„èšåˆåˆ†æåŠŸèƒ½ä¸»è¦æœ‰æŒ‡æ ‡èšåˆï¼ˆmetrics aggregationsï¼‰ã€æ¡¶èšåˆï¼ˆbucket aggregationsï¼‰ã€ç®¡é“èšåˆï¼ˆpipeline aggregationsï¼‰ ä¸‰å¤§ç±»ï¼Œ\næ‰€æœ‰çš„èšåˆï¼Œæ— è®ºå®ƒä»¬æ˜¯ä»€ä¹ˆç±»å‹ï¼Œéƒ½éµä»ä»¥ä¸‹çš„è§„åˆ™ã€‚\nä½¿ç”¨æŸ¥è¯¢ä¸­åŒæ ·çš„ JSON è¯·æ±‚æ¥å®šä¹‰å®ƒä»¬ï¼Œè€Œä¸”ä½ æ˜¯ä½¿ç”¨é”® aggregations æˆ–è€…æ˜¯ aggs æ¥è¿›è¡Œæ ‡è®°ã€‚éœ€è¦ç»™æ¯ä¸ªèšåˆèµ·ä¸€ä¸ªåå­—ï¼ŒæŒ‡å®šå®ƒçš„ç±»å‹ä»¥åŠå’Œè¯¥ç±»å‹ç›¸å…³çš„é€‰é¡¹ã€‚ å®ƒä»¬è¿è¡Œåœ¨æŸ¥è¯¢çš„ç»“æœä¹‹ä¸Šã€‚å’ŒæŸ¥è¯¢ä¸åŒ¹é…çš„æ–‡æ¡£ä¸ä¼šè®¡ç®—åœ¨å†…ï¼Œé™¤éä½ ä½¿ç”¨ global èšé›†å°†ä¸åŒ¹é…çš„æ–‡æ¡£å›Šæ‹¬å…¶ä¸­ã€‚ å¯ä»¥è¿›ä¸€æ­¥è¿‡æ»¤æŸ¥è¯¢çš„ç»“æœï¼Œè€Œä¸å½±å“èšé›†ã€‚ ä»¥ä¸‹æ˜¯èšåˆçš„åŸºæœ¬ç»“æ„ï¼š\n\"aggregations\" : { \"\" : { \"\" : { } [,\"meta\" : { [] } ]? [,\"aggregations\" : { []+ } ]? } [,\"\" : { ... } ]* } åœ¨æœ€ä¸Šå±‚æœ‰ä¸€ä¸ª aggregations çš„é”®ï¼Œå¯ä»¥ç¼©å†™ä¸º aggsã€‚ åœ¨ä¸‹é¢ä¸€å±‚ï¼Œéœ€è¦ä¸ºèšåˆæŒ‡å®šä¸€ä¸ªåå­—ã€‚å¯ä»¥åœ¨è¯·æ±‚çš„è¿”å›ä¸­çœ‹åˆ°è¿™ä¸ªåå­—ã€‚åœ¨åŒä¸€ä¸ªè¯·æ±‚ä¸­ä½¿ç”¨å¤šä¸ªèšåˆæ—¶ï¼Œè¿™ä¸€ç‚¹éå¸¸æœ‰ç”¨ï¼Œå®ƒè®©ä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°ç†è§£æ¯ç»„ç»“æœçš„å«ä¹‰ã€‚ æœ€åï¼Œå¿…é¡»è¦æŒ‡å®šèšåˆçš„ç±»å‹ã€‚ å…³äºèšåˆåˆ†æçš„å€¼æ¥æºï¼Œå¯ä»¥å–å­—æ®µçš„å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯è„šæœ¬è®¡ç®—çš„ç»“æœã€‚\nä½†æ˜¯ç”¨è„šæœ¬è®¡ç®—çš„ç»“æœæ—¶ï¼Œéœ€è¦æ³¨æ„è„šæœ¬çš„æ€§èƒ½å’Œå®‰å…¨æ€§ï¼›å°½ç®¡å¤šæ•°èšé›†ç±»å‹å…è®¸ä½¿ç”¨è„šæœ¬ï¼Œä½†æ˜¯è„šæœ¬ä½¿å¾—èšé›†å˜å¾—ç¼“æ…¢ï¼Œå› ä¸ºè„šæœ¬å¿…é¡»åœ¨æ¯ç¯‡æ–‡æ¡£ä¸Šè¿è¡Œã€‚ä¸ºäº†é¿å…è„šæœ¬çš„è¿è¡Œï¼Œå¯ä»¥åœ¨ç´¢å¼•é˜¶æ®µè¿›è¡Œè®¡ç®—ã€‚\næ­¤å¤–ï¼Œè„šæœ¬ä¹Ÿå¯ä»¥è¢«äººå¯èƒ½åˆ©ç”¨è¿›è¡Œæ¶æ„ä»£ç æ”»å‡»ï¼Œå°½é‡ä½¿ç”¨æ²™ç›’ï¼ˆsandboxï¼‰å†…çš„è„šæœ¬è¯­è¨€ã€‚\ntextç±»å‹é»˜è®¤ä¸æ”¯æŒèšåˆ\næŸ¥è¯¢æ‰€æœ‰çƒå‘˜çš„å¹³å‡å¹´é¾„æ˜¯å¤šå°‘ï¼Œå¹¶å¯¹çƒå‘˜çš„å¹³å‡è–ªæ°´åŠ  188ï¼ˆä¹Ÿå¯ä»¥ç†è§£ä¸ºæ¯åçƒå‘˜åŠ  188 åçš„å¹³å‡è–ªæ°´ï¼‰ã€‚\nPOST /player/_search?size=0 { \"aggs\": { \"avg_age\": { \"avg\": { \"field\": \"age\" } }, \"avg_salary_188\": { \"avg\": { \"script\": { \"source\": \"doc.salary.value + 188\" } } } } } // é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒ…å«èšåˆçš„æœç´¢ä¼šè¿”å›æœç´¢å‘½ä¸­å’Œèšåˆç»“æœ, size è¡¨ç¤ºè¿”å›å‘½ä¸­çš„æ–‡æ¡£æ•°é‡,è®¾ä¸º0è¡¨ç¤ºåªè¿”å›èšåˆç»“æœ 3.3.1 Metrics aggregations æŒ‡æ ‡èšåˆï¼ˆåˆç§°åº¦é‡èšåˆï¼‰ä¸»è¦ä»ä¸åŒæ–‡æ¡£çš„åˆ†ç»„ä¸­æå–ç»Ÿè®¡æ•°æ®ï¼Œæˆ–è€…ï¼Œä»æ¥è‡ªå…¶ä»–èšåˆçš„æ–‡æ¡£æ¡¶æ¥æå–ç»Ÿè®¡æ•°æ®ã€‚\nè¿™äº›ç»Ÿè®¡æ•°æ®é€šå¸¸æ¥è‡ªæ•°å€¼å‹å­—æ®µï¼Œå¦‚æœ€å°æˆ–è€…å¹³å‡ä»·æ ¼ã€‚ç”¨æˆ·å¯ä»¥å•ç‹¬è·å–æ¯é¡¹ç»Ÿè®¡æ•°æ®ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨ stats èšåˆæ¥åŒæ—¶è·å–å®ƒä»¬ã€‚æ›´é«˜çº§çš„ç»Ÿè®¡æ•°æ®ï¼Œå¦‚å¹³æ–¹å’Œæˆ–è€…æ˜¯æ ‡å‡†å·®ï¼Œå¯ä»¥é€šè¿‡ extended stats èšåˆæ¥è·å–ã€‚\n3.3.1.1 Min Aggregation Min Aggregation ç”¨äºæœ€å°å€¼ç»Ÿè®¡ã€‚ä¾‹å¦‚ï¼Œç»Ÿè®¡ sales ç´¢å¼•ä¸­ä»·æ ¼æœ€ä½çš„æ˜¯å“ªæœ¬ä¹¦ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š\nGET /sales/_search?size=0 { \"aggs\" : { \"min_price\" : { \"min\" : { \"field\" : \"price\" } } } } èšåˆç»“æœå¦‚ä¸‹ï¼š\n{ ... \"aggregations\": { \"min_price\": { \"value\": 18.0 } } } 3.3.1.2 Max Aggregation Max Aggregation ç”¨äºæœ€å¤§å€¼ç»Ÿè®¡ã€‚ä¾‹å¦‚ï¼Œç»Ÿè®¡ sales ç´¢å¼•ä¸­typeæ˜¯hatçš„ä¸”ä»·æ ¼æœ€é«˜çš„æ˜¯å“ªæœ¬ä¹¦ï¼Œå¹¶ä¸”è®¡ç®—å‡ºå¯¹åº”çš„ä»·æ ¼çš„ 2 å€å€¼ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š\nGET /sales/_search?size=0 { \"query\" : { \"constant_score\" : { \"filter\" : { \"match\" : { \"type\" : \"hat\" } } } }, \"aggs\" : { \"max_price\" : { \"max\" : { \"field\" : \"price\" , \"missing\": 60 } }, \"max_price_2\" : { \"max\" : { \"field\" : \"price\", \"script\": { \"source\": \"_value * 2.0\" } } } } } æŒ‡å®šçš„ fieldï¼Œåœ¨è„šæœ¬ä¸­å¯ä»¥ç”¨ _value å–å­—æ®µçš„å€¼ã€‚\nå¦‚æœæŒ‡å®šå­—æ®µæ²¡æœ‰å€¼ï¼Œå¯ä»¥é€šè¿‡ missing æŒ‡å®šé»˜è®¤å€¼ï¼›è‹¥æœªæŒ‡å®šé»˜è®¤å€¼ï¼Œç¼ºå¤±è¯¥å­—æ®µå€¼çš„æ–‡æ¡£å°†è¢«å¿½ç•¥ï¼ˆè®¡ç®—ï¼‰ã€‚\nèšåˆç»“æœå¦‚ä¸‹ï¼š\n{ ... \"aggregations\": { \"max_price\": { \"value\": 188.0 }, \"max_price_2\": { \"value\": 376.0 } } } 3.3.1.3 Avg Aggregation Avg Aggregation ç”¨äºè®¡ç®—å¹³å‡å€¼ã€‚ä¾‹å¦‚ï¼Œç»Ÿè®¡ exams ç´¢å¼•ä¸­è€ƒè¯•çš„å¹³å‡åˆ†æ•°ï¼Œ\nGET /exams/_search?size=0 { \"aggs\" : { \"avg_grade\" : { \"avg\" : { \"field\" : \"grade\" } } } } { ... \"aggregations\": { \"avg_grade\": { \"value\": 78.0 } } } é™¤äº†å¸¸è§„çš„å¹³å‡å€¼èšåˆè®¡ç®—å¤–ï¼Œelasticsearch è¿˜æä¾›äº†åŠ æƒå¹³å‡å€¼çš„èšåˆè®¡ç®—ï¼Œ è¯¦æƒ…å‚è§ Elasticsearch æŒ‡æ ‡èšåˆä¹‹ Weighted Avg Aggregation ã€‚\nç”¨åŠ æƒå¹³å‡å€¼ä»£æ›¿åŸæœ¬å€¼\n3.3.1.4 Sum Aggregation Sum Aggregation ç”¨äºè®¡ç®—æ€»å’Œã€‚\nGET /exams/_search?size=0 { \"aggs\" : { \"hat_prices\" : { \"sum\" : { \"field\" : \"price\" } } } } { ... \"aggregations\": { \"hat_prices\": { \"value\": 567.0 } } } 3.3.1.5 Count Aggregation Count Aggregation å¯æŒ‰å­—æ®µç»Ÿè®¡æ–‡æ¡£æ•°é‡ã€‚ä¾‹å¦‚ï¼Œç»Ÿè®¡ books ç´¢å¼•ä¸­åŒ…å« author å­—æ®µçš„æ–‡æ¡£æ•°é‡ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š\nGET /books/_search?size=0 { \"aggs\" : { \"doc_count\" : { \"value_count\" : { \"field\" : \"author\" } } } } { ... \"aggregations\": { \"doc_count\": { \"value\": 5 } } } 3.3.1.6 Cardinality Aggregation Cardinality Aggregation ç”¨äºåŸºæ•°ç»Ÿè®¡ï¼Œå…¶ä½œç”¨æ˜¯å…ˆæ‰§è¡Œç±»ä¼¼ SQL ä¸­çš„ distinct æ“ä½œï¼Œå»æ‰é›†åˆä¸­çš„é‡å¤é¡¹ï¼Œç„¶åç»Ÿè®¡æ’é‡åçš„é›†åˆé•¿åº¦ã€‚\nä¾‹å¦‚ï¼Œåœ¨ books ç´¢å¼•ä¸­å¯¹ language å­—æ®µè¿›è¡Œ cardinality æ“ä½œå¯ä»¥ç»Ÿè®¡å‡ºç¼–ç¨‹è¯­è¨€çš„ç§ç±»æ•°ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š\nGET /books/_search?size=0 { \"aggs\" : { \"all_lan\" : { \"cardinality\" : { \"field\" : \"language\" } }, \"title_cnt\" : { \"cardinality\" : { \"field\" : \"title.keyword\" } } } } å‡è®¾ title å­—æ®µä¸ºæ–‡æœ¬ç±»å‹ï¼ˆtextï¼‰ï¼Œå»é‡æ—¶éœ€è¦æŒ‡å®š keywordï¼Œè¡¨ç¤ºæŠŠ title ä½œä¸ºæ•´ä½“å»é‡ï¼Œå³ä¸åˆ†è¯ç»Ÿè®¡ã€‚\n{ ... \"aggregations\": { \"all_lan\": { \"value\": 8 }, \"title_cnt\": { \"value\": 18 } } } 3.3.1.7 Stats Aggregation Stats Aggregation ç”¨äºåŸºæœ¬ç»Ÿè®¡ï¼Œä¼šä¸€æ¬¡è¿”å› countã€maxã€minã€avg å’Œ sum è¿™ 5 ä¸ªæŒ‡æ ‡ã€‚ä¾‹å¦‚ï¼Œåœ¨ exams ç´¢å¼•ä¸­å¯¹ grade å­—æ®µè¿›è¡Œåˆ†æ•°ç›¸å…³çš„åŸºæœ¬ç»Ÿè®¡ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š\nGET /exams/_search?size=0 { \"aggs\" : { \"grades_stats\" : { \"stats\" : { \"field\" : \"grade\" } } } } 3.3.1.8 Extended Stats Aggregation Extended Stats Aggregation ç”¨äºé«˜çº§ç»Ÿè®¡ï¼Œå’ŒåŸºæœ¬ç»Ÿè®¡åŠŸèƒ½ç±»ä¼¼ï¼Œä½†æ˜¯ä¼šæ¯”åŸºæœ¬ç»Ÿè®¡å¤šå‡ºä»¥ä¸‹å‡ ä¸ªç»Ÿè®¡ç»“æœï¼Œsum_of_squaresï¼ˆå¹³æ–¹å’Œï¼‰ã€varianceï¼ˆæ–¹å·®ï¼‰ã€std_deviationï¼ˆæ ‡å‡†å·®ï¼‰ã€std_deviation_boundsï¼ˆå¹³å‡å€¼åŠ /å‡ä¸¤ä¸ªæ ‡å‡†å·®çš„åŒºé—´ï¼‰ã€‚åœ¨ exams ç´¢å¼•ä¸­å¯¹ grade å­—æ®µè¿›è¡Œåˆ†æ•°ç›¸å…³çš„é«˜çº§ç»Ÿè®¡ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š\nGET /exams/_search?size=0 { \"aggs\" : { \"grades_stats\" : { \"extended_stats\" : { \"field\" : \"grade\" } } } } 3.3.1.9 Percentiles Aggregation Percentiles Aggregation ç”¨äºç™¾åˆ†ä½ç»Ÿè®¡ã€‚ç™¾åˆ†ä½æ•°æ˜¯ä¸€ä¸ªç»Ÿè®¡å­¦æœ¯è¯­ï¼Œå¦‚æœå°†ä¸€ç»„æ•°æ®ä»å¤§åˆ°å°æ’åºï¼Œå¹¶è®¡ç®—ç›¸åº”çš„ç´¯è®¡ç™¾åˆ†ä½ï¼ŒæŸä¸€ç™¾åˆ†ä½æ‰€å¯¹åº”æ•°æ®çš„å€¼å°±ç§°ä¸ºè¿™ä¸€ç™¾åˆ†ä½çš„ç™¾åˆ†ä½æ•°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç´¯è®¡ç™¾åˆ†ä½ä¸º [ 1, 5, 25, 50, 75, 95, 99 ],ä¹Ÿå¯ä»¥ç”¨percentsæŒ‡å®šèŒƒå›´ã€‚ä»¥ä¸‹ä¾‹å­ç»™å‡ºäº†åœ¨ latency ç´¢å¼•ä¸­å¯¹ load_time å­—æ®µè¿›è¡ŒåŠ è½½æ—¶é—´çš„ç™¾åˆ†ä½ç»Ÿè®¡ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š\nGET latency/_search { \"size\": 0, \"aggs\" : { \"load_time_outlier\" : { \"percentiles\" : { \"field\" : \"load_time\" , \"percents\":[30,45] //æŸ¥è¯¢ç¬¬30%å’Œ45%çš„æ•°æ® } } } } éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚ä¸Šçš„ load_time å­—æ®µå¿…é¡»æ˜¯æ•°å­—ç±»å‹ã€‚\n{ ... \"aggregations\": { \"load_time_outlier\": { \"values\" : { \"1.0\": 5.0, \"5.0\": 25.0, \"25.0\": 165.0, \"50.0\": 445.0, \"75.0\": 725.0, \"95.0\": 945.0, \"99.0\": 985.0 } } } } ç¬¬1%ä½çš„æ•°æ®æ˜¯5\nç¬¬5%ä½çš„æ•°æ®æ˜¯25\nâ€¦â€¦\nç¬¬99%ä½çš„æ•°æ®æ˜¯99\n3.3.1.10 Percentiles Ranks Aggregation Percentiles Ranks Aggregation ä¸ Percentiles Aggregation ç»Ÿè®¡æ°æ°ç›¸åï¼Œå°±æ˜¯æƒ³çœ‹å½“å‰æ•°å€¼å¤„åœ¨ä»€ä¹ˆèŒƒå›´å†…ï¼ˆç™¾åˆ†ä½ï¼‰ï¼Œ å‡å¦‚ä½ æŸ¥ä¸€ä¸‹å½“å‰å€¼ 500 å’Œ 600 æ‰€å¤„çš„ç™¾åˆ†ä½ï¼Œå‘ç°æ˜¯ 90.01 å’Œ 100ï¼Œé‚£ä¹ˆè¯´æ˜æœ‰ 90.01 % çš„æ•°å€¼éƒ½åœ¨ 500 ä»¥å†…ï¼Œ100 % çš„æ•°å€¼åœ¨ 600 ä»¥å†…ã€‚\nGET latency/_search { \"size\": 0, \"aggs\" : { \"load_time_ranks\" : { \"percentile_ranks\" : { \"field\" : \"load_time\", \"values\" : [500, 600] } } } } åŒæ · load_time å­—æ®µå¿…é¡»æ˜¯æ•°å­—ç±»å‹ã€‚\n{ ... \"aggregations\": { \"load_time_ranks\": { \"values\" : { \"500.0\": 90.01, \"600.0\": 100.0 } } } } å¯ä»¥è®¾ç½® keyed å‚æ•°ä¸º trueï¼Œå°†å¯¹åº”çš„ values ä½œä¸ºæ¡¶ key ä¸€èµ·è¿”å›ï¼Œé»˜è®¤æ˜¯ falseã€‚\nGET latency/_search { \"size\": 0, \"aggs\": { \"load_time_ranks\": { \"percentile_ranks\": { \"field\": \"load_time\", \"values\": [500, 600], \"keyed\": true } } } } { ... \"aggregations\": { \"load_time_ranks\": { \"values\": [ { \"key\": 500.0, \"value\": 90.01 }, { \"key\": 600.0, \"value\": 100.0 } ] } } } 3.3.2 bucket aggregations bucket å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ¡¶ï¼Œå®ƒä¼šéå†æ–‡æ¡£ä¸­çš„å†…å®¹ï¼Œå‡¡æ˜¯ç¬¦åˆæŸä¸€è¦æ±‚çš„å°±æ”¾å…¥ä¸€ä¸ªæ¡¶ä¸­ï¼Œåˆ†æ¡¶ç›¸å½“äº SQL ä¸­çš„ group byã€‚ä»å¦å¤–ä¸€ä¸ªè§’åº¦ï¼Œå¯ä»¥å°†æŒ‡æ ‡èšåˆçœ‹æˆå•æ¡¶èšåˆï¼Œå³æŠŠæ‰€æœ‰æ–‡æ¡£æ”¾åˆ°ä¸€ä¸ªæ¡¶ä¸­ï¼Œè€Œæ¡¶èšåˆæ˜¯å¤šæ¡¶å‹èšåˆï¼Œå®ƒæ ¹æ®ç›¸åº”çš„æ¡ä»¶è¿›è¡Œåˆ†ç»„ã€‚\næ¡¶æ•°æœ€å¤š 65536 ä¸ª,å¯ä¿®æ”¹\n3.3.2.1 Terms Aggregation Terms Aggregation ç”¨äºè¯é¡¹çš„åˆ†ç»„èšåˆã€‚æœ€ä¸ºç»å…¸çš„ç”¨ä¾‹æ˜¯è·å– X ä¸­æœ€é¢‘ç¹ï¼ˆtop frequentï¼‰çš„é¡¹ç›®ï¼Œå…¶ä¸­ X æ˜¯æ–‡æ¡£ä¸­çš„æŸä¸ªå­—æ®µï¼Œå¦‚ç”¨æˆ·çš„åç§°ã€æ ‡ç­¾æˆ–åˆ†ç±»ã€‚ç”±äº terms èšé›†ç»Ÿè®¡çš„æ˜¯æ¯ä¸ªè¯æ¡ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå­—æ®µå€¼ï¼Œå› æ­¤é€šå¸¸éœ€è¦åœ¨ä¸€ä¸ªéåˆ†æå‹çš„å­—æ®µä¸Šè¿è¡Œè¿™ç§èšé›†ã€‚åŸå› æ˜¯, ä½ æœŸæœ›â€œbig dataâ€ä½œä¸ºè¯ç»„ç»Ÿè®¡ï¼Œè€Œä¸æ˜¯â€œbigâ€å•ç‹¬ç»Ÿè®¡ä¸€æ¬¡ï¼Œâ€œdataâ€å†å•ç‹¬ç»Ÿè®¡ä¸€æ¬¡ã€‚\næ”¯æŒå­—æ®µç±»å‹ Keyword, Numeric, ip, boolean, binary.\nç”¨æˆ·å¯ä»¥ä½¿ç”¨ terms èšé›†ï¼Œä»åˆ†æå‹å­—æ®µï¼ˆå¦‚å†…å®¹ï¼‰ä¸­æŠ½å–æœ€ä¸ºé¢‘ç¹çš„è¯æ¡ã€‚è¿˜å¯ä»¥ä½¿ç”¨è¿™ç§ä¿¡æ¯æ¥ç”Ÿæˆä¸€ä¸ªå•è¯äº‘ã€‚\n{ \"aggs\": { \"profit_terms\": { \"terms\": { \"field\": \"skuName\" } } } } ç»“æœ:\n{ ... \"aggregations\": { \"genres\": { \"doc_count_error_upper_bound\": 0, // é”™è¯¯æ–‡æ¡£çš„ä¸ªæ•° \"sum_other_doc_count\": 0, // æœªç»Ÿè®¡çš„æ–‡æ¡£ä¸ªæ•° \"buckets\": [ { \"key\": \"electronic\", \"doc_count\": 6 }, { \"key\": \"rock\", \"doc_count\": 3 }, { \"key\": \"jazz\", \"doc_count\": 2 } ] } } } è¿”å›å€¼ä¸­,é»˜è®¤æŒ‰doc_countæ•°é‡é™åºæ’åº, å¯ä»¥ç”¨orderå­—æ®µæŒ‡å®šæ’åºè§„åˆ™\nå¯ä»¥ç”¨sizeå­—æ®µæ§åˆ¶è¿”å›çš„æ¡¶æ•°\n3.2.2.2 Filter Aggregation Filter Aggregation æ˜¯è¿‡æ»¤å™¨èšåˆï¼Œå¯ä»¥æŠŠç¬¦åˆè¿‡æ»¤å™¨ä¸­çš„æ¡ä»¶çš„æ–‡æ¡£åˆ†åˆ°ä¸€ä¸ªæ¡¶ä¸­ï¼Œå³æ˜¯å•åˆ†ç»„èšåˆã€‚\n{ \"aggs\": { \"age_terms\": { \"filter\": {\"term\":{\"gender\":\"F\"}}, \"aggs\": { \"avg_age\": { \"avg\": { \"field\": \"age\" } } } } } } åœ¨èšåˆæ“ä½œä¸­åŠ å…¥è¿‡æ»¤,æ¯” è¿‡æ»¤åå†èšåˆè¦å·®, ä¸Šé¢çš„æ•ˆç‡æ¯”ä¸‹é¢çš„æ•ˆç‡è¦å·®\nPOST /sales/_search?size=0\u0026filter_path=aggregations { \"query\": { \"term\": { \"type\": \"t-shirt\" } }, \"aggs\": { \"avg_price\": { \"avg\": { \"field\": \"price\" } } } } 3.2.2.3 Filters Aggregation Filters Aggregation æ˜¯å¤šè¿‡æ»¤å™¨èšåˆï¼Œå¯ä»¥æŠŠç¬¦åˆå¤šä¸ªè¿‡æ»¤æ¡ä»¶çš„æ–‡æ¡£åˆ†åˆ°ä¸åŒçš„æ¡¶ä¸­ï¼Œå³æ¯ä¸ªåˆ†ç»„å…³è”ä¸€ä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œå¹¶æ”¶é›†æ‰€æœ‰æ»¡è¶³è‡ªèº«è¿‡æ»¤æ¡ä»¶çš„æ–‡æ¡£ã€‚\n{ \"size\": 0, \"aggs\": { \"messages\": { \"filters\": { \"filters\": { \"errors\": { \"match\": { \"body\": \"error\" } }, \"warnings\": { \"match\": { \"body\": \"warning\" } } } } } } } åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬åˆ†ææ—¥å¿—ä¿¡æ¯ã€‚èšåˆä¼šåˆ›å»ºä¸¤ä¸ªå…³äºæ—¥å¿—æ•°æ®çš„åˆ†ç»„ï¼Œä¸€ä¸ªæ”¶é›†åŒ…å«é”™è¯¯ä¿¡æ¯çš„æ–‡æ¡£ï¼Œå¦ä¸€ä¸ªæ”¶é›†åŒ…å«å‘Šè­¦ä¿¡æ¯çš„æ–‡æ¡£ã€‚è€Œä¸”æ¯ä¸ªåˆ†ç»„ä¼šæŒ‰æœˆä»½åˆ’åˆ†ã€‚\nfilters å†™å¤šä¸ªè¿‡æ»¤å™¨æ¯” å†™è¿‡filteræ•ˆç‡å¥½\n3.2.2.4 Range Aggregation Range Aggregation èŒƒå›´èšåˆæ˜¯ä¸€ä¸ªåŸºäºå¤šç»„å€¼æ¥æºçš„èšåˆï¼Œå¯ä»¥è®©ç”¨æˆ·å®šä¹‰ä¸€ç³»åˆ—èŒƒå›´ï¼Œæ¯ä¸ªèŒƒå›´ä»£è¡¨ä¸€ä¸ªåˆ†ç»„ã€‚åœ¨èšåˆæ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä»æ¯ä¸ªæ–‡æ¡£æå–å‡ºæ¥çš„å€¼éƒ½ä¼šæ£€æŸ¥æ¯ä¸ªåˆ†ç»„çš„èŒƒå›´ï¼Œå¹¶ä¸”ä½¿ç›¸å…³çš„æ–‡æ¡£è½å…¥åˆ†ç»„ä¸­ã€‚æ³¨æ„ï¼ŒèŒƒå›´èšåˆçš„æ¯ä¸ªèŒƒå›´å†…åŒ…å« from å€¼ä½†æ˜¯æ’é™¤ to å€¼ã€‚\n{ \"aggs\": { \"age_range\": { \"range\": { \"field\": \"age\", \"ranges\": [{ \"to\": 25 }, { \"from\": 25, \"to\": 35 }, { \"from\": 35 }] }, \"aggs\": { \"bmax\": { \"max\": { \"field\": \"balance\" } } } } } } } 3.2.2.5 Date Range Aggr æ—¥æœŸèŒƒå›´èšåˆæ˜¯ä¸“ç”¨äºæ—¥æœŸå€¼çš„èŒƒå›´èšåˆã€‚è¯¥èšåˆå’Œæ­£å¸¸çš„ èŒƒå›´ èšåˆçš„åŒºåˆ«ä¸»è¦åœ¨äºï¼šè¯¥èšåˆå¯ä»¥ç”¨ æ—¥æœŸæ•°å­¦ è¡¨è¾¾å¼è¡¨ç¤º from å€¼ å’Œ to å€¼ï¼Œè¿˜å¯ä»¥æŒ‡å®š è¿”å› from å’Œ to å“åº”å­—æ®µçš„æ—¥æœŸæ ¼å¼ã€‚æ³¨æ„ï¼Œè¯¥èšåˆåŒ…å« from å€¼ï¼Œä½†ä¸åŒ…å« to å€¼ã€‚(å·¦é—­å³å¼€çš„åŒºé—´)\nPOST /sales/_search?size=0 { \"aggs\": { \"range\": { \"date_range\": { \"field\": \"date\", \"format\": \"MM-yyyy\", \"ranges\": [ { \"to\": \"now-10M/M\" }, { \"from\": \"now-10M/M\" } ] } } } } to: \u003c ç°åœ¨å‡å» 10 ä¸ªæœˆï¼Œå‘ä¸‹èˆå…¥åˆ°æœˆåˆ\nfrom: \u003e= ç°åœ¨å‡å» 10 ä¸ªæœˆï¼Œå‘ä¸‹èˆå…¥åˆ°æœˆåˆ\nåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªèŒƒå›´æ¡¶ï¼Œç¬¬ä¸€ä¸ªæ¡¶ä¼šå°†æ—©äº 10 ä¸ªæœˆä¹‹å‰çš„æ‰€æœ‰æ–‡æ¡£å­˜å‚¨ï¼Œç¬¬äºŒä¸ªæ¡¶ä¼šå°†ä» 10 æœˆä¹‹å‰å¼€å§‹çš„æ–‡æ¡£å­˜å‚¨ã€‚\n{ ... \"aggregations\": { \"range\": { \"buckets\": [ { \"to\": 1.4436576E12, \"to_as_string\": \"10-2015\", \"doc_count\": 7, \"key\": \"*-10-2015\" }, { \"from\": 1.4436576E12, \"from_as_string\": \"10-2015\", \"doc_count\": 0, \"key\": \"10-2015-*\" } ] } } } æ—¶é—´æ ¼å¼å’Œjavaçš„ä¸€æ ·\nes-ä¸­æ–‡æ–‡æ¡£ 3.2.2.6 Range Aggr åŸºäºå¤šæ¡¶å€¼æºçš„èšåˆï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿå®šä¹‰ä¸€ç»„èŒƒå›´ - æ¯ä¸ªèŒƒå›´ä»£è¡¨ä¸€ä¸ªæ¡¶ã€‚ åœ¨èšåˆè¿‡ç¨‹ä¸­ï¼Œå°†ä»æ¯ä¸ªæ–‡æ¡£ä¸­æå–çš„å€¼æ ¹æ®æ¯ä¸ªå­˜å‚¨åŒºèŒƒå›´è¿›è¡Œæ£€æŸ¥ï¼Œå¹¶å°†ç›¸å…³/åŒ¹é…æ–‡æ¡£â€œå­˜å‚¨â€åˆ°â€œå­˜å‚¨åŒºâ€ä¸­ã€‚ è¯·æ³¨æ„ï¼Œè¯¥èšåˆåŒ…å« from å€¼ï¼Œä½†ä¸åŒ…å« to å€¼\nGET /_search { \"aggs\": { \"price_ranges\": { \"range\": { \"field\": \"price\", \"ranges\": [ { \"to\": 100.0 }, { \"from\": 100.0, \"to\": 200.0 }, { \"from\": 200.0 } ] } } } } ç»“æœ:\n{ ... \"aggregations\": { \"price_ranges\": { \"buckets\": [ { \"key\": \"*-100.0\", \"to\": 100.0, \"doc_count\": 2 }, { \"key\": \"100.0-200.0\", \"from\": 100.0, \"to\": 200.0, \"doc_count\": 2 }, { \"key\": \"200.0-*\", \"from\": 200.0, \"doc_count\": 3 } ] } } } 3.4 å¤åˆæŸ¥è¯¢ å¤åˆæŸ¥è¯¢åŒ…è£…å…¶ä»–å¤åˆæŸ¥è¯¢æˆ–å¶æŸ¥è¯¢ï¼Œä»¥ç»„åˆå®ƒä»¬çš„ç»“æœå’Œåˆ†æ•°ï¼Œæ”¹å˜å®ƒä»¬çš„è¡Œä¸ºï¼Œæˆ–è€…ä»æŸ¥è¯¢åˆ‡æ¢åˆ°è¿‡æ»¤ä¸Šä¸‹æ–‡ã€‚\nç®€å•çš„è¯´æ˜¯ å°†å¤šç§æŸ¥è¯¢æ¡ä»¶ç»„åˆåˆ°ä¸€èµ·\n3.4.1 Bool query filter\nå­å¥åœ¨è¿‡æ»¤å™¨ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œï¼Œè¿™æ„å‘³ç€è®¡åˆ†è¢«å¿½ç•¥ï¼Œå¹¶ä¸”å­å¥è¢«è§†ä¸ºç”¨äºç¼“å­˜ã€‚(è¿‡æ»¤æ‰ä¸è¦çš„æ•°æ®)\nmust\nå­å¥ï¼ˆæŸ¥è¯¢ï¼‰å¿…é¡»å‡ºç°åœ¨åŒ¹é…çš„æ–‡æ¡£ä¸­ï¼Œå¹¶å°†æœ‰åŠ©äºå¾—åˆ†ã€‚(ç”¨æ¥åšåŒ¹é…çš„,è¡¨ç¤ºéœ€è¦å‡ºç°åœ¨æ–‡æ¡£é‡Œ)\nmust_not\nå­å¥ï¼ˆæŸ¥è¯¢ï¼‰ä¸å¾—å‡ºç°åœ¨åŒ¹é…çš„æ–‡æ¡£ä¸­ã€‚å­å¥åœ¨è¿‡æ»¤å™¨ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œï¼Œè¿™æ„å‘³ç€è®¡åˆ†è¢«å¿½ç•¥ï¼Œå¹¶ä¸”å­å¥è¢«è§†ä¸ºç”¨äºç¼“å­˜ã€‚\nshould\nå­å¥ï¼ˆæŸ¥è¯¢ï¼‰åº”å‡ºç°åœ¨åŒ¹é…çš„æ–‡æ¡£ä¸­ã€‚ã€æ³¨æ„shouldçš„æœ€å°åŒ¹é…æ•°ã€‘\nå…³äºshouldå­å¥ï¼Œç‰¹åˆ«è¦æ³¨æ„ï¼š\nå¦‚æœè¿™ä¸ªå¸ƒå°”æŸ¥è¯¢ä½äºquery contextï¼Œå¹¶ä¸”æœ‰mustæˆ–è€…filterå­å¥ï¼Œé‚£ä¹ˆå³ä½¿shouldå­å¥æ²¡æœ‰åŒ¹é…ä»»ä½•æ–‡æ¡£ï¼Œä¹Ÿæ²¡å…³ç³»\nå¦‚æœæ˜¯ä½äºfilter contextï¼Œæˆ–è€…æ—¢æ²¡æœ‰mustä¹Ÿæ²¡æœ‰filterï¼Œé‚£ä¹ˆè‡³å°‘æœ‰\"æŒ‡å®š\"ä¸ªshouldæŸ¥è¯¢å¿…é¡»åŒ¹é…æ–‡æ¡£ã€‚è¿™ä¸ªè¡Œä¸ºå¯ä»¥é€šè¿‡è®¾ç½®minimum_should_matchå‚æ•°æ¥æ˜¾å¼åœ°æ§åˆ¶ã€‚(è‡³å°‘æ»¡è¶³å‡ ä¸ªshouldå­å¥), å¯ä»¥æ˜¯æ­£è´Ÿæ•´æ•°/æ­£è´Ÿç™¾åˆ†æ¯”ç­‰å„ç§æ¯”ä¾‹ (é»˜è®¤å€¼æ˜¯0)\nå‚æ•°è¯¦æƒ… GET product/_search { \"query\": { \"bool\": { \"filter\": [ { \"range\": { \"sellPrice\": { \"gte\": 1 } } } ], \"must\": [ { \"match\": { \"skuName\": \"ç©ºè°ƒ\" } } ] } } , \"_source\": \"skuName\" } // æŸ¥è¯¢skuNameä¸­\"ç©ºè°ƒ\"çš„æ–‡æ¡£,å¹¶ä¸”è¿‡æ»¤å‡ºsellPriceå¤§äºç­‰äº1çš„æ–‡æ¡£ filter å­å¥ç±»å¯åŒ…å« bool queryï¼Œå®ç°æ›´å¤æ‚çš„é€»è¾‘, (ä¿„ç½—æ–¯å¥—å¨ƒä¹‹æ·±åœ³åˆ†å¥—)\n// å¤šä¸ªæ¡ä»¶ GET service-java-logs-2021.07.16/_search { \"_source\": \"message\", \"query\": { \"bool\": { \"must\": [ { \"match_phrase\": { \"message\": \"ERROR\" } } ], \"must_not\": [ { \"wildcard\": { \"message\": \"*navigation*\" } }, { \"match\": { \"message\": \"defaultParameterMap\" } }, { \"match\": { \"message\": \"parameters\" } } ], \"filter\": [ { \"term\": { \"log.file.path.keyword\": \"/opt/online-shop-manage/logs/online-shop-manage-provider.log\" } } ] } } } 3.4.2 boosting query æ¥æº:\nhttps://www.cnblogs.com/hong-fithing/p/11221020.html http://www.ruanyifeng.com/blog/2017/08/elasticsearch.html https://www.cnblogs.com/hirampeng/p/10035858.html https://www.cnblogs.com/cjsblog/p/9910788.html å¾®ä¿¡esç³»åˆ— https://www.knowledgedict.com/tutorial/elasticsearch-sort.html ","wordCount":"8322","inLanguage":"zh","datePublished":"2023-08-22T00:00:00Z","dateModified":"2023-09-11T17:02:27.955865206+08:00","author":{"@type":"Person","name":"xkj"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/ELK/ElasticSearch/%E5%91%BD%E4%BB%A4.html"},"publisher":{"@type":"Organization","name":"ç±³äºŒ","logo":{"@type":"ImageObject","url":"https://xiaokunji.com/img/Q.svg"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://xiaokunji.com/zh/ accesskey=h title="ç±³äºŒ (Alt + H)"><img src=https://xiaokunji.com/img/Q.svg alt aria-label=logo height=35>ç±³äºŒ</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://xiaokunji.com/en/ title=English aria-label=English>English</a></li></ul></div></div><ul id=menu><li><a href=https://xiaokunji.com/zh/ title=ğŸ ä¸»é¡µ><span>ğŸ ä¸»é¡µ</span></a></li><li><a href=https://xiaokunji.com/zh/search title="ğŸ”æœç´¢ (Alt + /)" accesskey=/><span>ğŸ”æœç´¢</span></a></li><li><a href=https://xiaokunji.com/zh/post.html title=ğŸ“šæ–‡ç« ><span>ğŸ“šæ–‡ç« </span></a></li><li><a href=https://xiaokunji.com/zh/archives.html title=â±æ—¶é—´è½´><span>â±æ—¶é—´è½´</span></a></li><li><a href=https://xiaokunji.com/zh/tags.html title=ğŸ”–æ ‡ç­¾><span>ğŸ”–æ ‡ç­¾</span></a></li><li><a href=https://xiaokunji.com/zh/categories.html title=ğŸ“–åˆ†ç±»><span>ğŸ“–åˆ†ç±»</span></a></li><li><a href=https://xiaokunji.com/zh/links.html title=ğŸ¤å‹é“¾><span>ğŸ¤å‹é“¾</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><nav aria-label=breadcrumb><ul><a href=https://xiaokunji.com/zh/>ğŸ </a> <span>></span>
<a href=https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88.html>ç»¼åˆ</a> <span>></span>
<a href=https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/ELK.html>ELK</a> <span>></span>
<a href=https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/ELK/ElasticSearch.html>ElasticSearch</a> <span>></span></ul></nav><h1 class=post-title>å‘½ä»¤</h1><div class=post-description></div><div class=post-meta>åˆ›å»º:&nbsp;<span title='2023-08-22 00:00:00 +0000 UTC'>2023-08-22</span>&nbsp;Â·&nbsp;æ›´æ–°:&nbsp;2023-09-11&nbsp;Â·&nbsp;xkj
&nbsp;|&nbsp;åˆ†ç±»: &nbsp;<ul class=post-categories-meta><a href=https://xiaokunji.com/zh/categories/%E7%BB%BC%E5%90%88.html>ç»¼åˆ</a></ul><span id=busuanzi_container_page_pv>&nbsp;| è®¿é—®: <span id=busuanzi_value_page_pv>1</span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#%e5%89%8d%e8%a8%80 aria-label=å‰è¨€>å‰è¨€</a></li><li><a href=#1-%e5%9f%ba%e6%9c%ac%e6%a0%bc%e5%bc%8f aria-label="1. åŸºæœ¬æ ¼å¼">1. åŸºæœ¬æ ¼å¼</a></li><li><a href=#2-%e5%91%bd%e4%bb%a4 aria-label="2. å‘½ä»¤">2. å‘½ä»¤</a><ul><li><a href=#21-%e5%88%9b%e5%bb%ba%e7%b4%a2%e5%bc%95 aria-label="2.1 åˆ›å»ºç´¢å¼•">2.1 åˆ›å»ºç´¢å¼•</a></li><li><a href=#22-%e6%8f%92%e5%85%a5%e6%95%b0%e6%8d%ae aria-label="2.2 æ’å…¥æ•°æ®">2.2 æ’å…¥æ•°æ®</a></li><li><a href=#23-%e4%bf%ae%e6%94%b9%e6%95%b0%e6%8d%ae aria-label="2.3 ä¿®æ”¹æ•°æ®">2.3 ä¿®æ”¹æ•°æ®</a></li><li><a href=#24-%e6%9f%a5%e7%9c%8b aria-label="2.4 æŸ¥çœ‹">2.4 æŸ¥çœ‹</a></li><li><a href=#25-%e5%88%a0%e9%99%a4 aria-label="2.5 åˆ é™¤">2.5 åˆ é™¤</a></li><li><a href=#26-%e7%ae%80%e5%8d%95%e6%8e%92%e5%ba%8f aria-label="2.6 ç®€å•æ’åº">2.6 ç®€å•æ’åº</a></li></ul></li><li><a href=#3-%e5%a4%8d%e6%9d%82%e6%9f%a5%e8%af%a2 aria-label="3. å¤æ‚æŸ¥è¯¢">3. å¤æ‚æŸ¥è¯¢</a><ul><li><a href=#31-query-and-filter-context aria-label="3.1 Query and filter context">3.1 Query and filter context</a><ul><li><a href=#311-query-context aria-label="3.1.1 Query context">3.1.1 Query context</a></li><li><a href=#312-filter-context aria-label="3.1.2 Filter context">3.1.2 Filter context</a></li></ul></li><li><a href=#32-%e5%85%a8%e6%96%87%e6%9f%a5%e8%af%a2-full-text aria-label="3.2 å…¨æ–‡æŸ¥è¯¢( Full text)">3.2 å…¨æ–‡æŸ¥è¯¢( Full text)</a><ul><li><a href=#311--match--query aria-label="3.1.1  match  query">3.1.1 match query</a></li><li><a href=#312-match-phrase-query aria-label="3.1.2 Match Phrase Query">3.1.2 Match Phrase Query</a></li><li><a href=#313-multi-match-query aria-label="3.1.3 Multi Match Query">3.1.3 Multi Match Query</a></li><li><a href=#314-query-string-query aria-label="3.1.4 Query String Query">3.1.4 Query String Query</a></li></ul></li><li><a href=#32-%e5%8d%95%e8%af%8d%e7%ba%a7%e6%9f%a5%e8%af%a2term-text aria-label="3.2 å•è¯çº§æŸ¥è¯¢(term text)">3.2 å•è¯çº§æŸ¥è¯¢(term text)</a><ul><li><a href=#321--term-query aria-label="3.2.1  Term Query">3.2.1 Term Query</a></li><li><a href=#322--terms-query aria-label="3.2.2  Terms Query">3.2.2 Terms Query</a></li><li><a href=#323-range-query aria-label="3.2.3 Range Query">3.2.3 Range Query</a></li><li><a href=#324-exsit-query aria-label="3.2.4 Exsit Query">3.2.4 Exsit Query</a></li><li><a href=#325-prefix-query aria-label="3.2.5 Prefix Query">3.2.5 Prefix Query</a></li><li><a href=#326-wildcard-query aria-label="3.2.6 Wildcard Query">3.2.6 Wildcard Query</a></li><li><a href=#327-regexp-query aria-label="3.2.7 Regexp Query">3.2.7 Regexp Query</a></li></ul></li><li><a href=#33-%e8%81%9a%e5%90%88%e6%9f%a5%e8%af%a2 aria-label="3.3 èšåˆæŸ¥è¯¢">3.3 èšåˆæŸ¥è¯¢</a><ul><li><a href=#331--metrics-aggregations aria-label="3.3.1  Metrics aggregations">3.3.1 Metrics aggregations</a><ul><li><a href=#3311-min-aggregation aria-label="3.3.1.1 Min Aggregation">3.3.1.1 Min Aggregation</a></li><li><a href=#3312-max-aggregation aria-label="3.3.1.2 Max Aggregation">3.3.1.2 Max Aggregation</a></li><li><a href=#3313-avg-aggregation aria-label="3.3.1.3 Avg Aggregation">3.3.1.3 Avg Aggregation</a></li><li><a href=#3314--sum-aggregation aria-label="3.3.1.4  Sum Aggregation">3.3.1.4 Sum Aggregation</a></li><li><a href=#3315--count-aggregation aria-label="3.3.1.5  Count Aggregation">3.3.1.5 Count Aggregation</a></li><li><a href=#3316-cardinality-aggregation aria-label="3.3.1.6 Cardinality Aggregation">3.3.1.6 Cardinality Aggregation</a></li><li><a href=#3317-stats-aggregation aria-label="3.3.1.7 Stats Aggregation">3.3.1.7 Stats Aggregation</a></li><li><a href=#3318--extended-stats-aggregation aria-label="3.3.1.8  Extended Stats Aggregation">3.3.1.8 Extended Stats Aggregation</a></li><li><a href=#3319-percentiles-aggregation aria-label="3.3.1.9 Percentiles Aggregation">3.3.1.9 Percentiles Aggregation</a></li><li><a href=#33110-percentiles-ranks-aggregation aria-label="3.3.1.10 Percentiles Ranks Aggregation">3.3.1.10 Percentiles Ranks Aggregation</a></li></ul></li><li><a href=#332--bucket-aggregations aria-label="3.3.2  bucket aggregations">3.3.2 bucket aggregations</a><ul><li><a href=#3321-terms-aggregation aria-label="3.3.2.1 Terms Aggregation">3.3.2.1 Terms Aggregation</a></li><li><a href=#3222--filter-aggregation aria-label="3.2.2.2  Filter Aggregation">3.2.2.2 Filter Aggregation</a></li><li><a href=#3223-filters-aggregation aria-label="3.2.2.3 Filters Aggregation">3.2.2.3 Filters Aggregation</a></li><li><a href=#3224-range-aggregation aria-label="3.2.2.4 Range Aggregation">3.2.2.4 Range Aggregation</a></li><li><a href=#3225-date-range-aggr aria-label="3.2.2.5 Date Range Aggr">3.2.2.5 Date Range Aggr</a></li><li><a href=#3226-range-aggr aria-label="3.2.2.6 Range Aggr">3.2.2.6 Range Aggr</a></li></ul></li></ul></li><li><a href=#34-%e5%a4%8d%e5%90%88%e6%9f%a5%e8%af%a2 aria-label="3.4 å¤åˆæŸ¥è¯¢">3.4 å¤åˆæŸ¥è¯¢</a><ul><li><a href=#341-bool-query aria-label="3.4.1 Bool query">3.4.1 Bool query</a></li><li><a href=#342--boosting-query aria-label="3.4.2  boosting query">3.4.2 boosting query</a></li></ul></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>[toc]</p><h1 id=å‰è¨€>å‰è¨€<a hidden class=anchor aria-hidden=true href=#å‰è¨€>#</a></h1><p>æœ¬æ–‡ä»¥å‘½ä»¤è¡Œä¸ºä¸»</p><blockquote><p>å…¶æœ¬è´¨è¿˜æ˜¯å‘é€httpè¯·æ±‚å»æ“ä½œæ•°æ®</p></blockquote><h1 id=1-åŸºæœ¬æ ¼å¼>1. åŸºæœ¬æ ¼å¼<a hidden class=anchor aria-hidden=true href=#1-åŸºæœ¬æ ¼å¼>#</a></h1><p>esæ˜¯ä»¥RESTFulé£æ ¼æ¥å‘½åAPIçš„ï¼Œå…¶APIçš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š</p><p><code>http://&lt;ip>:&lt;port>/&lt;ç´¢å¼•>/&lt;ç±»å‹>/&lt;æ–‡æ¡£id></code></p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥æ ¼å¼ä»es7.0.0å¼€å§‹ï¼Œç§»é™¤Typeï¼ˆç±»å‹ï¼‰è¿™ä¸ªæ¦‚å¿µï¼Œæ–°çš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š</p><p><code>http://&lt;ip>:&lt;port>/&lt;ç´¢å¼•>/_doc/&lt;æ–‡æ¡£id></code></p><p>Typeï¼ˆç±»å‹ï¼‰å­—æ®µé‚£é‡Œå˜ä¸ºå›ºå®šå€¼ _doc</p><p>esçš„åŠ¨ä½œæ˜¯ä»¥httpæ–¹æ³•æ¥å†³å®šçš„: å¸¸ç”¨çš„httpæ–¹æ³•: <code>GET/PUT/POST/DELETE</code></p><blockquote><p>post ä¸»åšä¿®æ”¹, putä¸»åšåˆ›å»º</p><p>postä¹Ÿæœ‰åˆ›å»ºçš„åŠŸèƒ½,ç‰¹åˆ«æ˜¯æ’å…¥æ•°æ®ç”Ÿæˆéšæœºidæ—¶</p></blockquote><h1 id=2-å‘½ä»¤>2. å‘½ä»¤<a hidden class=anchor aria-hidden=true href=#2-å‘½ä»¤>#</a></h1><h2 id=21-åˆ›å»ºç´¢å¼•>2.1 åˆ›å»ºç´¢å¼•<a hidden class=anchor aria-hidden=true href=#21-åˆ›å»ºç´¢å¼•>#</a></h2><p><code>curl -XPUT http://localhost:9200/xkj_test</code> æ²¡æœ‰æŒ‡å®šmappings,æ•…ä¸ºéç»“æ„åŒ–ç´¢å¼•,ä¹Ÿæ²¡æœ‰å­—æ®µ</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// ç»“æ„åŒ–ç´¢å¼•: æŒ‡å®šäº†mappings
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#f85149>curl</span> <span style=color:#f85149>-X</span> <span style=color:#f85149>PUT</span> <span style=color:#f85149>&#39;localhost:</span><span style=color:#a5d6ff>9200</span><span style=color:#f85149>/accounts&#39;</span> <span style=color:#f85149>-d</span> <span style=color:#f85149>&#39;</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#7ee787>&#34;mappings&#34;</span>: { <span style=color:#8b949e;font-style:italic>// mappings æ˜ å°„
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        <span style=color:#7ee787>&#34;man&#34;</span>: { <span style=color:#8b949e;font-style:italic>// type
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>            <span style=color:#7ee787>&#34;properties&#34;</span>: { <span style=color:#8b949e;font-style:italic>// å…·ä½“å±æ€§
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                <span style=color:#7ee787>&#34;name&#34;</span>: { <span style=color:#8b949e;font-style:italic>// å­—æ®µå
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                    <span style=color:#7ee787>&#34;type&#34;</span>:<span style=color:#a5d6ff>&#34;text&#34;</span> <span style=color:#8b949e;font-style:italic>// å­—æ®µç±»å‹
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                    <span style=color:#8b949e;font-style:italic>// ....è¿˜æœ‰å…¶ä»–å¯ä»¥é€‰,æ¯”å¦‚æ‹†åˆ†è§„åˆ™,æƒé‡å€¼
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                },
</span></span><span style=display:flex><span>                <span style=color:#7ee787>&#34;country&#34;</span>: {
</span></span><span style=display:flex><span>                    <span style=color:#7ee787>&#34;type&#34;</span>:<span style=color:#a5d6ff>&#34;keyword&#34;</span>
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>                <span style=color:#7ee787>&#34;age&#34;</span>: {
</span></span><span style=display:flex><span>                    <span style=color:#7ee787>&#34;type&#34;</span>:<span style=color:#a5d6ff>&#34;integer&#34;</span>
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>                <span style=color:#7ee787>&#34;date&#34;</span>: {
</span></span><span style=display:flex><span>                    <span style=color:#7ee787>&#34;type&#34;</span>: <span style=color:#a5d6ff>&#34;date&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#7ee787>&#34;format&#34;</span>: <span style=color:#a5d6ff>&#34;yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis&#34;</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>//         &#34;worman&#34;: {} // 6.xç‰ˆæœ¬åªæ”¯æŒä¸€ä¸ªtype
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>   		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span><span style=color:#f85149>}&#39;</span>
</span></span></code></pre></div><blockquote><p>å…¶æ ¸å¿ƒæ˜¯é‡Œé¢çš„jsonå­—ç¬¦ä¸²</p></blockquote><p><img loading=lazy src=https://img2018.cnblogs.com/blog/1242227/201907/1242227-20190721123224362-996727299.png alt=ä¸€å¼ ç½‘å›¾></p><h2 id=22-æ’å…¥æ•°æ®>2.2 æ’å…¥æ•°æ®<a hidden class=anchor aria-hidden=true href=#22-æ’å…¥æ•°æ®>#</a></h2><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#f85149>curl</span> <span style=color:#f85149>-X</span> <span style=color:#f85149>POST</span> <span style=color:#f85149>&#39;localhost:</span><span style=color:#a5d6ff>9200</span><span style=color:#f85149>/accounts/person/</span><span style=color:#a5d6ff>1000</span><span style=color:#f85149>&#39;</span> <span style=color:#f85149>-d</span> <span style=color:#f85149>&#39;</span> 
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// è¿™ä¸ª1000è¡¨ç¤ºid,å¦‚æœä¸å†™esä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª,å¦‚æœè¿ç´¢å¼•å’Œç±»å‹ä¹Ÿæ²¡æœ‰ä¹Ÿä¼šä¸€å¹¶åˆ›å»º,å¦‚æœidå·²å­˜åœ¨åˆ™ä¿®æ”¹
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>{
</span></span><span style=display:flex><span>  <span style=color:#7ee787>&#34;user&#34;</span>: <span style=color:#a5d6ff>&#34;å¼ ä¸‰&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#7ee787>&#34;title&#34;</span>: <span style=color:#a5d6ff>&#34;å·¥ç¨‹å¸ˆ&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#7ee787>&#34;desc&#34;</span>: <span style=color:#a5d6ff>&#34;æ•°æ®åº“ç®¡ç†&#34;</span>
</span></span><span style=display:flex><span>}<span style=color:#f85149>&#39;</span> 
</span></span></code></pre></div><blockquote><p>æ ¼å¼æ˜¯ <code>ip:port/ç´¢å¼•/ç±»å‹/id</code>, å‚æ•°æ˜¯å„å±æ€§çš„jsonå­—ç¬¦ä¸²</p></blockquote><h2 id=23-ä¿®æ”¹æ•°æ®>2.3 ä¿®æ”¹æ•°æ®<a hidden class=anchor aria-hidden=true href=#23-ä¿®æ”¹æ•°æ®>#</a></h2><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#f85149>post</span> <span style=color:#f85149>http:</span><span style=color:#8b949e;font-style:italic>//localhost:9200/test/_doc/1/_update
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#7ee787>&#34;script&#34;</span>: {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7ee787>&#34;lang&#34;</span>: <span style=color:#a5d6ff>&#34;painless&#34;</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#7ee787>&#34;inline&#34;</span>: <span style=color:#a5d6ff>&#34;ctx._source.age += 30&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><p>å…³é”®å­—â€scriptâ€: æ ‡å¿—ä»¥è„šæœ¬çš„æ–¹å¼ä¿®æ”¹æ–‡æ¡£</p><p>â€œlangâ€ï¼šè¡¨ç¤ºä»¥ä½•ç§è„šæœ¬è¯­è¨€è¿›è¡Œä¿®æ”¹ï¼Œâ€œpainlessâ€è¡¨ç¤ºä»¥eså†…ç½®çš„è„šæœ¬è¯­è¨€è¿›è¡Œä¿®æ”¹ã€‚æ­¤å¤–esè¿˜æ”¯æŒå¤šç§è„šæœ¬è¯­è¨€ï¼Œå¦‚Pythonï¼Œjsç­‰ç­‰</p><p>â€œinlineâ€ï¼šæŒ‡å®šè„šæœ¬å†…å®¹ â€œctxâ€ä»£è¡¨esä¸Šä¸‹æ–‡ï¼Œ_source ä»£è¡¨æ–‡æ¡£</p></blockquote><p>æ ¹æ®æ¡ä»¶ä¿®æ”¹ä¿¡æ¯:</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#f85149>POST</span> <span style=color:#f85149>my_index/_update_by_query</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#7ee787>&#34;script&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#7ee787>&#34;source&#34;</span>: <span style=color:#a5d6ff>&#34;ctx._source[&#39;ipsub&#39;]=0&#34;</span> 
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#7ee787>&#34;query&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#7ee787>&#34;bool&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#7ee787>&#34;must_not&#34;</span>: [
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>          <span style=color:#7ee787>&#34;exists&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#7ee787>&#34;field&#34;</span>: <span style=color:#a5d6ff>&#34;ipsub&#34;</span>
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      ]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span></code></pre></div><blockquote><p>ä¸Šé¢è¯­å¥æ˜¯æ ¹æ®æ˜¯å¦å­˜åœ¨"ipsub"å­—æ®µï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œç»™ä¿¡æ¯å¢åŠ å­—æ®µ"ipsub"ï¼Œå¹¶ä¸”èµ‹å€¼0</p></blockquote><h2 id=24-æŸ¥çœ‹>2.4 æŸ¥çœ‹<a hidden class=anchor aria-hidden=true href=#24-æŸ¥çœ‹>#</a></h2><ol><li>æŸ¥çœ‹xkj_testç´¢å¼•æ•°æ®æ ¼å¼</li></ol><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#f85149>curl</span> <span style=color:#f85149>-X</span> <span style=color:#f85149>GET</span> <span style=color:#f85149>http:</span><span style=color:#8b949e;font-style:italic>//localhost:9200/xkj_test/
</span></span></span></code></pre></div><ol start=2><li>æŸ¥çœ‹xkj_testç´¢å¼•ä¸‹æŒ‡å®šidæŸ¥çœ‹</li></ol><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#f85149>curl</span> <span style=color:#f85149>-X</span> <span style=color:#f85149>GET</span> <span style=color:#f85149>&#39;localhost:</span><span style=color:#a5d6ff>9200</span><span style=color:#f85149>/xkj_test/person/</span><span style=color:#a5d6ff>1000</span><span style=color:#f85149>?pretty=</span><span style=color:#79c0ff>true</span><span style=color:#f85149>&#39;</span>
</span></span></code></pre></div><ol start=3><li>æ ¹æ®æ¡ä»¶æŸ¥è¯¢</li></ol><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#f85149>curl</span> <span style=color:#f85149>-X</span> <span style=color:#f85149>POST</span> <span style=color:#f85149>&#39;localhost:</span><span style=color:#a5d6ff>9200</span><span style=color:#f85149>/accounts/person/_search&#39;</span>  <span style=color:#f85149>-d</span> <span style=color:#f85149>&#39;</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// è¦å¸¦ä¸Š  _search å…³é”®å­—
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>{
</span></span><span style=display:flex><span>  <span style=color:#7ee787>&#34;query&#34;</span> : { <span style=color:#7ee787>&#34;match&#34;</span> : [{ <span style=color:#7ee787>&#34;desc&#34;</span> : <span style=color:#a5d6ff>&#34;è½¯ä»¶&#34;</span> },{ <span style=color:#7ee787>&#34;desc&#34;</span> : <span style=color:#a5d6ff>&#34;è½¯ä»¶ å·¥ç¨‹&#34;</span> }]}
</span></span><span style=display:flex><span>}<span style=color:#f85149>&#39;</span>
</span></span></code></pre></div><blockquote><p>and æŸ¥è¯¢: matchå†™å¤šä¸ªæ¡ä»¶</p><p>or æŸ¥è¯¢: åˆ©ç”¨ç©ºæ ¼çš„åˆ†è¯,è¾¾åˆ°orçš„æ•ˆæœ(æˆ‘çŒœçš„)</p><p><code>_score</code> ï¼šåŒ¹é…åº¦</p><p><code>_source</code>ï¼šæ–‡æ¡£çš„å­—æ®µ</p><p>æ¥æº: <a href=https://www.jianshu.com/p/083d99a1db6e target=_blank rel=noopener>https://www.jianshu.com/p/083d99a1db6e</a></p></blockquote><p><b style=color:red>esçš„æŸ¥è¯¢äº”èŠ±å…«é—¨,æœ€å¥½çš„æŠ€æœ¯ä¹¦ç±å°±æ˜¯å®˜ç½‘,ä»¥åå¥½å¥½çœ‹,å¦‚æœè¦æŸ¥æ•°æ®,å€ŸåŠ©å¯è§†åŒ–ç•Œé¢å°±å¤Ÿç”¨äº†</b></p><blockquote><p><a href=https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html target=_blank rel=noopener>https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html</a></p></blockquote><h2 id=25-åˆ é™¤>2.5 åˆ é™¤<a hidden class=anchor aria-hidden=true href=#25-åˆ é™¤>#</a></h2><p><strong>åˆ é™¤xkj_testç´¢å¼•</strong></p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#f85149>delete</span> <span style=color:#f85149>http:</span><span style=color:#8b949e;font-style:italic>//localhost:9200/xkj_test/
</span></span></span></code></pre></div><p><strong>åˆ é™¤xkj_testç´¢å¼•ä¸‹çš„æ•°æ®(æŒ‡å®šid)</strong></p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#f85149>delete</span> <span style=color:#f85149>http:</span><span style=color:#8b949e;font-style:italic>//localhost:9200/xkj_test/_doc/1
</span></span></span></code></pre></div><p><strong>æ ¹æ®æ¡ä»¶åˆ é™¤xkj_testç´¢å¼•ä¸‹test1ç±»å‹çš„æ•°æ®</strong></p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#f85149>post</span> <span style=color:#f85149>http:</span><span style=color:#8b949e;font-style:italic>//localhost:9200/xkj_test/test1/_delete_by_query
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>{
</span></span><span style=display:flex><span>  <span style=color:#7ee787>&#34;query&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#7ee787>&#34;range&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#7ee787>&#34;createDate&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&#34;lt&#34;</span>: <span style=color:#a5d6ff>&#34;now-31d&#34;</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><p>è§£é‡Š: åˆ é™¤ createDate å­—æ®µä¸‹31å¤©å‰çš„æ•°æ®</p><p>åˆ©ç”¨_delete_by_queryæ’ä»¶å»æ‰¹é‡åˆ é™¤</p><p><a href=https://blog.csdn.net/weixin_44034192/article/details/89372934 target=_blank rel=noopener>https://blog.csdn.net/weixin_44034192/article/details/89372934</a></p></blockquote><h2 id=26-ç®€å•æ’åº>2.6 ç®€å•æ’åº<a hidden class=anchor aria-hidden=true href=#26-ç®€å•æ’åº>#</a></h2><p>æŒ‰ç…§æŒ‡å®šå­—æ®µæ’åº,(é»˜è®¤æŒ‰ç…§åˆ†æ•°æ’åº)</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>GET books/_search
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;sort&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;price&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;order&#34;: &#34;desc&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>    },
</span></span></span><span style=display:flex><span><span style=color:#f85149>     &#34;age&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;order&#34;: &#34;desc&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  ]
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span><span style=display:flex><span><span style=color:#f85149>// æŒ‰ç…§ä»·æ ¼é™åºæ’,å†æŒ‰å¹´é¾„æ’
</span></span></span></code></pre></div><blockquote><p>åœ¨ Elasticsearch ä¸­ï¼Œé»˜è®¤æ’åºæ˜¯<strong>æŒ‰ç…§ç›¸å…³æ€§çš„è¯„åˆ†ï¼ˆ_scoreï¼‰<strong>è¿›è¡Œé™åºæ’åºï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§</strong>å­—æ®µçš„å€¼æ’åº</strong>ã€<strong>å¤šçº§æ’åº</strong>ã€<strong>å¤šå€¼å­—æ®µæ’åºã€åŸºäº geoï¼ˆåœ°ç†ä½ç½®ï¼‰æ’åºä»¥åŠè‡ªå®šä¹‰è„šæœ¬æ’åº</strong>ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå¯¹äºç›¸å…³æ€§çš„è¯„åˆ†ä¹Ÿå¯ä»¥ç”¨ rescore äºŒæ¬¡ã€ä¸‰æ¬¡æ‰“åˆ†ï¼Œå®ƒå¯ä»¥é™å®šé‡æ–°æ‰“åˆ†çš„çª—å£å¤§å°ï¼ˆwindow sizeï¼‰ï¼Œå¹¶é’ˆå¯¹ä½œç”¨èŒƒå›´å†…çš„æ–‡æ¡£ä¿®æ”¹å…¶å¾—åˆ†ï¼Œä»è€Œè¾¾åˆ°ç²¾ç»†åŒ–æ§åˆ¶ç»“æœç›¸å…³æ€§çš„ç›®çš„ã€‚</p></blockquote><h1 id=3-å¤æ‚æŸ¥è¯¢>3. å¤æ‚æŸ¥è¯¢<a hidden class=anchor aria-hidden=true href=#3-å¤æ‚æŸ¥è¯¢>#</a></h1><h2 id=31-query-and-filter-context>3.1 Query and filter context<a hidden class=anchor aria-hidden=true href=#31-query-and-filter-context>#</a></h2><p>æŸ¥è¯¢å­å¥çš„è¡Œä¸ºå–å†³äºå®ƒæ˜¯ç”¨åœ¨æŸ¥è¯¢ä¸Šä¸‹æ–‡ï¼ˆquery contextï¼‰è¿˜æ˜¯ç”¨åœ¨è¿‡æ»¤å™¨ä¸Šä¸‹æ–‡ï¼ˆfilter contextï¼‰ï¼š</p><h3 id=311-query-context>3.1.1 Query context<a hidden class=anchor aria-hidden=true href=#311-query-context>#</a></h3><p>åœ¨æŸ¥è¯¢ä¸Šä¸‹æ–‡ä¸­çš„æŸ¥è¯¢å­å¥å›ç­”äº†â€œè¿™ä¸ªæ–‡æ¡£ä¸è¿™ä¸ªæŸ¥è¯¢å­å¥çš„åŒ¹é…ç¨‹åº¦æ˜¯æ€æ ·çš„ï¼Ÿâ€é—®é¢˜ã€‚é™¤äº†å†³å®šæ–‡æ¡£æ˜¯å¦åŒ¹é…ä»¥å¤–ï¼ŒæŸ¥è¯¢å­å¥<strong>è¿˜ä¼šè®¡ç®—ä¸€ä¸ªâ€œ_scoreâ€</strong>ï¼Œå®ƒè¡¨ç¤ºæ–‡æ¡£ä¸å…¶ä»–æ–‡æ¡£çš„ç›¸å…³ç¨‹åº¦(åˆ†æ•°)ã€‚</p><h3 id=312-filter-context>3.1.2 Filter context<a hidden class=anchor aria-hidden=true href=#312-filter-context>#</a></h3><p>åœ¨è¿‡æ»¤å™¨ä¸Šä¸‹æ–‡ä¸­ï¼Œä¸€ä¸ªæŸ¥è¯¢å­å¥å›ç­”äº†â€œè¿™ä¸ªæ–‡æ¡£ä¸æŸ¥è¯¢å­å¥åŒ¹é…å—ï¼Ÿâ€çš„é—®é¢˜ã€‚è¿™ä¸ªç­”æ¡ˆæ˜¯ç®€å•çš„Yesæˆ–è€…Noï¼Œ<strong>ä¹Ÿä¸ä¼šè®¡ç®—åˆ†æ•°</strong>ã€‚è¿‡æ»¤ä¸Šä¸‹æ–‡ä¸»è¦ç”¨äºè¿‡æ»¤ç»“æ„åŒ–æ•°æ®</p><blockquote><p>PSï¼šQuery VS Filter</p><ol><li>æŸ¥è¯¢ååº”çš„æ˜¯æ–‡æ¡£ä¸æŸ¥è¯¢å­å¥çš„åŒ¹é…ç¨‹åº¦ï¼Œè€Œè¿‡æ»¤ååº”çš„æ˜¯æ–‡æ¡£æ˜¯å¦åŒ¹é…æŸ¥è¯¢å­å¥</li><li>ä¸€ä¸ªæ˜¯ç­›é€‰æ˜¯å¦æ»¡è¶³æ¡ä»¶ï¼Œæƒ…å†µæ— éä¸¤ç§ï¼šæ˜¯æˆ–ä¸æ˜¯ï¼›ä¸€ä¸ªæ˜¯çœ‹æ»¡è¶³æ¡ä»¶çš„è®°å½•ä¸æŸ¥è¯¢æ¡ä»¶çš„åŒ¹é…ç¨‹åº¦</li><li>å“ªäº›æ»¡è¶³æ¡ä»¶ï¼Œè¿™æ˜¯è¿‡æ»¤ï¼›æ»¡è¶³æ¡ä»¶çš„è¿™äº›è®°å½•ä¸æ¡ä»¶çš„åŒ¹é…ç¨‹åº¦ï¼Œè¿™æ˜¯æŸ¥è¯¢</li><li>è¿‡æ»¤ä¸ä¼šè®¡ç®—è¯„åˆ†ï¼ŒæŸ¥è¯¢ä¼šè®¡ç®—è¯„åˆ†</li></ol></blockquote><h2 id=32-å…¨æ–‡æŸ¥è¯¢-full-text>3.2 å…¨æ–‡æŸ¥è¯¢( Full text)<a hidden class=anchor aria-hidden=true href=#32-å…¨æ–‡æŸ¥è¯¢-full-text>#</a></h2><h3 id=311--match--query>3.1.1 match query<a hidden class=anchor aria-hidden=true href=#311--match--query>#</a></h3><p>matchæŸ¥è¯¢æ¥å—æ–‡æœ¬/æ•°å€¼/æ—¥æœŸç±»å‹çš„æ•°æ®ï¼Œåˆ†æå®ƒä»¬ï¼Œå¹¶æ„é€ ä¸€ä¸ªæŸ¥è¯¢ã€‚</p><blockquote><p><strong>ç›¸å½“äºæ¨¡ç³ŠæŸ¥è¯¢</strong></p></blockquote><p>matchæ˜¯ä¸€ç§å¸ƒå°”ç±»å‹çš„æŸ¥è¯¢ã€‚è¿™æ„å‘³ç€å®ƒå¯¹æä¾›çš„æ–‡æœ¬è¿›è¡Œåˆ†æï¼Œå¹¶åœ¨åˆ†æçš„è¿‡ç¨‹ä¸­ä¸ºæä¾›çš„æ–‡æœ¬æ„é€ ä¸€ä¸ªå¸ƒå°”æŸ¥è¯¢ã€‚operator é€‰é¡¹å¯ä»¥è®¾ç½®ä¸º or æˆ–è€… and ä»¥æ­¤æ¥æ§åˆ¶å¸ƒå°”å­å¥ï¼ˆé»˜è®¤æ˜¯ or ï¼‰ã€‚ä¾‹å¦‚</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>curl -X GET &#34;localhost:9200/_search&#34; -H &#39;Content-Type: application/json&#39; -d&#39;
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;query&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;match&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>            &#34;skuName&#34; : &#34;ç©ºè°ƒ&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>        }
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}&#39;
</span></span></span></code></pre></div><h3 id=312-match-phrase-query>3.1.2 Match Phrase Query<a hidden class=anchor aria-hidden=true href=#312-match-phrase-query>#</a></h3><p>match_phrase æŸ¥è¯¢ä¸ matchç±»ä¼¼ï¼Œä½†æ˜¯å®ƒæ˜¯ç”¨äº<strong>ç²¾ç¡®åŒ¹é…æˆ–å•è¯æ¥è¿‘åŒ¹é…</strong>çš„ã€‚ä¾‹å¦‚ï¼š</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>curl -X GET &#34;localhost:9200/_search&#34; -H &#39;Content-Type: application/json&#39; -d&#39;
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;query&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;match_phrase&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>            &#34;skuName&#34; : &#34;this is a test&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>        }
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}&#39;
</span></span></span></code></pre></div><h3 id=313-multi-match-query>3.1.3 Multi Match Query<a hidden class=anchor aria-hidden=true href=#313-multi-match-query>#</a></h3><p>multi_match ç›¸å½“äº match çš„å¤šå­—æ®µç‰ˆæœ¬, multi_matchå¯ä»¥æŒ‡å®šå¤šä¸ªå­—æ®µï¼Œè€Œmatchåªèƒ½é’ˆå¯¹ä¸€ä¸ªå­—æ®µ</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>curl -X GET &#34;localhost:9200/_search&#34; -H &#39;Content-Type: application/json&#39; -d&#39;
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;query&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;multi_match&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;query&#34;:    &#34;this is a test&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;fields&#34;: [ &#34;subject&#34;, &#34;skuName&#34; ] 
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span><span style=display:flex><span><span style=color:#f85149>&#39;
</span></span></span><span style=display:flex><span><span style=color:#f85149>fields é‡Œçš„å­—æ®µç”¨ * æ”¯æŒæ¨¡ç³ŠåŒ¹é…,  å†™æˆè¿™ç§ [ &#34;subject^3&#34;, &#34;skuName&#34; ] è¡¨ç¤ºsubjectæ¯”skuNameé‡è¦3å€
</span></span></span></code></pre></div><h3 id=314-query-string-query>3.1.4 Query String Query<a hidden class=anchor aria-hidden=true href=#314-query-string-query>#</a></h3><p>æ”¯æŒLuceneæŸ¥è¯¢å­—ç¬¦ä¸²è¯­æ³•ï¼Œå…è®¸æŒ‡å®š AND | OR | NOT ï¼Œå¹¶ä¸”åœ¨å•ä¸ªæŸ¥è¯¢å­—ç¬¦ä¸²ä¸­è¿›è¡Œå¤šå­—æ®µæŸ¥è¯¢, åˆ†è¯åå¯¹æ¯ä¸ªè¯éƒ½æŸ¥è¯¢</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>curl -X GET &#34;localhost:9200/_search&#34; -H &#39;Content-Type: application/json&#39; -d&#39;
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;query&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;query_string&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>            &#34;default_field&#34; : &#34;skuName&#34;,
</span></span></span><span style=display:flex><span><span style=color:#f85149>            &#34;query&#34; : &#34;this  that  thus&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>        }
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span><span style=display:flex><span><span style=color:#f85149>&#39;
</span></span></span><span style=display:flex><span><span style=color:#f85149>// åœ¨skuNameä¸­æŸ¥è¯¢ this , that , thus ä¸‰ä¸ªè¯ , å…¶å®è´¨è§£ææˆ: &#34; this OR that OR thus&#34;, ä½ å¯ä»¥æ›¿æ¢ORä¸ºAND/NOT
</span></span></span><span style=display:flex><span><span style=color:#f85149>// è¿˜å¯ä»¥æŒ‡å®šå¿« ä¾‹å¦‚:  &#34;query&#34; : &#34;(new york city) OR (big apple)&#34;  è¿™æ ·å°†è¢«æ‹†åˆ†æˆ â€œnew york cityâ€ å’Œ â€œbig appleâ€ ä¸¤éƒ¨åˆ†ï¼Œå¹¶ä¸”æ¯ä¸€éƒ¨åˆ†éƒ½è¢«åˆ†æå™¨ç‹¬ç«‹åˆ†æ
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>curl -X GET &#34;localhost:9200/_search&#34; -H &#39;Content-Type: application/json&#39; -d&#39;
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;query&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;query_string&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>            &#34;fields&#34; : [&#34;content&#34;, &#34;name&#34;],
</span></span></span><span style=display:flex><span><span style=color:#f85149>            &#34;query&#34; : &#34;this AND that&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>        }
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span><span style=display:flex><span><span style=color:#f85149>&#39;
</span></span></span><span style=display:flex><span><span style=color:#f85149>// ç­‰ä»·äº
</span></span></span><span style=display:flex><span><span style=color:#f85149>curl -X GET &#34;localhost:9200/_search&#34; -H &#39;Content-Type: application/json&#39; -d&#39;
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;query&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;query_string&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>            &#34;query&#34;: &#34;(content:this OR name:this) AND (content:that OR name:that)&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>        }
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span><span style=display:flex><span><span style=color:#f85149>&#39;
</span></span></span></code></pre></div><blockquote><p>æ³¨æ„ï¼Œ<strong>æŒ‰æ“ä½œç¬¦æ‹†åˆ†</strong></p><p>query_stringçš„å‚æ•°åŒ…æ‹¬ï¼š</p><p>queryã€€ã€€å®ä¾‹è¢«è§£æçš„æŸ¥è¯¢æ–‡æœ¬</p><p>default_fieldã€€ã€€å¦‚æœæ²¡æœ‰æŒ‡å®šå‰ç¼€å­—æ®µçš„è¯ï¼Œè¿™æ˜¯é»˜è®¤çš„æŸ¥è¯¢å­—æ®µã€‚ï¼ˆé»˜è®¤æŸ¥è¯¢æ‰€æœ‰å­—æ®µï¼‰</p><p>default_operatorã€€ã€€å¦‚æœæ²¡æœ‰æ˜ç¡®æŒ‡å®šæ“ä½œç¬¦çš„è¯ï¼Œé‚£ä¹ˆè¿™æ˜¯é»˜è®¤çš„æ“ä½œç¬¦ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé»˜è®¤æ“ä½œç¬¦æ˜¯ORçš„è¯ï¼Œé‚£ä¹ˆâ€œmy name is jackâ€å°†è¢«ç¿»è¯‘æˆâ€œmy OR name OR is OR jackâ€ï¼ŒåŒç†ï¼Œå¦‚æœæ˜¯ANDï¼Œåˆ™è¢«ç¿»è¯‘æˆâ€œmy AND name AND is AND jackâ€</p><p>analyzerã€€ã€€ç”¨æ¥è§£ææŸ¥è¯¢å­—ç¬¦ä¸²çš„è§£æå™¨çš„åå­—</p><p>allow_leading_wildcardã€€ã€€å¦‚æœè®¾ç½®äº†ï¼Œé‚£ä¹ˆ * æˆ– ? å…è®¸ä½œä¸ºç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚é»˜è®¤æ˜¯true</p><p>lenientã€€ã€€å¦‚æœè®¾ç½®ä¸ºtrueï¼Œåˆ™æ ¼å¼å¤±è´¥å°†è¢«å¿½ç•¥</p></blockquote><h2 id=32-å•è¯çº§æŸ¥è¯¢term-text>3.2 å•è¯çº§æŸ¥è¯¢(term text)<a hidden class=anchor aria-hidden=true href=#32-å•è¯çº§æŸ¥è¯¢term-text>#</a></h2><p>å…¨æ–‡æœ¬æŸ¥è¯¢ä¼šåœ¨æ‰§è¡Œä¹‹å‰å¯¹æŸ¥è¯¢å­—ç¬¦ä¸²è¿›è¡Œåˆ†æï¼Œè€Œå•è¯çº§åˆ«æŸ¥è¯¢ä¼šå¯¹å­˜å‚¨åœ¨åå‘ç´¢å¼•ä¸­çš„ç²¾ç¡®çš„termè¿›è¡Œæ“ä½œã€‚</p><p>è¿™äº›æŸ¥è¯¢é€šå¸¸ç”¨äºç»“æ„åŒ–çš„æ•°æ®ï¼Œæ¯”å¦‚ï¼šnumbers ï¼Œ dates ï¼Œenums ç­‰ï¼Œè€Œä¸æ˜¯å¯¹å…¨æ–‡æœ¬å­—æ®µã€‚</p><p>ï¼ˆPSï¼šä¹Ÿå°±æ˜¯è¯´ï¼Œå…¨æ–‡æœ¬æŸ¥è¯¢ä¹‹å‰è¦å…ˆå¯¹æ–‡æœ¬å†…å®¹è¿›è¡Œåˆ†è¯ï¼Œè€Œå•è¯çº§åˆ«çš„æŸ¥è¯¢ç›´æ¥åœ¨ç›¸åº”å­—æ®µçš„åå‘ç´¢å¼•ä¸­ç²¾ç¡®æŸ¥æ‰¾ï¼Œå•è¯çº§åˆ«çš„æŸ¥è¯¢ä¸€èˆ¬ç”¨äºæ•°å€¼ã€æ—¥æœŸç­‰ç±»å‹çš„å­—æ®µä¸Šï¼‰</p><h3 id=321--term-query>3.2.1 Term Query<a hidden class=anchor aria-hidden=true href=#321--term-query>#</a></h3><p>åœ¨æŒ‡å®šçš„å­—æ®µä¸­æŸ¥æ‰¾åŒ…å«æŒ‡å®šçš„ç²¾ç¡®çš„termçš„æ–‡æ¡£</p><p>termæŸ¥è¯¢å°†åœ¨åå‘ç´¢å¼•ï¼ˆæˆ–è€…å«å€’æ’ç´¢å¼•ï¼‰ä¸­æŸ¥æ‰¾åŒ…å«ç‰¹å®šçš„ç²¾ç¡®çš„termçš„æ–‡æ¡£ã€‚ä¾‹å¦‚ï¼š</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>curl -X POST &#34;localhost:9200/_search&#34; -H &#39;Content-Type: application/json&#39; -d&#39;
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;query&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;term&#34; : { &#34;user&#34; : &#34;Kimchy&#34; } 
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span><span style=display:flex><span><span style=color:#f85149>&#39;
</span></span></span><span style=display:flex><span><span style=color:#f85149>// æŸ¥è¯¢å€’æ’ç´¢å¼•(åˆ‡è¯å)ä¸­useråŒ…å«&#34;kimchy&#34;å­—ç¬¦ä¸²çš„å€¼,
</span></span></span></code></pre></div><h3 id=322--terms-query>3.2.2 Terms Query<a hidden class=anchor aria-hidden=true href=#322--terms-query>#</a></h3><p>æŸ¥æ‰¾åŒ…å«æŒ‡å®šå­—æ®µä¸­æŒ‡å®šçš„ä»»ä½•ç¡®åˆ‡termçš„æ–‡æ¡£</p><p>ç­›é€‰å‡ºä¸æ‰€æä¾›çš„termsä¸­ä»»ä½•ä¸€ä¸ªåŒ¹é…çš„æ–‡æ¡£</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>curl -X GET &#34;localhost:9200/_search&#34; -H &#39;Content-Type: application/json&#39; -d&#39;
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;query&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;terms&#34; : { &#34;user&#34; : [&#34;kimchy&#34;, &#34;elasticsearch&#34;]}
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span><span style=display:flex><span><span style=color:#f85149>&#39;
</span></span></span><span style=display:flex><span><span style=color:#f85149>// æŸ¥è¯¢ åˆ‡è¯ååŒ…å«&#34;kimchy&#34;æˆ–è€… &#34;elasticsearch&#34;æ–‡æ¡£
</span></span></span></code></pre></div><h3 id=323-range-query>3.2.3 Range Query<a hidden class=anchor aria-hidden=true href=#323-range-query>#</a></h3><p>æŸ¥æ‰¾æŒ‡å®šå­—æ®µåœ¨æŒ‡å®šèŒƒå›´å†…åŒ…å«å€¼ï¼ˆæ—¥æœŸã€æ•°å­—æˆ–å­—ç¬¦ä¸²ï¼‰çš„æ–‡æ¡£ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­è¿”å›ageå­—æ®µçš„å€¼åœ¨10åˆ°20ä¹‹é—´çš„æ–‡æ¡£ï¼š</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>curl -X GET &#34;localhost:9200/_search&#34; -H &#39;Content-Type: application/json&#39; -d&#39;
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;query&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;range&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>            &#34;age&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>                &#34;gte&#34; : 10,
</span></span></span><span style=display:flex><span><span style=color:#f85149>                &#34;lte&#34; : 20,
</span></span></span><span style=display:flex><span><span style=color:#f85149>                &#34;boost&#34; : 2.0
</span></span></span><span style=display:flex><span><span style=color:#f85149>            }
</span></span></span><span style=display:flex><span><span style=color:#f85149>        }
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span><span style=display:flex><span><span style=color:#f85149>&#39;
</span></span></span></code></pre></div><blockquote><p>rangeæŸ¥è¯¢å¯ä»¥æ¥å—ä¸‹åˆ—å‚æ•°ï¼š</p><p>gteã€€ã€€å¤§äºæˆ–ç­‰äº</p><p>gtã€€ã€€ å¤§äº</p><p>lteã€€ã€€ å°äºæˆ–ç­‰äº</p><p>ltã€€ã€€ å°äº</p><p>boostã€€ã€€è®¾ç½®boostå€¼ï¼Œé»˜è®¤æ˜¯1.0</p></blockquote><p>åœ¨æ—¥æœŸèŒƒå›´æŸ¥è¯¢çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šæ—¥æœŸæ ¼å¼ã€‚ä¾‹å¦‚ï¼š(æ—¶é—´æ ¼å¼esä¼šè‡ªåŠ¨è½¬åŒ–,ç”¨å­—ç¬¦ä¸²å»æŸ¥æ—¶é—´æ ¼å¼ä¹Ÿèƒ½è¡Œ)</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>curl -X GET &#34;localhost:9200/_search&#34; -H &#39;Content-Type: application/json&#39; -d&#39;
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;query&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;range&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>            &#34;born&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>                &#34;gte&#34;: &#34;01/01/2012&#34;,
</span></span></span><span style=display:flex><span><span style=color:#f85149>                &#34;lte&#34;: &#34;2013&#34;,
</span></span></span><span style=display:flex><span><span style=color:#f85149>                &#34;format&#34;: &#34;dd/MM/yyyy||yyyy&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>            }
</span></span></span><span style=display:flex><span><span style=color:#f85149>        }
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span><span style=display:flex><span><span style=color:#f85149>&#39;
</span></span></span><span style=display:flex><span><span style=color:#f85149>// è¿™ä¸ªä¾‹å­æ˜¯æŸ¥è¯¢åœ¨2012-01-01åˆ°2013-12-31ä¹‹é—´å‡ºç”Ÿçš„äºº
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>curl -X GET &#34;localhost:9200/_search&#34; -H &#39;Content-Type: application/json&#39; -d&#39;
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;query&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;range&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>            &#34;timestamp&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>                &#34;gte&#34;: &#34;2015-01-01 00:00:00&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#f85149>                &#34;lte&#34;: &#34;now&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#f85149>                &#34;time_zone&#34;: &#34;+01:00&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>            }
</span></span></span><span style=display:flex><span><span style=color:#f85149>        }
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span><span style=display:flex><span><span style=color:#f85149>&#39;
</span></span></span></code></pre></div><h3 id=324-exsit-query>3.2.4 Exsit Query<a hidden class=anchor aria-hidden=true href=#324-exsit-query>#</a></h3><p>åœ¨ç‰¹å®šçš„å­—æ®µä¸­æŸ¥æ‰¾éç©ºå€¼çš„æ–‡æ¡£</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>curl -X GET &#34;localhost:9200/_search&#34; -H &#39;Content-Type: application/json&#39; -d&#39;
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;query&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;exists&#34; : { &#34;field&#34; : &#34;user&#34; }
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span><span style=display:flex><span><span style=color:#f85149>&#39;
</span></span></span></code></pre></div><h3 id=325-prefix-query>3.2.5 Prefix Query<a hidden class=anchor aria-hidden=true href=#325-prefix-query>#</a></h3><p>æŸ¥æ‰¾åŒ…å«å¸¦æœ‰æŒ‡å®šå‰ç¼€çš„termçš„æ–‡æ¡£</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>curl -X GET &#34;localhost:9200/_search&#34; -H &#39;Content-Type: application/json&#39; -d&#39;
</span></span></span><span style=display:flex><span><span style=color:#f85149>{ 
</span></span></span><span style=display:flex><span><span style=color:#f85149>	&#34;query&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    	&#34;prefix&#34; : { &#34;user&#34; : &#34;ki&#34; }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span><span style=display:flex><span><span style=color:#f85149>&#39;
</span></span></span></code></pre></div><h3 id=326-wildcard-query>3.2.6 Wildcard Query<a hidden class=anchor aria-hidden=true href=#326-wildcard-query>#</a></h3><p>æ”¯æŒé€šé…ç¬¦æŸ¥è¯¢ï¼Œ*è¡¨ç¤ºä»»æ„å­—ç¬¦ï¼Œ?è¡¨ç¤ºä»»æ„å•ä¸ªå­—ç¬¦</p><blockquote><p>è¿™ä¸ªæŸ¥è¯¢æ•ˆç‡æ¯”è¾ƒæ…¢</p></blockquote><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>curl -X GET &#34;localhost:9200/_search&#34; -H &#39;Content-Type: application/json&#39; -d&#39;
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;query&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;wildcard&#34; : { &#34;user&#34; : &#34;ki*y&#34; }
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span><span style=display:flex><span><span style=color:#f85149>&#39;
</span></span></span></code></pre></div><h3 id=327-regexp-query>3.2.7 Regexp Query<a hidden class=anchor aria-hidden=true href=#327-regexp-query>#</a></h3><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>curl -X GET &#34;localhost:9200/_search&#34; -H &#39;Content-Type: application/json&#39; -d&#39;
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;query&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;regexp&#34;:{
</span></span></span><span style=display:flex><span><span style=color:#f85149>            &#34;name.first&#34;: &#34;s.*y&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>        }
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span><span style=display:flex><span><span style=color:#f85149>&#39;
</span></span></span></code></pre></div><blockquote><p>prefix å’Œ wildcard å’Œ regexp ä¸‰è€…å·¥ä½œæ–¹å¼æ˜¯ä¸€æ ·çš„ ,éœ€è¦æ‰«æå€’æ’ç´¢å¼•ä¸­çš„è¯åˆ—è¡¨æ‰èƒ½æ‰¾åˆ°æ‰€æœ‰åŒ¹é…çš„è¯ï¼Œç„¶åä¾æ¬¡è·å–æ¯ä¸ªè¯ç›¸å…³çš„æ–‡æ¡£ ID</p><p>æ€§èƒ½å¯¹æ¯”: prefix > wildcard > regexp</p><p><strong>wildcard å’Œ regexpè¦é¿å…å·¦æ¨¡ç³ŠæŸ¥è¯¢</strong></p><p><a href=https://www.elastic.co/guide/cn/elasticsearch/guide/current/_wildcard_and_regexp_queries.html target=_blank rel=noopener>å®˜ç½‘</a></p></blockquote><h2 id=33-èšåˆæŸ¥è¯¢>3.3 èšåˆæŸ¥è¯¢<a hidden class=anchor aria-hidden=true href=#33-èšåˆæŸ¥è¯¢>#</a></h2><p>Elasticsearch çš„èšåˆï¼ˆAggregationsï¼‰åŠŸèƒ½ååˆ†å¼ºå¤§ï¼Œå…è®¸åœ¨æ•°æ®ä¸Šåšå¤æ‚çš„åˆ†æç»Ÿè®¡ã€‚Elasticsearch æä¾›çš„èšåˆåˆ†æåŠŸèƒ½ä¸»è¦æœ‰<strong>æŒ‡æ ‡èšåˆï¼ˆmetrics aggregationsï¼‰</strong>ã€<strong>æ¡¶èšåˆï¼ˆbucket aggregationsï¼‰</strong>ã€<strong>ç®¡é“èšåˆï¼ˆpipeline aggregationsï¼‰</strong> ä¸‰å¤§ç±»ï¼Œ</p><p>æ‰€æœ‰çš„èšåˆï¼Œæ— è®ºå®ƒä»¬æ˜¯ä»€ä¹ˆç±»å‹ï¼Œéƒ½éµä»ä»¥ä¸‹çš„è§„åˆ™ã€‚</p><ul><li>ä½¿ç”¨æŸ¥è¯¢ä¸­åŒæ ·çš„ JSON è¯·æ±‚æ¥å®šä¹‰å®ƒä»¬ï¼Œè€Œä¸”ä½ æ˜¯ä½¿ç”¨é”® aggregations æˆ–è€…æ˜¯ aggs æ¥è¿›è¡Œæ ‡è®°ã€‚éœ€è¦ç»™æ¯ä¸ªèšåˆèµ·ä¸€ä¸ªåå­—ï¼ŒæŒ‡å®šå®ƒçš„ç±»å‹ä»¥åŠå’Œè¯¥ç±»å‹ç›¸å…³çš„é€‰é¡¹ã€‚</li><li>å®ƒä»¬è¿è¡Œåœ¨æŸ¥è¯¢çš„ç»“æœä¹‹ä¸Šã€‚å’ŒæŸ¥è¯¢ä¸åŒ¹é…çš„æ–‡æ¡£ä¸ä¼šè®¡ç®—åœ¨å†…ï¼Œé™¤éä½ ä½¿ç”¨ global èšé›†å°†ä¸åŒ¹é…çš„æ–‡æ¡£å›Šæ‹¬å…¶ä¸­ã€‚</li><li>å¯ä»¥è¿›ä¸€æ­¥è¿‡æ»¤æŸ¥è¯¢çš„ç»“æœï¼Œè€Œä¸å½±å“èšé›†ã€‚</li></ul><p>ä»¥ä¸‹æ˜¯èšåˆçš„åŸºæœ¬ç»“æ„ï¼š</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#a5d6ff>&#34;aggregations&#34;</span> <span style=color:#f85149>:</span> { <span style=color:#f85149>&lt;!--</span> <span style=color:#f85149>æœ€å¤–å±‚çš„èšåˆé”®ï¼Œä¹Ÿå¯ä»¥ç¼©å†™ä¸º</span> <span style=color:#f85149>aggs</span> <span style=color:#f85149>--&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#7ee787>&#34;&lt;aggregation_name&gt;&#34;</span> : { <span style=color:#f85149>&lt;!--</span> <span style=color:#f85149>èšåˆçš„è‡ªå®šä¹‰åå­—</span> <span style=color:#f85149>--&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&#34;&lt;aggregation_type&gt;&#34;</span> : { <span style=color:#f85149>&lt;!--</span> <span style=color:#f85149>èšåˆçš„ç±»å‹ï¼ŒæŒ‡æ ‡ç›¸å…³çš„ï¼Œå¦‚</span> <span style=color:#f85149>maxã€minã€avgã€sumï¼Œæ¡¶ç›¸å…³çš„</span> <span style=color:#f85149>termsã€filter</span> <span style=color:#f85149>ç­‰</span> <span style=color:#f85149>--&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f85149>&lt;aggregation_body&gt;</span> <span style=color:#f85149>&lt;!--</span> <span style=color:#f85149>èšåˆä½“ï¼šå¯¹å“ªäº›å­—æ®µè¿›è¡Œèšåˆï¼Œå¯ä»¥å–å­—æ®µçš„å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯è„šæœ¬è®¡ç®—çš„ç»“æœ</span> <span style=color:#f85149>--&gt;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        [,<span style=color:#a5d6ff>&#34;meta&#34;</span> <span style=color:#f85149>:</span> {  <span style=color:#f85149>[&lt;meta_data_body&gt;]</span> } ]<span style=color:#f85149>?</span> <span style=color:#f85149>&lt;!--</span> <span style=color:#f85149>å…ƒ</span> <span style=color:#f85149>--&gt;</span>
</span></span><span style=display:flex><span>        [,<span style=color:#a5d6ff>&#34;aggregations&#34;</span> <span style=color:#f85149>:</span> { <span style=color:#f85149>[&lt;sub_aggregation&gt;]+</span> } ]<span style=color:#f85149>?</span> <span style=color:#f85149>&lt;!--</span> <span style=color:#f85149>åœ¨èšåˆé‡Œé¢åœ¨å®šä¹‰å­èšåˆ</span> <span style=color:#f85149>--&gt;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    [,<span style=color:#a5d6ff>&#34;&lt;aggregation_name_2&gt;&#34;</span> <span style=color:#f85149>:</span> { <span style=color:#f85149>...</span> } ]<span style=color:#f85149>*</span> <span style=color:#f85149>&lt;!--</span> <span style=color:#f85149>èšåˆçš„è‡ªå®šä¹‰åå­—</span> <span style=color:#a5d6ff>2</span> <span style=color:#f85149>--&gt;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li><strong>åœ¨æœ€ä¸Šå±‚æœ‰ä¸€ä¸ª aggregations çš„é”®ï¼Œå¯ä»¥ç¼©å†™ä¸º aggs</strong>ã€‚</li><li>åœ¨ä¸‹é¢ä¸€å±‚ï¼Œéœ€è¦ä¸ºèšåˆæŒ‡å®šä¸€ä¸ªåå­—ã€‚å¯ä»¥åœ¨è¯·æ±‚çš„è¿”å›ä¸­çœ‹åˆ°è¿™ä¸ªåå­—ã€‚åœ¨åŒä¸€ä¸ªè¯·æ±‚ä¸­ä½¿ç”¨å¤šä¸ªèšåˆæ—¶ï¼Œè¿™ä¸€ç‚¹éå¸¸æœ‰ç”¨ï¼Œå®ƒè®©ä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°ç†è§£æ¯ç»„ç»“æœçš„å«ä¹‰ã€‚</li><li>æœ€åï¼Œå¿…é¡»è¦æŒ‡å®šèšåˆçš„ç±»å‹ã€‚</li></ul><blockquote><p>å…³äºèšåˆåˆ†æçš„å€¼æ¥æºï¼Œå¯ä»¥<strong>å–å­—æ®µçš„å€¼</strong>ï¼Œä¹Ÿå¯ä»¥æ˜¯<strong>è„šæœ¬è®¡ç®—çš„ç»“æœ</strong>ã€‚</p><p>ä½†æ˜¯ç”¨è„šæœ¬è®¡ç®—çš„ç»“æœæ—¶ï¼Œéœ€è¦æ³¨æ„è„šæœ¬çš„æ€§èƒ½å’Œå®‰å…¨æ€§ï¼›å°½ç®¡å¤šæ•°èšé›†ç±»å‹å…è®¸ä½¿ç”¨è„šæœ¬ï¼Œä½†æ˜¯è„šæœ¬ä½¿å¾—èšé›†å˜å¾—ç¼“æ…¢ï¼Œå› ä¸ºè„šæœ¬å¿…é¡»åœ¨æ¯ç¯‡æ–‡æ¡£ä¸Šè¿è¡Œã€‚ä¸ºäº†é¿å…è„šæœ¬çš„è¿è¡Œï¼Œå¯ä»¥åœ¨ç´¢å¼•é˜¶æ®µè¿›è¡Œè®¡ç®—ã€‚</p><p>æ­¤å¤–ï¼Œè„šæœ¬ä¹Ÿå¯ä»¥è¢«äººå¯èƒ½åˆ©ç”¨è¿›è¡Œæ¶æ„ä»£ç æ”»å‡»ï¼Œå°½é‡ä½¿ç”¨æ²™ç›’ï¼ˆsandboxï¼‰å†…çš„è„šæœ¬è¯­è¨€ã€‚</p><p><strong>textç±»å‹é»˜è®¤ä¸æ”¯æŒèšåˆ</strong></p></blockquote><p>æŸ¥è¯¢æ‰€æœ‰çƒå‘˜çš„å¹³å‡å¹´é¾„æ˜¯å¤šå°‘ï¼Œå¹¶å¯¹çƒå‘˜çš„å¹³å‡è–ªæ°´åŠ  188ï¼ˆä¹Ÿå¯ä»¥ç†è§£ä¸ºæ¯åçƒå‘˜åŠ  188 åçš„å¹³å‡è–ªæ°´ï¼‰ã€‚</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>POST /player/_search?size=0
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggs&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;avg_age&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;avg&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;field&#34;: &#34;age&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>      }
</span></span></span><span style=display:flex><span><span style=color:#f85149>    },
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;avg_salary_188&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;avg&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;script&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;source&#34;: &#34;doc.salary.value + 188&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>        }
</span></span></span><span style=display:flex><span><span style=color:#f85149>      }
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span><span style=display:flex><span><span style=color:#f85149>// é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒ…å«èšåˆçš„æœç´¢ä¼šè¿”å›æœç´¢å‘½ä¸­å’Œèšåˆç»“æœ, size è¡¨ç¤ºè¿”å›å‘½ä¸­çš„æ–‡æ¡£æ•°é‡,è®¾ä¸º0è¡¨ç¤ºåªè¿”å›èšåˆç»“æœ
</span></span></span></code></pre></div><h3 id=331--metrics-aggregations>3.3.1 Metrics aggregations<a hidden class=anchor aria-hidden=true href=#331--metrics-aggregations>#</a></h3><p>æŒ‡æ ‡èšåˆï¼ˆåˆç§°åº¦é‡èšåˆï¼‰ä¸»è¦ä»ä¸åŒæ–‡æ¡£çš„åˆ†ç»„ä¸­æå–ç»Ÿè®¡æ•°æ®ï¼Œæˆ–è€…ï¼Œä»æ¥è‡ªå…¶ä»–èšåˆçš„æ–‡æ¡£æ¡¶æ¥æå–ç»Ÿè®¡æ•°æ®ã€‚</p><p>è¿™äº›ç»Ÿè®¡æ•°æ®é€šå¸¸æ¥è‡ªæ•°å€¼å‹å­—æ®µï¼Œå¦‚æœ€å°æˆ–è€…å¹³å‡ä»·æ ¼ã€‚ç”¨æˆ·å¯ä»¥å•ç‹¬è·å–æ¯é¡¹ç»Ÿè®¡æ•°æ®ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨ stats èšåˆæ¥åŒæ—¶è·å–å®ƒä»¬ã€‚æ›´é«˜çº§çš„ç»Ÿè®¡æ•°æ®ï¼Œå¦‚å¹³æ–¹å’Œæˆ–è€…æ˜¯æ ‡å‡†å·®ï¼Œå¯ä»¥é€šè¿‡ extended stats èšåˆæ¥è·å–ã€‚</p><h4 id=3311-min-aggregation>3.3.1.1 Min Aggregation<a hidden class=anchor aria-hidden=true href=#3311-min-aggregation>#</a></h4><p>Min Aggregation ç”¨äºæœ€å°å€¼ç»Ÿè®¡ã€‚ä¾‹å¦‚ï¼Œç»Ÿè®¡ sales ç´¢å¼•ä¸­ä»·æ ¼æœ€ä½çš„æ˜¯å“ªæœ¬ä¹¦ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>GET /sales/_search?size=0
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggs&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;min_price&#34; : { 
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;min&#34; : { 
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;field&#34; : &#34;price&#34; 
</span></span></span><span style=display:flex><span><span style=color:#f85149>      } 
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><p>èšåˆç»“æœå¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  ...
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggregations&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;min_price&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;value&#34;: 18.0
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><h4 id=3312-max-aggregation>3.3.1.2 Max Aggregation<a hidden class=anchor aria-hidden=true href=#3312-max-aggregation>#</a></h4><p>Max Aggregation ç”¨äºæœ€å¤§å€¼ç»Ÿè®¡ã€‚ä¾‹å¦‚ï¼Œç»Ÿè®¡ sales ç´¢å¼•ä¸­typeæ˜¯hatçš„ä¸”ä»·æ ¼æœ€é«˜çš„æ˜¯å“ªæœ¬ä¹¦ï¼Œå¹¶ä¸”è®¡ç®—å‡ºå¯¹åº”çš„ä»·æ ¼çš„ 2 å€å€¼ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>GET /sales/_search?size=0
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;query&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;constant_score&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;filter&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>            &#34;match&#34; : { &#34;type&#34; : &#34;hat&#34; }
</span></span></span><span style=display:flex><span><span style=color:#f85149>          }
</span></span></span><span style=display:flex><span><span style=color:#f85149>       }
</span></span></span><span style=display:flex><span><span style=color:#f85149>   },
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggs&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;max_price&#34; : { 
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;max&#34; : { 
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;field&#34; : &#34;price&#34; ,
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;missing&#34;: 60
</span></span></span><span style=display:flex><span><span style=color:#f85149>      } 
</span></span></span><span style=display:flex><span><span style=color:#f85149>    },
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;max_price_2&#34; : { 
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;max&#34; : { 
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;field&#34; : &#34;price&#34;,
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;script&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;source&#34;: &#34;_value * 2.0&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>        } 
</span></span></span><span style=display:flex><span><span style=color:#f85149>      } 
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><p><strong>æŒ‡å®šçš„ fieldï¼Œåœ¨è„šæœ¬ä¸­å¯ä»¥ç”¨ _value å–å­—æ®µçš„å€¼</strong>ã€‚</p><p><strong>å¦‚æœæŒ‡å®šå­—æ®µæ²¡æœ‰å€¼ï¼Œå¯ä»¥é€šè¿‡ missing æŒ‡å®šé»˜è®¤å€¼ï¼›è‹¥æœªæŒ‡å®šé»˜è®¤å€¼ï¼Œç¼ºå¤±è¯¥å­—æ®µå€¼çš„æ–‡æ¡£å°†è¢«å¿½ç•¥ï¼ˆè®¡ç®—ï¼‰</strong>ã€‚</p><p>èšåˆç»“æœå¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  ...
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggregations&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;max_price&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;value&#34;: 188.0
</span></span></span><span style=display:flex><span><span style=color:#f85149>    },
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;max_price_2&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;value&#34;: 376.0
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><h4 id=3313-avg-aggregation>3.3.1.3 Avg Aggregation<a hidden class=anchor aria-hidden=true href=#3313-avg-aggregation>#</a></h4><p>Avg Aggregation ç”¨äºè®¡ç®—å¹³å‡å€¼ã€‚ä¾‹å¦‚ï¼Œç»Ÿè®¡ exams ç´¢å¼•ä¸­è€ƒè¯•çš„å¹³å‡åˆ†æ•°ï¼Œ</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>GET /exams/_search?size=0
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggs&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;avg_grade&#34; : { 
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;avg&#34; : { 
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;field&#34; : &#34;grade&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>      } 
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  ...
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggregations&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;avg_grade&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;value&#34;: 78.0
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><p>é™¤äº†å¸¸è§„çš„å¹³å‡å€¼èšåˆè®¡ç®—å¤–ï¼Œelasticsearch è¿˜æä¾›äº†åŠ æƒå¹³å‡å€¼çš„èšåˆè®¡ç®—ï¼Œ è¯¦æƒ…å‚è§ <a href=https://blog.csdn.net/wjzt7322/article/details/103566139 target=_blank rel=noopener>Elasticsearch æŒ‡æ ‡èšåˆä¹‹ Weighted Avg Aggregation</a>
ã€‚</p><blockquote><p>ç”¨åŠ æƒå¹³å‡å€¼ä»£æ›¿åŸæœ¬å€¼</p></blockquote><h4 id=3314--sum-aggregation>3.3.1.4 Sum Aggregation<a hidden class=anchor aria-hidden=true href=#3314--sum-aggregation>#</a></h4><p>Sum Aggregation ç”¨äºè®¡ç®—æ€»å’Œã€‚</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>GET /exams/_search?size=0
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggs&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;hat_prices&#34; : { 
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;sum&#34; : { &#34;field&#34; : &#34;price&#34; } 
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  ...
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggregations&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;hat_prices&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;value&#34;: 567.0
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><h4 id=3315--count-aggregation>3.3.1.5 Count Aggregation<a hidden class=anchor aria-hidden=true href=#3315--count-aggregation>#</a></h4><p>Count Aggregation å¯æŒ‰å­—æ®µç»Ÿè®¡æ–‡æ¡£æ•°é‡ã€‚ä¾‹å¦‚ï¼Œç»Ÿè®¡ books ç´¢å¼•ä¸­åŒ…å« author å­—æ®µçš„æ–‡æ¡£æ•°é‡ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>GET /books/_search?size=0
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggs&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;doc_count&#34; : { 
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;value_count&#34; : { &#34;field&#34; : &#34;author&#34; } 
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  ...
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggregations&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;doc_count&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;value&#34;: 5
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><h4 id=3316-cardinality-aggregation>3.3.1.6 Cardinality Aggregation<a hidden class=anchor aria-hidden=true href=#3316-cardinality-aggregation>#</a></h4><p>Cardinality Aggregation ç”¨äºåŸºæ•°ç»Ÿè®¡ï¼Œå…¶ä½œç”¨æ˜¯å…ˆæ‰§è¡Œç±»ä¼¼ SQL ä¸­çš„ distinct æ“ä½œï¼Œå»æ‰é›†åˆä¸­çš„é‡å¤é¡¹ï¼Œç„¶åç»Ÿè®¡æ’é‡åçš„é›†åˆé•¿åº¦ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨ books ç´¢å¼•ä¸­å¯¹ language å­—æ®µè¿›è¡Œ cardinality æ“ä½œå¯ä»¥ç»Ÿè®¡å‡ºç¼–ç¨‹è¯­è¨€çš„ç§ç±»æ•°ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>GET /books/_search?size=0
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggs&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;all_lan&#34; : { 
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;cardinality&#34; : { &#34;field&#34; : &#34;language&#34; } 
</span></span></span><span style=display:flex><span><span style=color:#f85149>    },
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;title_cnt&#34; : { 
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;cardinality&#34; : { &#34;field&#34; : &#34;title.keyword&#34; } 
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><p><strong>å‡è®¾ title å­—æ®µä¸ºæ–‡æœ¬ç±»å‹ï¼ˆtextï¼‰ï¼Œå»é‡æ—¶éœ€è¦æŒ‡å®š keywordï¼Œè¡¨ç¤ºæŠŠ title ä½œä¸ºæ•´ä½“å»é‡ï¼Œå³ä¸åˆ†è¯ç»Ÿè®¡</strong>ã€‚</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  ...
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggregations&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;all_lan&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;value&#34;: 8
</span></span></span><span style=display:flex><span><span style=color:#f85149>    },
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;title_cnt&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;value&#34;: 18
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><h4 id=3317-stats-aggregation>3.3.1.7 Stats Aggregation<a hidden class=anchor aria-hidden=true href=#3317-stats-aggregation>#</a></h4><p>Stats Aggregation ç”¨äºåŸºæœ¬ç»Ÿè®¡ï¼Œä¼šä¸€æ¬¡è¿”å› countã€maxã€minã€avg å’Œ sum è¿™ 5 ä¸ªæŒ‡æ ‡ã€‚ä¾‹å¦‚ï¼Œåœ¨ exams ç´¢å¼•ä¸­å¯¹ grade å­—æ®µè¿›è¡Œåˆ†æ•°ç›¸å…³çš„åŸºæœ¬ç»Ÿè®¡ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>GET /exams/_search?size=0
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggs&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;grades_stats&#34; : { 
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;stats&#34; : { &#34;field&#34; : &#34;grade&#34; } 
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><h4 id=3318--extended-stats-aggregation>3.3.1.8 Extended Stats Aggregation<a hidden class=anchor aria-hidden=true href=#3318--extended-stats-aggregation>#</a></h4><p>Extended Stats Aggregation ç”¨äºé«˜çº§ç»Ÿè®¡ï¼Œå’ŒåŸºæœ¬ç»Ÿè®¡åŠŸèƒ½ç±»ä¼¼ï¼Œä½†æ˜¯ä¼šæ¯”åŸºæœ¬ç»Ÿè®¡å¤šå‡ºä»¥ä¸‹å‡ ä¸ªç»Ÿè®¡ç»“æœï¼Œsum_of_squaresï¼ˆå¹³æ–¹å’Œï¼‰ã€varianceï¼ˆæ–¹å·®ï¼‰ã€std_deviationï¼ˆæ ‡å‡†å·®ï¼‰ã€std_deviation_boundsï¼ˆå¹³å‡å€¼åŠ /å‡ä¸¤ä¸ªæ ‡å‡†å·®çš„åŒºé—´ï¼‰ã€‚åœ¨ exams ç´¢å¼•ä¸­å¯¹ grade å­—æ®µè¿›è¡Œåˆ†æ•°ç›¸å…³çš„é«˜çº§ç»Ÿè®¡ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>GET /exams/_search?size=0
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggs&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;grades_stats&#34; : { 
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;extended_stats&#34; : { &#34;field&#34; : &#34;grade&#34; } 
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><h4 id=3319-percentiles-aggregation>3.3.1.9 Percentiles Aggregation<a hidden class=anchor aria-hidden=true href=#3319-percentiles-aggregation>#</a></h4><p>Percentiles Aggregation ç”¨äºç™¾åˆ†ä½ç»Ÿè®¡ã€‚ç™¾åˆ†ä½æ•°æ˜¯ä¸€ä¸ªç»Ÿè®¡å­¦æœ¯è¯­ï¼Œå¦‚æœå°†ä¸€ç»„æ•°æ®ä»å¤§åˆ°å°æ’åºï¼Œå¹¶è®¡ç®—ç›¸åº”çš„ç´¯è®¡ç™¾åˆ†ä½ï¼ŒæŸä¸€ç™¾åˆ†ä½æ‰€å¯¹åº”æ•°æ®çš„å€¼å°±ç§°ä¸ºè¿™ä¸€ç™¾åˆ†ä½çš„ç™¾åˆ†ä½æ•°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç´¯è®¡ç™¾åˆ†ä½ä¸º [ 1, 5, 25, 50, 75, 95, 99 ],ä¹Ÿå¯ä»¥ç”¨<code>percents</code>æŒ‡å®šèŒƒå›´ã€‚ä»¥ä¸‹ä¾‹å­ç»™å‡ºäº†åœ¨ latency ç´¢å¼•ä¸­å¯¹ load_time å­—æ®µè¿›è¡ŒåŠ è½½æ—¶é—´çš„ç™¾åˆ†ä½ç»Ÿè®¡ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>GET latency/_search
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;size&#34;: 0,
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggs&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;load_time_outlier&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;percentiles&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;field&#34; : &#34;load_time&#34; ,
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;percents&#34;:[30,45] //æŸ¥è¯¢ç¬¬30%å’Œ45%çš„æ•°æ®
</span></span></span><span style=display:flex><span><span style=color:#f85149>      }
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚ä¸Šçš„ <code>load_time</code> å­—æ®µå¿…é¡»æ˜¯æ•°å­—ç±»å‹</strong>ã€‚</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  ...
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggregations&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;load_time_outlier&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;values&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;1.0&#34;: 5.0,
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;5.0&#34;: 25.0,
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;25.0&#34;: 165.0,
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;50.0&#34;: 445.0,
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;75.0&#34;: 725.0,
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;95.0&#34;: 945.0,
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;99.0&#34;: 985.0
</span></span></span><span style=display:flex><span><span style=color:#f85149>      }
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><blockquote><p>ç¬¬1%ä½çš„æ•°æ®æ˜¯5</p><p>ç¬¬5%ä½çš„æ•°æ®æ˜¯25</p><p>&mldr;&mldr;</p><p>ç¬¬99%ä½çš„æ•°æ®æ˜¯99</p></blockquote><h4 id=33110-percentiles-ranks-aggregation>3.3.1.10 Percentiles Ranks Aggregation<a hidden class=anchor aria-hidden=true href=#33110-percentiles-ranks-aggregation>#</a></h4><p>Percentiles Ranks Aggregation ä¸ Percentiles Aggregation ç»Ÿè®¡æ°æ°ç›¸åï¼Œå°±æ˜¯æƒ³çœ‹å½“å‰æ•°å€¼å¤„åœ¨ä»€ä¹ˆèŒƒå›´å†…ï¼ˆç™¾åˆ†ä½ï¼‰ï¼Œ å‡å¦‚ä½ æŸ¥ä¸€ä¸‹å½“å‰å€¼ 500 å’Œ 600 æ‰€å¤„çš„ç™¾åˆ†ä½ï¼Œå‘ç°æ˜¯ 90.01 å’Œ 100ï¼Œé‚£ä¹ˆè¯´æ˜æœ‰ 90.01 % çš„æ•°å€¼éƒ½åœ¨ 500 ä»¥å†…ï¼Œ100 % çš„æ•°å€¼åœ¨ 600 ä»¥å†…ã€‚</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>GET latency/_search
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;size&#34;: 0,
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;aggs&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;load_time_ranks&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;percentile_ranks&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;field&#34; : &#34;load_time&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;values&#34; : [500, 600]
</span></span></span><span style=display:flex><span><span style=color:#f85149>        }
</span></span></span><span style=display:flex><span><span style=color:#f85149>      }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><p><strong><code>åŒæ · load_time</code> å­—æ®µå¿…é¡»æ˜¯æ•°å­—ç±»å‹</strong>ã€‚</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  ...
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggregations&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;load_time_ranks&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;values&#34; : {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;500.0&#34;: 90.01,
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;600.0&#34;: 100.0
</span></span></span><span style=display:flex><span><span style=color:#f85149>      }
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><p>å¯ä»¥è®¾ç½® <code>keyed</code> å‚æ•°ä¸º <code>true</code>ï¼Œå°†å¯¹åº”çš„ values ä½œä¸ºæ¡¶ key ä¸€èµ·è¿”å›ï¼Œé»˜è®¤æ˜¯ <code>false</code>ã€‚</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>GET latency/_search
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;size&#34;: 0,
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggs&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;load_time_ranks&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;percentile_ranks&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;field&#34;: &#34;load_time&#34;,
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;values&#34;: [500, 600],
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;keyed&#34;: true
</span></span></span><span style=display:flex><span><span style=color:#f85149>      }
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  ...
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggregations&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;load_time_ranks&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;values&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#f85149>        {
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;key&#34;: 500.0,
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;value&#34;: 90.01
</span></span></span><span style=display:flex><span><span style=color:#f85149>        },
</span></span></span><span style=display:flex><span><span style=color:#f85149>        {
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;key&#34;: 600.0,
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;value&#34;: 100.0
</span></span></span><span style=display:flex><span><span style=color:#f85149>        }
</span></span></span><span style=display:flex><span><span style=color:#f85149>      ]
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><h3 id=332--bucket-aggregations>3.3.2 bucket aggregations<a hidden class=anchor aria-hidden=true href=#332--bucket-aggregations>#</a></h3><p>bucket å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ¡¶ï¼Œå®ƒä¼šéå†æ–‡æ¡£ä¸­çš„å†…å®¹ï¼Œå‡¡æ˜¯ç¬¦åˆæŸä¸€è¦æ±‚çš„å°±æ”¾å…¥ä¸€ä¸ªæ¡¶ä¸­ï¼Œåˆ†æ¡¶ç›¸å½“äº SQL ä¸­çš„ group byã€‚ä»å¦å¤–ä¸€ä¸ªè§’åº¦ï¼Œå¯ä»¥å°†æŒ‡æ ‡èšåˆçœ‹æˆå•æ¡¶èšåˆï¼Œå³æŠŠæ‰€æœ‰æ–‡æ¡£æ”¾åˆ°ä¸€ä¸ªæ¡¶ä¸­ï¼Œè€Œæ¡¶èšåˆæ˜¯å¤šæ¡¶å‹èšåˆï¼Œå®ƒæ ¹æ®ç›¸åº”çš„æ¡ä»¶è¿›è¡Œåˆ†ç»„ã€‚</p><blockquote><p>æ¡¶æ•°æœ€å¤š 65536 ä¸ª,å¯ä¿®æ”¹</p></blockquote><h4 id=3321-terms-aggregation>3.3.2.1 Terms Aggregation<a hidden class=anchor aria-hidden=true href=#3321-terms-aggregation>#</a></h4><p>Terms Aggregation ç”¨äºè¯é¡¹çš„åˆ†ç»„èšåˆã€‚æœ€ä¸ºç»å…¸çš„ç”¨ä¾‹æ˜¯è·å– X ä¸­æœ€é¢‘ç¹ï¼ˆtop frequentï¼‰çš„é¡¹ç›®ï¼Œå…¶ä¸­ X æ˜¯æ–‡æ¡£ä¸­çš„æŸä¸ªå­—æ®µï¼Œå¦‚ç”¨æˆ·çš„åç§°ã€æ ‡ç­¾æˆ–åˆ†ç±»ã€‚ç”±äº terms èšé›†ç»Ÿè®¡çš„æ˜¯æ¯ä¸ªè¯æ¡ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå­—æ®µå€¼ï¼Œå› æ­¤é€šå¸¸éœ€è¦åœ¨ä¸€ä¸ªéåˆ†æå‹çš„å­—æ®µä¸Šè¿è¡Œè¿™ç§èšé›†ã€‚åŸå› æ˜¯, ä½ æœŸæœ›â€œbig dataâ€ä½œä¸ºè¯ç»„ç»Ÿè®¡ï¼Œè€Œä¸æ˜¯â€œbigâ€å•ç‹¬ç»Ÿè®¡ä¸€æ¬¡ï¼Œâ€œdataâ€å†å•ç‹¬ç»Ÿè®¡ä¸€æ¬¡ã€‚</p><blockquote><p>æ”¯æŒå­—æ®µç±»å‹ Keyword, Numeric, ip, boolean, binary.</p></blockquote><p>ç”¨æˆ·å¯ä»¥ä½¿ç”¨ terms èšé›†ï¼Œä»åˆ†æå‹å­—æ®µï¼ˆå¦‚å†…å®¹ï¼‰ä¸­æŠ½å–æœ€ä¸ºé¢‘ç¹çš„è¯æ¡ã€‚è¿˜å¯ä»¥ä½¿ç”¨è¿™ç§ä¿¡æ¯æ¥ç”Ÿæˆä¸€ä¸ªå•è¯äº‘ã€‚</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggs&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;profit_terms&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;terms&#34;: { 
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;field&#34;: &#34;skuName&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>      }
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><p>ç»“æœ:</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  ...
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggregations&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;genres&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;doc_count_error_upper_bound&#34;: 0,   // é”™è¯¯æ–‡æ¡£çš„ä¸ªæ•°
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;sum_other_doc_count&#34;: 0,    // æœªç»Ÿè®¡çš„æ–‡æ¡£ä¸ªæ•°
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;buckets&#34;: [                        
</span></span></span><span style=display:flex><span><span style=color:#f85149>        {
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;key&#34;: &#34;electronic&#34;,
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;doc_count&#34;: 6
</span></span></span><span style=display:flex><span><span style=color:#f85149>        },
</span></span></span><span style=display:flex><span><span style=color:#f85149>        {
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;key&#34;: &#34;rock&#34;,
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;doc_count&#34;: 3
</span></span></span><span style=display:flex><span><span style=color:#f85149>        },
</span></span></span><span style=display:flex><span><span style=color:#f85149>        {
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;key&#34;: &#34;jazz&#34;,
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;doc_count&#34;: 2
</span></span></span><span style=display:flex><span><span style=color:#f85149>        }
</span></span></span><span style=display:flex><span><span style=color:#f85149>      ]
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><blockquote><p>è¿”å›å€¼ä¸­,é»˜è®¤æŒ‰doc_countæ•°é‡é™åºæ’åº, å¯ä»¥ç”¨orderå­—æ®µæŒ‡å®šæ’åºè§„åˆ™</p><p>å¯ä»¥ç”¨sizeå­—æ®µæ§åˆ¶è¿”å›çš„æ¡¶æ•°</p></blockquote><h4 id=3222--filter-aggregation>3.2.2.2 Filter Aggregation<a hidden class=anchor aria-hidden=true href=#3222--filter-aggregation>#</a></h4><p>Filter Aggregation æ˜¯è¿‡æ»¤å™¨èšåˆï¼Œå¯ä»¥æŠŠç¬¦åˆè¿‡æ»¤å™¨ä¸­çš„æ¡ä»¶çš„æ–‡æ¡£åˆ†åˆ°ä¸€ä¸ªæ¡¶ä¸­ï¼Œå³æ˜¯å•åˆ†ç»„èšåˆã€‚</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggs&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;age_terms&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;filter&#34;: {&#34;term&#34;:{&#34;gender&#34;:&#34;F&#34;}},
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;aggs&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;avg_age&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;avg&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>            &#34;field&#34;: &#34;age&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>          }
</span></span></span><span style=display:flex><span><span style=color:#f85149>        }
</span></span></span><span style=display:flex><span><span style=color:#f85149>      }
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><blockquote><p>åœ¨èšåˆæ“ä½œä¸­åŠ å…¥è¿‡æ»¤,æ¯” è¿‡æ»¤åå†èšåˆè¦å·®, ä¸Šé¢çš„æ•ˆç‡æ¯”ä¸‹é¢çš„æ•ˆç‡è¦å·®</p></blockquote><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>POST /sales/_search?size=0&amp;filter_path=aggregations
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;query&#34;: { &#34;term&#34;: { &#34;type&#34;: &#34;t-shirt&#34; } },
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggs&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;avg_price&#34;: { &#34;avg&#34;: { &#34;field&#34;: &#34;price&#34; } }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><h4 id=3223-filters-aggregation>3.2.2.3 Filters Aggregation<a hidden class=anchor aria-hidden=true href=#3223-filters-aggregation>#</a></h4><p>Filters Aggregation æ˜¯å¤šè¿‡æ»¤å™¨èšåˆï¼Œå¯ä»¥æŠŠç¬¦åˆå¤šä¸ªè¿‡æ»¤æ¡ä»¶çš„æ–‡æ¡£åˆ†åˆ°ä¸åŒçš„æ¡¶ä¸­ï¼Œå³æ¯ä¸ªåˆ†ç»„å…³è”ä¸€ä¸ªè¿‡æ»¤æ¡ä»¶ï¼Œå¹¶æ”¶é›†æ‰€æœ‰æ»¡è¶³è‡ªèº«è¿‡æ»¤æ¡ä»¶çš„æ–‡æ¡£ã€‚</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;size&#34;: 0,
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggs&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;messages&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;filters&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;filters&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;errors&#34;: { &#34;match&#34;: { &#34;body&#34;: &#34;error&#34; } },
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;warnings&#34;: { &#34;match&#34;: { &#34;body&#34;: &#34;warning&#34; } }
</span></span></span><span style=display:flex><span><span style=color:#f85149>        }
</span></span></span><span style=display:flex><span><span style=color:#f85149>      }
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬åˆ†ææ—¥å¿—ä¿¡æ¯ã€‚èšåˆä¼šåˆ›å»ºä¸¤ä¸ªå…³äºæ—¥å¿—æ•°æ®çš„åˆ†ç»„ï¼Œä¸€ä¸ªæ”¶é›†åŒ…å«é”™è¯¯ä¿¡æ¯çš„æ–‡æ¡£ï¼Œå¦ä¸€ä¸ªæ”¶é›†åŒ…å«å‘Šè­¦ä¿¡æ¯çš„æ–‡æ¡£ã€‚è€Œä¸”æ¯ä¸ªåˆ†ç»„ä¼šæŒ‰æœˆä»½åˆ’åˆ†ã€‚</p><blockquote><p>filters å†™å¤šä¸ªè¿‡æ»¤å™¨æ¯” å†™è¿‡filteræ•ˆç‡å¥½</p></blockquote><h4 id=3224-range-aggregation>3.2.2.4 Range Aggregation<a hidden class=anchor aria-hidden=true href=#3224-range-aggregation>#</a></h4><p>Range Aggregation èŒƒå›´èšåˆæ˜¯ä¸€ä¸ªåŸºäºå¤šç»„å€¼æ¥æºçš„èšåˆï¼Œå¯ä»¥è®©ç”¨æˆ·å®šä¹‰ä¸€ç³»åˆ—èŒƒå›´ï¼Œæ¯ä¸ªèŒƒå›´ä»£è¡¨ä¸€ä¸ªåˆ†ç»„ã€‚åœ¨èšåˆæ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä»æ¯ä¸ªæ–‡æ¡£æå–å‡ºæ¥çš„å€¼éƒ½ä¼šæ£€æŸ¥æ¯ä¸ªåˆ†ç»„çš„èŒƒå›´ï¼Œå¹¶ä¸”ä½¿ç›¸å…³çš„æ–‡æ¡£è½å…¥åˆ†ç»„ä¸­ã€‚æ³¨æ„ï¼ŒèŒƒå›´èšåˆçš„æ¯ä¸ªèŒƒå›´å†…åŒ…å« from å€¼ä½†æ˜¯æ’é™¤ to å€¼ã€‚</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggs&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;age_range&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;range&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;field&#34;: &#34;age&#34;,
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;ranges&#34;: [{
</span></span></span><span style=display:flex><span><span style=color:#f85149>            &#34;to&#34;: 25
</span></span></span><span style=display:flex><span><span style=color:#f85149>          },
</span></span></span><span style=display:flex><span><span style=color:#f85149>          {
</span></span></span><span style=display:flex><span><span style=color:#f85149>            &#34;from&#34;: 25,
</span></span></span><span style=display:flex><span><span style=color:#f85149>            &#34;to&#34;: 35
</span></span></span><span style=display:flex><span><span style=color:#f85149>          },
</span></span></span><span style=display:flex><span><span style=color:#f85149>          {
</span></span></span><span style=display:flex><span><span style=color:#f85149>            &#34;from&#34;: 35
</span></span></span><span style=display:flex><span><span style=color:#f85149>          }]
</span></span></span><span style=display:flex><span><span style=color:#f85149>        },
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;aggs&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;bmax&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>            &#34;max&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>              &#34;field&#34;: &#34;balance&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>            }
</span></span></span><span style=display:flex><span><span style=color:#f85149>          }
</span></span></span><span style=display:flex><span><span style=color:#f85149>        }
</span></span></span><span style=display:flex><span><span style=color:#f85149>      }
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><h4 id=3225-date-range-aggr>3.2.2.5 Date Range Aggr<a hidden class=anchor aria-hidden=true href=#3225-date-range-aggr>#</a></h4><p>æ—¥æœŸèŒƒå›´èšåˆæ˜¯ä¸“ç”¨äºæ—¥æœŸå€¼çš„èŒƒå›´èšåˆã€‚è¯¥èšåˆå’Œæ­£å¸¸çš„ èŒƒå›´ èšåˆçš„åŒºåˆ«ä¸»è¦åœ¨äºï¼šè¯¥èšåˆå¯ä»¥ç”¨ æ—¥æœŸæ•°å­¦ è¡¨è¾¾å¼è¡¨ç¤º from å€¼ å’Œ to å€¼ï¼Œè¿˜å¯ä»¥æŒ‡å®š è¿”å› from å’Œ to å“åº”å­—æ®µçš„æ—¥æœŸæ ¼å¼ã€‚æ³¨æ„ï¼Œè¯¥èšåˆåŒ…å« from å€¼ï¼Œä½†ä¸åŒ…å« to å€¼ã€‚(å·¦é—­å³å¼€çš„åŒºé—´)</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>POST /sales/_search?size=0
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggs&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;range&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;date_range&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;field&#34;: &#34;date&#34;,
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;format&#34;: &#34;MM-yyyy&#34;,
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;ranges&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#f85149>          { &#34;to&#34;: &#34;now-10M/M&#34; },  
</span></span></span><span style=display:flex><span><span style=color:#f85149>          { &#34;from&#34;: &#34;now-10M/M&#34; } 
</span></span></span><span style=display:flex><span><span style=color:#f85149>        ]
</span></span></span><span style=display:flex><span><span style=color:#f85149>      }
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><blockquote><p>to: &lt; ç°åœ¨å‡å» 10 ä¸ªæœˆï¼Œå‘ä¸‹èˆå…¥åˆ°æœˆåˆ</p><p>from: >= ç°åœ¨å‡å» 10 ä¸ªæœˆï¼Œå‘ä¸‹èˆå…¥åˆ°æœˆåˆ</p><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªèŒƒå›´æ¡¶ï¼Œç¬¬ä¸€ä¸ªæ¡¶ä¼šå°†æ—©äº 10 ä¸ªæœˆä¹‹å‰çš„æ‰€æœ‰æ–‡æ¡£å­˜å‚¨ï¼Œç¬¬äºŒä¸ªæ¡¶ä¼šå°†ä» 10 æœˆä¹‹å‰å¼€å§‹çš„æ–‡æ¡£å­˜å‚¨ã€‚</p></blockquote><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>    ...
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;aggregations&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;range&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>            &#34;buckets&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#f85149>                {
</span></span></span><span style=display:flex><span><span style=color:#f85149>                    &#34;to&#34;: 1.4436576E12,
</span></span></span><span style=display:flex><span><span style=color:#f85149>                    &#34;to_as_string&#34;: &#34;10-2015&#34;,
</span></span></span><span style=display:flex><span><span style=color:#f85149>                    &#34;doc_count&#34;: 7,
</span></span></span><span style=display:flex><span><span style=color:#f85149>                    &#34;key&#34;: &#34;*-10-2015&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>                },
</span></span></span><span style=display:flex><span><span style=color:#f85149>                {
</span></span></span><span style=display:flex><span><span style=color:#f85149>                    &#34;from&#34;: 1.4436576E12,
</span></span></span><span style=display:flex><span><span style=color:#f85149>                    &#34;from_as_string&#34;: &#34;10-2015&#34;,
</span></span></span><span style=display:flex><span><span style=color:#f85149>                    &#34;doc_count&#34;: 0,
</span></span></span><span style=display:flex><span><span style=color:#f85149>                    &#34;key&#34;: &#34;10-2015-*&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>                }
</span></span></span><span style=display:flex><span><span style=color:#f85149>            ]
</span></span></span><span style=display:flex><span><span style=color:#f85149>        }
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><blockquote><p>æ—¶é—´æ ¼å¼å’Œjavaçš„ä¸€æ ·</p><p><a href=https://learnku.com/docs/elasticsearch73/7.3/526-date-range-aggregation/7774 target=_blank rel=noopener>es-ä¸­æ–‡æ–‡æ¡£</a></p></blockquote><h4 id=3226-range-aggr>3.2.2.6 Range Aggr<a hidden class=anchor aria-hidden=true href=#3226-range-aggr>#</a></h4><p>åŸºäºå¤šæ¡¶å€¼æºçš„èšåˆï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿå®šä¹‰ä¸€ç»„èŒƒå›´ - æ¯ä¸ªèŒƒå›´ä»£è¡¨ä¸€ä¸ªæ¡¶ã€‚ åœ¨èšåˆè¿‡ç¨‹ä¸­ï¼Œå°†ä»æ¯ä¸ªæ–‡æ¡£ä¸­æå–çš„å€¼æ ¹æ®æ¯ä¸ªå­˜å‚¨åŒºèŒƒå›´è¿›è¡Œæ£€æŸ¥ï¼Œå¹¶å°†ç›¸å…³/åŒ¹é…æ–‡æ¡£â€œå­˜å‚¨â€åˆ°â€œå­˜å‚¨åŒºâ€ä¸­ã€‚ è¯·æ³¨æ„ï¼Œè¯¥èšåˆåŒ…å« from å€¼ï¼Œä½†ä¸åŒ…å« to å€¼</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>GET /_search
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggs&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;price_ranges&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;range&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;field&#34;: &#34;price&#34;,
</span></span></span><span style=display:flex><span><span style=color:#f85149>        &#34;ranges&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#f85149>          { &#34;to&#34;: 100.0 },
</span></span></span><span style=display:flex><span><span style=color:#f85149>          { &#34;from&#34;: 100.0, &#34;to&#34;: 200.0 },
</span></span></span><span style=display:flex><span><span style=color:#f85149>          { &#34;from&#34;: 200.0 }
</span></span></span><span style=display:flex><span><span style=color:#f85149>        ]
</span></span></span><span style=display:flex><span><span style=color:#f85149>      }
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><p>ç»“æœ:</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  ...
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;aggregations&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;price_ranges&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;buckets&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#f85149>        {
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;key&#34;: &#34;*-100.0&#34;,
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;to&#34;: 100.0,
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;doc_count&#34;: 2
</span></span></span><span style=display:flex><span><span style=color:#f85149>        },
</span></span></span><span style=display:flex><span><span style=color:#f85149>        {
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;key&#34;: &#34;100.0-200.0&#34;,
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;from&#34;: 100.0,
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;to&#34;: 200.0,
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;doc_count&#34;: 2
</span></span></span><span style=display:flex><span><span style=color:#f85149>        },
</span></span></span><span style=display:flex><span><span style=color:#f85149>        {
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;key&#34;: &#34;200.0-*&#34;,
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;from&#34;: 200.0,
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;doc_count&#34;: 3
</span></span></span><span style=display:flex><span><span style=color:#f85149>        }
</span></span></span><span style=display:flex><span><span style=color:#f85149>      ]
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><h2 id=34-å¤åˆæŸ¥è¯¢>3.4 å¤åˆæŸ¥è¯¢<a hidden class=anchor aria-hidden=true href=#34-å¤åˆæŸ¥è¯¢>#</a></h2><p>å¤åˆæŸ¥è¯¢åŒ…è£…å…¶ä»–å¤åˆæŸ¥è¯¢æˆ–å¶æŸ¥è¯¢ï¼Œä»¥ç»„åˆå®ƒä»¬çš„ç»“æœå’Œåˆ†æ•°ï¼Œæ”¹å˜å®ƒä»¬çš„è¡Œä¸ºï¼Œæˆ–è€…ä»æŸ¥è¯¢åˆ‡æ¢åˆ°è¿‡æ»¤ä¸Šä¸‹æ–‡ã€‚</p><blockquote><p>ç®€å•çš„è¯´æ˜¯ å°†å¤šç§æŸ¥è¯¢æ¡ä»¶ç»„åˆåˆ°ä¸€èµ·</p></blockquote><h3 id=341-bool-query>3.4.1 Bool query<a hidden class=anchor aria-hidden=true href=#341-bool-query>#</a></h3><ul><li><p>filter</p><p>å­å¥åœ¨è¿‡æ»¤å™¨ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œï¼Œè¿™æ„å‘³ç€è®¡åˆ†è¢«å¿½ç•¥ï¼Œå¹¶ä¸”å­å¥è¢«è§†ä¸ºç”¨äºç¼“å­˜ã€‚(<strong>è¿‡æ»¤æ‰ä¸è¦çš„æ•°æ®</strong>)</p></li><li><p>must</p><p>å­å¥ï¼ˆæŸ¥è¯¢ï¼‰å¿…é¡»å‡ºç°åœ¨åŒ¹é…çš„æ–‡æ¡£ä¸­ï¼Œå¹¶å°†æœ‰åŠ©äºå¾—åˆ†ã€‚(<strong>ç”¨æ¥åšåŒ¹é…çš„,è¡¨ç¤ºéœ€è¦å‡ºç°åœ¨æ–‡æ¡£é‡Œ</strong>)</p></li><li><p>must_not</p><p>å­å¥ï¼ˆæŸ¥è¯¢ï¼‰ä¸å¾—å‡ºç°åœ¨åŒ¹é…çš„æ–‡æ¡£ä¸­ã€‚å­å¥åœ¨è¿‡æ»¤å™¨ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œï¼Œè¿™æ„å‘³ç€è®¡åˆ†è¢«å¿½ç•¥ï¼Œå¹¶ä¸”å­å¥è¢«è§†ä¸ºç”¨äºç¼“å­˜ã€‚</p></li><li><p>should</p><p>å­å¥ï¼ˆæŸ¥è¯¢ï¼‰åº”å‡ºç°åœ¨åŒ¹é…çš„æ–‡æ¡£ä¸­ã€‚ã€æ³¨æ„shouldçš„æœ€å°åŒ¹é…æ•°ã€‘</p></li></ul><blockquote><p>å…³äºshouldå­å¥ï¼Œç‰¹åˆ«è¦æ³¨æ„ï¼š</p><p>å¦‚æœè¿™ä¸ªå¸ƒå°”æŸ¥è¯¢ä½äº<code>query context</code>ï¼Œå¹¶ä¸”æœ‰mustæˆ–è€…filterå­å¥ï¼Œé‚£ä¹ˆå³ä½¿shouldå­å¥æ²¡æœ‰åŒ¹é…ä»»ä½•æ–‡æ¡£ï¼Œä¹Ÿæ²¡å…³ç³»</p><p>å¦‚æœæ˜¯ä½äº<code>filter context</code>ï¼Œæˆ–è€…æ—¢æ²¡æœ‰mustä¹Ÿæ²¡æœ‰filterï¼Œé‚£ä¹ˆè‡³å°‘æœ‰"æŒ‡å®š"ä¸ªshouldæŸ¥è¯¢å¿…é¡»åŒ¹é…æ–‡æ¡£ã€‚è¿™ä¸ªè¡Œä¸ºå¯ä»¥é€šè¿‡è®¾ç½®<code>minimum_should_match</code>å‚æ•°æ¥æ˜¾å¼åœ°æ§åˆ¶ã€‚(è‡³å°‘æ»¡è¶³å‡ ä¸ªshouldå­å¥), å¯ä»¥æ˜¯æ­£è´Ÿæ•´æ•°/æ­£è´Ÿç™¾åˆ†æ¯”ç­‰å„ç§æ¯”ä¾‹ (<strong>é»˜è®¤å€¼æ˜¯0</strong>)</p><p><a href="https://mp.weixin.qq.com/s?__biz=MzIxMjE3NjYwOQ==&amp;mid=2247483976&amp;idx=1&amp;sn=f9fc58f7f38ef79d4a652a9578ce1181&amp;chksm=974b59c6a03cd0d036f9e1cc9d211b999c9d3acdd664f4a250a1573089fdfe747c7784191066&amp;cur_album_id=1337850434433744897&amp;scene=190#rd" target=_blank rel=noopener>å‚æ•°è¯¦æƒ…</a></p></blockquote><p><img loading=lazy src=https://img2018.cnblogs.com/blog/874963/201812/874963-20181201134433373-297882943.png alt=image></p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>GET product/_search
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;query&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;bool&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>     &#34;filter&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#f85149>       {
</span></span></span><span style=display:flex><span><span style=color:#f85149>         &#34;range&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>           &#34;sellPrice&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>             &#34;gte&#34;: 1
</span></span></span><span style=display:flex><span><span style=color:#f85149>           }
</span></span></span><span style=display:flex><span><span style=color:#f85149>         }
</span></span></span><span style=display:flex><span><span style=color:#f85149>       }
</span></span></span><span style=display:flex><span><span style=color:#f85149>     ],
</span></span></span><span style=display:flex><span><span style=color:#f85149>     &#34;must&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#f85149>       {
</span></span></span><span style=display:flex><span><span style=color:#f85149>         &#34;match&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>           &#34;skuName&#34;: &#34;ç©ºè°ƒ&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>         }
</span></span></span><span style=display:flex><span><span style=color:#f85149>       }
</span></span></span><span style=display:flex><span><span style=color:#f85149>     ]
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149> , &#34;_source&#34;: &#34;skuName&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span><span style=display:flex><span><span style=color:#f85149>// æŸ¥è¯¢skuNameä¸­&#34;ç©ºè°ƒ&#34;çš„æ–‡æ¡£,å¹¶ä¸”è¿‡æ»¤å‡ºsellPriceå¤§äºç­‰äº1çš„æ–‡æ¡£
</span></span></span></code></pre></div><blockquote><p>filter å­å¥ç±»å¯åŒ…å« bool queryï¼Œå®ç°æ›´å¤æ‚çš„é€»è¾‘, (ä¿„ç½—æ–¯å¥—å¨ƒä¹‹æ·±åœ³åˆ†å¥—)</p></blockquote><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f85149>// å¤šä¸ªæ¡ä»¶
</span></span></span><span style=display:flex><span><span style=color:#f85149>GET service-java-logs-2021.07.16/_search
</span></span></span><span style=display:flex><span><span style=color:#f85149>{
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;_source&#34;: &#34;message&#34;, 
</span></span></span><span style=display:flex><span><span style=color:#f85149>  &#34;query&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>    &#34;bool&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;must&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#f85149>        {
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;match_phrase&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>            &#34;message&#34;: &#34;ERROR&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>          }
</span></span></span><span style=display:flex><span><span style=color:#f85149>        }
</span></span></span><span style=display:flex><span><span style=color:#f85149>      ],
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;must_not&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#f85149>        {
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;wildcard&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>            &#34;message&#34;: &#34;*navigation*&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>          }
</span></span></span><span style=display:flex><span><span style=color:#f85149>        },
</span></span></span><span style=display:flex><span><span style=color:#f85149>        {
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;match&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>            &#34;message&#34;: &#34;defaultParameterMap&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>          }
</span></span></span><span style=display:flex><span><span style=color:#f85149>        },
</span></span></span><span style=display:flex><span><span style=color:#f85149>        {
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;match&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>            &#34;message&#34;: &#34;parameters&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>          }
</span></span></span><span style=display:flex><span><span style=color:#f85149>        }
</span></span></span><span style=display:flex><span><span style=color:#f85149>      ], 
</span></span></span><span style=display:flex><span><span style=color:#f85149>      &#34;filter&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#f85149>        {
</span></span></span><span style=display:flex><span><span style=color:#f85149>          &#34;term&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f85149>            &#34;log.file.path.keyword&#34;: &#34;/opt/online-shop-manage/logs/online-shop-manage-provider.log&#34;
</span></span></span><span style=display:flex><span><span style=color:#f85149>          }
</span></span></span><span style=display:flex><span><span style=color:#f85149>        }
</span></span></span><span style=display:flex><span><span style=color:#f85149>      ]
</span></span></span><span style=display:flex><span><span style=color:#f85149>    }
</span></span></span><span style=display:flex><span><span style=color:#f85149>  }
</span></span></span><span style=display:flex><span><span style=color:#f85149>}
</span></span></span></code></pre></div><h3 id=342--boosting-query>3.4.2 boosting query<a hidden class=anchor aria-hidden=true href=#342--boosting-query>#</a></h3><blockquote><p>æ¥æº:</p><p><a href=https://www.cnblogs.com/hong-fithing/p/11221020.html target=_blank rel=noopener>https://www.cnblogs.com/hong-fithing/p/11221020.html</a></p><p><a href=http://www.ruanyifeng.com/blog/2017/08/elasticsearch.html target=_blank rel=noopener>http://www.ruanyifeng.com/blog/2017/08/elasticsearch.html</a></p><p><a href=https://www.cnblogs.com/hirampeng/p/10035858.html target=_blank rel=noopener>https://www.cnblogs.com/hirampeng/p/10035858.html</a></p><p><a href=https://www.cnblogs.com/cjsblog/p/9910788.html target=_blank rel=noopener>https://www.cnblogs.com/cjsblog/p/9910788.html</a></p><p><a href="https://mp.weixin.qq.com/s?__biz=MzIxMjE3NjYwOQ==&amp;mid=2247483976&amp;idx=1&amp;sn=f9fc58f7f38ef79d4a652a9578ce1181&amp;chksm=974b59c6a03cd0d036f9e1cc9d211b999c9d3acdd664f4a250a1573089fdfe747c7784191066&amp;cur_album_id=1337850434433744897&amp;scene=190#rd" target=_blank rel=noopener>å¾®ä¿¡esç³»åˆ—</a></p><p><a href=https://www.knowledgedict.com/tutorial/elasticsearch-sort.html target=_blank rel=noopener>https://www.knowledgedict.com/tutorial/elasticsearch-sort.html</a></p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://xiaokunji.com/zh/tags/ElasticSearch.html>ElasticSearch</a></li><li><a href=https://xiaokunji.com/zh/tags/%E7%BB%BC%E5%90%88.html>ç»¼åˆ</a></li></ul><nav class=paginav><a class=prev href=https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/Docker/%E5%91%BD%E4%BB%A4.html><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>å‘½ä»¤</span></a>
<a class=next href=https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/Kubernetes/%E5%91%BD%E4%BB%A4.html><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>å‘½ä»¤</span></a></nav></footer></article></main><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><footer class=footer><span>Copyright
&copy;
-2023
<a href=https://xiaokunji.com/zh/ style=color:#939393>ç±³äºŒ</a>
All Rights Reserved</span>
<span id=busuanzi_container><span class="fa fa-user">ç”¨æˆ·æ•°:</span><span id=busuanzi_value_site_uv></span>
<span class="fa fa-eye">è®¿é—®æ•°:</span><span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="å¤åˆ¶";function s(){t.innerHTML="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerHTML="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>