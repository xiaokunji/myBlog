<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Logstash | ç±³äºŒ</title><meta name=keywords content=" 1.input, 1.1 fileæ’ä»¶, 1.2 TCP/UDPæ’ä»¶, 2.filter, 2.1 dateæ’ä»¶, 2.2 grokæ’ä»¶, 2.3 dissectæ’ä»¶,dissectå¯ä»¥è‡ªåŠ¨å¤„ç†ç©ºçš„åŒ¹é…å€¼,dissectåˆ†å‰²åçš„å­—æ®µå€¼éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨convert_datatypeå±æ€§è¿›è¡Œç±»å‹è½¬æ¢, 2.4 mutateæ’ä»¶, 2.5 jsonæ’ä»¶, 2.6 geoipæ’ä»¶, 2.7 rubyæ’ä»¶, 3.output, 3.1 elasticsearchæ’ä»¶"><meta name=description content="     "><meta name=author content="xkj"><link rel=canonical href=https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/ELK/Logstash.html><link crossorigin=anonymous href=/assets/css/stylesheet.b3faf608c544858ba700943ffe182cb647f38432d29a07d73234965beacb26f6.css integrity="sha256-s/r2CMVEhYunAJQ//hgstkfzhDLSmgfXMjSWW+rLJvY=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://xiaokunji.com/img/Q.svg><link rel=icon type=image/png sizes=16x16 href=https://xiaokunji.com/img/Q.svg><link rel=icon type=image/png sizes=32x32 href=https://xiaokunji.com/img/Q.svg><link rel=apple-touch-icon href=https://xiaokunji.com/Q.svg><link rel=mask-icon href=https://xiaokunji.com/Q.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/ELK/Logstash.html><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Logstash"><meta property="og:description" content="     "><meta property="og:type" content="article"><meta property="og:url" content="https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/ELK/Logstash.html"><meta property="article:section" content="ç»¼åˆ"><meta property="article:published_time" content="2023-08-22T00:00:00+00:00"><meta property="article:modified_time" content="2023-09-08T04:01:12+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Logstash"><meta name=twitter:description content="     "><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":4,"name":"Logstash","item":"https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/ELK/Logstash.html"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Logstash","name":"Logstash","description":"     ","keywords":[" 1.input"," 1.1 fileæ’ä»¶"," 1.2 TCP/UDPæ’ä»¶"," 2.filter"," 2.1 dateæ’ä»¶"," 2.2 grokæ’ä»¶"," 2.3 dissectæ’ä»¶","dissectå¯ä»¥è‡ªåŠ¨å¤„ç†ç©ºçš„åŒ¹é…å€¼","dissectåˆ†å‰²åçš„å­—æ®µå€¼éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨convert_datatypeå±æ€§è¿›è¡Œç±»å‹è½¬æ¢"," 2.4 mutateæ’ä»¶"," 2.5 jsonæ’ä»¶"," 2.6 geoipæ’ä»¶"," 2.7 rubyæ’ä»¶"," 3.output"," 3.1 elasticsearchæ’ä»¶"],"articleBody":"[toc]\nlogstashå…¨æ˜¯æ’ä»¶,ä»inputåˆ°output,å¹¸è¿çš„æ˜¯å®˜æ–¹æ–‡æ¡£éƒ½æœ‰äº›,https://www.elastic.co/guide/en/logstash/6.5/index.html ,\næ€»æ„Ÿè§‰logstashå’Œflumeå¾ˆç›¸ä¼¼,ä»–ä»¬éƒ½æœ‰ä¸‰ä¸ªçº§åˆ«,å‰,ä¸­,å,ä½†æ˜¯ä»–ä»¬è¿˜æ˜¯åŒºåˆ«,logstashæ›´å€¾å‘äºæ—¥å¿—æ”¶é›†,æ¯”è¾ƒè½»é‡çº§,flumeæ›´å€¾å‘äºé“¾è·¯è·¯ç”±,æ¯”è¾ƒé‡é‡çº§,https://blog.csdn.net/jek123456/article/details/65658790\n1.input èƒ½ä»è®¸å¤šåœ°æ–¹è¯»å–ä¿¡æ¯,ä»beats(ä¸“é—¨è¯»æ–‡ä»¶(log)çš„)å·¥å…·,elasticsearch,shell,æ–‡ä»¶,jdbc,kafka,redis,rabbitmp,tcp/udpç­‰ç­‰\n1.1 fileæ’ä»¶ input{ file{ path =\u003e [\"/var/log/nginx/access.log\", \"/var/log/nginx/error.log\"] #å¤„ç†çš„æ–‡ä»¶çš„è·¯å¾„, å¯ä»¥å®šä¹‰å¤šä¸ªè·¯å¾„ exclude =\u003e \"*.zip\" #åŒ¹é…æ’é™¤ sincedb_path =\u003e \"/data/\" #sincedbæ•°æ®æ–‡ä»¶çš„è·¯å¾„, é»˜è®¤/plugins/inputs/file codec =\u003e \"plain\" #é»˜è®¤æ˜¯plain,å¯é€šè¿‡è¿™ä¸ªå‚æ•°è®¾ç½®ç¼–ç æ–¹å¼ # codec =\u003e multiline { # ç®¡ç†å¤šçº¿äº‹ä»¶,å°†javaçš„å¼‚å¸¸å½’çº³åˆ°ä¸€æ¡æ•°æ®ä¸­ # pattern =\u003eâ€œ^\\sâ€ # what =\u003eâ€œpreviousâ€ # } tags =\u003e [\"nginx\"] #æ·»åŠ æ ‡è®° type =\u003e \"nginx\" #æ·»åŠ ç±»å‹ discover_interval =\u003e 2 #æ¯éš”å¤šä¹…å»æŸ¥ä¸€æ¬¡æ–‡ä»¶, é»˜è®¤15s stat_interval =\u003e 1 #æ¯éš”å¤šä¹…å»æŸ¥ä¸€æ¬¡æ–‡ä»¶æ˜¯å¦è¢«ä¿®æ”¹è¿‡, é»˜è®¤1s start_position =\u003e \"beginning\" #ä»ä»€ä¹ˆä½ç½®å¼€å§‹è¯»å–æ–‡ä»¶æ•°æ®, beginningå’Œend, é»˜è®¤æ˜¯ç»“æŸä½ç½®end } } åŸæ–‡ï¼šhttps://blog.csdn.net/gekkoou/article/details/809 1.2 TCP/UDPæ’ä»¶ input{ tcp{ port =\u003e 8888 #ç«¯å£ mode =\u003e \"server\" #æ“ä½œæ¨¡å¼, server:ç›‘å¬å®¢æˆ·ç«¯è¿æ¥, client:è¿æ¥åˆ°æœåŠ¡å™¨ host =\u003e \"0.0.0.0\" #å½“modeä¸ºserver, æŒ‡å®šç›‘å¬åœ°å€, å½“modeä¸ºclient, æŒ‡å®šè¿æ¥åœ°å€, é»˜è®¤0.0.0.0 ssl_enable =\u003e false #æ˜¯å¦å¯ç”¨SSL, é»˜è®¤false ssl_cert =\u003e \"\" #SSLè¯ä¹¦è·¯å¾„ ssl_extra_chain_certs =\u003e [] #å°†é¢å¤–çš„X509è¯ä¹¦æ·»åŠ åˆ°è¯ä¹¦é“¾ä¸­ ssl_key =\u003e \"\" #SSLå¯†é’¥è·¯å¾„ ssl_key_passphrase =\u003e \"nil\" #SSLå¯†é’¥å¯†ç , é»˜è®¤nil ssl_verify =\u003e true #æ ¸å®ä¸CAçš„SSLè¿æ¥çš„å¦ä¸€ç«¯çš„èº«ä»½ tcp_keep_alive =\u003e false #TCPæ˜¯å¦ä¿æŒalives } } input{ udp{ buffer_size =\u003e 65536 #ä»ç½‘ç»œè¯»å–çš„æœ€å¤§æ•°æ®åŒ…å¤§å°, é»˜è®¤65536 host =\u003e 0.0.0.0 #ç›‘å¬åœ°å€ port =\u003e 8888 #ç«¯å£ queue_size =\u003e 2000 #åœ¨å†…å­˜ä¸­ä¿å­˜æœªå¤„ç†çš„UDPæ•°æ®åŒ…çš„æ•°é‡, é»˜è®¤2000 workers =\u003e 2 #å¤„ç†ä¿¡æ¯åŒ…çš„æ•°é‡, é»˜è®¤2 } } åŸæ–‡ï¼šhttps://blog.csdn.net/gekkoou/article/details/809 2.filter Filteræ˜¯LogstashåŠŸèƒ½å¼ºå¤§çš„ä¸»è¦åŸå› ï¼Œå®ƒå¯ä»¥å¯¹Logstash Eventè¿›è¡Œä¸°å¯Œçš„å¤„ç†ï¼Œæ¯”å¦‚è¯´è§£ææ•°æ®ã€åˆ é™¤å­—æ®µã€ç±»å‹è½¬æ¢ç­‰ç­‰ï¼Œå¸¸è§çš„æœ‰å¦‚ä¸‹å‡ ä¸ªï¼š\ndate: æ—¥å¿—è§£æ grokï¼šæ­£åˆ™åŒ¹é…è§£æ dissectï¼šåˆ†å‰²ç¬¦è§£æ mutateï¼šå¯¹å­—æ®µåšå¤„ç†ï¼Œæ¯”å¦‚é‡å‘½åã€åˆ é™¤ã€æ›¿æ¢ç­‰ jsonï¼šæŒ‰ç…§jsonè§£æå­—æ®µå†…å®¹åˆ°æŒ‡å®šå­—æ®µä¸­ geoipï¼šå¢åŠ åœ°ç†ä½ç½®æ•°æ® rubyï¼š åˆ©ç”¨rubyä»£ç æ¥åŠ¨æ€ä¿®æ”¹Logstash Event 2.1 dateæ’ä»¶ ä»å­—æ®µè§£ææ—¥æœŸä»¥ç”¨ä½œäº‹ä»¶çš„Logstashæ—¶é—´æˆ³ï¼Œä»¥ä¸‹é…ç½®è§£æåä¸ºlogdateçš„å­—æ®µä»¥è®¾ç½®Logstashæ—¶é—´æˆ³ï¼š\nfilter { date { match =\u003e [ \"logdate\", \"MMM dd yyyy HH:mm:ss\" ] } } è¿”å›ç»“æœ:\n{\"logdate\":\"Jan 01 2018 12:02:03\"} { \"@version\" =\u003e \"1\", \"host\" =\u003e \"Node2\", \"@timestamp\" =\u003e 2018-01-01T04:02:03.000Z, \"logdate\" =\u003e \"Jan 01 2018 12:02:03\" } è¯´æ˜ï¼š\nmatchï¼šç±»å‹ä¸ºæ•°ç»„ï¼Œç”¨äºæŒ‡å®šæ—¥æœŸåŒ¹é…çš„æ ¼å¼ï¼Œå¯ä»¥ä¸€æ¬¡æŒ‡å®šå¤šç§æ—¥å¿—æ ¼å¼\nmatch =\u003e [ \"logdate\", \"MMM dd yyyy HH:mm:ss\" ,\"MMM d yyyy HH:mm:ss\",\"ISO8601\"] target:ç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œç”¨äºæŒ‡å®šèµ‹å€¼çš„å­—æ®µåï¼Œé»˜è®¤æ˜¯@timestamp timezoneï¼šç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œç”¨äºæŒ‡å®šæ—¶åŒº å…³äºlogstashæ—¶åŒºçš„é—®é¢˜å¯ä»¥å‚è€ƒï¼šlogstash æ—¶é—´æˆ³æ—¶åŒºé—®é¢˜ 2.2 grokæ’ä»¶ å°†éç»“æ„åŒ–äº‹ä»¶æ•°æ®åˆ†æåˆ°å­—æ®µä¸­ã€‚ è¿™ä¸ªå·¥å…·éå¸¸é€‚ç”¨äºç³»ç»Ÿæ—¥å¿—ï¼ŒApacheå’Œå…¶ä»–ç½‘ç»œæœåŠ¡å™¨æ—¥å¿—ï¼ŒMySQLæ—¥å¿—ï¼Œä»¥åŠé€šå¸¸ä¸ºäººç±»è€Œä¸æ˜¯è®¡ç®—æœºæ¶ˆè€—çš„ä»»ä½•æ—¥å¿—æ ¼å¼ã€‚ä½†æ˜¯æ¶ˆè€—çš„èµ„æºä¹Ÿååˆ†å·¨å¤§\nfilter { grok { match =\u003e { \"message\" =\u003e \"%{IP:client} %{WORD:method} %{URIPATHPARAM:request} %{NUMBER:bytes} %{NUMBER:duration}\" } } } æµ‹è¯•:\n55.3.244.1 GET /index.html 15824 0.043 ä»¥ä¸‹é…ç½®å°†æ¶ˆæ¯è§£æä¸ºå­—æ®µï¼š\nclient: 55.3.244.1 method: GET request: /index.html bytes: 15824 duration: 0.043 Grokè¯­æ³•ï¼š\n%{SYNTAX:SEMANTIC} # SYNTAXä¸ºgrok patternçš„åç§°ï¼ŒSEMANTICä¸ºèµ‹å€¼å­—æ®µåç§° %{NUMBER:duration}å¯ä»¥åŒ¹é…æ•°å€¼ç±»å‹ï¼Œä½†æ˜¯grokåŒ¹é…å‡ºçš„å†…å®¹éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œå¯ä»¥é€šè¿‡åœ¨æœ€åæŒ‡å®šä¸ºintæˆ–è€…floatæ¥å¼ºåˆ¶è½¬æ¢ç±»å‹ã€‚ %{NUMBER:duration:float} å¸¸è§patternå¯ä»¥æŸ¥çœ‹ï¼šGitHub æˆ–è€…logstashå®¶ç›®å½•ä¸‹çš„ï¼š\nvendor/bundle/jruby/2.3.0/gems/logstash-patterns-core-4.1.2/patterns è‡ªå®šä¹‰åŒ¹é…è§„åˆ™ï¼š\næ ¼å¼ï¼š(?the pattern here)\npattern_definitionså‚æ•°ï¼Œä»¥é”®å€¼å¯¹çš„æ–¹å¼å®šä¹‰patternåç§°å’Œå†…å®¹ pattern_dirå‚æ•°ï¼Œä»¥æ–‡ä»¶çš„å½¢å¼è¢«è¯»å– filter{ grok { match =\u003e {\"message\"=\u003e\"%{SERVICE:service}\"} pattern_definitions =\u003e {\"SERVICE\" =\u003e \"[a-z0-9]{10,11}\"} #patterns_dir =\u003e [\"/opt/logstash/patterns\", \"/opt/logstash/extra_patterns\"] } } tag_on_failure: é»˜è®¤æ˜¯_grokparsefailure,å¯ä»¥åŸºäºæ­¤åšåˆ¤æ–­ è°ƒè¯•ï¼š æ­£åˆ™è¡¨è¾¾å¼ï¼š https://regexr.com/ grokï¼š http://grokdebug.herokuapp.com/ http://grok.elasticsearch.cn/ x-pack\n2.3 dissectæ’ä»¶ åŸºäºåˆ†éš”ç¬¦åŸç†è§£ææ•°æ®ï¼Œè§£å†³grokè§£ææ—¶æ¶ˆè€—è¿‡å¤šcpuèµ„æºçš„é—®é¢˜\nä½¿ç”¨åˆ†éš”ç¬¦å°†éç»“æ„åŒ–äº‹ä»¶æ•°æ®æå–åˆ°å­—æ®µä¸­ã€‚ è§£å‰–è¿‡æ»¤å™¨ä¸ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œé€Ÿåº¦éå¸¸å¿«ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ•°æ®çš„ç»“æ„å› è¡Œè€Œå¼‚ï¼Œgrokè¿‡æ»¤å™¨æ›´åˆé€‚ã€‚\ndissectçš„åº”ç”¨æœ‰ä¸€å®šçš„å±€é™æ€§ï¼šä¸»è¦é€‚ç”¨äºæ¯è¡Œæ ¼å¼ç›¸ä¼¼ä¸”åˆ†éš”ç¬¦æ˜ç¡®ç®€å•çš„åœºæ™¯ dissectè¯­æ³•æ¯”è¾ƒç®€å•ï¼Œæœ‰ä¸€ç³»åˆ—å­—æ®µ(field)å’Œåˆ†éš”ç¬¦(delimiter)ç»„æˆ\n%{}å­—æ®µ %{}ä¹‹é—´æ˜¯åˆ†éš”ç¬¦ ä¾‹å¦‚ï¼Œå‡è®¾æ—¥å¿—ä¸­åŒ…å«ä»¥ä¸‹æ¶ˆæ¯ï¼š\nApr 26 12:20:02 localhost systemd[1]: Starting system activity accounting tool... ä»¥ä¸‹é…ç½®è§£ææ¶ˆæ¯ï¼š\nfilter { dissect { mapping =\u003e { \"message\" =\u003e \"%{ts} %{+ts} %{+ts} %{src} %{prog}[%{pid}]: %{msg}\" } } } è§£å‰–è¿‡æ»¤å™¨åº”ç”¨åï¼Œäº‹ä»¶å°†è¢«è§£å‰–åˆ°ä»¥ä¸‹é¢†åŸŸï¼š\n{ \"msg\" =\u003e \"Starting system activity accounting tool...\", \"@timestamp\" =\u003e 2017-04-26T19:33:39.257Z, \"src\" =\u003e \"localhost\", \"@version\" =\u003e \"1\", \"host\" =\u003e \"localhost.localdomain\", \"pid\" =\u003e \"1\", \"message\" =\u003e \"Apr 26 12:20:02 localhost systemd[1]: Starting system activity accounting tool...\", \"type\" =\u003e \"stdin\", \"prog\" =\u003e \"systemd\", \"ts\" =\u003e \"Apr 26 12:20:02\" } è¯´æ˜\nApr 26 12:20:02 %{ts} %{+ts} %{+ts} #+ä»£è¡¨è¯¥åŒ¹é…å€¼è¿½åŠ åˆ°tså­—æ®µä¸‹ { \"ts\":\"Apr 26 12:20:02\" } two three one go %{+order/2} %{+order/3} %{+order/1} %{+order/4} #/åé¢çš„æ•°å­—ä»£è¡¨æ‹¼æ¥çš„æ¬¡åº { \"order\": \"one two three go\" } a=1\u0026b=2 %{?key1}=%{\u0026key1}\u0026%{?key2}=%{\u0026key2} #%{?}ä»£è¡¨å¿½ç•¥åŒ¹é…å€¼ï¼Œä½†æ˜¯å¯Œè£•å­—æ®µåï¼Œç”¨äºåç»­åŒ¹é…ç”¨ï¼›%{\u0026}ä»£è¡¨å°†åŒ¹é…å€¼èµ‹äºˆkey1çš„åŒ¹é…å€¼ { \"a\":\"1\", \"b\":\"2\" } #dissectå¯ä»¥è‡ªåŠ¨å¤„ç†ç©ºçš„åŒ¹é…å€¼ John Smith,Big Oaks,Wood Lane,Hambledown,Canterbury,CB34RY %{name},%{addr1},%{addr2},%{addr3},%{city},%{zip} Jane Doe,4321 Fifth Avenue,,,New York,87432 { \"name\":\"Jane Doe\", \"addr1\":\"4321 Fifth Avenue\", \"addr2\":\"\", \"addr3\":\"\", \"city\":\"New York\", \"zip\":\"87432\" } #dissectåˆ†å‰²åçš„å­—æ®µå€¼éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨convert_datatypeå±æ€§è¿›è¡Œç±»å‹è½¬æ¢ filter{ dissect{ convert_datatype =\u003e {age =\u003e \"int\"} } } 2.4 mutateæ’ä»¶ ä½¿ç”¨æœ€é¢‘ç¹çš„æ“ä½œï¼Œå¯ä»¥å¯¹å­—æ®µè¿›è¡Œå„ç§æ“ä½œï¼Œæ¯”å¦‚é‡å‘½åã€åˆ é™¤ã€æ›¿æ¢ã€æ›´æ–°ç­‰ï¼Œä¸»è¦æ“ä½œå¦‚ä¸‹ï¼š\nconvert #ç±»å‹è½¬æ¢ gsub #å­—ç¬¦ä¸²æ›¿æ¢ split/join/merge #å­—ç¬¦ä¸²åˆ‡å‰²ã€æ•°ç»„åˆå¹¶ä¸ºå­—ç¬¦ä¸²ã€æ•°ç»„åˆå¹¶ä¸ºæ•°ç»„ rename #å­—æ®µé‡å‘½å update/replace #å­—æ®µå†…å®¹æ›´æ–°æˆ–æ›¿æ¢ remove_field #åˆ é™¤å­—æ®µ convertï¼šå®ç°å­—æ®µç±»å‹çš„è½¬æ¢ï¼Œç±»å‹ä¸ºhash,ä»…æ”¯æŒè½¬æ¢ä¸ºintegerã€floatã€stringå’ŒBoolean filter{ mutate{ convert =\u003e {\"age\" =\u003e \"integer\"} } } gsubï¼šå¯¹å­—æ®µå†…å®¹è¿›è¡Œæ›¿æ¢ï¼Œç±»å‹ä¸ºæ•°ç»„ï¼Œæ¯3é¡¹ä¸ºä¸€ä¸ªæ›¿æ¢é…ç½® filter { mutate { gsub =\u003e [ # replace all forward slashes with underscore \"fieldname\", \"/\", \"_\", # replace backslashes, question marks, hashes, and minuses # with a dot \".\" \"fieldname2\", \"[\\?#-]\", \".\" ] } } split: å°†å­—ç¬¦ä¸²åˆ‡å‰²ä¸ºæ•°ç»„ filter { mutate { split =\u003e { \"fieldname\" =\u003e \",\" } } } joinï¼šå°†æ•°ç»„æ‹¼æ¥ä¸ºå­—ç¬¦ä¸² mergeï¼šå°†ä¸¤ä¸ªæ•°ç»„åˆå¹¶ä¸º1ä¸ªæ•°ç»„ï¼Œå­—ç¬¦ä¸²ä¼šè¢«è½¬ä¸º1ä¸ªå…ƒç´ çš„æ•°ç»„è¿›è¡Œæ“ä½œ renameï¼šå­—æ®µé‡å‘½å update/replaceï¼šæ›´æ–°å­—æ®µå†…å®¹ï¼ŒåŒºåˆ«åœ¨äºupdateåªåœ¨å­—æ®µå­˜åœ¨æ—¶ç”Ÿæ•ˆï¼Œè€Œreplaceåœ¨å­—æ®µä¸å­˜åœ¨æ—¶ä¼šæ‰§è¡Œæ–°å¢å­—æ®µçš„æ“ä½œ filter { mutate { update =\u003e { \"sample\" =\u003e \"My new message\" } update =\u003e { \"message\" =\u003e \"source from c:%{source_host}\" } #%{source_host}å¯ä»¥å¼•ç”¨logstash Eventä¸­çš„å­—æ®µå€¼ } } input { stdin{type=\u003estdin} } filter{ dissect{ mapping =\u003e {\"message\" =\u003e \"%{a}-%{b}-%{c}\"} } mutate{ replace =\u003e {\"d\" =\u003e\"source from c:%{c}\"} } } output{ stdout{codec=\u003erubydebug} } hi-hello-123 { \"a\" =\u003e \"hi\", \"b\" =\u003e \"hello\", \"@timestamp\" =\u003e 2018-06-29T02:01:24.473Z, \"c\" =\u003e \"123\", \"d\" =\u003e \"source from c:123\", \"@version\" =\u003e \"1\", \"host\" =\u003e \"Node2\", \"message\" =\u003e \"hi-hello-123\", \"type\" =\u003e \"stdin\" } 2.5 jsonæ’ä»¶ å°†å­—æ®µå†…å®¹ä¸ºjsonæ ¼å¼çš„æ•°æ®è¿›è¡Œè§£æ\nfilter { json { source =\u003e \"message\" #è¦è§£æçš„å­—æ®µå target =\u003e \"msg_json\" #è§£æåçš„å­˜å‚¨å­—æ®µï¼Œé»˜è®¤å’ŒmessageåŒçº§åˆ« } } 2.6 geoipæ’ä»¶ å¸¸ç”¨çš„æ’ä»¶ï¼Œæ ¹æ®ipåœ°å€æä¾›å¯¹åº”çš„åœ°åŸŸä¿¡æ¯ï¼Œæ¯”å¦‚ç»çº¬åº¦ã€åŸå¸‚åç­‰ï¼Œæ–¹ä¾¿è¿›è¡Œåœ°ç†æ•°æ®åˆ†æ\nfilter { geoip { source =\u003e \"clientip\" } } 2.7 rubyæ’ä»¶ æœ€çµæ´»çš„æ’ä»¶ï¼Œå¯ä»¥ ä»¥rubyè¯­è¨€æ¥éšå¿ƒæ‰€æ¬²çš„ä¿®æ”¹Logstash Eventå¯¹è±¡,rubyèƒ½å®ç°é€»è¾‘,ç†è®ºä¸Šæ¥è¯´å¯ä»¥å®Œæˆä½ æƒ³è¦çš„ä»»ä½•æ“ä½œ,åæ­£å¾ˆåŠå°±å¯¹äº†(å‰ææ˜¯ä½ å¾—ä¼šrubyè¯­è¨€)\nfilter{ ruby{ code =\u003e 'size = event.get(\"message\").size; event.set(\"message_size\",size)' } } ruby { code =\u003e \"event.set('@read_timestamp',event.get('@timestamp'))\" } åŸæ–‡ï¼šhttps://blog.csdn.net/wfs1994/article/details/80862952\n3.output èƒ½è¾“å‡ºåˆ°å¾ˆå¤šåœ°æ–¹,æ¯”å¦‚,csv,elasticsearch,shell,file,kafka,mongDB,rabbitMq,solr,æ›´å¤šçš„å‚è§å®˜ç½‘\n3.1 elasticsearchæ’ä»¶ elasticsearch{ hosts=\u003e[\"172.132.12.3:9200\"] action=\u003e\"index\" index=\u003e\"indextemplate-logstash\" #document_type=\u003e\"%{@type}\" document_id=\u003e\"ignore\" template=\u003e\"/opt/logstash-conf/es-template.json\" template_name=\u003e\"es-template.json\" template_overwrite=\u003etrue } æ¥è‡ª: https://yq.aliyun.com/articles/197785 ä¸‹è½½å·¥å…·:https://motrix.app/zh-CN/\n","wordCount":"3461","inLanguage":"zh","datePublished":"2023-08-22T00:00:00Z","dateModified":"2023-09-08T04:01:12.394867588Z","author":{"@type":"Person","name":"xkj"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/ELK/Logstash.html"},"publisher":{"@type":"Organization","name":"ç±³äºŒ","logo":{"@type":"ImageObject","url":"https://xiaokunji.com/img/Q.svg"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://xiaokunji.com/zh/ accesskey=h title="ç±³äºŒ (Alt + H)"><img src=https://xiaokunji.com/img/Q.svg alt aria-label=logo height=35>ç±³äºŒ</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://xiaokunji.com/en/ title=English aria-label=English>English</a></li></ul></div></div><ul id=menu><li><a href=https://xiaokunji.com/zh/ title=ğŸ ä¸»é¡µ><span>ğŸ ä¸»é¡µ</span></a></li><li><a href=https://xiaokunji.com/zh/search title="ğŸ”æœç´¢ (Alt + /)" accesskey=/><span>ğŸ”æœç´¢</span></a></li><li><a href=https://xiaokunji.com/zh/post.html title=ğŸ“šæ–‡ç« ><span>ğŸ“šæ–‡ç« </span></a></li><li><a href=https://xiaokunji.com/zh/archives.html title=â±æ—¶é—´è½´><span>â±æ—¶é—´è½´</span></a></li><li><a href=https://xiaokunji.com/zh/tags.html title=ğŸ”–æ ‡ç­¾><span>ğŸ”–æ ‡ç­¾</span></a></li><li><a href=https://xiaokunji.com/zh/categories.html title=ğŸ“–åˆ†ç±»><span>ğŸ“–åˆ†ç±»</span></a></li><li><a href=https://xiaokunji.com/zh/links.html title=ğŸ¤å‹é“¾><span>ğŸ¤å‹é“¾</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><nav aria-label=breadcrumb><ul><a href=https://xiaokunji.com/zh/>ğŸ </a> <span>></span>
<a href=https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88.html>ç»¼åˆ</a> <span>></span>
<a href=https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/ELK.html>ELK</a> <span>></span></ul></nav><h1 class=post-title>Logstash</h1><div class=post-description></div><div class=post-meta>åˆ›å»º:&nbsp;<span title='2023-08-22 00:00:00 +0000 UTC'>2023-08-22</span>&nbsp;Â·&nbsp;æ›´æ–°:&nbsp;2023-09-08&nbsp;Â·&nbsp;xkj
&nbsp;|&nbsp;åˆ†ç±»: &nbsp;<ul class=post-categories-meta><a href=https://xiaokunji.com/zh/categories/%E7%BB%BC%E5%90%88.html>ç»¼åˆ</a></ul><span id=busuanzi_container_page_pv>&nbsp;| è®¿é—®: <span id=busuanzi_value_page_pv>1</span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#1input aria-label=1.input>1.input</a><ul><li><a href=#11-file%e6%8f%92%e4%bb%b6 aria-label="1.1 fileæ’ä»¶">1.1 fileæ’ä»¶</a></li><li><a href=#12-tcpudp%e6%8f%92%e4%bb%b6 aria-label="1.2 TCP/UDPæ’ä»¶">1.2 TCP/UDPæ’ä»¶</a></li></ul></li><li><a href=#2filter aria-label=2.filter>2.filter</a><ul><li><a href=#21-date%e6%8f%92%e4%bb%b6 aria-label="2.1 dateæ’ä»¶">2.1 dateæ’ä»¶</a></li><li><a href=#22-grok%e6%8f%92%e4%bb%b6 aria-label="2.2 grokæ’ä»¶">2.2 grokæ’ä»¶</a></li><li><a href=#23-dissect%e6%8f%92%e4%bb%b6 aria-label="2.3 dissectæ’ä»¶">2.3 dissectæ’ä»¶</a></li><li><a href=#24-mutate%e6%8f%92%e4%bb%b6 aria-label="2.4 mutateæ’ä»¶">2.4 mutateæ’ä»¶</a></li><li><a href=#25-json%e6%8f%92%e4%bb%b6 aria-label="2.5 jsonæ’ä»¶">2.5 jsonæ’ä»¶</a></li><li><a href=#26-geoip%e6%8f%92%e4%bb%b6 aria-label="2.6 geoipæ’ä»¶">2.6 geoipæ’ä»¶</a></li><li><a href=#27-ruby%e6%8f%92%e4%bb%b6 aria-label="2.7 rubyæ’ä»¶">2.7 rubyæ’ä»¶</a></li></ul></li><li><a href=#3output aria-label=3.output>3.output</a><ul><li><a href=#31-elasticsearch%e6%8f%92%e4%bb%b6 aria-label="3.1 elasticsearchæ’ä»¶">3.1 elasticsearchæ’ä»¶</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>[toc]</p><p>logstashå…¨æ˜¯æ’ä»¶,ä»inputåˆ°output,å¹¸è¿çš„æ˜¯å®˜æ–¹æ–‡æ¡£éƒ½æœ‰äº›,https://www.elastic.co/guide/en/logstash/6.5/index.html ,</p><blockquote><p>æ€»æ„Ÿè§‰logstashå’Œflumeå¾ˆç›¸ä¼¼,ä»–ä»¬éƒ½æœ‰ä¸‰ä¸ªçº§åˆ«,å‰,ä¸­,å,ä½†æ˜¯ä»–ä»¬è¿˜æ˜¯åŒºåˆ«,logstashæ›´å€¾å‘äºæ—¥å¿—æ”¶é›†,æ¯”è¾ƒè½»é‡çº§,flumeæ›´å€¾å‘äºé“¾è·¯è·¯ç”±,æ¯”è¾ƒé‡é‡çº§,https://blog.csdn.net/jek123456/article/details/65658790</p></blockquote><h1 id=1input>1.input<a hidden class=anchor aria-hidden=true href=#1input>#</a></h1><p>èƒ½ä»è®¸å¤šåœ°æ–¹è¯»å–ä¿¡æ¯,ä»<code>beats</code>(ä¸“é—¨è¯»æ–‡ä»¶(log)çš„)å·¥å…·,<code>elasticsearch</code>,<code>shell</code>,<code>æ–‡ä»¶</code>,<code>jdbc</code>,<code>kafka</code>,<code>redis</code>,<code>rabbitmp</code>,<code>tcp/udp</code>ç­‰ç­‰</p><h2 id=11-fileæ’ä»¶>1.1 fileæ’ä»¶<a hidden class=anchor aria-hidden=true href=#11-fileæ’ä»¶>#</a></h2><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>input{
</span></span><span style=display:flex><span>    file{
</span></span><span style=display:flex><span>        path =&gt; [&#34;/var/log/nginx/access.log&#34;, &#34;/var/log/nginx/error.log&#34;] #å¤„ç†çš„æ–‡ä»¶çš„è·¯å¾„, å¯ä»¥å®šä¹‰å¤šä¸ªè·¯å¾„
</span></span><span style=display:flex><span>        exclude =&gt; &#34;*.zip&#34; #åŒ¹é…æ’é™¤
</span></span><span style=display:flex><span>        sincedb_path =&gt; &#34;/data/&#34; #sincedbæ•°æ®æ–‡ä»¶çš„è·¯å¾„, é»˜è®¤&lt;path.data&gt;/plugins/inputs/file
</span></span><span style=display:flex><span>        codec =&gt; &#34;plain&#34; #é»˜è®¤æ˜¯plain,å¯é€šè¿‡è¿™ä¸ªå‚æ•°è®¾ç½®ç¼–ç æ–¹å¼
</span></span><span style=display:flex><span>       # codec =&gt; multiline {  # ç®¡ç†å¤šçº¿äº‹ä»¶,å°†javaçš„å¼‚å¸¸å½’çº³åˆ°ä¸€æ¡æ•°æ®ä¸­
</span></span><span style=display:flex><span>       #   pattern =&gt;â€œ^\sâ€
</span></span><span style=display:flex><span>       #   what =&gt;â€œpreviousâ€
</span></span><span style=display:flex><span>       # }
</span></span><span style=display:flex><span>        tags =&gt; [&#34;nginx&#34;] #æ·»åŠ æ ‡è®°
</span></span><span style=display:flex><span>        type =&gt; &#34;nginx&#34; #æ·»åŠ ç±»å‹
</span></span><span style=display:flex><span>        discover_interval =&gt; 2 #æ¯éš”å¤šä¹…å»æŸ¥ä¸€æ¬¡æ–‡ä»¶, é»˜è®¤15s
</span></span><span style=display:flex><span>        stat_interval =&gt; 1 #æ¯éš”å¤šä¹…å»æŸ¥ä¸€æ¬¡æ–‡ä»¶æ˜¯å¦è¢«ä¿®æ”¹è¿‡, é»˜è®¤1s
</span></span><span style=display:flex><span>        start_position =&gt; &#34;beginning&#34; #ä»ä»€ä¹ˆä½ç½®å¼€å§‹è¯»å–æ–‡ä»¶æ•°æ®, beginningå’Œend, é»˜è®¤æ˜¯ç»“æŸä½ç½®end
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>åŸæ–‡ï¼šhttps://blog.csdn.net/gekkoou/article/details/809
</span></span></code></pre></div><h2 id=12-tcpudpæ’ä»¶>1.2 TCP/UDPæ’ä»¶<a hidden class=anchor aria-hidden=true href=#12-tcpudpæ’ä»¶>#</a></h2><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>input{
</span></span><span style=display:flex><span>    tcp{
</span></span><span style=display:flex><span>       port =&gt; 8888 #ç«¯å£
</span></span><span style=display:flex><span>       mode =&gt; &#34;server&#34; #æ“ä½œæ¨¡å¼, server:ç›‘å¬å®¢æˆ·ç«¯è¿æ¥, client:è¿æ¥åˆ°æœåŠ¡å™¨
</span></span><span style=display:flex><span>       host =&gt; &#34;0.0.0.0&#34; #å½“modeä¸ºserver, æŒ‡å®šç›‘å¬åœ°å€, å½“modeä¸ºclient, æŒ‡å®šè¿æ¥åœ°å€, é»˜è®¤0.0.0.0
</span></span><span style=display:flex><span>       ssl_enable =&gt; false #æ˜¯å¦å¯ç”¨SSL, é»˜è®¤false
</span></span><span style=display:flex><span>       ssl_cert =&gt; &#34;&#34; #SSLè¯ä¹¦è·¯å¾„
</span></span><span style=display:flex><span>       ssl_extra_chain_certs =&gt; [] #å°†é¢å¤–çš„X509è¯ä¹¦æ·»åŠ åˆ°è¯ä¹¦é“¾ä¸­
</span></span><span style=display:flex><span>       ssl_key =&gt; &#34;&#34; #SSLå¯†é’¥è·¯å¾„
</span></span><span style=display:flex><span>       ssl_key_passphrase =&gt; &#34;nil&#34; #SSLå¯†é’¥å¯†ç , é»˜è®¤nil
</span></span><span style=display:flex><span>       ssl_verify =&gt; true #æ ¸å®ä¸CAçš„SSLè¿æ¥çš„å¦ä¸€ç«¯çš„èº«ä»½
</span></span><span style=display:flex><span>       tcp_keep_alive =&gt; false #TCPæ˜¯å¦ä¿æŒalives
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>input{
</span></span><span style=display:flex><span>    udp{
</span></span><span style=display:flex><span>       buffer_size =&gt; 65536 #ä»ç½‘ç»œè¯»å–çš„æœ€å¤§æ•°æ®åŒ…å¤§å°, é»˜è®¤65536
</span></span><span style=display:flex><span>       host =&gt; 0.0.0.0 #ç›‘å¬åœ°å€
</span></span><span style=display:flex><span>       port =&gt; 8888 #ç«¯å£
</span></span><span style=display:flex><span>       queue_size =&gt; 2000 #åœ¨å†…å­˜ä¸­ä¿å­˜æœªå¤„ç†çš„UDPæ•°æ®åŒ…çš„æ•°é‡, é»˜è®¤2000
</span></span><span style=display:flex><span>       workers =&gt; 2 #å¤„ç†ä¿¡æ¯åŒ…çš„æ•°é‡, é»˜è®¤2
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>åŸæ–‡ï¼šhttps://blog.csdn.net/gekkoou/article/details/809
</span></span></code></pre></div><h1 id=2filter>2.filter<a hidden class=anchor aria-hidden=true href=#2filter>#</a></h1><p>Â Â Filteræ˜¯LogstashåŠŸèƒ½å¼ºå¤§çš„ä¸»è¦åŸå› ï¼Œå®ƒå¯ä»¥å¯¹Logstash Eventè¿›è¡Œä¸°å¯Œçš„å¤„ç†ï¼Œæ¯”å¦‚è¯´è§£ææ•°æ®ã€åˆ é™¤å­—æ®µã€ç±»å‹è½¬æ¢ç­‰ç­‰ï¼Œå¸¸è§çš„æœ‰å¦‚ä¸‹å‡ ä¸ªï¼š</p><ul><li>date: æ—¥å¿—è§£æ</li><li>grokï¼šæ­£åˆ™åŒ¹é…è§£æ</li><li>dissectï¼šåˆ†å‰²ç¬¦è§£æ</li><li>mutateï¼šå¯¹å­—æ®µåšå¤„ç†ï¼Œæ¯”å¦‚é‡å‘½åã€åˆ é™¤ã€æ›¿æ¢ç­‰</li><li>jsonï¼šæŒ‰ç…§jsonè§£æå­—æ®µå†…å®¹åˆ°æŒ‡å®šå­—æ®µä¸­</li><li>geoipï¼šå¢åŠ åœ°ç†ä½ç½®æ•°æ®</li><li>rubyï¼š åˆ©ç”¨rubyä»£ç æ¥åŠ¨æ€ä¿®æ”¹Logstash Event</li></ul><h2 id=21-dateæ’ä»¶>2.1 dateæ’ä»¶<a hidden class=anchor aria-hidden=true href=#21-dateæ’ä»¶>#</a></h2><p>ä»å­—æ®µè§£ææ—¥æœŸä»¥ç”¨ä½œäº‹ä»¶çš„Logstashæ—¶é—´æˆ³ï¼Œä»¥ä¸‹é…ç½®è§£æåä¸ºlogdateçš„å­—æ®µä»¥è®¾ç½®Logstashæ—¶é—´æˆ³ï¼š</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>filter {
</span></span><span style=display:flex><span>  date {
</span></span><span style=display:flex><span>    match =&gt; [ &#34;logdate&#34;, &#34;MMM dd yyyy HH:mm:ss&#34; ]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿”å›ç»“æœ:</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{&#34;logdate&#34;:&#34;Jan 01 2018 12:02:03&#34;} 
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>      &#34;@version&#34; =&gt; &#34;1&#34;,
</span></span><span style=display:flex><span>          &#34;host&#34; =&gt; &#34;Node2&#34;,
</span></span><span style=display:flex><span>    &#34;@timestamp&#34; =&gt; 2018-01-01T04:02:03.000Z,
</span></span><span style=display:flex><span>       &#34;logdate&#34; =&gt; &#34;Jan 01 2018 12:02:03&#34;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¯´æ˜ï¼š<br>matchï¼šç±»å‹ä¸ºæ•°ç»„ï¼Œç”¨äºæŒ‡å®šæ—¥æœŸåŒ¹é…çš„æ ¼å¼ï¼Œå¯ä»¥ä¸€æ¬¡æŒ‡å®šå¤šç§æ—¥å¿—æ ¼å¼</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>match =&gt; [ &#34;logdate&#34;, &#34;MMM dd yyyy HH:mm:ss&#34; ,&#34;MMM d yyyy HH:mm:ss&#34;,&#34;ISO8601&#34;]
</span></span></code></pre></div><ul><li>target:ç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œç”¨äºæŒ‡å®šèµ‹å€¼çš„å­—æ®µåï¼Œé»˜è®¤æ˜¯@timestamp</li><li>timezoneï¼šç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œç”¨äºæŒ‡å®šæ—¶åŒº</li></ul><p>å…³äºlogstashæ—¶åŒºçš„é—®é¢˜å¯ä»¥å‚è€ƒï¼š<a href=https://www.zybuluo.com/StrGlee/note/1179723 target=_blank rel=noopener>logstash æ—¶é—´æˆ³æ—¶åŒºé—®é¢˜</a></p><h2 id=22-grokæ’ä»¶>2.2 grokæ’ä»¶<a hidden class=anchor aria-hidden=true href=#22-grokæ’ä»¶>#</a></h2><p>å°†éç»“æ„åŒ–äº‹ä»¶æ•°æ®åˆ†æåˆ°å­—æ®µä¸­ã€‚ è¿™ä¸ªå·¥å…·éå¸¸é€‚ç”¨äºç³»ç»Ÿæ—¥å¿—ï¼ŒApacheå’Œå…¶ä»–ç½‘ç»œæœåŠ¡å™¨æ—¥å¿—ï¼ŒMySQLæ—¥å¿—ï¼Œä»¥åŠé€šå¸¸ä¸ºäººç±»è€Œä¸æ˜¯è®¡ç®—æœºæ¶ˆè€—çš„ä»»ä½•æ—¥å¿—æ ¼å¼ã€‚ä½†æ˜¯æ¶ˆè€—çš„èµ„æºä¹Ÿååˆ†å·¨å¤§</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>filter {
</span></span><span style=display:flex><span>  grok {
</span></span><span style=display:flex><span>    match =&gt; { &#34;message&#34; =&gt; &#34;%{IP:client} %{WORD:method} %{URIPATHPARAM:request} %{NUMBER:bytes} %{NUMBER:duration}&#34; }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æµ‹è¯•:</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>55.3.244.1 GET /index.html 15824 0.043
</span></span></code></pre></div><p>ä»¥ä¸‹é…ç½®å°†æ¶ˆæ¯è§£æä¸ºå­—æ®µï¼š</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>client: 55.3.244.1
</span></span><span style=display:flex><span>method: GET
</span></span><span style=display:flex><span>request: /index.html
</span></span><span style=display:flex><span>bytes: 15824
</span></span><span style=display:flex><span>duration: 0.043
</span></span></code></pre></div><p>Grokè¯­æ³•ï¼š</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>%{SYNTAX:SEMANTIC}   # SYNTAXä¸ºgrok patternçš„åç§°ï¼ŒSEMANTICä¸ºèµ‹å€¼å­—æ®µåç§°
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>%{NUMBER:duration}å¯ä»¥åŒ¹é…æ•°å€¼ç±»å‹ï¼Œä½†æ˜¯grokåŒ¹é…å‡ºçš„å†…å®¹éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œå¯ä»¥é€šè¿‡åœ¨æœ€åæŒ‡å®šä¸ºintæˆ–è€…floatæ¥å¼ºåˆ¶è½¬æ¢ç±»å‹ã€‚
</span></span><span style=display:flex><span>%{NUMBER:duration:float}
</span></span></code></pre></div><p>å¸¸è§patternå¯ä»¥æŸ¥çœ‹ï¼š<a href=https://github.com/logstash-plugins/logstash-patterns-core/tree/master/patterns target=_blank rel=noopener>GitHub</a>
æˆ–è€…logstashå®¶ç›®å½•ä¸‹çš„ï¼š</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>vendor/bundle/jruby/2.3.0/gems/logstash-patterns-core-4.1.2/patterns
</span></span></code></pre></div><p>è‡ªå®šä¹‰åŒ¹é…è§„åˆ™ï¼š<br>æ ¼å¼ï¼š<code>(?&lt;field_name>the pattern here)</code></p><ul><li>pattern_definitionså‚æ•°ï¼Œä»¥é”®å€¼å¯¹çš„æ–¹å¼å®šä¹‰patternåç§°å’Œå†…å®¹</li><li>pattern_dirå‚æ•°ï¼Œä»¥æ–‡ä»¶çš„å½¢å¼è¢«è¯»å–</li></ul><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>filter{
</span></span><span style=display:flex><span>    grok {
</span></span><span style=display:flex><span>        match =&gt; {&#34;message&#34;=&gt;&#34;%{SERVICE:service}&#34;}
</span></span><span style=display:flex><span>        pattern_definitions =&gt; {&#34;SERVICE&#34; =&gt; &#34;[a-z0-9]{10,11}&#34;}
</span></span><span style=display:flex><span>        #patterns_dir =&gt; [&#34;/opt/logstash/patterns&#34;, &#34;/opt/logstash/extra_patterns&#34;]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>tag_on_failure: é»˜è®¤æ˜¯_grokparsefailure,å¯ä»¥åŸºäºæ­¤åšåˆ¤æ–­</li></ul><p>è°ƒè¯•ï¼š
æ­£åˆ™è¡¨è¾¾å¼ï¼š
<a href=https://regexr.com/ target=_blank rel=noopener>https://regexr.com/</a></p><p>grokï¼š
<a href=http://grokdebug.herokuapp.com/ target=_blank rel=noopener>http://grokdebug.herokuapp.com/</a>
<a href=http://grok.elasticsearch.cn/ target=_blank rel=noopener>http://grok.elasticsearch.cn/</a><br>x-pack</p><h2 id=23-dissectæ’ä»¶>2.3 dissectæ’ä»¶<a hidden class=anchor aria-hidden=true href=#23-dissectæ’ä»¶>#</a></h2><p>åŸºäºåˆ†éš”ç¬¦åŸç†è§£ææ•°æ®ï¼Œè§£å†³grokè§£ææ—¶æ¶ˆè€—è¿‡å¤šcpuèµ„æºçš„é—®é¢˜</p><p>ä½¿ç”¨åˆ†éš”ç¬¦å°†éç»“æ„åŒ–äº‹ä»¶æ•°æ®æå–åˆ°å­—æ®µä¸­ã€‚ è§£å‰–è¿‡æ»¤å™¨ä¸ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œé€Ÿåº¦éå¸¸å¿«ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ•°æ®çš„ç»“æ„å› è¡Œè€Œå¼‚ï¼Œgrokè¿‡æ»¤å™¨æ›´åˆé€‚ã€‚</p><p>dissectçš„åº”ç”¨æœ‰ä¸€å®šçš„å±€é™æ€§ï¼šä¸»è¦é€‚ç”¨äºæ¯è¡Œæ ¼å¼ç›¸ä¼¼ä¸”åˆ†éš”ç¬¦æ˜ç¡®ç®€å•çš„åœºæ™¯
dissectè¯­æ³•æ¯”è¾ƒç®€å•ï¼Œæœ‰ä¸€ç³»åˆ—å­—æ®µ(field)å’Œåˆ†éš”ç¬¦(delimiter)ç»„æˆ</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>%{}å­—æ®µ
</span></span><span style=display:flex><span>%{}ä¹‹é—´æ˜¯åˆ†éš”ç¬¦
</span></span></code></pre></div><p>ä¾‹å¦‚ï¼Œå‡è®¾æ—¥å¿—ä¸­åŒ…å«ä»¥ä¸‹æ¶ˆæ¯ï¼š<br><code>Apr 26 12:20:02 localhost systemd[1]: Starting system activity accounting tool...</code>
ä»¥ä¸‹é…ç½®è§£ææ¶ˆæ¯ï¼š</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>filter {
</span></span><span style=display:flex><span>  dissect {
</span></span><span style=display:flex><span>    mapping =&gt; { &#34;message&#34; =&gt; &#34;%{ts} %{+ts} %{+ts} %{src} %{prog}[%{pid}]: %{msg}&#34; }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è§£å‰–è¿‡æ»¤å™¨åº”ç”¨åï¼Œäº‹ä»¶å°†è¢«è§£å‰–åˆ°ä»¥ä¸‹é¢†åŸŸï¼š</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>{
</span></span><span style=display:flex><span>  &#34;msg&#34;        =&gt; &#34;Starting system activity accounting tool...&#34;,
</span></span><span style=display:flex><span>  &#34;@timestamp&#34; =&gt; 2017-04-26T19:33:39.257Z,
</span></span><span style=display:flex><span>  &#34;src&#34;        =&gt; &#34;localhost&#34;,
</span></span><span style=display:flex><span>  &#34;@version&#34;   =&gt; &#34;1&#34;,
</span></span><span style=display:flex><span>  &#34;host&#34;       =&gt; &#34;localhost.localdomain&#34;,
</span></span><span style=display:flex><span>  &#34;pid&#34;        =&gt; &#34;1&#34;,
</span></span><span style=display:flex><span>  &#34;message&#34;    =&gt; &#34;Apr 26 12:20:02 localhost systemd[1]: Starting system activity accounting tool...&#34;,
</span></span><span style=display:flex><span>  &#34;type&#34;       =&gt; &#34;stdin&#34;,
</span></span><span style=display:flex><span>  &#34;prog&#34;       =&gt; &#34;systemd&#34;,
</span></span><span style=display:flex><span>  &#34;ts&#34;         =&gt; &#34;Apr 26 12:20:02&#34;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¯´æ˜</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>Apr 26 12:20:02
</span></span><span style=display:flex><span>%{ts} %{+ts} %{+ts}     #+ä»£è¡¨è¯¥åŒ¹é…å€¼è¿½åŠ åˆ°tså­—æ®µä¸‹
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    &#34;ts&#34;:&#34;Apr 26 12:20:02&#34;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>two three one go
</span></span><span style=display:flex><span>%{+order/2} %{+order/3} %{+order/1} %{+order/4}     #/åé¢çš„æ•°å­—ä»£è¡¨æ‹¼æ¥çš„æ¬¡åº
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    &#34;order&#34;: &#34;one two three go&#34;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>a=1&amp;b=2
</span></span><span style=display:flex><span>%{?key1}=%{&amp;key1}&amp;%{?key2}=%{&amp;key2}  #%{?}ä»£è¡¨å¿½ç•¥åŒ¹é…å€¼ï¼Œä½†æ˜¯å¯Œè£•å­—æ®µåï¼Œç”¨äºåç»­åŒ¹é…ç”¨ï¼›%{&amp;}ä»£è¡¨å°†åŒ¹é…å€¼èµ‹äºˆkey1çš„åŒ¹é…å€¼
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    &#34;a&#34;:&#34;1&#34;,
</span></span><span style=display:flex><span>    &#34;b&#34;:&#34;2&#34;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#dissectå¯ä»¥è‡ªåŠ¨å¤„ç†ç©ºçš„åŒ¹é…å€¼
</span></span><span style=display:flex><span>John Smith,Big Oaks,Wood Lane,Hambledown,Canterbury,CB34RY
</span></span><span style=display:flex><span>%{name},%{addr1},%{addr2},%{addr3},%{city},%{zip}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Jane Doe,4321 Fifth Avenue,,,New York,87432
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    &#34;name&#34;:&#34;Jane Doe&#34;,
</span></span><span style=display:flex><span>    &#34;addr1&#34;:&#34;4321 Fifth Avenue&#34;,
</span></span><span style=display:flex><span>    &#34;addr2&#34;:&#34;&#34;,
</span></span><span style=display:flex><span>    &#34;addr3&#34;:&#34;&#34;,
</span></span><span style=display:flex><span>    &#34;city&#34;:&#34;New York&#34;,
</span></span><span style=display:flex><span>    &#34;zip&#34;:&#34;87432&#34;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#dissectåˆ†å‰²åçš„å­—æ®µå€¼éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨convert_datatypeå±æ€§è¿›è¡Œç±»å‹è½¬æ¢
</span></span><span style=display:flex><span>filter{
</span></span><span style=display:flex><span>    dissect{
</span></span><span style=display:flex><span>        convert_datatype =&gt; {age =&gt; &#34;int&#34;}
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=24-mutateæ’ä»¶>2.4 mutateæ’ä»¶<a hidden class=anchor aria-hidden=true href=#24-mutateæ’ä»¶>#</a></h2><p>ä½¿ç”¨æœ€é¢‘ç¹çš„æ“ä½œï¼Œå¯ä»¥å¯¹å­—æ®µè¿›è¡Œå„ç§æ“ä½œï¼Œæ¯”å¦‚é‡å‘½åã€åˆ é™¤ã€æ›¿æ¢ã€æ›´æ–°ç­‰ï¼Œä¸»è¦æ“ä½œå¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>convert   #ç±»å‹è½¬æ¢
</span></span><span style=display:flex><span>gsub      #å­—ç¬¦ä¸²æ›¿æ¢
</span></span><span style=display:flex><span>split/join/merge    #å­—ç¬¦ä¸²åˆ‡å‰²ã€æ•°ç»„åˆå¹¶ä¸ºå­—ç¬¦ä¸²ã€æ•°ç»„åˆå¹¶ä¸ºæ•°ç»„
</span></span><span style=display:flex><span>rename    #å­—æ®µé‡å‘½å
</span></span><span style=display:flex><span>update/replace   #å­—æ®µå†…å®¹æ›´æ–°æˆ–æ›¿æ¢
</span></span><span style=display:flex><span>remove_field     #åˆ é™¤å­—æ®µ
</span></span></code></pre></div><ul><li><code>convert</code>ï¼šå®ç°å­—æ®µç±»å‹çš„è½¬æ¢ï¼Œç±»å‹ä¸ºhash,ä»…æ”¯æŒè½¬æ¢ä¸ºintegerã€floatã€stringå’ŒBoolean</li></ul><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>filter{
</span></span><span style=display:flex><span>    mutate{
</span></span><span style=display:flex><span>        convert =&gt; {&#34;age&#34; =&gt; &#34;integer&#34;}
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li><code>gsub</code>ï¼šå¯¹å­—æ®µå†…å®¹è¿›è¡Œæ›¿æ¢ï¼Œç±»å‹ä¸ºæ•°ç»„ï¼Œæ¯3é¡¹ä¸ºä¸€ä¸ªæ›¿æ¢é…ç½®</li></ul><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>filter {
</span></span><span style=display:flex><span>  mutate {
</span></span><span style=display:flex><span>    gsub =&gt; [
</span></span><span style=display:flex><span>      # replace all forward slashes with underscore
</span></span><span style=display:flex><span>      &#34;fieldname&#34;, &#34;/&#34;, &#34;_&#34;,
</span></span><span style=display:flex><span>      # replace backslashes, question marks, hashes, and minuses
</span></span><span style=display:flex><span>      # with a dot &#34;.&#34;
</span></span><span style=display:flex><span>      &#34;fieldname2&#34;, &#34;[\?#-]&#34;, &#34;.&#34;
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}  
</span></span></code></pre></div><ul><li><code>split</code>: å°†å­—ç¬¦ä¸²åˆ‡å‰²ä¸ºæ•°ç»„</li></ul><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>filter {
</span></span><span style=display:flex><span>  mutate {
</span></span><span style=display:flex><span>     split =&gt; { &#34;fieldname&#34; =&gt; &#34;,&#34; }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}   
</span></span></code></pre></div><ul><li><code>join</code>ï¼šå°†æ•°ç»„æ‹¼æ¥ä¸ºå­—ç¬¦ä¸²</li><li><code>merge</code>ï¼šå°†ä¸¤ä¸ªæ•°ç»„åˆå¹¶ä¸º1ä¸ªæ•°ç»„ï¼Œå­—ç¬¦ä¸²ä¼šè¢«è½¬ä¸º1ä¸ªå…ƒç´ çš„æ•°ç»„è¿›è¡Œæ“ä½œ</li><li><code>rename</code>ï¼šå­—æ®µé‡å‘½å</li><li><code>update/replace</code>ï¼šæ›´æ–°å­—æ®µå†…å®¹ï¼ŒåŒºåˆ«åœ¨äºupdateåªåœ¨å­—æ®µå­˜åœ¨æ—¶ç”Ÿæ•ˆï¼Œè€Œreplaceåœ¨å­—æ®µä¸å­˜åœ¨æ—¶ä¼šæ‰§è¡Œæ–°å¢å­—æ®µçš„æ“ä½œ</li></ul><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>filter {
</span></span><span style=display:flex><span>  mutate {
</span></span><span style=display:flex><span>    update =&gt; { &#34;sample&#34; =&gt; &#34;My new message&#34; }
</span></span><span style=display:flex><span>    update =&gt; { &#34;message&#34; =&gt; &#34;source from c:%{source_host}&#34; }   #%{source_host}å¯ä»¥å¼•ç”¨logstash Eventä¸­çš„å­—æ®µå€¼
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}     
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>input {
</span></span><span style=display:flex><span>        stdin{type=&gt;stdin}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>filter{
</span></span><span style=display:flex><span>        dissect{ mapping =&gt; {&#34;message&#34; =&gt; &#34;%{a}-%{b}-%{c}&#34;} }
</span></span><span style=display:flex><span>        mutate{ replace =&gt; {&#34;d&#34; =&gt;&#34;source from c:%{c}&#34;} }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>output{
</span></span><span style=display:flex><span>        stdout{codec=&gt;rubydebug}
</span></span><span style=display:flex><span>}   
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>hi-hello-123
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>             &#34;a&#34; =&gt; &#34;hi&#34;,
</span></span><span style=display:flex><span>             &#34;b&#34; =&gt; &#34;hello&#34;,
</span></span><span style=display:flex><span>    &#34;@timestamp&#34; =&gt; 2018-06-29T02:01:24.473Z,
</span></span><span style=display:flex><span>             &#34;c&#34; =&gt; &#34;123&#34;,
</span></span><span style=display:flex><span>             &#34;d&#34; =&gt; &#34;source from c:123&#34;,
</span></span><span style=display:flex><span>      &#34;@version&#34; =&gt; &#34;1&#34;,
</span></span><span style=display:flex><span>          &#34;host&#34; =&gt; &#34;Node2&#34;,
</span></span><span style=display:flex><span>       &#34;message&#34; =&gt; &#34;hi-hello-123&#34;,
</span></span><span style=display:flex><span>          &#34;type&#34; =&gt; &#34;stdin&#34;
</span></span><span style=display:flex><span>}       
</span></span></code></pre></div><h2 id=25-jsonæ’ä»¶>2.5 jsonæ’ä»¶<a hidden class=anchor aria-hidden=true href=#25-jsonæ’ä»¶>#</a></h2><p>å°†å­—æ®µå†…å®¹ä¸ºjsonæ ¼å¼çš„æ•°æ®è¿›è¡Œè§£æ</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>filter {
</span></span><span style=display:flex><span>  json {
</span></span><span style=display:flex><span>    source =&gt; &#34;message&#34;     #è¦è§£æçš„å­—æ®µå
</span></span><span style=display:flex><span>    target =&gt; &#34;msg_json&#34;    #è§£æåçš„å­˜å‚¨å­—æ®µï¼Œé»˜è®¤å’ŒmessageåŒçº§åˆ«
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}  
</span></span></code></pre></div><h2 id=26-geoipæ’ä»¶>2.6 geoipæ’ä»¶<a hidden class=anchor aria-hidden=true href=#26-geoipæ’ä»¶>#</a></h2><p>å¸¸ç”¨çš„æ’ä»¶ï¼Œæ ¹æ®ipåœ°å€æä¾›å¯¹åº”çš„åœ°åŸŸä¿¡æ¯ï¼Œæ¯”å¦‚ç»çº¬åº¦ã€åŸå¸‚åç­‰ï¼Œæ–¹ä¾¿è¿›è¡Œåœ°ç†æ•°æ®åˆ†æ</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>filter {
</span></span><span style=display:flex><span>  geoip {
</span></span><span style=display:flex><span>    source =&gt; &#34;clientip&#34;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=27-rubyæ’ä»¶>2.7 rubyæ’ä»¶<a hidden class=anchor aria-hidden=true href=#27-rubyæ’ä»¶>#</a></h2><p>æœ€çµæ´»çš„æ’ä»¶ï¼Œå¯ä»¥ ä»¥rubyè¯­è¨€æ¥éšå¿ƒæ‰€æ¬²çš„ä¿®æ”¹Logstash Eventå¯¹è±¡,rubyèƒ½å®ç°é€»è¾‘,ç†è®ºä¸Šæ¥è¯´å¯ä»¥å®Œæˆä½ æƒ³è¦çš„ä»»ä½•æ“ä½œ,åæ­£å¾ˆåŠå°±å¯¹äº†(å‰ææ˜¯ä½ å¾—ä¼šrubyè¯­è¨€)</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>filter{
</span></span><span style=display:flex><span>    ruby{
</span></span><span style=display:flex><span>        code =&gt; &#39;size = event.get(&#34;message&#34;).size;
</span></span><span style=display:flex><span>                event.set(&#34;message_size&#34;,size)&#39;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ruby {
</span></span><span style=display:flex><span>        code =&gt; &#34;event.set(&#39;@read_timestamp&#39;,event.get(&#39;@timestamp&#39;))&#34;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>åŸæ–‡ï¼šhttps://blog.csdn.net/wfs1994/article/details/80862952</p><h1 id=3output>3.output<a hidden class=anchor aria-hidden=true href=#3output>#</a></h1><p>èƒ½è¾“å‡ºåˆ°å¾ˆå¤šåœ°æ–¹,æ¯”å¦‚,<code>csv</code>,<code>elasticsearch</code>,<code>shell</code>,<code>file</code>,<code>kafka</code>,<code>mongDB</code>,<code>rabbitMq</code>,<code>solr</code>,æ›´å¤šçš„å‚è§å®˜ç½‘</p><h2 id=31-elasticsearchæ’ä»¶>3.1 elasticsearchæ’ä»¶<a hidden class=anchor aria-hidden=true href=#31-elasticsearchæ’ä»¶>#</a></h2><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>  elasticsearch{  
</span></span><span style=display:flex><span>    hosts=&gt;[&#34;172.132.12.3:9200&#34;]  
</span></span><span style=display:flex><span>    action=&gt;&#34;index&#34;  
</span></span><span style=display:flex><span>    index=&gt;&#34;indextemplate-logstash&#34;  
</span></span><span style=display:flex><span>    #document_type=&gt;&#34;%{@type}&#34;  
</span></span><span style=display:flex><span>    document_id=&gt;&#34;ignore&#34;  
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>    template=&gt;&#34;/opt/logstash-conf/es-template.json&#34;  
</span></span><span style=display:flex><span>    template_name=&gt;&#34;es-template.json&#34;  
</span></span><span style=display:flex><span>    template_overwrite=&gt;true       
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    æ¥è‡ª: https://yq.aliyun.com/articles/197785
</span></span></code></pre></div><p>ä¸‹è½½å·¥å…·:https://motrix.app/zh-CN/</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://xiaokunji.com/zh/tags/ELK.html>ELK</a></li><li><a href=https://xiaokunji.com/zh/tags/%E7%BB%BC%E5%90%88.html>ç»¼åˆ</a></li></ul><nav class=paginav><a class=prev href=https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/log4j2%E5%BC%82%E6%AD%A5%E6%97%A5%E5%BF%97.html><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>log4j2å¼‚æ­¥æ—¥å¿—</span></a>
<a class=next href=https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/java%E5%9F%BA%E7%A1%80/lombok.html><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>lombok</span></a></nav></footer></article></main><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><footer class=footer><span>Copyright
&copy;
-2023
<a href=https://xiaokunji.com/zh/ style=color:#939393>ç±³äºŒ</a>
All Rights Reserved</span>
<span id=busuanzi_container><span class="fa fa-user">ç”¨æˆ·æ•°:</span><span id=busuanzi_value_site_uv></span>
<span class="fa fa-eye">è®¿é—®æ•°:</span><span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="å¤åˆ¶";function s(){t.innerHTML="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerHTML="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>