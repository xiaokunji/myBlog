<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>命令 | 米二</title><meta name=keywords content=" 1. kubectl 使用指南, 2. 简单部署, 2.1 部署 Pod, 2.1.1 pod 的yaml文件, 2.1.2 执行 kubectl 命令部署, 2.2 部署 Deployment, 2.2.1  Deployment 的 yaml 文件, 2.2.2 执行 kubectl 命令部署"><meta name=description content="     "><meta name=author content="xkj"><link rel=canonical href=https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/kubernetes/%E5%91%BD%E4%BB%A4.html><link crossorigin=anonymous href=/assets/css/stylesheet.b3faf608c544858ba700943ffe182cb647f38432d29a07d73234965beacb26f6.css integrity="sha256-s/r2CMVEhYunAJQ//hgstkfzhDLSmgfXMjSWW+rLJvY=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://xiaokunji.com/img/Q.svg><link rel=icon type=image/png sizes=16x16 href=https://xiaokunji.com/img/Q.svg><link rel=icon type=image/png sizes=32x32 href=https://xiaokunji.com/img/Q.svg><link rel=apple-touch-icon href=https://xiaokunji.com/Q.svg><link rel=mask-icon href=https://xiaokunji.com/Q.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/kubernetes/%E5%91%BD%E4%BB%A4.html><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="命令"><meta property="og:description" content="     "><meta property="og:type" content="article"><meta property="og:url" content="https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/kubernetes/%E5%91%BD%E4%BB%A4.html"><meta property="article:section" content="综合"><meta property="article:published_time" content="2023-08-22T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-30T16:27:33+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="命令"><meta name=twitter:description content="     "><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":4,"name":"命令","item":"https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/kubernetes/%E5%91%BD%E4%BB%A4.html"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"命令","name":"命令","description":"     ","keywords":[" 1. kubectl 使用指南"," 2. 简单部署"," 2.1 部署 Pod"," 2.1.1 pod 的yaml文件"," 2.1.2 执行 kubectl 命令部署"," 2.2 部署 Deployment"," 2.2.1  Deployment 的 yaml 文件"," 2.2.2 执行 kubectl 命令部署"],"articleBody":"[toc]\n1. kubectl 使用指南 kubectl 是 Kubernetes 自带的客户端，可以用它来直接操作 Kubernetes集群。Kubectl 的配置文件在$HOME/.kube 目录。我们可以通过设置 KUBECONFIG 环境变量或设置命令参数–kubeconfig 来指定其他位置的 kubeconfig 文件。\nkubectl 并不需要 kubectl 安装在 K8S 集群的任何 Node 上，但是，需要确保安装 kubectl 的机器和 K8S 的集群能够进行网络互通。\n从用户角度来说，kubectl 就是控制 Kubernetes 的驾驶舱，它允许你执行所有可能的 Kubernetes 操作；从技术角度来看，kubectl 就是 Kubernetes API 的一个客户端而已。\n使用以下语法 kubectl 从终端窗口运行命令： kubectl [command] [TYPE] [NAME] [flags]\ncommand：指定要对一个或多个资源执行的操作，例如 create、get、describe、delete。 TYPE：指定**资源类型 **。资源类型不区分大小写，可以指定单数、复数或缩写形式。例如，以下命令输出相同的结果: kubectl get pod pod1 kubectl get pods pod1 kubectl get po pod1 NAME：指定资源的名称。名称区分大小写。如果省略名称，则显示所有资源的详细信息 kubectl get pods。\nflags: 指定可选的参数。例如，可以使用 -s 或 -server 参数指定 Kubernetes API 服务器的地址和端口。\n在对多个资源执行操作时，您可以按类型和名称指定每个资源，或指定一个或多个文件：\n要按类型和名称指定资源： kubectl get pod pod1 要对所有类型相同的资源进行分组，请执行以下操作：TYPE name1 name2 。 例子：kubectl get pod example-pod1 example-pod2 分别指定多个资源类型：TYPE1/name1 TYPE1/name2 TYPE2/name3 TYPE4/name4。 例子：kubectl get pod/example-pod1 replicationcontroller/example-rc1 用一个或多个文件指定资源：-f file1 -f file2 -f file3 使用 YAML 而不是 JSON 因为 YAML 更容易使用，特别是用于配置文件时。 例子：kubectl get -f pod.yaml 2. 简单部署 2.1 部署 Pod 通过 kubectl 部署 Pod 的办法分为两步：\n准备 Pod 的 yaml 文件；\n执行 kubectl 命令部署\n2.1.1 pod 的yaml文件 apiVersion: v1 kind: Pod metadata: name: memory-demo namespace: mem-example spec: containers: - name: memory-demo-ctr image: polinux/stress resources: limits: memory: \"200Mi\" requests: memory: \"100Mi\" command: [\"stress\"] args: [\"--vm\", \"1\", \"--vm-bytes\", \"150M\", \"--vm-hang\", \"1\"] volumeMounts: - name: redis-storage mountPath: /data/redis volumes: - name: redis-storage emptyDir: {} apiVersion记录 K8S 的 API Server 版本，现在看到的都是v1，用户不用管。\nkind记录该 yaml 的对象，比如这是一份 Pod 的 yaml 配置文件，那么值内容就是Pod。\nmetadata记录了 Pod 自身的元数据，比如这个 Pod 的名字、这个 Pod 属于哪个 namespace\nspec记录了 Pod 内部所有的资源的详细信息，看懂这个很重要：\ncontainers记录了 Pod 内的容器信息，\ncontainers包括了：name容器名，image容器的镜像地址，resources容器需要的 CPU、内存、GPU 等资源，command容器的入口命令，args容器的入口参数，volumeMounts容器要挂载的 Pod 数据卷等。limits是 K8S 为该容器至多分配的资源配额；而requests则是 K8S 为该容器至少分配的资源配额\nvolumes记录了 Pod 内的数据卷信息，后文会详细介绍 Pod 的数据卷。\n2.1.2 执行 kubectl 命令部署 有了 Pod 的 yaml 文件之后，就可以用 kubectl 部署了，命令非常简单：kubectl create -f ${POD_YAML}。\n2.2 部署 Deployment 2.2.1 Deployment 的 yaml 文件 apiVersion: extensions/v1beta1 kind: Deployment metadata: name: rss-site namespace: mem-example spec: replicas: 2 template: metadata: labels: app: web spec: containers: - name: memory-demo-ctr image: polinux/stress resources: limits: emory: \"200Mi\" requests: memory: \"100Mi\" command: [\"stress\"] args: [\"--vm\", \"1\", \"--vm-bytes\", \"150M\", \"--vm-hang\", \"1\"] volumeMounts: - name: redis-storage mountPath: /data/redis volumes: - name: redis-storage emptyDir: {} metadata同 Pod 的 yaml，这里提一点：如果没有指明 namespace，那么就是用 kubectl 默认的 namespace（如果 kubectl 配置文件中没有指明 namespace，那么就是 default 空间）。\nspec，可以看到 Deployment 的spec字段是在 Pod 的spec内容外“包了一层”，那就来看 Deployment 有哪些需要注意的：\nreplicas。副本个数。也就是该 Deployment 需要起多少个相同的 Pod，如果用户成功在 K8S 中配置了 n（n\u003e1）个，那么 Deployment 会确保在集群中始终有 n 个服务在运行。\ntemplate。\nmetadata，新手同学先不管这边的信息。 spec，会发现这完完全全是上文提到的 Pod 的spec内容，在这里写明了 Deployment 下属管理的每个 Pod 的具体内容。 2.2.2 执行 kubectl 命令部署 Deployment 的部署办法同 Pod：kubectl create -f ${DEPLOYMENT_YAML}。由此可见，K8S 会根据配置文件中的kind字段来判断具体要创建的是什么资源。\n部署完 deployment 之后，可以查看到自动创建了 ReplicaSet 和 Pod，\n如下图所示：\n从名字上可以看出,deployment和 replicaSet还有Pod三者的名字是一个累加的方式, 所以看pod的名称, 可以看到deployment和replicaSet的名字是什么\n命令行工具 (kubectl) | Kubernetes Kubernetes 入门\u0026进阶实战 - 知乎 (zhihu.com) ","wordCount":"1744","inLanguage":"zh","datePublished":"2023-08-22T00:00:00Z","dateModified":"2023-08-30T16:27:33.871737268Z","author":{"@type":"Person","name":"xkj"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/kubernetes/%E5%91%BD%E4%BB%A4.html"},"publisher":{"@type":"Organization","name":"米二","logo":{"@type":"ImageObject","url":"https://xiaokunji.com/img/Q.svg"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://xiaokunji.com/zh/ accesskey=h title="米二 (Alt + H)"><img src=https://xiaokunji.com/img/Q.svg alt aria-label=logo height=35>米二</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://xiaokunji.com/en/ title=English aria-label=English>English</a></li></ul></div></div><ul id=menu><li><a href=https://xiaokunji.com/zh/ title=🏠主页><span>🏠主页</span></a></li><li><a href=https://xiaokunji.com/zh/search.html title="🔍搜索 (Alt + /)" accesskey=/><span>🔍搜索</span></a></li><li><a href=https://xiaokunji.com/zh/post.html title=📚文章><span>📚文章</span></a></li><li><a href=https://xiaokunji.com/zh/archives.html title=⏱时间轴><span>⏱时间轴</span></a></li><li><a href=https://xiaokunji.com/zh/tags.html title=🔖标签><span>🔖标签</span></a></li><li><a href=https://xiaokunji.com/zh/categories.html title=📖分类><span>📖分类</span></a></li><li><a href=https://xiaokunji.com/zh/links.html title=🤝友链><span>🤝友链</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><nav aria-label=breadcrumb><ul><a href=https://xiaokunji.com/zh/>🏠</a> <span>></span>
<a href=https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88.html>综合</a> <span>></span>
<a href=https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/kubernetes.html>Kubernetes</a> <span>></span></ul></nav><h1 class=post-title>命令</h1><div class=post-description></div><div class=post-meta>创建:&nbsp;<span title='2023-08-22 00:00:00 +0000 UTC'>2023-08-22</span>&nbsp;·&nbsp;更新:&nbsp;2023-08-30&nbsp;·&nbsp;4 分钟&nbsp;·&nbsp;xkj
&nbsp;|&nbsp;分类: &nbsp;<ul class=post-categories-meta><a href=https://xiaokunji.com/zh/categories/%E7%BB%BC%E5%90%88.html>综合</a></ul><span id=busuanzi_container_page_pv>&nbsp;| 访问: <span id=busuanzi_value_page_pv></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#1-kubectl-%e4%bd%bf%e7%94%a8%e6%8c%87%e5%8d%97 aria-label="1. kubectl 使用指南">1. kubectl 使用指南</a></li><li><a href=#2-%e7%ae%80%e5%8d%95%e9%83%a8%e7%bd%b2 aria-label="2. 简单部署">2. 简单部署</a><ul><li><a href=#21-%e9%83%a8%e7%bd%b2-pod aria-label="2.1 部署 Pod">2.1 部署 Pod</a><ul><li><a href=#211-pod-%e7%9a%84yaml%e6%96%87%e4%bb%b6 aria-label="2.1.1 pod 的yaml文件">2.1.1 pod 的yaml文件</a></li><li><a href=#212-%e6%89%a7%e8%a1%8c-kubectl-%e5%91%bd%e4%bb%a4%e9%83%a8%e7%bd%b2 aria-label="2.1.2 执行 kubectl 命令部署">2.1.2 执行 kubectl 命令部署</a></li></ul></li><li><a href=#22-%e9%83%a8%e7%bd%b2-deployment aria-label="2.2 部署 Deployment">2.2 部署 Deployment</a><ul><li><a href=#221--deployment-%e7%9a%84-yaml-%e6%96%87%e4%bb%b6 aria-label="2.2.1  Deployment 的 yaml 文件">2.2.1 Deployment 的 yaml 文件</a></li><li><a href=#222-%e6%89%a7%e8%a1%8c-kubectl-%e5%91%bd%e4%bb%a4%e9%83%a8%e7%bd%b2 aria-label="2.2.2 执行 kubectl 命令部署">2.2.2 执行 kubectl 命令部署</a></li></ul></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>[toc]</p><h1 id=1-kubectl-使用指南>1. kubectl 使用指南<a hidden class=anchor aria-hidden=true href=#1-kubectl-使用指南>#</a></h1><p>kubectl 是 Kubernetes 自带的客户端，可以用它来直接操作 Kubernetes集群。Kubectl 的配置文件在$HOME/.kube 目录。我们可以通过设置 KUBECONFIG 环境变量或设置命令参数&ndash;kubeconfig 来指定其他位置的 kubeconfig 文件。</p><p>kubectl 并不需要 kubectl 安装在 K8S 集群的任何 Node 上，但是，需要确保安装 kubectl 的机器和 K8S 的集群能够进行网络互通。</p><p>从用户角度来说，kubectl 就是控制 Kubernetes 的驾驶舱，它允许你执行所有可能的 Kubernetes 操作；从技术角度来看，kubectl 就是 Kubernetes API 的一个客户端而已。</p><p>使用以下语法 <code>kubectl</code> 从终端窗口运行命令：
<code>kubectl [command] [TYPE] [NAME] [flags]</code></p><ul><li><code>command</code>：指定要对一个或多个资源执行的操作，例如 <code>create</code>、<code>get</code>、<code>describe</code>、<code>delete</code>。</li><li><code>TYPE</code>：指定**<a href=https://kubernetes.io/zh/docs/reference/kubectl/overview/#resource-types target=_blank rel=noopener>资源类型</a>
**。资源类型不区分大小写，可以指定单数、复数或缩写形式。例如，以下命令输出相同的结果:</li></ul><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get pod pod1
</span></span><span style=display:flex><span>kubectl get pods pod1
</span></span><span style=display:flex><span>kubectl get po pod1
</span></span></code></pre></div><ul><li><p><code>NAME</code>：指定资源的名称。名称区分大小写。如果省略名称，则显示所有资源的详细信息 <code>kubectl get pods</code>。</p></li><li><p><code>flags</code>: 指定可选的参数。例如，可以使用 <code>-s</code> 或 <code>-server</code> 参数指定 Kubernetes API 服务器的地址和端口。</p></li></ul><p>在对多个资源执行操作时，您可以按类型和名称指定每个资源，或指定一个或多个文件：</p><ul><li>要按类型和名称指定资源： <code>kubectl get pod pod1</code></li><li>要对所有类型相同的资源进行分组，请执行以下操作：<code>TYPE name1 name2 </code>。
例子：<code>kubectl get pod example-pod1 example-pod2</code></li><li>分别指定多个资源类型：<code>TYPE1/name1 TYPE1/name2 TYPE2/name3 TYPE4/name4</code>。
例子：<code>kubectl get pod/example-pod1 replicationcontroller/example-rc1</code></li><li>用一个或多个文件指定资源：<code>-f file1 -f file2 -f file3</code></li><li><a href=https://kubernetes.io/zh/docs/concepts/configuration/overview/*#general-config-tips target=_blank rel=noopener>使用 YAML 而不是 JSON</a>
因为 YAML 更容易使用，特别是用于配置文件时。
例子：<code>kubectl get -f pod.yaml</code></li></ul><h1 id=2-简单部署>2. 简单部署<a hidden class=anchor aria-hidden=true href=#2-简单部署>#</a></h1><h2 id=21-部署-pod>2.1 部署 Pod<a hidden class=anchor aria-hidden=true href=#21-部署-pod>#</a></h2><p>通过 kubectl 部署 Pod 的办法分为两步：</p><ol><li><p>准备 Pod 的 yaml 文件；</p></li><li><p>执行 kubectl 命令部署</p></li></ol><h3 id=211-pod-的yaml文件>2.1.1 pod 的yaml文件<a hidden class=anchor aria-hidden=true href=#211-pod-的yaml文件>#</a></h3><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#7ee787>apiVersion</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>v1</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>kind</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>Pod</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>metadata</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>memory-demo</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>namespace</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>mem-example</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681></span><span style=color:#7ee787>spec</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>containers</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span>- <span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>memory-demo-ctr</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>image</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>polinux/stress</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>resources</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span><span style=color:#7ee787>limits</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>memory</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;200Mi&#34;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span><span style=color:#7ee787>requests</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>memory</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;100Mi&#34;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>command</span>:<span style=color:#6e7681> </span>[<span style=color:#a5d6ff>&#34;stress&#34;</span>]<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>args</span>:<span style=color:#6e7681> </span>[<span style=color:#a5d6ff>&#34;--vm&#34;</span>,<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;1&#34;</span>,<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;--vm-bytes&#34;</span>,<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;150M&#34;</span>,<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;--vm-hang&#34;</span>,<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;1&#34;</span>]<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>volumeMounts</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span>- <span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>redis-storage</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span><span style=color:#7ee787>mountPath</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>/data/redis</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span><span style=color:#7ee787>volumes</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>  </span>- <span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>redis-storage</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>    </span><span style=color:#7ee787>emptyDir</span>:<span style=color:#6e7681> </span>{}<span style=color:#6e7681>
</span></span></span></code></pre></div><ul><li><p><code>apiVersion</code>记录 K8S 的 API Server 版本，现在看到的都是<code>v1</code>，用户不用管。</p></li><li><p><code>kind</code>记录该 yaml 的对象，比如这是一份 Pod 的 yaml 配置文件，那么值内容就是<code>Pod</code>。</p></li><li><p><code>metadata</code>记录了 Pod 自身的元数据，比如这个 Pod 的名字、这个 Pod 属于哪个 namespace</p></li><li><p><code>spec</code>记录了 Pod 内部所有的资源的详细信息，看懂这个很重要：</p></li><li><ul><li><p><code>containers</code>记录了 Pod 内的容器信息，</p><p><code>containers</code>包括了：<code>name</code>容器名，<code>image</code>容器的镜像地址，<code>resources</code>容器需要的 CPU、内存、GPU 等资源，<code>command</code>容器的入口命令，<code>args</code>容器的入口参数，<code>volumeMounts</code>容器要挂载的 Pod 数据卷等。<code>limits</code>是 K8S 为该容器至多分配的资源配额；而<code>requests</code>则是 K8S 为该容器至少分配的资源配额</p></li><li><p><code>volumes</code>记录了 Pod 内的数据卷信息，后文会详细介绍 Pod 的数据卷。</p></li></ul></li></ul><h3 id=212-执行-kubectl-命令部署>2.1.2 执行 kubectl 命令部署<a hidden class=anchor aria-hidden=true href=#212-执行-kubectl-命令部署>#</a></h3><p>有了 Pod 的 yaml 文件之后，就可以用 kubectl 部署了，命令非常简单：<code>kubectl create -f ${POD_YAML}</code>。</p><p><img loading=lazy src=.%5c%e5%91%bd%e4%bb%a4.assets%0b2-3ca4f40582d40e56a57511e8785de3b2_r.jpg alt=img></p><h2 id=22-部署-deployment>2.2 部署 Deployment<a hidden class=anchor aria-hidden=true href=#22-部署-deployment>#</a></h2><h3 id=221--deployment-的-yaml-文件>2.2.1 Deployment 的 yaml 文件<a hidden class=anchor aria-hidden=true href=#221--deployment-的-yaml-文件>#</a></h3><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#7ee787>apiVersion</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>extensions/v1beta1</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681> </span><span style=color:#7ee787>kind</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>Deployment</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681> </span><span style=color:#7ee787>metadata</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span><span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>rss-site</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span><span style=color:#7ee787>namespace</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>mem-example</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681> </span><span style=color:#7ee787>spec</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span><span style=color:#7ee787>replicas</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>2</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>   </span><span style=color:#7ee787>template</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>     </span><span style=color:#7ee787>metadata</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>       </span><span style=color:#7ee787>labels</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>         </span><span style=color:#7ee787>app</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>web</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>     </span><span style=color:#7ee787>spec</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>      </span><span style=color:#7ee787>containers</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>       </span>- <span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>memory-demo-ctr</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>         </span><span style=color:#7ee787>image</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>polinux/stress</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>         </span><span style=color:#7ee787>resources</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>         </span><span style=color:#7ee787>limits</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>           </span><span style=color:#7ee787>emory</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;200Mi&#34;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>         </span><span style=color:#7ee787>requests</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>           </span><span style=color:#7ee787>memory</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;100Mi&#34;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>         </span><span style=color:#7ee787>command</span>:<span style=color:#6e7681> </span>[<span style=color:#a5d6ff>&#34;stress&#34;</span>]<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>         </span><span style=color:#7ee787>args</span>:<span style=color:#6e7681> </span>[<span style=color:#a5d6ff>&#34;--vm&#34;</span>,<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;1&#34;</span>,<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;--vm-bytes&#34;</span>,<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;150M&#34;</span>,<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;--vm-hang&#34;</span>,<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;1&#34;</span>]<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>         </span><span style=color:#7ee787>volumeMounts</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>         </span>- <span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>redis-storage</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>           </span><span style=color:#7ee787>mountPath</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>/data/redis</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>     </span><span style=color:#7ee787>volumes</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>     </span>- <span style=color:#7ee787>name</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>redis-storage</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>       </span><span style=color:#7ee787>emptyDir</span>:<span style=color:#6e7681> </span>{}<span style=color:#6e7681>
</span></span></span></code></pre></div><ul><li><p><code>metadata</code>同 Pod 的 yaml，这里提一点：如果没有指明 namespace，那么就是用 kubectl 默认的 namespace（如果 kubectl 配置文件中没有指明 namespace，那么就是 default 空间）。</p></li><li><p><code>spec</code>，可以看到 Deployment 的<code>spec</code>字段是在 Pod 的<code>spec</code>内容外“包了一层”，那就来看 Deployment 有哪些需要注意的：</p></li><li><ul><li><p><code>replicas</code>。副本个数。也就是该 Deployment 需要起多少个相同的 Pod，<strong>如果用户成功在 K8S 中配置了 n（n>1）个，那么 Deployment 会确保在集群中始终有 n 个服务在运行</strong>。</p></li><li><p><code>template</code>。</p></li><li><ul><li><code>metadata</code>，新手同学先不管这边的信息。</li><li><code>spec</code>，会发现这完完全全是上文提到的 Pod 的<code>spec</code>内容，在这里写明了 Deployment 下属管理的每个 Pod 的具体内容。</li></ul></li></ul></li></ul><h3 id=222-执行-kubectl-命令部署>2.2.2 执行 kubectl 命令部署<a hidden class=anchor aria-hidden=true href=#222-执行-kubectl-命令部署>#</a></h3><p>Deployment 的部署办法同 Pod：<code>kubectl create -f ${DEPLOYMENT_YAML}</code>。由此可见，<strong>K8S 会根据配置文件中的<code>kind</code>字段来判断具体要创建的是什么资源</strong>。</p><p><strong>部署完 deployment 之后，可以查看到自动创建了 ReplicaSet 和 Pod</strong>，</p><p>如下图所示：</p><p><img loading=lazy src=.%5c%e5%91%bd%e4%bb%a4.assets%0b2-904c600a9d2e18911ee342efcbcca6bb_r.jpg alt=img></p><p>从名字上可以看出,deployment和 replicaSet还有Pod三者的名字是一个累加的方式, 所以看pod的名称, 可以看到deployment和replicaSet的名字是什么</p><p><a href=https://kubernetes.io/zh-cn/docs/reference/kubectl/ target=_blank rel=noopener>命令行工具 (kubectl) | Kubernetes</a></p><p><a href=https://zhuanlan.zhihu.com/p/339008746 target=_blank rel=noopener>Kubernetes 入门&进阶实战 - 知乎 (zhihu.com)</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://xiaokunji.com/zh/tags/kubernetes.html>Kubernetes</a></li><li><a href=https://xiaokunji.com/zh/tags/%E7%BB%BC%E5%90%88.html>综合</a></li></ul><nav class=paginav><a class=prev href=https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/elk/elasticsearch/%E5%91%BD%E4%BB%A4.html><span class=title>« 上一页</span><br><span>命令</span></a>
<a class=next href=https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/java%E5%9F%BA%E7%A1%80/jvm/%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F.html><span class=title>下一页 »</span><br><span>内存区域</span></a></nav></footer></article></main><footer class=footer><span>Copyright
&copy;
-2023
<a href=https://xiaokunji.com/zh/ style=color:#939393>米二</a>
All Rights Reserved</span>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<span id=busuanzi_container><span class="fa fa-user">用户数:</span><span id=busuanzi_value_site_uv></span>
<span class="fa fa-eye">访问数:</span><span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>