<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>å®‰è£… | ç±³äºŒ</title><meta name=keywords content="  1 å‡†å¤‡ç¯å¢ƒ, 1.1 æœåŠ¡å™¨è¦æ±‚ï¼š, 1.2 è½¯ä»¶ç¯å¢ƒï¼š, 1.3 æœåŠ¡å™¨è§„åˆ’ï¼š, 2. ä¸»æœºåè§£æ, 3.æ—¶é—´åŒæ­¥, 4.ç¦ç”¨selinuxå’ŒfirewalldæœåŠ¡, 5.ç¦ç”¨swapåˆ†åŒº, 6.æ·»åŠ ç½‘æ¡¥è¿‡æ»¤å’Œåœ°å€è½¬å‘åŠŸèƒ½,ç„¶åæ‰§è¡Œ, 7.dockerå®‰è£…, 7.1 å®‰è£…dockerä¾èµ–, 7.2 é…ç½®docker é•œåƒåŠ é€Ÿå™¨å’Œé»˜è®¤å­˜å‚¨ç›®å½•, 7.3 å¯åŠ¨Docker, è®¾ç½®å¼€æœºå¯åŠ¨, å¯åŠ¨docker, 7.4 éªŒè¯, 7.5 å®‰è£…cri-dockerd, 8.kubernetesçš„Yumæºåˆ‡æ¢æˆå›½å†…æº, 9.å®‰è£…æŒ‡å®šç‰ˆæœ¬ kubeadmï¼Œkubeletå’Œkubect,è®¾ç½®kubeletå¼€æœºå¯åŠ¨, 10. é€šè¿‡ kubeadm éƒ¨ç½²Kubernetes, 10.1 éƒ¨ç½²masterèŠ‚ç‚¹, è¿™è¡Œæ•°æ® å¤åˆ¶ä¸‹æ¥,èŠ‚ç‚¹åŠ å…¥è¿›ç¾¤éœ€è¦ç”¨åˆ°æ­¤å‘½ä»¤, 10.2 å°†nodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤, 11.éƒ¨ç½²å®¹å™¨ç½‘ç»œï¼ˆCNIï¼‰, ä¸Šé¢è¿™äº›, 12.å…¶ä»–ç»´æŠ¤äº‹é¡¹"><meta name=description content="     "><meta name=author content="xkj"><link rel=canonical href=https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/kubernetes/%E5%AE%89%E8%A3%85.html><link crossorigin=anonymous href=/assets/css/stylesheet.b3faf608c544858ba700943ffe182cb647f38432d29a07d73234965beacb26f6.css integrity="sha256-s/r2CMVEhYunAJQ//hgstkfzhDLSmgfXMjSWW+rLJvY=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://xiaokunji.com/img/Q.svg><link rel=icon type=image/png sizes=16x16 href=https://xiaokunji.com/img/Q.svg><link rel=icon type=image/png sizes=32x32 href=https://xiaokunji.com/img/Q.svg><link rel=apple-touch-icon href=https://xiaokunji.com/Q.svg><link rel=mask-icon href=https://xiaokunji.com/Q.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/kubernetes/%E5%AE%89%E8%A3%85.html><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="å®‰è£…"><meta property="og:description" content="     "><meta property="og:type" content="article"><meta property="og:url" content="https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/kubernetes/%E5%AE%89%E8%A3%85.html"><meta property="article:section" content="ç»¼åˆ"><meta property="article:published_time" content="2023-08-22T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-28T17:01:18+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="å®‰è£…"><meta name=twitter:description content="     "><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":4,"name":"å®‰è£…","item":"https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/kubernetes/%E5%AE%89%E8%A3%85.html"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"å®‰è£…","name":"å®‰è£…","description":"     ","keywords":["  1 å‡†å¤‡ç¯å¢ƒ"," 1.1 æœåŠ¡å™¨è¦æ±‚ï¼š"," 1.2 è½¯ä»¶ç¯å¢ƒï¼š"," 1.3 æœåŠ¡å™¨è§„åˆ’ï¼š"," 2. ä¸»æœºåè§£æ"," 3.æ—¶é—´åŒæ­¥"," 4.ç¦ç”¨selinuxå’ŒfirewalldæœåŠ¡"," 5.ç¦ç”¨swapåˆ†åŒº"," 6.æ·»åŠ ç½‘æ¡¥è¿‡æ»¤å’Œåœ°å€è½¬å‘åŠŸèƒ½","ç„¶åæ‰§è¡Œ"," 7.dockerå®‰è£…"," 7.1 å®‰è£…dockerä¾èµ–"," 7.2 é…ç½®docker é•œåƒåŠ é€Ÿå™¨å’Œé»˜è®¤å­˜å‚¨ç›®å½•"," 7.3 å¯åŠ¨Docker"," è®¾ç½®å¼€æœºå¯åŠ¨"," å¯åŠ¨docker"," 7.4 éªŒè¯"," 7.5 å®‰è£…cri-dockerd"," 8.kubernetesçš„Yumæºåˆ‡æ¢æˆå›½å†…æº"," 9.å®‰è£…æŒ‡å®šç‰ˆæœ¬ kubeadmï¼Œkubeletå’Œkubect","è®¾ç½®kubeletå¼€æœºå¯åŠ¨"," 10. é€šè¿‡ kubeadm éƒ¨ç½²Kubernetes"," 10.1 éƒ¨ç½²masterèŠ‚ç‚¹"," è¿™è¡Œæ•°æ® å¤åˆ¶ä¸‹æ¥, èŠ‚ç‚¹åŠ å…¥è¿›ç¾¤éœ€è¦ç”¨åˆ°æ­¤å‘½ä»¤"," 10.2 å°†nodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤"," 11.éƒ¨ç½²å®¹å™¨ç½‘ç»œï¼ˆCNIï¼‰"," ä¸Šé¢è¿™äº›"," 12.å…¶ä»–ç»´æŠ¤äº‹é¡¹"],"articleBody":"[toc]\nK8sæ­å»ºæµç¨‹-ä½¿ç”¨kubeadm\n1 å‡†å¤‡ç¯å¢ƒ 1.1 æœåŠ¡å™¨è¦æ±‚ï¼š å»ºè®®æœ€å°ç¡¬ä»¶é…ç½®ï¼š2æ ¸CPUã€2Gå†…å­˜ã€20Gç¡¬ç›˜ï¼ŒæœåŠ¡å™¨æœ€å¥½å¯ä»¥è®¿é—®å¤–ç½‘ï¼Œä¼šæœ‰ä»ç½‘ä¸Šæ‹‰å–é•œåƒéœ€æ±‚ï¼Œå¦‚æœæœåŠ¡å™¨ä¸èƒ½ä¸Šç½‘ï¼Œéœ€è¦æå‰ä¸‹è½½å¯¹åº”é•œåƒå¹¶å¯¼å…¥èŠ‚ç‚¹ã€‚\n1.2 è½¯ä»¶ç¯å¢ƒï¼š è½¯ä»¶ ç‰ˆæœ¬ æ“ä½œç³»ç»Ÿ CentOS 7.7.1908 (Core) Docker 24.0.4 (å½“å‰æœ€æ–°ç‰ˆ) Kubernetes 1.23 1.3 æœåŠ¡å™¨è§„åˆ’ï¼š æœåŠ¡å™¨åç§° æœåŠ¡å™¨IP å¤‡æ³¨ master 10.39.40.1 24u/93G/755G åŒæ—¶ä½œä¸ºnodeèŠ‚ç‚¹ node1 10.39.40.2 32u/132G/3.6T node2 10.39.40.3 64u/141G/1.1T éƒ¨ç½²ä½¿ç”¨rootè´¦å·, érootè´¦å·å¾ˆå¤šå‘½ä»¤ç›¸å¯¹éº»çƒ¦\n2. ä¸»æœºåè§£æ ç¼–è¾‘æ‰€æœ‰èŠ‚ç‚¹æœåŠ¡å™¨çš„ /etc/hosts æ–‡ä»¶ ,æ·»åŠ ä¸»æœºå, æ‰§è¡Œå‘½ä»¤ï¼š\ncat \u003e\u003e /etc/hosts \u003c\u003c EOF 10.39.97.19 master 10.39.97.20 node1 EOF ç”¨sudo catè¿½åŠ æ–‡ä»¶å‡ºé”™_iteye_2225çš„åšå®¢-CSDNåšå®¢ è®¾ç½®æ¯å°èŠ‚ç‚¹çš„hostname, åˆ†åˆ«æ‰§è¡Œ\nmasterèŠ‚ç‚¹:\nhostnamectl set-hostname master\nnode1èŠ‚ç‚¹:\nhostnamectl set-hostname node1\n3.æ—¶é—´åŒæ­¥ å¯åŠ¨chronydæœåŠ¡\nsystemctl start chronyd systemctl enable chronyd date å¦‚æœæ²¡æœ‰å®‰è£… chronyd , å¯ä»¥ä½¿ç”¨ yum install chrony -y å®‰è£…\n4.ç¦ç”¨selinuxå’ŒfirewalldæœåŠ¡ å…³é—­firewalldæœåŠ¡,å¹¶ è®¾ç½®å¼€æœºä¸å¯åŠ¨\nsystemctl stop firewalld systemctl disable firewalld å…³é—­selinuxæœåŠ¡ï¼Œé‡å¯åç”Ÿæ•ˆ\nsed -i 's/enforcing/disabled/' /etc/selinux/config\nselinux - linuxçš„å®‰å…¨ç³»ç»Ÿ, å¯ä»¥å°½å¯èƒ½çš„æ§åˆ¶æƒé™æœ€å°åŒ– 5.ç¦ç”¨swapåˆ†åŒº swapåˆ†åŒºæŒ‡çš„æ˜¯è™šæ‹Ÿå†…å­˜åˆ†åŒºï¼Œå®ƒçš„ä½œç”¨æ˜¯ç‰©ç†å†…å­˜ä½¿ç”¨å®Œï¼Œä¹‹åå°†ç£ç›˜ç©ºé—´è™šæ‹Ÿæˆå†…å­˜æ¥ä½¿ç”¨ï¼Œå¯ç”¨swapè®¾å¤‡ä¼šå¯¹ç³»ç»Ÿçš„æ€§èƒ½äº§ç”Ÿéå¸¸è´Ÿé¢çš„å½±å“ï¼Œå› æ­¤kubernetesè¦æ±‚æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦ç¦ç”¨swapè®¾å¤‡ï¼Œä½†æ˜¯å¦‚æœå› ä¸ºæŸäº›åŸå› ç¡®å®ä¸èƒ½å…³é—­swapåˆ†åŒºï¼Œå°±éœ€è¦åœ¨é›†ç¾¤å®‰è£…è¿‡ç¨‹ä¸­é€šè¿‡æ˜ç¡®çš„å‚æ•°è¿›è¡Œé…ç½®è¯´æ˜\nsed -ri 's/.*swap.*/#\u0026/' /etc/fstab # æ°¸ä¹…å…³é—­\n6.æ·»åŠ ç½‘æ¡¥è¿‡æ»¤å’Œåœ°å€è½¬å‘åŠŸèƒ½ cat \u003e\u003e /etc/sysctl.d/kubernetes.conf \u003c\u003c EOF net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 net.ipv4.ip_forward = 1 EOF #ç„¶åæ‰§è¡Œ sysctl --system ä¸ºä½¿ä¹‹å‰çš„é…ç½®ç”Ÿæ•ˆï¼Œé‡å¯æ‰€æœ‰èŠ‚ç‚¹æœåŠ¡å™¨\nreboot\n7.dockerå®‰è£… 7.1 å®‰è£…dockerä¾èµ– curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun\nè¿™é‡Œä½¿ç”¨é˜¿é‡Œçš„é•œåƒä¸€é”®å®‰è£…, é»˜è®¤è£…æœ€æ–°ç‰ˆ, å¦‚æœæ˜¯è¦æŒ‡å®šç‰ˆæœ¬,å°±é‡‡ç”¨æ‰‹åŠ¨å®‰è£…çš„æ–¹å¼, ä¼šå¸®æˆ‘ä»¬åšå¦‚ä¸‹æ“ä½œ\nå®‰è£…yum-utils\nè®¾ç½®dockerä»“åº“é•œåƒä¸ºé˜¿é‡Œçš„\nå®‰è£… docker-ce / docker-ce-cli / containerd.io / docker-compose / makecache\nCentOS Docker å®‰è£… | èœé¸Ÿæ•™ç¨‹ (runoob.com) 7.2 é…ç½®docker é•œåƒåŠ é€Ÿå™¨å’Œé»˜è®¤å­˜å‚¨ç›®å½• cat \u003c /etc/docker/daemon.json { \"exec-opts\": [\"native.cgroupdriver=systemd\"], \"log-driver\": \"json-file\", \"log-opts\": { \"max-size\": \"100m\" }, \"data-root\": \"/app/docker-home\", \"registry-mirrors\": [\"https://registry.docker-cn.com\", \"https://hub-mirror.c.163.com\", \"https://docker.mirrors.ustc.edu.cn\",\"https://alzgoonw.mirror.aliyuncs.com\"] } EOF ã€ç®€è®°ã€‘ä¿®æ”¹Dockeræ•°æ®ç›®å½•ä½ç½®ï¼ŒåŒ…å«é•œåƒä½ç½® - ä¸œåŒ—å°ç‹ç‹¸ - åšå®¢å›­ (cnblogs.com) 7.3 å¯åŠ¨Docker # è®¾ç½®å¼€æœºå¯åŠ¨ systemctl enable docker # å¯åŠ¨docker systemctl start docker 7.4 éªŒè¯ docker version æ£€æŸ¥ç‰ˆæœ¬\nå¯ä»¥çœ‹åˆ° dockerç‰ˆæœ¬, å®¹å™¨æ•°, é•œåƒæ•°, root dir è·¯å¾„, é•œåƒä»“åº“ ç­‰ç­‰\ndocker run hello-world\næ‰§è¡Œä¸€ä¸ª hello-world , å¦‚æœèƒ½è¿è¡ŒæˆåŠŸ, åˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸ, ç¬¬ä¸€æ¬¡è¿è¡Œè¦pull é•œåƒ, å¯èƒ½ä¼šæ…¢ä¸€ç‚¹, ç­‰ä¸€ä¼šå®ƒ\nUnable to find image 'hello-world:latest' locally latest: Pulling from library/hello-world 1b930d010525: Pull complete Digest: sha256:9572f7cdcee8591948c2963463447a53466950b3fc15a247fcad1917ca215a2f Status: Downloaded newer image for hello-world:latest Hello from Docker! This message shows that your installation appears to be working correctly. To generate this message, Docker took the following steps: 1. The Docker client contacted the Docker daemon. 2. The Docker daemon pulled the \"hello-world\" image from the Docker Hub. (amd64) 3. The Docker daemon created a new container from that image which runs the executable that produces the output you are currently reading. 4. The Docker daemon streamed that output to the Docker client, which sent it to your terminal. To try something more ambitious, you can run an Ubuntu container with: $ docker run -it ubuntu bash Share images, automate workflows, and more with a free Docker ID: https://hub.docker.com/ For more examples and ideas, visit: https://docs.docker.com/get-started/ 7.5 å®‰è£…cri-dockerd ä»v1.24èµ·ï¼ŒDockerä¸èƒ½ç›´æ¥ä½œä¸ºk8sçš„å®¹å™¨è¿è¡Œæ—¶ ï¼Œå› ä¸ºåœ¨k8s v1.24ç‰ˆæœ¬ç§»é™¤äº†å«dockershimçš„ç»„ä»¶ï¼Œè¿™æ˜¯ç”±k8så›¢é˜Ÿç›´æ¥ç»´æŠ¤è€ŒéDockerå›¢é˜Ÿç»´æŠ¤çš„ç»„ä»¶ï¼Œè¿™æ„å‘³ç€Dockerå’Œk8sçš„å…³ç³»ä¸å†åƒåŸæ¥é‚£èˆ¬äº²å¯†ï¼Œå¼€å‘è€…éœ€è¦ä½¿ç”¨å…¶å®ƒç¬¦åˆCRIï¼ˆå®¹å™¨è¿è¡Œæ—¶æ¥å£ ï¼‰çš„å®¹å™¨è¿è¡Œæ—¶å·¥å…·ï¼ˆå¦‚containerd, CRI-Oç­‰ï¼‰ï¼Œå½“ç„¶è¿™å¹¶ä¸æ„å‘³ç€æ–°ç‰ˆæœ¬çš„k8så½»åº•æŠ›å¼ƒDockerï¼ˆç”±äºDockeråºå¤§çš„ç”Ÿæ€å’Œå¹¿æ³›çš„ç¾¤ä¼—åŸºç¡€ï¼Œæ˜¾ç„¶è¿™å¹¶ä¸å®¹æ˜“åŠåˆ°ï¼‰ï¼Œåœ¨åŸæœ¬å®‰è£…äº†Dockerçš„åŸºç¡€ä¸Šï¼Œå¯ä»¥é€šè¿‡è¡¥å……å®‰è£…cri-dockerd ï¼Œä»¥æ»¡è¶³å®¹å™¨è¿è¡Œæ—¶æ¥å£çš„æ¡ä»¶ï¼Œä»æŸç§ç¨‹åº¦ä¸Šè¯´ï¼Œcri-dockerdå°±æ˜¯ç¿»ç‰ˆçš„dockershimã€‚\næœ¬ç¯‡çš„k8s åˆšå¥½åœ¨ 1.23ç‰ˆæœ¬, æ‰€ä»¥ä¸ç”¨ç‰¹æ„å®‰è£…\nKubernetesæœ€æ–°ç‰ˆ2023.07v1.27.4å®‰è£…å’Œé›†ç¾¤æ­å»ºä¿å§†çº§æ•™ç¨‹ - çŸ¥ä¹ (zhihu.com) 8.kubernetesçš„Yumæºåˆ‡æ¢æˆå›½å†…æº cat \u003e\u003e /etc/yum.repos.d/kubernetes.repo \u003c\u003c EOF [kubernetes] name=Kubernetes baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64 enabled=1 gpgcheck=0 repo_gpgcheck=0 gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg EOF 9.å®‰è£…æŒ‡å®šç‰ˆæœ¬ kubeadmï¼Œkubeletå’Œkubect yum install -y kubelet-1.23.0 kubeadm-1.23.0 kubectl-1.23.0 #è®¾ç½®kubeletå¼€æœºå¯åŠ¨ systemctl enable kubelet 10. é€šè¿‡ kubeadm éƒ¨ç½²Kubernetes 10.1 éƒ¨ç½²masterèŠ‚ç‚¹ Kubernetes åˆå§‹åŒ–ï¼Œä¸‹é¢çš„æ“ä½œåªéœ€è¦åœ¨masterèŠ‚ç‚¹ä¸Šæ‰§è¡Œå³å¯\nkubeadm init \\ --apiserver-advertise-address=10.39.40.1 \\ --image-repository registry.aliyuncs.com/google_containers \\ --kubernetes-version v1.23.0 \\ --service-cidr=192.168.128.0/17 \\ --pod-network-cidr=192.168.0.0/17 \\ --ignore-preflight-errors=all â€“apiserver-advertise-address #é›†ç¾¤é€šå‘Šåœ°å€(master æœºå™¨IP) â€“image-repository #ç”±äºé»˜è®¤æ‹‰å–é•œåƒåœ°å€k8s.gcr.ioå›½å†…æ— æ³•è®¿é—®ï¼Œè¿™é‡ŒæŒ‡å®šé˜¿é‡Œäº‘é•œåƒä»“åº“åœ°å€ â€“kubernetes-version #K8sç‰ˆæœ¬ï¼Œä¸ä¸Šé¢å®‰è£…çš„ä¸€è‡´ â€“service-cidr #é›†ç¾¤å†…éƒ¨serviceç½‘ç»œ â€“pod-network-cidr #é›†ç¾¤å†…éƒ¨podç½‘ç»œï¼Œä¸ä¸‹é¢éƒ¨ç½²çš„CNIç½‘ç»œç»„ä»¶yamlä¸­ä¿æŒä¸€è‡´\næ­å»ºk8sæ—¶service-cidræ˜¯æ ¹æ®è‡ªå·±æœ¬åœ°å¾—ipåœ°å€å†™å¾— (aliyun.com) æˆåŠŸåæœ«å°¾è¾“å‡ºä¿¡æ¯å¦‚ä¸‹ï¼š\nYour Kubernetes control-plane has initialized successfully! To start using your cluster, you need to run the following as a regular user: mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config You should now deploy a pod network to the cluster. Run \"kubectl apply -f [podnetwork].yaml\" with one of the options listed at: https://kubernetes.io/docs/concepts/cluster-administration/addons/ Then you can join any number of worker nodes by running the following on each as root: #### è¿™è¡Œæ•°æ® å¤åˆ¶ä¸‹æ¥, èŠ‚ç‚¹åŠ å…¥è¿›ç¾¤éœ€è¦ç”¨åˆ°æ­¤å‘½ä»¤ kubeadm join 10.39.40.1:6443 --token 1j3dl9.1z8wjckd94xluwh6 \\ --discovery-token-ca-cert-hash sha256:c464e3ebd7f432f094bacf06269003730f010b431c3fb76acade4f43d4740 åˆ›å»ºå®¢æˆ·ç«¯æˆæƒæ–‡ä»¶\nmkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config æˆæƒkubectl å®¢æˆ·ç«¯èƒ½è¿æ¥ä¸Š k8s, è¿™é‡Œåªåœ¨masteré…ç½®, å¦‚æœéœ€è¦åœ¨å…¶ä»–èŠ‚ç‚¹é…ç½®, å°±æŠŠ /etc/kubernetes/admin.conf æ–‡ä»¶å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Š\n10.2 å°†nodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤ åœ¨æ‰€æœ‰nodeèŠ‚ç‚¹ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤(åˆå§‹åŒ–master å¾—åˆ°çš„å‘½ä»¤)\nkubeadm join 10.39.40.1:6443 --token 1j3dl9.1z8wjckd94xluwh6 \\ --discovery-token-ca-cert-hash sha256:c464e3ebd7f432f094bacf06269003730f010b431c3fb76acade4f43d4740 11.éƒ¨ç½²å®¹å™¨ç½‘ç»œï¼ˆCNIï¼‰ podä¹‹å‰éœ€è¦ç½‘ç»œé€šä¿¡, ä½†æ˜¯k8sæ²¡æœ‰å…·ä½“å®ç°, åªæ˜¯å¼€äº†CNIèƒ½åŠ›, æ‰€ä»¥éœ€è¦å…¶ä»–æ–¹æ¡ˆæ¥å®Œå–„\nCalicoæ˜¯ä¸€ä¸ªçº¯ä¸‰å±‚çš„æ•°æ®ä¸­å¿ƒç½‘ç»œæ–¹æ¡ˆï¼Œæ˜¯ç›®å‰Kubernetesä¸»æµçš„ç½‘ç»œæ–¹æ¡ˆã€‚ å®˜æ–¹çš„éƒ¨ç½²æ–‡æ¡£ä½¿ç”¨çš„æ˜¯ flannel\nKubernetes CNIç½‘ç»œæœ€å¼ºå¯¹æ¯”ï¼šFlannelã€Calicoã€Canalå’ŒWeave_æ–‡åŒ– \u0026 æ–¹æ³•_Rancher_InfoQç²¾é€‰æ–‡ç«  Master èŠ‚ç‚¹ä¸‹è½½Calico YAML æ–‡ä»¶\ncurl https://docs.projectcalico.org/v3.7/manifests/calico.yaml -O\nä¸‹è½½å®Œåä¿®æ”¹é‡Œé¢å®šä¹‰Podç½‘ç»œï¼ˆCALICO_IPV4POOL_CIDRï¼‰ï¼Œä¸å‰é¢kubeadm init çš„ â€“pod-network-cidr æŒ‡å®šçš„ä¸€æ ·\nåˆ›å»ºcalicoç½‘ç»œï¼ŒMasterèŠ‚ç‚¹ä¸Šæ‰§è¡Œ\nkubectl apply -f calico.yaml\næŸ¥çœ‹ç½‘ç»œçŠ¶æ€\nkubectl get pods -n kube-system -w\nç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œcalico å’Œ coredns ç›¸å…³podå¤„äºreadyçŠ¶æ€, è¿™ä¸ªè¿‡ç¨‹è¦ç­‰å¥½å‡ åˆ†é’Ÿ\nNAMESPACE NAME READY STATUS RESTARTS AGE kube-system calico-kube-controllers-dbd6bd945-vlqxh 1/1 Running 0 4m51s kube-system calico-node-hkp5s 1/1 Running 0 4m51s kube-system calico-node-ksxg8 1/1 Running 0 4m51s kube-system calico-node-srd2r 1/1 Running 0 4m51s kube-system coredns-7f6cbbb7b8-svhdg 1/1 Running 0 22h kube-system coredns-7f6cbbb7b8-vmm2h 1/1 Running 0 22h ### ä¸Šé¢è¿™äº› kube-system etcd-k8s-master 1/1 Running 0 22h kube-system kube-apiserver-k8s-master 1/1 Running 0 22h kube-system kube-controller-manager-k8s-master 1/1 Running 0 22h kube-system kube-proxy-4dvgq 1/1 Running 0 22h kube-system kube-proxy-5jhkj 1/1 Running 0 22h kube-system kube-proxy-5jtwf 1/1 Running 0 22h kube-system kube-scheduler-k8s-master 1/1 Running 0 22h æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼Œå¤„äº ready çŠ¶æ€\n[root@master01 ~]# kubectl get nodes NAME STATUS ROLES AGE VERSION master Ready control-plane,master 21h v1.23.4 node1 Ready 16h v1.23.4 node2 Ready 16h v1.23.4 [root@master01 ~]# å¯ä»¥çœ‹åˆ°æ‰€æœ‰èŠ‚ç‚¹çš„çŠ¶æ€å·²ç»å˜ä¸ºæ˜¯Readyäº†ã€‚ è‡³æ­¤K8så·²ç»éƒ¨ç½²å®Œæˆï¼Œå·²å¯ä»¥ç®€å•ä½¿ç”¨ï¼Œä½†æ˜¯ç¼ºå°‘NFSï¼Œä¸æ”¯æŒçµæ´»çš„æ•°æ®æŒä¹…åŒ–\n12.å…¶ä»–ç»´æŠ¤äº‹é¡¹ é‡æ–°ç”³è¯· join token 24å°æ—¶æœ‰æ•ˆ\nkubeadm token create --print-join-command\nmaster èŠ‚ç‚¹åŒæ—¶è®¾ç½®ä¸º nodeèŠ‚ç‚¹\nkubectl taint node master node-role.kubernetes.io/master-\næ¢å¤ master only\nkubectl taint node master node-role.kubernetes.io/master=\"\":NoSchedule\nK8sæ­å»ºæµç¨‹-ä½¿ç”¨kubeadm (flowus.cn) kubernetes(k8s)ç¯å¢ƒæ­å»º - çŸ¥ä¹ (zhihu.com) Kubernetesæœ€æ–°ç‰ˆ2023.07v1.27.4å®‰è£…å’Œé›†ç¾¤æ­å»ºä¿å§†çº§æ•™ç¨‹ - çŸ¥ä¹ (zhihu.com) Windows Docker å®‰è£… | èœé¸Ÿæ•™ç¨‹ (runoob.com) ","wordCount":"2773","inLanguage":"zh","datePublished":"2023-08-22T00:00:00Z","dateModified":"2023-08-28T17:01:18.759436243Z","author":{"@type":"Person","name":"xkj"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/kubernetes/%E5%AE%89%E8%A3%85.html"},"publisher":{"@type":"Organization","name":"ç±³äºŒ","logo":{"@type":"ImageObject","url":"https://xiaokunji.com/img/Q.svg"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://xiaokunji.com/zh/ accesskey=h title="ç±³äºŒ (Alt + H)"><img src=https://xiaokunji.com/img/Q.svg alt aria-label=logo height=35>ç±³äºŒ</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://xiaokunji.com/en/ title=English aria-label=English>English</a></li></ul></div></div><ul id=menu><li><a href=https://xiaokunji.com/zh/ title=ğŸ ä¸»é¡µ><span>ğŸ ä¸»é¡µ</span></a></li><li><a href=https://xiaokunji.com/zh/search.html title="ğŸ”æœç´¢ (Alt + /)" accesskey=/><span>ğŸ”æœç´¢</span></a></li><li><a href=https://xiaokunji.com/zh/post.html title=ğŸ“šæ–‡ç« ><span>ğŸ“šæ–‡ç« </span></a></li><li><a href=https://xiaokunji.com/zh/archives.html title=â±æ—¶é—´è½´><span>â±æ—¶é—´è½´</span></a></li><li><a href=https://xiaokunji.com/zh/tags.html title=ğŸ”–æ ‡ç­¾><span>ğŸ”–æ ‡ç­¾</span></a></li><li><a href=https://xiaokunji.com/zh/categories.html title=ğŸ“–åˆ†ç±»><span>ğŸ“–åˆ†ç±»</span></a></li><li><a href=https://xiaokunji.com/zh/links.html title=ğŸ¤å‹é“¾><span>ğŸ¤å‹é“¾</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><nav aria-label=breadcrumb><ul><a href=https://xiaokunji.com/zh/>ğŸ </a> <span>></span>
<a href=https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88.html>ç»¼åˆ</a> <span>></span>
<a href=https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/kubernetes.html>Kubernetes</a> <span>></span></ul></nav><h1 class=post-title>å®‰è£…</h1><div class=post-description></div><div class=post-meta><span title='2023-08-22 00:00:00 +0000 UTC'>2023-08-22</span>&nbsp;Â·&nbsp;6 åˆ†é’Ÿ&nbsp;Â·&nbsp;xkj
&nbsp;|&nbsp;åˆ†ç±»: &nbsp;<ul class=post-categories-meta><a href=https://xiaokunji.com/zh/categories/%E7%BB%BC%E5%90%88.html>ç»¼åˆ</a></ul><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<span id=busuanzi_container_page_pv>&nbsp;| è®¿é—®: <span id=busuanzi_value_page_pv></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#1-%e5%87%86%e5%a4%87%e7%8e%af%e5%a2%83 aria-label="1 å‡†å¤‡ç¯å¢ƒ">1 å‡†å¤‡ç¯å¢ƒ</a><ul><li><a href=#11-%e6%9c%8d%e5%8a%a1%e5%99%a8%e8%a6%81%e6%b1%82 aria-label="1.1 æœåŠ¡å™¨è¦æ±‚ï¼š">1.1 æœåŠ¡å™¨è¦æ±‚ï¼š</a></li><li><a href=#12-%e8%bd%af%e4%bb%b6%e7%8e%af%e5%a2%83 aria-label="1.2 è½¯ä»¶ç¯å¢ƒï¼š">1.2 è½¯ä»¶ç¯å¢ƒï¼š</a></li><li><a href=#13-%e6%9c%8d%e5%8a%a1%e5%99%a8%e8%a7%84%e5%88%92 aria-label="1.3 æœåŠ¡å™¨è§„åˆ’ï¼š">1.3 æœåŠ¡å™¨è§„åˆ’ï¼š</a></li></ul></li><li><a href=#2-%e4%b8%bb%e6%9c%ba%e5%90%8d%e8%a7%a3%e6%9e%90 aria-label="2. ä¸»æœºåè§£æ">2. ä¸»æœºåè§£æ</a></li><li><a href=#3%e6%97%b6%e9%97%b4%e5%90%8c%e6%ad%a5 aria-label=3.æ—¶é—´åŒæ­¥>3.æ—¶é—´åŒæ­¥</a></li><li><a href=#4%e7%a6%81%e7%94%a8selinux%e5%92%8cfirewalld%e6%9c%8d%e5%8a%a1 aria-label=4.ç¦ç”¨selinuxå’ŒfirewalldæœåŠ¡>4.ç¦ç”¨selinuxå’ŒfirewalldæœåŠ¡</a></li><li><a href=#5%e7%a6%81%e7%94%a8swap%e5%88%86%e5%8c%ba aria-label=5.ç¦ç”¨swapåˆ†åŒº>5.ç¦ç”¨swapåˆ†åŒº</a></li><li><a href=#6%e6%b7%bb%e5%8a%a0%e7%bd%91%e6%a1%a5%e8%bf%87%e6%bb%a4%e5%92%8c%e5%9c%b0%e5%9d%80%e8%bd%ac%e5%8f%91%e5%8a%9f%e8%83%bd aria-label=6.æ·»åŠ ç½‘æ¡¥è¿‡æ»¤å’Œåœ°å€è½¬å‘åŠŸèƒ½>6.æ·»åŠ ç½‘æ¡¥è¿‡æ»¤å’Œåœ°å€è½¬å‘åŠŸèƒ½</a></li><li><a href=#7docker%e5%ae%89%e8%a3%85 aria-label=7.dockerå®‰è£…>7.dockerå®‰è£…</a><ul><li><a href=#71-%e5%ae%89%e8%a3%85docker%e4%be%9d%e8%b5%96 aria-label="7.1 å®‰è£…dockerä¾èµ–">7.1 å®‰è£…dockerä¾èµ–</a></li><li><a href=#72-%e9%85%8d%e7%bd%aedocker-%e9%95%9c%e5%83%8f%e5%8a%a0%e9%80%9f%e5%99%a8%e5%92%8c%e9%bb%98%e8%ae%a4%e5%ad%98%e5%82%a8%e7%9b%ae%e5%bd%95 aria-label="7.2 é…ç½®docker é•œåƒåŠ é€Ÿå™¨å’Œé»˜è®¤å­˜å‚¨ç›®å½•">7.2 é…ç½®docker é•œåƒåŠ é€Ÿå™¨å’Œé»˜è®¤å­˜å‚¨ç›®å½•</a></li><li><a href=#73-%e5%90%af%e5%8a%a8docker aria-label="7.3 å¯åŠ¨Docker">7.3 å¯åŠ¨Docker</a></li><li><a href=#74-%e9%aa%8c%e8%af%81 aria-label="7.4 éªŒè¯">7.4 éªŒè¯</a></li><li><a href=#75-%e5%ae%89%e8%a3%85cri-dockerd aria-label="7.5 å®‰è£…cri-dockerd">7.5 å®‰è£…cri-dockerd</a></li></ul></li><li><a href=#8kubernetes%e7%9a%84yum%e6%ba%90%e5%88%87%e6%8d%a2%e6%88%90%e5%9b%bd%e5%86%85%e6%ba%90 aria-label=8.kubernetesçš„Yumæºåˆ‡æ¢æˆå›½å†…æº>8.kubernetesçš„Yumæºåˆ‡æ¢æˆå›½å†…æº</a></li><li><a href=#9%e5%ae%89%e8%a3%85%e6%8c%87%e5%ae%9a%e7%89%88%e6%9c%ac-kubeadmkubelet%e5%92%8ckubect aria-label="9.å®‰è£…æŒ‡å®šç‰ˆæœ¬ kubeadmï¼Œkubeletå’Œkubect">9.å®‰è£…æŒ‡å®šç‰ˆæœ¬ kubeadmï¼Œkubeletå’Œkubect</a></li><li><a href=#10-%e9%80%9a%e8%bf%87-kubeadm-%e9%83%a8%e7%bd%b2kubernetes aria-label="10. é€šè¿‡ kubeadm éƒ¨ç½²Kubernetes">10. é€šè¿‡ kubeadm éƒ¨ç½²Kubernetes</a><ul><li><a href=#101-%e9%83%a8%e7%bd%b2master%e8%8a%82%e7%82%b9 aria-label="10.1 éƒ¨ç½²masterèŠ‚ç‚¹">10.1 éƒ¨ç½²masterèŠ‚ç‚¹</a></li><li><a href=#102-%e5%b0%86node%e8%8a%82%e7%82%b9%e5%8a%a0%e5%85%a5%e9%9b%86%e7%be%a4 aria-label="10.2 å°†nodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤">10.2 å°†nodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤</a></li></ul></li><li><a href=#11%e9%83%a8%e7%bd%b2%e5%ae%b9%e5%99%a8%e7%bd%91%e7%bb%9ccni aria-label=11.éƒ¨ç½²å®¹å™¨ç½‘ç»œï¼ˆCNIï¼‰>11.éƒ¨ç½²å®¹å™¨ç½‘ç»œï¼ˆCNIï¼‰</a></li><li><a href=#12%e5%85%b6%e4%bb%96%e7%bb%b4%e6%8a%a4%e4%ba%8b%e9%a1%b9 aria-label=12.å…¶ä»–ç»´æŠ¤äº‹é¡¹>12.å…¶ä»–ç»´æŠ¤äº‹é¡¹</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>[toc]</p><p><strong>K8sæ­å»ºæµç¨‹-ä½¿ç”¨kubeadm</strong></p><h1 id=1-å‡†å¤‡ç¯å¢ƒ>1 å‡†å¤‡ç¯å¢ƒ<a hidden class=anchor aria-hidden=true href=#1-å‡†å¤‡ç¯å¢ƒ>#</a></h1><h2 id=11-æœåŠ¡å™¨è¦æ±‚>1.1 æœåŠ¡å™¨è¦æ±‚ï¼š<a hidden class=anchor aria-hidden=true href=#11-æœåŠ¡å™¨è¦æ±‚>#</a></h2><p>å»ºè®®æœ€å°ç¡¬ä»¶é…ç½®ï¼š2æ ¸CPUã€2Gå†…å­˜ã€20Gç¡¬ç›˜ï¼ŒæœåŠ¡å™¨æœ€å¥½å¯ä»¥è®¿é—®å¤–ç½‘ï¼Œä¼šæœ‰ä»ç½‘ä¸Šæ‹‰å–é•œåƒéœ€æ±‚ï¼Œå¦‚æœæœåŠ¡å™¨ä¸èƒ½ä¸Šç½‘ï¼Œéœ€è¦æå‰ä¸‹è½½å¯¹åº”é•œåƒå¹¶å¯¼å…¥èŠ‚ç‚¹ã€‚</p><h2 id=12-è½¯ä»¶ç¯å¢ƒ>1.2 è½¯ä»¶ç¯å¢ƒï¼š<a hidden class=anchor aria-hidden=true href=#12-è½¯ä»¶ç¯å¢ƒ>#</a></h2><table><thead><tr><th>è½¯ä»¶</th><th>ç‰ˆæœ¬</th></tr></thead><tbody><tr><td>æ“ä½œç³»ç»Ÿ</td><td>CentOS 7.7.1908 (Core)</td></tr><tr><td>Docker</td><td>24.0.4 (å½“å‰æœ€æ–°ç‰ˆ)</td></tr><tr><td>Kubernetes</td><td>1.23</td></tr></tbody></table><h2 id=13-æœåŠ¡å™¨è§„åˆ’>1.3 æœåŠ¡å™¨è§„åˆ’ï¼š<a hidden class=anchor aria-hidden=true href=#13-æœåŠ¡å™¨è§„åˆ’>#</a></h2><table><thead><tr><th>æœåŠ¡å™¨åç§°</th><th>æœåŠ¡å™¨IP</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>master</td><td>10.39.40.1</td><td>24u/93G/755G åŒæ—¶ä½œä¸ºnodeèŠ‚ç‚¹</td></tr><tr><td>node1</td><td>10.39.40.2</td><td>32u/132G/3.6T</td></tr><tr><td>node2</td><td>10.39.40.3</td><td>64u/141G/1.1T</td></tr></tbody></table><blockquote><p>éƒ¨ç½²ä½¿ç”¨rootè´¦å·, érootè´¦å·å¾ˆå¤šå‘½ä»¤ç›¸å¯¹éº»çƒ¦</p></blockquote><h1 id=2-ä¸»æœºåè§£æ>2. ä¸»æœºåè§£æ<a hidden class=anchor aria-hidden=true href=#2-ä¸»æœºåè§£æ>#</a></h1><p><strong>ç¼–è¾‘æ‰€æœ‰èŠ‚ç‚¹æœåŠ¡å™¨çš„ /etc/hosts æ–‡ä»¶ ,æ·»åŠ ä¸»æœºå, æ‰§è¡Œå‘½ä»¤ï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat &gt;&gt; /etc/hosts  <span style=color:#a5d6ff>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>10.39.97.19  master
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>10.39.97.20  node1
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>EOF</span>
</span></span></code></pre></div><blockquote><p><a href=https://blog.csdn.net/iteye_2225/article/details/82434589 target=_blank rel=noopener>ç”¨sudo catè¿½åŠ æ–‡ä»¶å‡ºé”™_iteye_2225çš„åšå®¢-CSDNåšå®¢</a></p></blockquote><p><strong>è®¾ç½®æ¯å°èŠ‚ç‚¹çš„hostname</strong>, åˆ†åˆ«æ‰§è¡Œ</p><p>masterèŠ‚ç‚¹:</p><p><code>hostnamectl set-hostname master</code></p><p>node1èŠ‚ç‚¹:</p><p><code>hostnamectl set-hostname node1</code></p><h1 id=3æ—¶é—´åŒæ­¥>3.æ—¶é—´åŒæ­¥<a hidden class=anchor aria-hidden=true href=#3æ—¶é—´åŒæ­¥>#</a></h1><p>å¯åŠ¨chronydæœåŠ¡</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>systemctl start chronyd 
</span></span><span style=display:flex><span>systemctl enable chronyd 
</span></span><span style=display:flex><span>date
</span></span></code></pre></div><blockquote><p>å¦‚æœæ²¡æœ‰å®‰è£… chronyd , å¯ä»¥ä½¿ç”¨ <code>yum install chrony -y</code> å®‰è£…</p></blockquote><h1 id=4ç¦ç”¨selinuxå’ŒfirewalldæœåŠ¡>4.ç¦ç”¨selinuxå’ŒfirewalldæœåŠ¡<a hidden class=anchor aria-hidden=true href=#4ç¦ç”¨selinuxå’ŒfirewalldæœåŠ¡>#</a></h1><p>å…³é—­firewalldæœåŠ¡,å¹¶ è®¾ç½®å¼€æœºä¸å¯åŠ¨</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>systemctl stop firewalld 
</span></span><span style=display:flex><span>systemctl disable firewalld
</span></span></code></pre></div><p>å…³é—­selinuxæœåŠ¡ï¼Œé‡å¯åç”Ÿæ•ˆ</p><p><code>sed -i 's/enforcing/disabled/' /etc/selinux/config</code></p><blockquote><p><a href=https://zhuanlan.zhihu.com/p/165974960 target=_blank rel=noopener>selinux - linuxçš„å®‰å…¨ç³»ç»Ÿ, å¯ä»¥å°½å¯èƒ½çš„æ§åˆ¶æƒé™æœ€å°åŒ–</a></p></blockquote><h1 id=5ç¦ç”¨swapåˆ†åŒº>5.ç¦ç”¨swapåˆ†åŒº<a hidden class=anchor aria-hidden=true href=#5ç¦ç”¨swapåˆ†åŒº>#</a></h1><blockquote><p>swapåˆ†åŒºæŒ‡çš„æ˜¯è™šæ‹Ÿå†…å­˜åˆ†åŒºï¼Œå®ƒçš„ä½œç”¨æ˜¯ç‰©ç†å†…å­˜ä½¿ç”¨å®Œï¼Œä¹‹åå°†ç£ç›˜ç©ºé—´è™šæ‹Ÿæˆå†…å­˜æ¥ä½¿ç”¨ï¼Œå¯ç”¨swapè®¾å¤‡ä¼šå¯¹ç³»ç»Ÿçš„æ€§èƒ½äº§ç”Ÿéå¸¸è´Ÿé¢çš„å½±å“ï¼Œå› æ­¤kubernetesè¦æ±‚æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦ç¦ç”¨swapè®¾å¤‡ï¼Œä½†æ˜¯å¦‚æœå› ä¸ºæŸäº›åŸå› ç¡®å®ä¸èƒ½å…³é—­swapåˆ†åŒºï¼Œå°±éœ€è¦åœ¨é›†ç¾¤å®‰è£…è¿‡ç¨‹ä¸­é€šè¿‡æ˜ç¡®çš„å‚æ•°è¿›è¡Œé…ç½®è¯´æ˜</p></blockquote><p><code>sed -ri 's/.*swap.*/#&/' /etc/fstab # æ°¸ä¹…å…³é—­</code></p><h1 id=6æ·»åŠ ç½‘æ¡¥è¿‡æ»¤å’Œåœ°å€è½¬å‘åŠŸèƒ½>6.æ·»åŠ ç½‘æ¡¥è¿‡æ»¤å’Œåœ°å€è½¬å‘åŠŸèƒ½<a hidden class=anchor aria-hidden=true href=#6æ·»åŠ ç½‘æ¡¥è¿‡æ»¤å’Œåœ°å€è½¬å‘åŠŸèƒ½>#</a></h1><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat &gt;&gt; /etc/sysctl.d/kubernetes.conf <span style=color:#a5d6ff>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>net.bridge.bridge-nf-call-iptables = 1
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>net.ipv4.ip_forward = 1
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>#ç„¶åæ‰§è¡Œ</span>
</span></span><span style=display:flex><span>sysctl --system  
</span></span></code></pre></div><p><strong>ä¸ºä½¿ä¹‹å‰çš„é…ç½®ç”Ÿæ•ˆï¼Œé‡å¯æ‰€æœ‰èŠ‚ç‚¹æœåŠ¡å™¨</strong></p><p><code>reboot</code></p><h1 id=7dockerå®‰è£…>7.dockerå®‰è£…<a hidden class=anchor aria-hidden=true href=#7dockerå®‰è£…>#</a></h1><h2 id=71-å®‰è£…dockerä¾èµ–>7.1 å®‰è£…dockerä¾èµ–<a hidden class=anchor aria-hidden=true href=#71-å®‰è£…dockerä¾èµ–>#</a></h2><p><code>curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</code></p><blockquote><p>è¿™é‡Œä½¿ç”¨é˜¿é‡Œçš„é•œåƒä¸€é”®å®‰è£…, é»˜è®¤è£…æœ€æ–°ç‰ˆ, å¦‚æœæ˜¯è¦æŒ‡å®šç‰ˆæœ¬,å°±é‡‡ç”¨æ‰‹åŠ¨å®‰è£…çš„æ–¹å¼, ä¼šå¸®æˆ‘ä»¬åšå¦‚ä¸‹æ“ä½œ</p><ol><li><p>å®‰è£…yum-utils</p></li><li><p>è®¾ç½®dockerä»“åº“é•œåƒä¸ºé˜¿é‡Œçš„</p></li><li><p>å®‰è£… docker-ce / docker-ce-cli / containerd.io / docker-compose / makecache</p><p><a href=https://www.runoob.com/docker/centos-docker-install.html target=_blank rel=noopener>CentOS Docker å®‰è£… | èœé¸Ÿæ•™ç¨‹ (runoob.com)</a></p></li></ol></blockquote><h2 id=72-é…ç½®docker-é•œåƒåŠ é€Ÿå™¨å’Œé»˜è®¤å­˜å‚¨ç›®å½•>7.2 é…ç½®docker é•œåƒåŠ é€Ÿå™¨å’Œé»˜è®¤å­˜å‚¨ç›®å½•<a hidden class=anchor aria-hidden=true href=#72-é…ç½®docker-é•œåƒåŠ é€Ÿå™¨å’Œé»˜è®¤å­˜å‚¨ç›®å½•>#</a></h2><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span>cat <span style=color:#a5d6ff>&lt;&lt;EOF&gt; /etc/docker/daemon.json
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>{
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  &#34;exec-opts&#34;: [&#34;native.cgroupdriver=systemd&#34;],
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  &#34;log-driver&#34;: &#34;json-file&#34;,
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  &#34;log-opts&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>    &#34;max-size&#34;: &#34;100m&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  },
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  &#34;data-root&#34;: &#34;/app/docker-home&#34;,
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>  &#34;registry-mirrors&#34;: [&#34;https://registry.docker-cn.com&#34;, &#34;https://hub-mirror.c.163.com&#34;, &#34;https://docker.mirrors.ustc.edu.cn&#34;,&#34;https://alzgoonw.mirror.aliyuncs.com&#34;]
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>}
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>EOF</span>
</span></span></code></pre></div><blockquote><p><a href=https://www.cnblogs.com/hellxz/p/docker-change-data-root.html target=_blank rel=noopener>ã€ç®€è®°ã€‘ä¿®æ”¹Dockeræ•°æ®ç›®å½•ä½ç½®ï¼ŒåŒ…å«é•œåƒä½ç½® - ä¸œåŒ—å°ç‹ç‹¸ - åšå®¢å›­ (cnblogs.com)</a></p></blockquote><h2 id=73-å¯åŠ¨docker>7.3 å¯åŠ¨Docker<a hidden class=anchor aria-hidden=true href=#73-å¯åŠ¨docker>#</a></h2><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Shell data-lang=Shell><span style=display:flex><span><span style=color:#8b949e;font-style:italic># è®¾ç½®å¼€æœºå¯åŠ¨</span>
</span></span><span style=display:flex><span>systemctl enable docker 
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># å¯åŠ¨docker</span>
</span></span><span style=display:flex><span>systemctl start docker
</span></span></code></pre></div><h2 id=74-éªŒè¯>7.4 éªŒè¯<a hidden class=anchor aria-hidden=true href=#74-éªŒè¯>#</a></h2><p><code>docker version</code> æ£€æŸ¥ç‰ˆæœ¬</p><blockquote><p>å¯ä»¥çœ‹åˆ° dockerç‰ˆæœ¬, å®¹å™¨æ•°, é•œåƒæ•°, root dir è·¯å¾„, é•œåƒä»“åº“ ç­‰ç­‰</p></blockquote><p><code>docker run hello-world</code></p><p>æ‰§è¡Œä¸€ä¸ª hello-world , å¦‚æœèƒ½è¿è¡ŒæˆåŠŸ, åˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸ, ç¬¬ä¸€æ¬¡è¿è¡Œè¦pull é•œåƒ, å¯èƒ½ä¼šæ…¢ä¸€ç‚¹, ç­‰ä¸€ä¼šå®ƒ</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>Unable to find image &#39;hello-world:latest&#39; locally
</span></span><span style=display:flex><span>latest: Pulling from library/hello-world
</span></span><span style=display:flex><span>1b930d010525: Pull complete
</span></span><span style=display:flex><span>Digest: sha256:9572f7cdcee8591948c2963463447a53466950b3fc15a247fcad1917ca215a2f
</span></span><span style=display:flex><span>Status: Downloaded newer image for hello-world:latest
</span></span><span style=display:flex><span>Hello from Docker!
</span></span><span style=display:flex><span>This message shows that your installation appears to be working correctly.
</span></span><span style=display:flex><span>To generate this message, Docker took the following steps:
</span></span><span style=display:flex><span> 1. The Docker client contacted the Docker daemon.
</span></span><span style=display:flex><span> 2. The Docker daemon pulled the &#34;hello-world&#34; image from the Docker Hub.
</span></span><span style=display:flex><span>    (amd64)
</span></span><span style=display:flex><span> 3. The Docker daemon created a new container from that image which runs the
</span></span><span style=display:flex><span>    executable that produces the output you are currently reading.
</span></span><span style=display:flex><span> 4. The Docker daemon streamed that output to the Docker client, which sent it
</span></span><span style=display:flex><span>    to your terminal.
</span></span><span style=display:flex><span>To try something more ambitious, you can run an Ubuntu container with:
</span></span><span style=display:flex><span> $ docker run -it ubuntu bash
</span></span><span style=display:flex><span>Share images, automate workflows, and more with a free Docker ID:
</span></span><span style=display:flex><span> https://hub.docker.com/
</span></span><span style=display:flex><span>For more examples and ideas, visit:
</span></span><span style=display:flex><span> https://docs.docker.com/get-started/
</span></span></code></pre></div><h2 id=75-å®‰è£…cri-dockerd>7.5 å®‰è£…cri-dockerd<a hidden class=anchor aria-hidden=true href=#75-å®‰è£…cri-dockerd>#</a></h2><p>ä»v1.24èµ·ï¼ŒDockerä¸èƒ½ç›´æ¥ä½œä¸ºk8sçš„<a href=https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/ target=_blank rel=noopener>å®¹å™¨è¿è¡Œæ—¶</a>
ï¼Œå› ä¸ºåœ¨k8s v1.24ç‰ˆæœ¬ç§»é™¤äº†å«dockershimçš„ç»„ä»¶ï¼Œè¿™æ˜¯ç”±k8så›¢é˜Ÿç›´æ¥ç»´æŠ¤è€ŒéDockerå›¢é˜Ÿç»´æŠ¤çš„ç»„ä»¶ï¼Œè¿™æ„å‘³ç€Dockerå’Œk8sçš„å…³ç³»ä¸å†åƒåŸæ¥é‚£èˆ¬äº²å¯†ï¼Œå¼€å‘è€…éœ€è¦ä½¿ç”¨å…¶å®ƒç¬¦åˆCRIï¼ˆ<a href=https://github.com/kubernetes/cri-api#readme target=_blank rel=noopener>å®¹å™¨è¿è¡Œæ—¶æ¥å£</a>
ï¼‰çš„å®¹å™¨è¿è¡Œæ—¶å·¥å…·ï¼ˆå¦‚containerd, CRI-Oç­‰ï¼‰ï¼Œå½“ç„¶è¿™å¹¶ä¸æ„å‘³ç€æ–°ç‰ˆæœ¬çš„k8så½»åº•æŠ›å¼ƒDockerï¼ˆç”±äºDockeråºå¤§çš„ç”Ÿæ€å’Œå¹¿æ³›çš„ç¾¤ä¼—åŸºç¡€ï¼Œæ˜¾ç„¶è¿™å¹¶ä¸å®¹æ˜“åŠåˆ°ï¼‰ï¼Œåœ¨åŸæœ¬å®‰è£…äº†Dockerçš„åŸºç¡€ä¸Šï¼Œå¯ä»¥é€šè¿‡è¡¥å……å®‰è£…<a href=https://github.com/Mirantis/cri-dockerd target=_blank rel=noopener>cri-dockerd</a>
ï¼Œä»¥æ»¡è¶³å®¹å™¨è¿è¡Œæ—¶æ¥å£çš„æ¡ä»¶ï¼Œä»æŸç§ç¨‹åº¦ä¸Šè¯´ï¼Œcri-dockerdå°±æ˜¯ç¿»ç‰ˆçš„dockershimã€‚</p><p><strong>æœ¬ç¯‡çš„k8s åˆšå¥½åœ¨ 1.23ç‰ˆæœ¬, æ‰€ä»¥ä¸ç”¨ç‰¹æ„å®‰è£…</strong></p><p><a href=https://zhuanlan.zhihu.com/p/641521752 target=_blank rel=noopener>Kubernetesæœ€æ–°ç‰ˆ2023.07v1.27.4å®‰è£…å’Œé›†ç¾¤æ­å»ºä¿å§†çº§æ•™ç¨‹ - çŸ¥ä¹ (zhihu.com)</a></p><h1 id=8kubernetesçš„yumæºåˆ‡æ¢æˆå›½å†…æº>8.kubernetesçš„Yumæºåˆ‡æ¢æˆå›½å†…æº<a hidden class=anchor aria-hidden=true href=#8kubernetesçš„yumæºåˆ‡æ¢æˆå›½å†…æº>#</a></h1><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat &gt;&gt; /etc/yum.repos.d/kubernetes.repo <span style=color:#a5d6ff>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>[kubernetes]
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>name=Kubernetes
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>enabled=1
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>gpgcheck=0
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>repo_gpgcheck=0
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg 
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>EOF</span>
</span></span></code></pre></div><h1 id=9å®‰è£…æŒ‡å®šç‰ˆæœ¬-kubeadmkubeletå’Œkubect>9.å®‰è£…æŒ‡å®šç‰ˆæœ¬ kubeadmï¼Œkubeletå’Œkubect<a hidden class=anchor aria-hidden=true href=#9å®‰è£…æŒ‡å®šç‰ˆæœ¬-kubeadmkubeletå’Œkubect>#</a></h1><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>yum install -y kubelet-1.23.0 kubeadm-1.23.0 kubectl-1.23.0
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>#è®¾ç½®kubeletå¼€æœºå¯åŠ¨</span>
</span></span><span style=display:flex><span>systemctl enable kubelet
</span></span></code></pre></div><h1 id=10-é€šè¿‡-kubeadm-éƒ¨ç½²kubernetes>10. é€šè¿‡ kubeadm éƒ¨ç½²Kubernetes<a hidden class=anchor aria-hidden=true href=#10-é€šè¿‡-kubeadm-éƒ¨ç½²kubernetes>#</a></h1><h2 id=101-éƒ¨ç½²masterèŠ‚ç‚¹>10.1 éƒ¨ç½²masterèŠ‚ç‚¹<a hidden class=anchor aria-hidden=true href=#101-éƒ¨ç½²masterèŠ‚ç‚¹>#</a></h2><p>Kubernetes åˆå§‹åŒ–ï¼Œä¸‹é¢çš„æ“ä½œ<strong>åªéœ€è¦åœ¨masterèŠ‚ç‚¹</strong>ä¸Šæ‰§è¡Œå³å¯</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubeadm init <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --apiserver-advertise-address<span style=color:#ff7b72;font-weight:700>=</span>10.39.40.1 <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --image-repository registry.aliyuncs.com/google_containers <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --kubernetes-version v1.23.0 <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --service-cidr<span style=color:#ff7b72;font-weight:700>=</span>192.168.128.0/17 <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --pod-network-cidr<span style=color:#ff7b72;font-weight:700>=</span>192.168.0.0/17 <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>  --ignore-preflight-errors<span style=color:#ff7b72;font-weight:700>=</span>all
</span></span></code></pre></div><blockquote><p>&ndash;apiserver-advertise-address #é›†ç¾¤é€šå‘Šåœ°å€(master æœºå™¨IP)
&ndash;image-repository #ç”±äºé»˜è®¤æ‹‰å–é•œåƒåœ°å€k8s.gcr.ioå›½å†…æ— æ³•è®¿é—®ï¼Œè¿™é‡ŒæŒ‡å®šé˜¿é‡Œäº‘é•œåƒä»“åº“åœ°å€
&ndash;kubernetes-version #K8sç‰ˆæœ¬ï¼Œä¸ä¸Šé¢å®‰è£…çš„ä¸€è‡´
&ndash;service-cidr #é›†ç¾¤å†…éƒ¨serviceç½‘ç»œ
&ndash;pod-network-cidr #é›†ç¾¤å†…éƒ¨podç½‘ç»œï¼Œä¸ä¸‹é¢éƒ¨ç½²çš„CNIç½‘ç»œç»„ä»¶yamlä¸­ä¿æŒä¸€è‡´</p></blockquote><blockquote><p><a href=https://developer.aliyun.com/ask/139167 target=_blank rel=noopener>æ­å»ºk8sæ—¶service-cidræ˜¯æ ¹æ®è‡ªå·±æœ¬åœ°å¾—ipåœ°å€å†™å¾— (aliyun.com)</a>
<img loading=lazy src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" alt=img></p></blockquote><p><strong>æˆåŠŸåæœ«å°¾è¾“å‡ºä¿¡æ¯å¦‚ä¸‹</strong>ï¼š</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>Your Kubernetes control-plane has initialized successfully!
</span></span><span style=display:flex><span>To start using your cluster, you need to run the following as a regular user<span style=color:#f85149>:</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  mkdir -p <span style=color:#79c0ff>$HOME</span>/.<span style=color:#79c0ff>kube</span>
</span></span><span style=display:flex><span>  sudo cp -i /etc/kubernetes/admin.<span style=color:#79c0ff>conf</span> <span style=color:#79c0ff>$HOME</span>/.kube/config
</span></span><span style=display:flex><span>  sudo chown $(id -u)<span style=color:#f85149>:</span>$(id -g) <span style=color:#79c0ff>$HOME</span>/.kube/config
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>You should now deploy a pod network to the cluster.
</span></span><span style=display:flex><span>Run <span style=color:#a5d6ff>&#34;kubectl apply -f [podnetwork].yaml&#34;</span> with one of the options listed at<span style=color:#f85149>:</span>
</span></span><span style=display:flex><span>  https<span style=color:#f85149>:</span>//kubernetes.io/docs/concepts/cluster-administration/addons/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Then you can join any number of worker nodes by running the following on each as root<span style=color:#f85149>:</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>#### è¿™è¡Œæ•°æ® å¤åˆ¶ä¸‹æ¥, èŠ‚ç‚¹åŠ å…¥è¿›ç¾¤éœ€è¦ç”¨åˆ°æ­¤å‘½ä»¤</span>
</span></span><span style=display:flex><span>kubeadm join <span style=color:#a5d6ff>10.39</span>.<span style=color:#79c0ff>40</span>.<span style=color:#a5d6ff>1</span><span style=color:#f85149>:</span><span style=color:#a5d6ff>6443</span> --token 1j3dl9.<span style=color:#79c0ff>1z8wjckd94xluwh6</span> \
</span></span><span style=display:flex><span>    --discovery-token-ca-cert-hash sha256<span style=color:#f85149>:</span>c464e3ebd7f432f094bacf06269003730f010b431c3fb76acade4f43d4740
</span></span></code></pre></div><p><strong>åˆ›å»ºå®¢æˆ·ç«¯æˆæƒæ–‡ä»¶</strong></p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mkdir -p <span style=color:#79c0ff>$HOME</span>/.kube
</span></span><span style=display:flex><span>sudo cp -i /etc/kubernetes/admin.conf <span style=color:#79c0ff>$HOME</span>/.kube/config
</span></span><span style=display:flex><span>sudo chown <span style=color:#ff7b72>$(</span>id -u<span style=color:#ff7b72>)</span>:<span style=color:#ff7b72>$(</span>id -g<span style=color:#ff7b72>)</span> <span style=color:#79c0ff>$HOME</span>/.kube/config
</span></span></code></pre></div><blockquote><p>æˆæƒkubectl å®¢æˆ·ç«¯èƒ½è¿æ¥ä¸Š k8s, è¿™é‡Œåªåœ¨masteré…ç½®, å¦‚æœéœ€è¦åœ¨å…¶ä»–èŠ‚ç‚¹é…ç½®, å°±æŠŠ <code>/etc/kubernetes/admin.conf</code> æ–‡ä»¶å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Š</p></blockquote><h2 id=102-å°†nodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤>10.2 å°†nodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤<a hidden class=anchor aria-hidden=true href=#102-å°†nodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤>#</a></h2><p>åœ¨æ‰€æœ‰nodeèŠ‚ç‚¹ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤(åˆå§‹åŒ–master å¾—åˆ°çš„å‘½ä»¤)</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubeadm join 10.39.40.1:6443 --token 1j3dl9.1z8wjckd94xluwh6 <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    --discovery-token-ca-cert-hash sha256:c464e3ebd7f432f094bacf06269003730f010b431c3fb76acade4f43d4740
</span></span></code></pre></div><h1 id=11éƒ¨ç½²å®¹å™¨ç½‘ç»œcni>11.éƒ¨ç½²å®¹å™¨ç½‘ç»œï¼ˆCNIï¼‰<a hidden class=anchor aria-hidden=true href=#11éƒ¨ç½²å®¹å™¨ç½‘ç»œcni>#</a></h1><blockquote><p>podä¹‹å‰éœ€è¦ç½‘ç»œé€šä¿¡, ä½†æ˜¯k8sæ²¡æœ‰å…·ä½“å®ç°, åªæ˜¯å¼€äº†CNIèƒ½åŠ›, æ‰€ä»¥éœ€è¦å…¶ä»–æ–¹æ¡ˆæ¥å®Œå–„</p><p>Calicoæ˜¯ä¸€ä¸ªçº¯ä¸‰å±‚çš„æ•°æ®ä¸­å¿ƒç½‘ç»œæ–¹æ¡ˆï¼Œæ˜¯ç›®å‰Kubernetesä¸»æµçš„ç½‘ç»œæ–¹æ¡ˆã€‚ å®˜æ–¹çš„éƒ¨ç½²æ–‡æ¡£ä½¿ç”¨çš„æ˜¯ <code>flannel</code></p><p><a href=https://www.infoq.cn/article/gxftm0x8z2zlhw9xlezv target=_blank rel=noopener>Kubernetes CNIç½‘ç»œæœ€å¼ºå¯¹æ¯”ï¼šFlannelã€Calicoã€Canalå’ŒWeave_æ–‡åŒ– & æ–¹æ³•_Rancher_InfoQç²¾é€‰æ–‡ç« </a></p></blockquote><p><strong>Master èŠ‚ç‚¹ä¸‹è½½Calico YAML æ–‡ä»¶</strong></p><p><code>curl https://docs.projectcalico.org/v3.7/manifests/calico.yaml -O</code></p><p>ä¸‹è½½å®Œå<strong>ä¿®æ”¹é‡Œé¢å®šä¹‰Podç½‘ç»œ</strong>ï¼ˆCALICO_IPV4POOL_CIDRï¼‰ï¼Œä¸å‰é¢kubeadm init çš„ &ndash;pod-network-cidr æŒ‡å®šçš„ä¸€æ ·</p><p><img loading=lazy src=./%E5%AE%89%E8%A3%85.assets/image-20230802201055835.png alt=image-20230802201055835></p><p><strong>åˆ›å»ºcalicoç½‘ç»œï¼ŒMasterèŠ‚ç‚¹ä¸Šæ‰§è¡Œ</strong></p><p><code>kubectl apply -f calico.yaml</code></p><p><strong>æŸ¥çœ‹ç½‘ç»œçŠ¶æ€</strong></p><p><code>kubectl get pods -n kube-system -w</code></p><p>ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œcalico å’Œ coredns ç›¸å…³podå¤„äºreadyçŠ¶æ€, è¿™ä¸ªè¿‡ç¨‹è¦ç­‰å¥½å‡ åˆ†é’Ÿ</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>NAMESPACE     NAME                                      READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>kube-system   calico-kube-controllers-dbd6bd945-vlqxh   1/1     Running   0          4m51s
</span></span><span style=display:flex><span>kube-system   calico-node-hkp5s                         1/1     Running   0          4m51s
</span></span><span style=display:flex><span>kube-system   calico-node-ksxg8                         1/1     Running   0          4m51s
</span></span><span style=display:flex><span>kube-system   calico-node-srd2r                         1/1     Running   0          4m51s
</span></span><span style=display:flex><span>kube-system   coredns-7f6cbbb7b8-svhdg                  1/1     Running   0          22h
</span></span><span style=display:flex><span>kube-system   coredns-7f6cbbb7b8-vmm2h                  1/1     Running   0          22h
</span></span><span style=display:flex><span>### ä¸Šé¢è¿™äº›
</span></span><span style=display:flex><span>kube-system   etcd-k8s-master                           1/1     Running   0          22h
</span></span><span style=display:flex><span>kube-system   kube-apiserver-k8s-master                 1/1     Running   0          22h
</span></span><span style=display:flex><span>kube-system   kube-controller-manager-k8s-master        1/1     Running   0          22h
</span></span><span style=display:flex><span>kube-system   kube-proxy-4dvgq                          1/1     Running   0          22h
</span></span><span style=display:flex><span>kube-system   kube-proxy-5jhkj                          1/1     Running   0          22h
</span></span><span style=display:flex><span>kube-system   kube-proxy-5jtwf                          1/1     Running   0          22h
</span></span><span style=display:flex><span>kube-system   kube-scheduler-k8s-master                 1/1     Running   0          22h
</span></span></code></pre></div><p>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼Œå¤„äº ready çŠ¶æ€</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>[root@master01 ~]# kubectl get nodes
</span></span><span style=display:flex><span>NAME       STATUS   ROLES                  AGE   VERSION
</span></span><span style=display:flex><span>master   Ready    control-plane,master   21h   v1.23.4
</span></span><span style=display:flex><span>node1   Ready    &lt;none&gt;                 16h   v1.23.4
</span></span><span style=display:flex><span>node2   Ready    &lt;none&gt;                 16h   v1.23.4
</span></span><span style=display:flex><span>[root@master01 ~]# 
</span></span><span style=display:flex><span>å¯ä»¥çœ‹åˆ°æ‰€æœ‰èŠ‚ç‚¹çš„çŠ¶æ€å·²ç»å˜ä¸ºæ˜¯Readyäº†ã€‚
</span></span></code></pre></div><p>è‡³æ­¤K8så·²ç»éƒ¨ç½²å®Œæˆï¼Œå·²å¯ä»¥ç®€å•ä½¿ç”¨ï¼Œä½†æ˜¯ç¼ºå°‘NFSï¼Œä¸æ”¯æŒçµæ´»çš„æ•°æ®æŒä¹…åŒ–</p><h1 id=12å…¶ä»–ç»´æŠ¤äº‹é¡¹>12.å…¶ä»–ç»´æŠ¤äº‹é¡¹<a hidden class=anchor aria-hidden=true href=#12å…¶ä»–ç»´æŠ¤äº‹é¡¹>#</a></h1><p>é‡æ–°ç”³è¯· join token 24å°æ—¶æœ‰æ•ˆ</p><p><code>kubeadm token create --print-join-command</code></p><p>master èŠ‚ç‚¹åŒæ—¶è®¾ç½®ä¸º nodeèŠ‚ç‚¹</p><p><code>kubectl taint node master node-role.kubernetes.io/master-</code></p><p>æ¢å¤ master only</p><p><code>kubectl taint node master node-role.kubernetes.io/master="":NoSchedule</code></p><p><a href=https://flowus.cn/share/cf359a50-272a-4fc2-b27b-42014bec123e target=_blank rel=noopener>K8sæ­å»ºæµç¨‹-ä½¿ç”¨kubeadm (flowus.cn)</a></p><p><a href=https://zhuanlan.zhihu.com/p/265968760 target=_blank rel=noopener>kubernetes(k8s)ç¯å¢ƒæ­å»º - çŸ¥ä¹ (zhihu.com)</a></p><p><a href=https://zhuanlan.zhihu.com/p/641521752 target=_blank rel=noopener>Kubernetesæœ€æ–°ç‰ˆ2023.07v1.27.4å®‰è£…å’Œé›†ç¾¤æ­å»ºä¿å§†çº§æ•™ç¨‹ - çŸ¥ä¹ (zhihu.com)</a></p><p><a href=https://www.runoob.com/docker/windows-docker-install.html target=_blank rel=noopener>Windows Docker å®‰è£… | èœé¸Ÿæ•™ç¨‹ (runoob.com)</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://xiaokunji.com/zh/tags/kubernetes.html>Kubernetes</a></li><li><a href=https://xiaokunji.com/zh/tags/%E7%BB%BC%E5%90%88.html>ç»¼åˆ</a></li></ul><nav class=paginav><a class=prev href=https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/docker/%E5%AE%89%E8%A3%85.html><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>å®‰è£…</span></a>
<a class=next href=https://xiaokunji.com/zh/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/%E5%AE%89%E8%A3%85%E5%8F%8A%E5%87%86%E5%A4%87.html><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>å®‰è£…åŠå‡†å¤‡</span></a></nav></footer></article></main><footer class=footer><span>Copyright
&copy;
-2023
<a href=https://xiaokunji.com/zh/ style=color:#939393>ç±³äºŒ</a>
All Rights Reserved</span>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<span id=busuanzi_container><span class="fa fa-user">ç”¨æˆ·æ•°:</span><span id=busuanzi_value_site_uv></span>
<span class="fa fa-eye">è®¿é—®æ•°:</span><span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="å¤åˆ¶";function s(){t.innerHTML="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerHTML="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>