<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>HBase | ç±³äºŒ</title><meta name=keywords content=" **1. ä¸ºä½•HBaseé€Ÿåº¦å¾ˆå¿«ï¼Ÿ**, **2. hbase å®æ—¶æŸ¥è¯¢çš„åŸç†**,  **3. åˆ—ç°‡æ€ä¹ˆåˆ›å»ºæ¯”è¾ƒå¥½ï¼Ÿ(<=2)**, **4. æè¿° HBase ä¸­ scan å’Œ get çš„åŠŸèƒ½ä»¥åŠå®ç°çš„å¼‚åŒï¼Ÿ**,  **5. ç®€è¿° HBase ä¸­ compact ç”¨é€”æ˜¯ä»€ä¹ˆï¼Œä»€ä¹ˆæ—¶å€™è§¦å‘ï¼Œåˆ†ä¸ºå“ªä¸¤ç§ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«?**, **6. HBase rowlock æœ‰ä»€ä¹ˆç”¨**"><meta name=description content="     "><meta name=author content="xkj"><link rel=canonical href=https://xiaokunji.github.io/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/%E9%9D%A2%E8%AF%95/hbase/><link crossorigin=anonymous href=/assets/css/stylesheet.a2492b1919558dad2b0783841b531329520921f957f354ded4c3fc4d21dcc77f.css integrity="sha256-okkrGRlVja0rB4OEG1MTKVIJIflX81Te1MP8TSHcx38=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://xiaokunji.github.io/img/Q.gif><link rel=icon type=image/png sizes=16x16 href=https://xiaokunji.github.io/img/Q.gif><link rel=icon type=image/png sizes=32x32 href=https://xiaokunji.github.io/img/Q.gif><link rel=apple-touch-icon href=https://xiaokunji.github.io/Q.gif><link rel=mask-icon href=https://xiaokunji.github.io/Q.gif><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://xiaokunji.github.io/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/%E9%9D%A2%E8%AF%95/hbase/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="HBase"><meta property="og:description" content="     "><meta property="og:type" content="article"><meta property="og:url" content="https://xiaokunji.github.io/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/%E9%9D%A2%E8%AF%95/hbase/"><meta property="article:section" content="Hadoopç”Ÿæ€åœˆ"><meta property="article:published_time" content="2023-08-22T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-22T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="HBase"><meta name=twitter:description content="     "><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":3,"name":"HBase","item":"https://xiaokunji.github.io/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/%E9%9D%A2%E8%AF%95/hbase/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HBase","name":"HBase","description":"     ","keywords":[" **1. ä¸ºä½•HBaseé€Ÿåº¦å¾ˆå¿«ï¼Ÿ**"," **2. hbase å®æ—¶æŸ¥è¯¢çš„åŸç†**","  **3. åˆ—ç°‡æ€ä¹ˆåˆ›å»ºæ¯”è¾ƒå¥½ï¼Ÿ(\u003c=2)**"," **4. æè¿° HBase ä¸­ scan å’Œ get çš„åŠŸèƒ½ä»¥åŠå®ç°çš„å¼‚åŒï¼Ÿ**","  **5. ç®€è¿° HBase ä¸­ compact ç”¨é€”æ˜¯ä»€ä¹ˆï¼Œä»€ä¹ˆæ—¶å€™è§¦å‘ï¼Œåˆ†ä¸ºå“ªä¸¤ç§ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«?**"," **6. HBase rowlock æœ‰ä»€ä¹ˆç”¨**"],"articleBody":"[toc]\n1. ä¸ºä½•HBaseé€Ÿåº¦å¾ˆå¿«ï¼Ÿ HBaseèƒ½æä¾›å®æ—¶è®¡ç®—æœåŠ¡ä¸»è¦åŸå› æ˜¯ç”±å…¶æ¶æ„å’Œåº•å±‚çš„æ•°æ®ç»“æ„å†³å®šçš„ï¼Œå³ç”±LSM-Tree(Log-Structured Merge-Tree) + HTable(regionåˆ†åŒº) + Cacheå†³å®šâ€”â€”å®¢æˆ·ç«¯å¯ä»¥ç›´æ¥å®šä½åˆ°è¦æŸ¥æ•°æ®æ‰€åœ¨çš„HRegion serveræœåŠ¡å™¨ï¼Œç„¶åç›´æ¥åœ¨æœåŠ¡å™¨çš„ä¸€ä¸ªregionä¸ŠæŸ¥æ‰¾è¦åŒ¹é…çš„æ•°æ®ï¼Œå¹¶ä¸”è¿™äº›æ•°æ®éƒ¨åˆ†æ˜¯ç»è¿‡cacheç¼“å­˜çš„ã€‚\nHBaseçš„å†™å…¥é€Ÿåº¦å¿«æ˜¯å› ä¸ºå®ƒå…¶å®å¹¶ä¸æ˜¯çœŸçš„ç«‹å³å†™å…¥æ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯å…ˆå†™å…¥å†…å­˜ï¼Œéšåå¼‚æ­¥åˆ·å…¥HFileã€‚æ‰€ä»¥åœ¨å®¢æˆ·ç«¯çœ‹æ¥ï¼Œå†™å…¥é€Ÿåº¦å¾ˆå¿«ã€‚å¦å¤–ï¼Œå†™å…¥æ—¶å€™å°†éšæœºå†™å…¥è½¬æ¢æˆé¡ºåºå†™ï¼Œæ•°æ®å†™å…¥é€Ÿåº¦ä¹Ÿå¾ˆç¨³å®šã€‚\nè¯»å–é€Ÿåº¦å¿«æ˜¯å› ä¸ºå®ƒä½¿ç”¨äº†LSMæ ‘å‹ç»“æ„ï¼Œè€Œä¸æ˜¯Bæˆ–B+æ ‘.HBaseçš„å­˜å‚¨ç»“æ„å¯¼è‡´å®ƒéœ€è¦ç£ç›˜å¯»é“æ—¶é—´åœ¨å¯é¢„æµ‹èŒƒå›´å†…ï¼Œå¹¶ä¸”è¯»å–ä¸æ‰€è¦æŸ¥è¯¢çš„rowkeyè¿ç»­çš„ä»»æ„æ•°é‡çš„è®°å½•éƒ½ä¸ä¼šå¼•å‘é¢å¤–çš„å¯»é“å¼€é”€ã€‚è€Œä¸”ï¼ŒHBaseè¯»å–é¦–å…ˆä¼šåœ¨ç¼“å­˜ï¼ˆBlockCacheï¼‰ä¸­æŸ¥æ‰¾ï¼Œå®ƒé‡‡ç”¨äº†LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•ï¼‰ï¼Œå¦‚æœç¼“å­˜ä¸­æ²¡æ‰¾åˆ°ï¼Œä¼šä»å†…å­˜ä¸­çš„MemStoreä¸­æŸ¥æ‰¾ï¼Œå†å»HFileæŸ¥æ‰¾\nhttps://zhuanlan.zhihu.com/p/83233850 2. hbase å®æ—¶æŸ¥è¯¢çš„åŸç† å®æ—¶æŸ¥è¯¢ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä»å†…å­˜ä¸­æŸ¥è¯¢ï¼Œä¸€èˆ¬å“åº”æ—¶é—´åœ¨ 1 ç§’å†…ã€‚ HBase çš„æœºåˆ¶æ˜¯æ•°æ®å…ˆå†™å…¥åˆ°å†…å­˜ä¸­ï¼Œå½“æ•°æ®é‡è¾¾åˆ°ä¸€å®šçš„é‡ï¼ˆå¦‚ 128Mï¼‰ï¼Œå†å†™å…¥ç£ç›˜ä¸­ï¼Œ åœ¨å†…å­˜ä¸­ï¼Œæ˜¯ä¸è¿›è¡Œæ•°æ®çš„æ›´æ–°æˆ–åˆå¹¶æ“ä½œçš„ï¼Œåªå¢åŠ æ•°æ®ï¼Œè¿™ä½¿å¾—ç”¨æˆ·çš„å†™æ“ä½œåªè¦è¿›å…¥å†…å­˜ä¸­å°±å¯ä»¥ç«‹å³è¿”å›ï¼Œä¿è¯äº† HBase I/O çš„é«˜æ€§èƒ½ã€‚\n3. åˆ—ç°‡æ€ä¹ˆåˆ›å»ºæ¯”è¾ƒå¥½ï¼Ÿ(\u003c=2) rowKey æœ€å¥½è¦åˆ›å»ºæœ‰è§„åˆ™çš„ rowKeyï¼Œå³æœ€å¥½æ˜¯æœ‰åºçš„ã€‚ HBase ä¸­ä¸€å¼ è¡¨æœ€å¥½åªåˆ›å»ºä¸€åˆ°ä¸¤ä¸ªåˆ—æ—æ¯”è¾ƒå¥½ï¼Œå› ä¸º HBase ä¸èƒ½å¾ˆå¥½çš„å¤„ç†å¤šä¸ªåˆ—æ—ã€‚\n4. æè¿° HBase ä¸­ scan å’Œ get çš„åŠŸèƒ½ä»¥åŠå®ç°çš„å¼‚åŒï¼Ÿ HBase çš„æŸ¥è¯¢å®ç°åªæä¾›ä¸¤ç§æ–¹å¼ï¼š\næŒ‰æŒ‡å®š RowKey è·å–å”¯ä¸€ä¸€æ¡è®°å½•ï¼Œget æ–¹æ³•ï¼ˆorg.apache.hadoop.hbase.client.Getï¼‰Get çš„æ–¹æ³•å¤„ç†åˆ†ä¸¤ç§ : è®¾ç½®äº† ClosestRowBefore å’Œæ²¡æœ‰è®¾ç½® ClosestRowBefore çš„rowlockã€‚ä¸»è¦æ˜¯ç”¨æ¥ä¿è¯è¡Œçš„äº‹åŠ¡æ€§ï¼Œå³æ¯ä¸ª get æ˜¯ä»¥ä¸€ä¸ª row æ¥æ ‡è®°çš„ã€‚ä¸€ä¸ª row ä¸­å¯ä»¥æœ‰å¾ˆå¤š family å’Œ columnã€‚\næŒ‰æŒ‡å®šçš„æ¡ä»¶è·å–ä¸€æ‰¹è®°å½•ï¼Œscan æ–¹æ³•(org.apache.Hadoop.hbase.client.Scanï¼‰å®ç°æ¡ä»¶æŸ¥è¯¢åŠŸèƒ½ä½¿ç”¨çš„å°±æ˜¯ scan æ–¹å¼ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/shujuelin/article/details/89035272\n5. ç®€è¿° HBase ä¸­ compact ç”¨é€”æ˜¯ä»€ä¹ˆï¼Œä»€ä¹ˆæ—¶å€™è§¦å‘ï¼Œåˆ†ä¸ºå“ªä¸¤ç§ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«? åœ¨ hbase ä¸­æ¯å½“æœ‰ memstore æ•°æ® flush åˆ°ç£ç›˜ä¹‹åï¼Œå°±å½¢æˆä¸€ä¸ª storefileï¼Œå½“ storeFileçš„æ•°é‡è¾¾åˆ°ä¸€å®šç¨‹åº¦åï¼Œå°±éœ€è¦å°† storefile æ–‡ä»¶æ¥è¿›è¡Œ compaction æ“ä½œã€‚\nCompact çš„ä½œç”¨ï¼š\nåˆå¹¶æ–‡ä»¶\næ¸…é™¤è¿‡æœŸï¼Œå¤šä½™ç‰ˆæœ¬çš„æ•°æ®(åˆ é™¤çš„æ•°æ®ä¸ä¼šé©¬ä¸Šåˆ é™¤,åªä¼šè¢«æ ‡è®°éœ€è¦åˆ é™¤)\næé«˜è¯»å†™æ•°æ®çš„æ•ˆç‡\nHBase ä¸­å®ç°äº†ä¸¤ç§ compaction çš„æ–¹å¼ï¼šminor and major. è¿™ä¸¤ç§ compaction æ–¹å¼çš„\nåŒºåˆ«æ˜¯ï¼š\nMinor æ“ä½œåªç”¨æ¥åšéƒ¨åˆ†æ–‡ä»¶çš„åˆå¹¶æ“ä½œä»¥åŠåŒ…æ‹¬ minVersion=0 å¹¶ä¸”è®¾ç½® ttl çš„è¿‡æœŸç‰ˆæœ¬æ¸…ç†ï¼Œä¸åšä»»ä½•åˆ é™¤æ•°æ®ã€å¤šç‰ˆæœ¬æ•°æ®çš„æ¸…ç†å·¥ä½œã€‚\nMajor æ“ä½œæ˜¯å¯¹ Region ä¸‹çš„ HStore ä¸‹çš„æ‰€æœ‰ StoreFile æ‰§è¡Œåˆå¹¶æ“ä½œï¼Œæœ€ç»ˆçš„ç»“æœæ˜¯æ•´ç†åˆå¹¶å‡ºä¸€ä¸ªæ–‡ä»¶ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ major åˆå¹¶çš„æ—¶å€™ï¼Œåªä¼šå¯¹ä¸€ä¸ªåˆ—æ—çš„ HFile è¿›è¡Œåˆå¹¶ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/shujuelin/article/details/89035272\n6. HBase rowlock æœ‰ä»€ä¹ˆç”¨ åœ¨åˆå§‹åŒ– Put å¯¹è±¡çš„æ—¶å€™ï¼Œå¦‚æœéœ€è¦é¢‘ç¹åœ°é‡å¤ä¿®æ”¹æŸäº›è¡Œï¼ˆåŠ é”ï¼‰ï¼Œç”¨æˆ·æœ‰å¿…è¦åˆ›å»ºä¸€ä¸ª RowLock å®ä¾‹æ¥é˜²æ­¢å…¶ä»–å®¢æˆ·ç«¯è®¿é—®è¿™äº›è¡Œã€‚\n","wordCount":"1399","inLanguage":"zh","datePublished":"2023-08-22T00:00:00Z","dateModified":"2023-08-22T00:00:00Z","author":{"@type":"Person","name":"xkj"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://xiaokunji.github.io/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/%E9%9D%A2%E8%AF%95/hbase/"},"publisher":{"@type":"Organization","name":"ç±³äºŒ","logo":{"@type":"ImageObject","url":"https://xiaokunji.github.io/img/Q.gif"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://xiaokunji.github.io/zh/ accesskey=h title="ç±³äºŒ (Alt + H)"><img src=https://xiaokunji.github.io/img/Q.gif alt aria-label=logo height=35>ç±³äºŒ</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://xiaokunji.github.io/en/ title=English aria-label=English>English</a></li></ul></div></div><ul id=menu><li><a href=https://xiaokunji.github.io/zh/ title=ğŸ ä¸»é¡µ><span>ğŸ ä¸»é¡µ</span></a></li><li><a href=https://xiaokunji.github.io/zh/search title="ğŸ”æœç´¢ (Alt + /)" accesskey=/><span>ğŸ”æœç´¢</span></a></li><li><a href=https://xiaokunji.github.io/zh/post title=ğŸ“šæ–‡ç« ><span>ğŸ“šæ–‡ç« </span></a></li><li><a href=https://xiaokunji.github.io/zh/archives/ title=â±æ—¶é—´è½´><span>â±æ—¶é—´è½´</span></a></li><li><a href=https://xiaokunji.github.io/zh/tags title=ğŸ”–æ ‡ç­¾><span>ğŸ”–æ ‡ç­¾</span></a></li><li><a href=https://xiaokunji.github.io/zh/categories title=ğŸ“–åˆ†ç±»><span>ğŸ“–åˆ†ç±»</span></a></li><li><a href=https://xiaokunji.github.io/zh/links title=ğŸ¤å‹é“¾><span>ğŸ¤å‹é“¾</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><nav aria-label=breadcrumb><ul><a href=https://xiaokunji.github.io/zh/>content</a> <span>></span>
<a href=https://xiaokunji.github.io/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/>Hadoopç”Ÿæ€åœˆ</a> <span>></span>
<a href=https://xiaokunji.github.io/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/%E9%9D%A2%E8%AF%95/>é¢è¯•</a> <span>></span></ul></nav><h1 class=post-title>HBase</h1><div class=post-description></div><div class=post-meta><span title='2023-08-22 00:00:00 +0000 UTC'>2023-08-22</span>&nbsp;Â·&nbsp;3 åˆ†é’Ÿ&nbsp;Â·&nbsp;xkj
&nbsp;|&nbsp;åˆ†ç±»: &nbsp;<ul class=post-categories-meta><a href=https://xiaokunji.github.io/zh/categories/hadoop%E7%94%9F%E6%80%81%E5%9C%88/>Hadoopç”Ÿæ€åœˆ</a></ul><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<span id=busuanzi_container_page_pv>&nbsp;| è®¿é—®: <span id=busuanzi_value_page_pv></span></span>
<script src=https://cdn.staticfile.org/twikoo//twikoo.all.min.js></script><script>let url=document.documentURI,dnsUrl="https://xiaokunji.github.io/",urlSplit=url.split(dnsUrl),finalUrl=urlSplit[1];finalUrl[0]!=="/"&&(finalUrl="/"+finalUrl),twikoo.getCommentsCount({envId:null,region:null,urls:[finalUrl],includeReply:!1}).then(function(e){let t=e[0].count;const n=document.getElementById("comment_count");n.innerText=t}).catch(function(e){console.error(e)})</script>&nbsp;| è¯„è®º: &nbsp; <span id=comment_count></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#1-%e4%b8%ba%e4%bd%95hbase%e9%80%9f%e5%ba%a6%e5%be%88%e5%bf%ab aria-label="1. ä¸ºä½•HBaseé€Ÿåº¦å¾ˆå¿«ï¼Ÿ"><strong>1. ä¸ºä½•HBaseé€Ÿåº¦å¾ˆå¿«ï¼Ÿ</strong></a></li><li><a href=#2-hbase-%e5%ae%9e%e6%97%b6%e6%9f%a5%e8%af%a2%e7%9a%84%e5%8e%9f%e7%90%86 aria-label="2. hbase å®æ—¶æŸ¥è¯¢çš„åŸç†"><strong>2. hbase å®æ—¶æŸ¥è¯¢çš„åŸç†</strong></a></li><li><a href=#3-%e5%88%97%e7%b0%87%e6%80%8e%e4%b9%88%e5%88%9b%e5%bb%ba%e6%af%94%e8%be%83%e5%a5%bd2 aria-label="3. åˆ—ç°‡æ€ä¹ˆåˆ›å»ºæ¯”è¾ƒå¥½ï¼Ÿ(&amp;lt;=2)"><strong>3. åˆ—ç°‡æ€ä¹ˆåˆ›å»ºæ¯”è¾ƒå¥½ï¼Ÿ(&lt;=2)</strong></a></li><li><a href=#4-%e6%8f%8f%e8%bf%b0-hbase-%e4%b8%ad-scan-%e5%92%8c-get-%e7%9a%84%e5%8a%9f%e8%83%bd%e4%bb%a5%e5%8f%8a%e5%ae%9e%e7%8e%b0%e7%9a%84%e5%bc%82%e5%90%8c aria-label="4. æè¿° HBase ä¸­ scan å’Œ get çš„åŠŸèƒ½ä»¥åŠå®ç°çš„å¼‚åŒï¼Ÿ"><strong>4. æè¿° HBase ä¸­ scan å’Œ get çš„åŠŸèƒ½ä»¥åŠå®ç°çš„å¼‚åŒï¼Ÿ</strong></a></li><li><a href=#5-%e7%ae%80%e8%bf%b0-hbase-%e4%b8%ad-compact-%e7%94%a8%e9%80%94%e6%98%af%e4%bb%80%e4%b9%88%e4%bb%80%e4%b9%88%e6%97%b6%e5%80%99%e8%a7%a6%e5%8f%91%e5%88%86%e4%b8%ba%e5%93%aa%e4%b8%a4%e7%a7%8d%e6%9c%89%e4%bb%80%e4%b9%88%e5%8c%ba%e5%88%ab aria-label="5. ç®€è¿° HBase ä¸­ compact ç”¨é€”æ˜¯ä»€ä¹ˆï¼Œä»€ä¹ˆæ—¶å€™è§¦å‘ï¼Œåˆ†ä¸ºå“ªä¸¤ç§ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«?"><strong>5. ç®€è¿° HBase ä¸­ compact ç”¨é€”æ˜¯ä»€ä¹ˆï¼Œä»€ä¹ˆæ—¶å€™è§¦å‘ï¼Œåˆ†ä¸ºå“ªä¸¤ç§ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«?</strong></a></li><li><a href=#6-hbase-rowlock-%e6%9c%89%e4%bb%80%e4%b9%88%e7%94%a8 aria-label="6. HBase rowlock æœ‰ä»€ä¹ˆç”¨"><strong>6. HBase rowlock æœ‰ä»€ä¹ˆç”¨</strong></a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>[toc]</p><h1 id=1-ä¸ºä½•hbaseé€Ÿåº¦å¾ˆå¿«><strong>1. ä¸ºä½•HBaseé€Ÿåº¦å¾ˆå¿«ï¼Ÿ</strong><a hidden class=anchor aria-hidden=true href=#1-ä¸ºä½•hbaseé€Ÿåº¦å¾ˆå¿«>#</a></h1><p>HBaseèƒ½æä¾›å®æ—¶è®¡ç®—æœåŠ¡ä¸»è¦åŸå› æ˜¯ç”±å…¶æ¶æ„å’Œåº•å±‚çš„æ•°æ®ç»“æ„å†³å®šçš„ï¼Œå³ç”±LSM-Tree(Log-Structured Merge-Tree) + HTable(regionåˆ†åŒº) + Cacheå†³å®šâ€”â€”å®¢æˆ·ç«¯å¯ä»¥ç›´æ¥å®šä½åˆ°è¦æŸ¥æ•°æ®æ‰€åœ¨çš„HRegion serveræœåŠ¡å™¨ï¼Œç„¶åç›´æ¥åœ¨æœåŠ¡å™¨çš„ä¸€ä¸ªregionä¸ŠæŸ¥æ‰¾è¦åŒ¹é…çš„æ•°æ®ï¼Œå¹¶ä¸”è¿™äº›æ•°æ®éƒ¨åˆ†æ˜¯ç»è¿‡cacheç¼“å­˜çš„ã€‚</p><p><strong>HBaseçš„å†™å…¥é€Ÿåº¦å¿«</strong>æ˜¯å› ä¸ºå®ƒå…¶å®å¹¶ä¸æ˜¯çœŸçš„ç«‹å³å†™å…¥æ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯å…ˆå†™å…¥å†…å­˜ï¼Œéšåå¼‚æ­¥åˆ·å…¥HFileã€‚æ‰€ä»¥åœ¨å®¢æˆ·ç«¯çœ‹æ¥ï¼Œå†™å…¥é€Ÿåº¦å¾ˆå¿«ã€‚å¦å¤–ï¼Œå†™å…¥æ—¶å€™å°†éšæœºå†™å…¥è½¬æ¢æˆé¡ºåºå†™ï¼Œæ•°æ®å†™å…¥é€Ÿåº¦ä¹Ÿå¾ˆç¨³å®šã€‚</p><p><strong>è¯»å–é€Ÿåº¦å¿«</strong>æ˜¯å› ä¸ºå®ƒä½¿ç”¨äº†LSMæ ‘å‹ç»“æ„ï¼Œè€Œä¸æ˜¯Bæˆ–B+æ ‘.HBaseçš„å­˜å‚¨ç»“æ„å¯¼è‡´å®ƒéœ€è¦ç£ç›˜å¯»é“æ—¶é—´åœ¨å¯é¢„æµ‹èŒƒå›´å†…ï¼Œå¹¶ä¸”è¯»å–ä¸æ‰€è¦æŸ¥è¯¢çš„rowkeyè¿ç»­çš„ä»»æ„æ•°é‡çš„è®°å½•éƒ½ä¸ä¼šå¼•å‘é¢å¤–çš„å¯»é“å¼€é”€ã€‚è€Œä¸”ï¼ŒHBaseè¯»å–é¦–å…ˆä¼šåœ¨ç¼“å­˜ï¼ˆBlockCacheï¼‰ä¸­æŸ¥æ‰¾ï¼Œå®ƒé‡‡ç”¨äº†LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•ï¼‰ï¼Œå¦‚æœç¼“å­˜ä¸­æ²¡æ‰¾åˆ°ï¼Œä¼šä»å†…å­˜ä¸­çš„MemStoreä¸­æŸ¥æ‰¾ï¼Œå†å»HFileæŸ¥æ‰¾</p><blockquote><p><a href=https://zhuanlan.zhihu.com/p/83233850 target=_blank rel=noopener>https://zhuanlan.zhihu.com/p/83233850</a></p></blockquote><h1 id=2-hbase-å®æ—¶æŸ¥è¯¢çš„åŸç†><strong>2. hbase å®æ—¶æŸ¥è¯¢çš„åŸç†</strong><a hidden class=anchor aria-hidden=true href=#2-hbase-å®æ—¶æŸ¥è¯¢çš„åŸç†>#</a></h1><p>ã€€ã€€ å®æ—¶æŸ¥è¯¢ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä»å†…å­˜ä¸­æŸ¥è¯¢ï¼Œä¸€èˆ¬å“åº”æ—¶é—´åœ¨ 1 ç§’å†…ã€‚ HBase çš„æœºåˆ¶æ˜¯æ•°æ®å…ˆå†™å…¥åˆ°å†…å­˜ä¸­ï¼Œå½“æ•°æ®é‡è¾¾åˆ°ä¸€å®šçš„é‡ï¼ˆå¦‚ 128Mï¼‰ï¼Œå†å†™å…¥ç£ç›˜ä¸­ï¼Œ åœ¨å†…å­˜ä¸­ï¼Œæ˜¯ä¸è¿›è¡Œæ•°æ®çš„æ›´æ–°æˆ–åˆå¹¶æ“ä½œçš„ï¼Œåªå¢åŠ æ•°æ®ï¼Œè¿™ä½¿å¾—ç”¨æˆ·çš„å†™æ“ä½œåªè¦è¿›å…¥å†…å­˜ä¸­å°±å¯ä»¥ç«‹å³è¿”å›ï¼Œä¿è¯äº† HBase I/O çš„é«˜æ€§èƒ½ã€‚</p><p>ã€€ã€€</p><h1 id=3-åˆ—ç°‡æ€ä¹ˆåˆ›å»ºæ¯”è¾ƒå¥½2><strong>3. åˆ—ç°‡æ€ä¹ˆåˆ›å»ºæ¯”è¾ƒå¥½ï¼Ÿ(&lt;=2)</strong><a hidden class=anchor aria-hidden=true href=#3-åˆ—ç°‡æ€ä¹ˆåˆ›å»ºæ¯”è¾ƒå¥½2>#</a></h1><p>rowKey æœ€å¥½è¦åˆ›å»ºæœ‰è§„åˆ™çš„ rowKeyï¼Œå³æœ€å¥½æ˜¯æœ‰åºçš„ã€‚ HBase ä¸­ä¸€å¼ è¡¨æœ€å¥½åªåˆ›å»ºä¸€åˆ°ä¸¤ä¸ªåˆ—æ—æ¯”è¾ƒå¥½ï¼Œå› ä¸º HBase ä¸èƒ½å¾ˆå¥½çš„å¤„ç†å¤šä¸ªåˆ—æ—ã€‚</p><h1 id=4-æè¿°-hbase-ä¸­-scan-å’Œ-get-çš„åŠŸèƒ½ä»¥åŠå®ç°çš„å¼‚åŒ><strong>4. æè¿° HBase ä¸­ scan å’Œ get çš„åŠŸèƒ½ä»¥åŠå®ç°çš„å¼‚åŒï¼Ÿ</strong><a hidden class=anchor aria-hidden=true href=#4-æè¿°-hbase-ä¸­-scan-å’Œ-get-çš„åŠŸèƒ½ä»¥åŠå®ç°çš„å¼‚åŒ>#</a></h1><p>HBase çš„æŸ¥è¯¢å®ç°åªæä¾›ä¸¤ç§æ–¹å¼ï¼š</p><ol><li><p>æŒ‰æŒ‡å®š RowKey è·å–å”¯ä¸€ä¸€æ¡è®°å½•ï¼Œget æ–¹æ³•ï¼ˆorg.apache.hadoop.hbase.client.Getï¼‰Get çš„æ–¹æ³•å¤„ç†åˆ†ä¸¤ç§ : è®¾ç½®äº† ClosestRowBefore å’Œæ²¡æœ‰è®¾ç½® ClosestRowBefore çš„rowlockã€‚ä¸»è¦æ˜¯ç”¨æ¥ä¿è¯è¡Œçš„äº‹åŠ¡æ€§ï¼Œå³æ¯ä¸ª get æ˜¯ä»¥ä¸€ä¸ª row æ¥æ ‡è®°çš„ã€‚ä¸€ä¸ª row ä¸­å¯ä»¥æœ‰å¾ˆå¤š family å’Œ columnã€‚</p></li><li><p>æŒ‰æŒ‡å®šçš„æ¡ä»¶è·å–ä¸€æ‰¹è®°å½•ï¼Œscan æ–¹æ³•(org.apache.Hadoop.hbase.client.Scanï¼‰å®ç°æ¡ä»¶æŸ¥è¯¢åŠŸèƒ½ä½¿ç”¨çš„å°±æ˜¯ scan æ–¹å¼ã€‚</p></li></ol><blockquote><p>åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/shujuelin/article/details/89035272</p></blockquote><h1 id=5-ç®€è¿°-hbase-ä¸­-compact-ç”¨é€”æ˜¯ä»€ä¹ˆä»€ä¹ˆæ—¶å€™è§¦å‘åˆ†ä¸ºå“ªä¸¤ç§æœ‰ä»€ä¹ˆåŒºåˆ«><strong>5. ç®€è¿° HBase ä¸­ compact ç”¨é€”æ˜¯ä»€ä¹ˆï¼Œä»€ä¹ˆæ—¶å€™è§¦å‘ï¼Œåˆ†ä¸ºå“ªä¸¤ç§ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«?</strong><a hidden class=anchor aria-hidden=true href=#5-ç®€è¿°-hbase-ä¸­-compact-ç”¨é€”æ˜¯ä»€ä¹ˆä»€ä¹ˆæ—¶å€™è§¦å‘åˆ†ä¸ºå“ªä¸¤ç§æœ‰ä»€ä¹ˆåŒºåˆ«>#</a></h1><p>åœ¨ hbase ä¸­æ¯å½“æœ‰ memstore æ•°æ® flush åˆ°ç£ç›˜ä¹‹åï¼Œå°±å½¢æˆä¸€ä¸ª storefileï¼Œå½“ storeFileçš„æ•°é‡è¾¾åˆ°ä¸€å®šç¨‹åº¦åï¼Œå°±éœ€è¦å°† storefile æ–‡ä»¶æ¥è¿›è¡Œ compaction æ“ä½œã€‚</p><p>Compact çš„ä½œç”¨ï¼š</p><ul><li><p>åˆå¹¶æ–‡ä»¶</p></li><li><p>æ¸…é™¤è¿‡æœŸï¼Œå¤šä½™ç‰ˆæœ¬çš„æ•°æ®(åˆ é™¤çš„æ•°æ®ä¸ä¼šé©¬ä¸Šåˆ é™¤,åªä¼šè¢«æ ‡è®°éœ€è¦åˆ é™¤)</p></li><li><p>æé«˜è¯»å†™æ•°æ®çš„æ•ˆç‡</p></li></ul><p>HBase ä¸­å®ç°äº†ä¸¤ç§ compaction çš„æ–¹å¼ï¼šminor and major. è¿™ä¸¤ç§ compaction æ–¹å¼çš„</p><p>åŒºåˆ«æ˜¯ï¼š</p><ol><li><p>Minor æ“ä½œåªç”¨æ¥åšéƒ¨åˆ†æ–‡ä»¶çš„åˆå¹¶æ“ä½œä»¥åŠåŒ…æ‹¬ minVersion=0 å¹¶ä¸”è®¾ç½® ttl çš„è¿‡æœŸç‰ˆæœ¬æ¸…ç†ï¼Œä¸åšä»»ä½•åˆ é™¤æ•°æ®ã€å¤šç‰ˆæœ¬æ•°æ®çš„æ¸…ç†å·¥ä½œã€‚</p></li><li><p>Major æ“ä½œæ˜¯å¯¹ Region ä¸‹çš„ HStore ä¸‹çš„æ‰€æœ‰ StoreFile æ‰§è¡Œåˆå¹¶æ“ä½œï¼Œæœ€ç»ˆçš„ç»“æœæ˜¯æ•´ç†åˆå¹¶å‡ºä¸€ä¸ªæ–‡ä»¶ã€‚</p></li></ol><p>éœ€è¦æ³¨æ„çš„æ˜¯ major åˆå¹¶çš„æ—¶å€™ï¼Œåªä¼šå¯¹ä¸€ä¸ªåˆ—æ—çš„ HFile è¿›è¡Œåˆå¹¶ã€‚</p><blockquote><p>åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/shujuelin/article/details/89035272</p></blockquote><h1 id=6-hbase-rowlock-æœ‰ä»€ä¹ˆç”¨><strong>6. HBase rowlock æœ‰ä»€ä¹ˆç”¨</strong><a hidden class=anchor aria-hidden=true href=#6-hbase-rowlock-æœ‰ä»€ä¹ˆç”¨>#</a></h1><p>åœ¨åˆå§‹åŒ– Put å¯¹è±¡çš„æ—¶å€™ï¼Œå¦‚æœéœ€è¦é¢‘ç¹åœ°é‡å¤ä¿®æ”¹æŸäº›è¡Œï¼ˆåŠ é”ï¼‰ï¼Œç”¨æˆ·æœ‰å¿…è¦åˆ›å»ºä¸€ä¸ª RowLock å®ä¾‹æ¥é˜²æ­¢å…¶ä»–å®¢æˆ·ç«¯è®¿é—®è¿™äº›è¡Œã€‚</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://xiaokunji.github.io/zh/tags/%E9%9D%A2%E8%AF%95/>é¢è¯•</a></li><li><a href=https://xiaokunji.github.io/zh/tags/hadoop%E7%94%9F%E6%80%81%E5%9C%88/>Hadoopç”Ÿæ€åœˆ</a></li></ul><nav class=paginav><a class=prev href=https://xiaokunji.github.io/zh/%E7%BB%BC%E5%90%88/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/git%E6%8B%93%E5%B1%95/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>gitæ‹“å±•</span></a>
<a class=next href=https://xiaokunji.github.io/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/hadoop/hdfs/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>HDFS</span></a></nav></footer></article></main><footer class=footer><span>Copyright
&copy;
-2023
<a href=https://xiaokunji.github.io/zh/ style=color:#939393>ç±³äºŒ</a>
All Rights Reserved</span>
<span id=busuanzi_container><span class="fa fa-user">ç”¨æˆ·æ•°:</span><span id=busuanzi_value_site_uv></span>
<span class="fa fa-eye">è®¿é—®æ•°:</span><span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="å¤åˆ¶";function s(){t.innerHTML="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerHTML="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>