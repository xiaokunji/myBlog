<!DOCTYPE html>
<html dir="auto" lang="zh"><head><meta charset="utf-8"/><meta content="IE=edge" http-equiv="x-ua-compatible"/><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name="viewport"/><meta content="index, follow" name="robots"/><title>spark | ç±³äºŒ</title><meta content=" **1. spark shuffleè¿‡ç¨‹**, **2. spark streaming è¯»å–kafkaæ•°æ®çš„ä¸¤ç§æ–¹å¼**, 3. Sparkæä¾›çš„ä¸¤ç§å…±äº«å˜é‡, **4.** **è§£é‡Šä¸€ä¸‹Spark Masterçš„é€‰ä¸¾è¿‡ç¨‹**, **5.** **Spark Streamingå°æ–‡ä»¶é—®é¢˜**" name="keywords"/><meta content="     " name="description"/><meta content="xkj" name="author"/><link href="https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/%E9%9D%A2%E8%AF%95/spark.html" rel="canonical"/><link as="style" crossorigin="anonymous" href="/assets/css/stylesheet.dc6bd2c841ee388e899e13872ae986c0e847e8b957d6714ad6ddc628ef2d17ff.css" integrity="sha256-3GvSyEHuOI6JnhOHKumGwOhH6LlX1nFK1t3GKO8tF/8=" rel="preload stylesheet"/><script crossorigin="anonymous" defer="" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload="hljs.initHighlightingOnLoad()" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js"></script>
<link href="https://xiaokunji.com/img/Q.svg" rel="icon"/><link href="https://xiaokunji.com/img/Q.svg" rel="icon" sizes="16x16" type="image/png"/><link href="https://xiaokunji.com/img/Q.svg" rel="icon" sizes="32x32" type="image/png"/><link href="https://xiaokunji.com/Q.svg" rel="apple-touch-icon"/><link href="https://xiaokunji.com/Q.svg" rel="mask-icon"/><meta content="#2e2e33" name="theme-color"/><meta content="#2e2e33" name="msapplication-TileColor"/><link href="https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/%E9%9D%A2%E8%AF%95/spark.html" hreflang="zh" rel="alternate"/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta content="spark" property="og:title"/><meta content="     " property="og:description"/><meta content="article" property="og:type"/><meta content="https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/%E9%9D%A2%E8%AF%95/spark.html" property="og:url"/><meta content="hadoopç”Ÿæ€åœˆ" property="article:section"/><meta content="2023-08-22T00:00:00+00:00" property="article:published_time"/><meta content="2023-08-29T00:59:17+08:00" property="article:modified_time"/><meta content="summary" name="twitter:card"/><meta content="spark" name="twitter:title"/><meta content="     " name="twitter:description"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":4,"name":"spark","item":"https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/%E9%9D%A2%E8%AF%95/spark.html"}]}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"spark","name":"spark","description":"     ","keywords":[" **1. spark shuffleè¿‡ç¨‹**"," **2. spark streaming è¯»å–kafkaæ•°æ®çš„ä¸¤ç§æ–¹å¼**"," 3. Sparkæä¾›çš„ä¸¤ç§å…±äº«å˜é‡"," **4.** **è§£é‡Šä¸€ä¸‹Spark Masterçš„é€‰ä¸¾è¿‡ç¨‹**"," **5.** **Spark Streamingå°æ–‡ä»¶é—®é¢˜**"],"articleBody":"[toc]\n1. spark shuffleè¿‡ç¨‹ sparkä¸­ç®¡ç†shuffleçš„è¿‡ç¨‹æœ‰ä¸€ä¸ªshuffleManageè´Ÿè´£ç®¡ç†, åœ¨spark 2.X ä¹‹å,ä¸»è¦è´Ÿè´£çš„æ˜¯sortshufflemanager, å…¶ä¸­ä¸»è¦çš„æ˜¯sortshuffle,shuffleåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ,shufflewriterå’Œshuffleread\na) map task çš„è®¡ç®—ç»“æœä¼šå†™å…¥åˆ°ä¸€ä¸ªå†…å­˜æ•°æ®ç»“æ„é‡Œé¢ï¼Œå†…å­˜æ•°æ®ç»“æ„é»˜è®¤æ˜¯5M\nb) åœ¨shuffleçš„æ—¶å€™ä¼šæœ‰ä¸€ä¸ªå®šæ—¶å™¨ï¼Œä¸å®šæœŸçš„å»ä¼°ç®—è¿™ä¸ªå†…å­˜ç»“æ„çš„å¤§å°ï¼Œå½“å†…å­˜ç»“æ„ä¸­çš„æ•°æ®è¶…è¿‡5Mæ—¶ï¼Œæ¯”å¦‚ç°åœ¨å†…å­˜ç»“æ„ä¸­çš„æ•°æ®ä¸º5.01Mï¼Œé‚£ä¹ˆä»–ä¼šç”³è¯·5.01*2-5=5.02Må†…å­˜ç»™å†…å­˜æ•°æ®ç»“æ„ã€‚\nc) å¦‚æœç”³è¯·æˆåŠŸä¸ä¼šè¿›è¡Œæº¢å†™ï¼Œå¦‚æœç”³è¯·ä¸æˆåŠŸï¼Œè¿™æ—¶å€™ä¼šå‘ç”Ÿæº¢å†™ç£ç›˜ã€‚\nd) åœ¨æº¢å†™ä¹‹å‰å†…å­˜ç»“æ„ä¸­çš„æ•°æ®ä¼šè¿›è¡Œæ’åºåˆ†åŒº\ne) ç„¶åå¼€å§‹æº¢å†™ç£ç›˜ï¼Œå†™ç£ç›˜æ˜¯ä»¥batchçš„å½¢å¼å»å†™ï¼Œä¸€ä¸ªbatchæ˜¯1ä¸‡æ¡æ•°æ®ï¼Œ\nf) map taskæ‰§è¡Œå®Œæˆåï¼Œä¼šå°†è¿™äº›ç£ç›˜å°æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªå¤§çš„ç£ç›˜æ–‡ä»¶ï¼ŒåŒæ—¶ç”Ÿæˆä¸€ä¸ªç´¢å¼•æ–‡ä»¶ã€‚\ng) reduce taskå»mapç«¯æ‹‰å–æ•°æ®çš„æ—¶å€™ï¼Œé¦–å…ˆè§£æç´¢å¼•æ–‡ä»¶ï¼Œæ ¹æ®ç´¢å¼•æ–‡ä»¶å†å»æ‹‰å–å¯¹åº”çš„æ•°æ®ã€‚\nhttps://blog.csdn.net/qq_21835703/article/details/79104733 2. spark streaming è¯»å–kafkaæ•°æ®çš„ä¸¤ç§æ–¹å¼ è¿™ä¸¤ç§æ–¹å¼åˆ†åˆ«æ˜¯ï¼š\nReceiver-base ä½¿ç”¨Kafkaçš„é«˜å±‚æ¬¡Consumer APIæ¥å®ç°ã€‚receiverä»Kafkaä¸­è·å–çš„æ•°æ®éƒ½å­˜å‚¨åœ¨Spark Executorçš„å†…å­˜ä¸­ï¼Œç„¶åSpark Streamingå¯åŠ¨çš„jobä¼šå»å¤„ç†é‚£äº›æ•°æ®ã€‚ç„¶è€Œï¼Œåœ¨é»˜è®¤çš„é…ç½®ä¸‹ï¼Œè¿™ç§æ–¹å¼å¯èƒ½ä¼šå› ä¸ºåº•å±‚çš„å¤±è´¥è€Œä¸¢å¤±æ•°æ®ã€‚å¦‚æœè¦å¯ç”¨é«˜å¯é æœºåˆ¶ï¼Œè®©æ•°æ®é›¶ä¸¢å¤±ï¼Œå°±å¿…é¡»å¯ç”¨Spark Streamingçš„é¢„å†™æ—¥å¿—æœºåˆ¶ï¼ˆWrite Ahead Logï¼ŒWALï¼‰ã€‚è¯¥æœºåˆ¶ä¼šåŒæ­¥åœ°å°†æ¥æ”¶åˆ°çš„Kafkaæ•°æ®å†™å…¥åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ˆæ¯”å¦‚HDFSï¼‰ä¸Šçš„é¢„å†™æ—¥å¿—ä¸­ã€‚æ‰€ä»¥ï¼Œå³ä½¿åº•å±‚èŠ‚ç‚¹å‡ºç°äº†å¤±è´¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é¢„å†™æ—¥å¿—ä¸­çš„æ•°æ®è¿›è¡Œæ¢å¤ã€‚\nDirect Spark1.3ä¸­å¼•å…¥Directæ–¹å¼ï¼Œç”¨æ¥æ›¿ä»£æ‰ä½¿ç”¨Receiveræ¥æ”¶æ•°æ®ï¼Œè¿™ç§æ–¹å¼ä¼šå‘¨æœŸæ€§åœ°æŸ¥è¯¢Kafkaï¼Œè·å¾—æ¯ä¸ªtopic+partitionçš„æœ€æ–°çš„offsetï¼Œä»è€Œå®šä¹‰æ¯ä¸ªbatchçš„offsetçš„èŒƒå›´ã€‚å½“å¤„ç†æ•°æ®çš„jobå¯åŠ¨æ—¶ï¼Œå°±ä¼šä½¿ç”¨Kafkaçš„ç®€å•consumer apiæ¥è·å–KafkaæŒ‡å®šoffsetèŒƒå›´çš„æ•°æ®ã€‚(ä½¿ç”¨æ¯”receivedæ›´åº•å±‚çš„api)\n3. Sparkæä¾›çš„ä¸¤ç§å…±äº«å˜é‡ Spark ç¨‹åºçš„å¤§éƒ¨åˆ†æ“ä½œéƒ½æ˜¯ RDD æ“ä½œï¼Œé€šè¿‡ä¼ å…¥å‡½æ•°ç»™ RDD æ“ä½œå‡½æ•°æ¥è®¡ç®—ï¼Œè¿™äº›å‡½æ•°åœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šå¹¶å‘æ‰§è¡Œï¼Œå†…éƒ¨çš„å˜é‡æœ‰ä¸åŒçš„ä½œç”¨åŸŸï¼Œä¸èƒ½ç›¸äº’è®¿é—®ï¼Œæœ‰äº›æƒ…å†µä¸‹ä¸å¤ªæ–¹ä¾¿ã€‚\nå¹¿æ’­å˜é‡ï¼Œæ˜¯ä¸€ä¸ªåªè¯»å¯¹è±¡ï¼Œåœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šéƒ½æœ‰ä¸€ä»½ç¼“å­˜ï¼Œåˆ›å»ºæ–¹æ³•æ˜¯ SparkContext.broadcast()ã€‚åˆ›å»ºä¹‹åå†æ›´æ–°å®ƒçš„å€¼æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œä¸€èˆ¬ç”¨ val æ¥ä¿®æ”¹å®šä¹‰ã€‚ è®¡æ•°å™¨ï¼Œåªèƒ½å¢åŠ ï¼Œå¯ä»¥ç”¨è®¡æ•°æˆ–æ±‚å’Œï¼Œæ”¯æŒè‡ªå®šä¹‰ç±»å‹ã€‚åˆ›å»ºæ–¹æ³•æ˜¯ SparkContext.accumulator(V, name)ã€‚åªæœ‰ Driver ç¨‹åºå¯ä»¥è¯»è¿™ä¸ªè®¡ç®—å™¨çš„å˜é‡ï¼ŒRDD æ“ä½œä¸­è¯»å–è®¡æ•°å™¨å˜é‡æ˜¯æ— æ„ä¹‰çš„ã€‚ä½†èŠ‚ç‚¹å¯ä»¥å¯¹è¯¥è®¡ç®—å™¨è¿›è¡Œå¢åŠ ï¼ˆï¼Ÿï¼Ÿï¼Ÿï¼‰ ä»¥ä¸Šä¸¤ç§ç±»å‹éƒ½æ˜¯ Spark çš„å…±äº«å˜é‡ã€‚\nhttps://zhuanlan.zhihu.com/p/49169166 4. è§£é‡Šä¸€ä¸‹Spark Masterçš„é€‰ä¸¾è¿‡ç¨‹ ä¸hadoopä¸€æ ·ï¼Œsparkä¹Ÿå­˜åœ¨å•ç‚¹æ•…éšœé—®é¢˜ï¼Œä¸ºæ­¤ï¼Œsparkçš„standaloneæ¨¡å¼æä¾›äº†masterçš„HAï¼Œä¸hadoopä¸€æ ·ï¼Œä¸€ä¸ªæ˜¯activeï¼Œä¸€ä¸ªæ˜¯standbyçŠ¶æ€ï¼Œå½“activeæŒ‚äº†ï¼Œstandbyä¼šé¡¶ä¸Šã€‚\nspark HAçš„ä¸»å¤‡åˆ‡æ¢ä¸»è¦åŸºäºä¸¤ç§æœºåˆ¶ï¼š\nåŸºäºæ–‡ä»¶ç³»ç»Ÿ\nåŸºäºzké›†ç¾¤ã€‚\nå‰è€…åœ¨æŒ‚äº†åéœ€è¦æ‰‹åŠ¨åˆ‡æ¢ï¼Œè€ŒåŸºäºzkçš„HAå¯ä»¥è‡ªåŠ¨å®ç°åˆ‡æ¢ã€‚ç­–ç•¥å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶spark-env.shé…ç½®spark.deploy.recoveryMode\nåˆ‡æ¢çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š\né¦–å…ˆï¼Œstandbyçš„masterå»è¯»å–æŒä¹…åŒ–ï¼ˆå¯èƒ½æ˜¯ç£ç›˜æˆ–è€…zkï¼‰çš„storedAPPï¼Œstoreddriverï¼Œstoredworkerçš„ç›¸å…³ä¿¡æ¯ã€‚è¯»å–åï¼Œå¦‚æœstoredAPPï¼Œstoreddriverï¼Œstoredworkeræœ‰ä»»ä½•ä¸€ä¸ªéç©ºï¼Œé‚£ä¹ˆå°±ä¼šå¯åŠ¨masteræ¢å¤æœºåˆ¶ï¼Œå°†æŒä¹…åŒ–çš„APPï¼Œdriverï¼Œworkerä¿¡æ¯é‡æ–°æ³¨å†Œåˆ°å†…å­˜ä¸­ï¼Œå°†applicationå’Œworkerçš„çŠ¶æ€ä¿®æ”¹ä¸ºUNknownï¼Œç„¶åå‘è¯¥APPå¯¹åº”çš„driverï¼Œworerå‘é€è‡ªå·±çš„åœ°å€ä¿¡æ¯ï¼Œdriverï¼Œworerå¦‚æœæ²¡æœ‰æŒ‚ï¼Œé‚£ä¹ˆåœ¨æ¥æ”¶åˆ°masterå‘é€çš„åœ°å€åï¼Œå°±ä¼šè¿”å›å“åº”æ¶ˆæ¯ç»™æ–°çš„masterã€‚æ­¤æ—¶ï¼Œmasteråœ¨æ¥æ”¶åˆ°driverï¼Œworkerçš„æ¶ˆæ¯åï¼Œä¼šä½¿ç”¨completeRecoryå¯¹æ²¡æœ‰å“åº”çš„ç»„ä»¶è¿›è¡Œæ¸…ç†ï¼Œæœ€åè°ƒç”¨masterçš„schedulæ–¹æ³•ï¼Œå¯¹æ­£åœ¨ç­‰å¾…çš„driverå’Œappè°ƒåº¦ï¼Œå¦‚å¯åŠ¨executorã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/englishsname/article/details/50631372\nhttps://blog.csdn.net/zhanglh046/article/details/78485745 5. Spark Streamingå°æ–‡ä»¶é—®é¢˜ â€‹\tä½¿ç”¨ Spark Streaming æ—¶ï¼Œå¦‚æœå®æ—¶è®¡ç®—ç»“æœè¦å†™å…¥åˆ° HDFSï¼Œé‚£ä¹ˆä¸å¯é¿å…çš„ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯åœ¨é»˜è®¤æƒ…å†µä¸‹ä¼šäº§ç”Ÿéå¸¸å¤šçš„å°æ–‡ä»¶ï¼Œè¿™æ˜¯ç”± Spark Streaming çš„å¾®æ‰¹å¤„ç†æ¨¡å¼å’Œ DStream(RDD) çš„åˆ†å¸ƒå¼(partition)ç‰¹æ€§å¯¼è‡´çš„ï¼ŒSpark Streaming ä¸ºæ¯ä¸ª Partition å¯åŠ¨ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ï¼ˆä¸€ä¸ª task/partition ä¸€ä¸ªçº¿ç¨‹ï¼‰æ¥å¤„ç†æ•°æ®ï¼Œä¸€æ—¦æ–‡ä»¶è¾“å‡ºåˆ° HDFSï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶æµå°±å…³é—­äº†.\nå¤„ç† Spark Streaming å°æ–‡ä»¶çš„å…¸å‹æ–¹æ³•(å¤§è‡´å¦‚ä¸‹):\nå¢åŠ  batch å¤§å°\nCoalesceå¤§æ³•å¥½ , å°æ–‡ä»¶çš„åŸºæ•°æ˜¯ batch_number * partition_number, æ‰€ä»¥å°±æ˜¯åˆå¹¶åˆ†åŒºæ•°\nSpark Streaming å¤–éƒ¨æ¥å¤„ç†: ç”¨ Hive æˆ–è€… Spark Sql è¿™æ ·çš„â€œsql on hadoopâ€ç³»ç»Ÿç±»è¿›ä¸€æ­¥è¿›è¡Œæ•°æ®åˆ†æï¼Œè€Œè¿™äº›è¡¨ä¸€èˆ¬éƒ½æ˜¯æŒ‰ç…§åŠå°æ—¶æˆ–è€…ä¸€å°æ—¶ã€ä¸€å¤©\nè‡ªå·±è°ƒç”¨ foreach å» append, å†™å…¥æ–‡ä»¶æ—¶,ä¸è¦æ–°å»º,è€Œæ˜¯è¿½åŠ å·²æœ‰çš„\nhttps://zhuanlan.zhihu.com/p/49169166 ","wordCount":"2263","inLanguage":"zh","datePublished":"2023-08-22T00:00:00Z","dateModified":"2023-08-29T00:59:17+08:00","author":{"@type":"Person","name":"xkj"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/%E9%9D%A2%E8%AF%95/spark.html"},"publisher":{"@type":"Organization","name":"ç±³äºŒ","logo":{"@type":"ImageObject","url":"https://xiaokunji.com/img/Q.svg"}}}</script></head><body class="dark" id="top"><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class="header"><nav class="nav"><div class="logo"><a accesskey="h" href="https://xiaokunji.com/zh/" title="ç±³äºŒ (Alt + H)"><img alt="" aria-label="logo" height="35" src="https://xiaokunji.com/img/Q.svg"/>ç±³äºŒ</a><div class="logo-switches"><button accesskey="t" id="theme-toggle" title="(Alt + T)"><svg fill="none" height="18" id="moon" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path></svg><svg fill="none" height="18" id="sun" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="5"></circle><line x1="12" x2="12" y1="1" y2="3"></line><line x1="12" x2="12" y1="21" y2="23"></line><line x1="4.22" x2="5.64" y1="4.22" y2="5.64"></line><line x1="18.36" x2="19.78" y1="18.36" y2="19.78"></line><line x1="1" x2="3" y1="12" y2="12"></line><line x1="21" x2="23" y1="12" y2="12"></line><line x1="4.22" x2="5.64" y1="19.78" y2="18.36"></line><line x1="18.36" x2="19.78" y1="5.64" y2="4.22"></line></svg></button><ul class="lang-switch"><li>|</li><li><a aria-label="English" href="https://xiaokunji.com/en/" title="English">English</a></li></ul></div></div><ul id="menu"><li><a href="https://xiaokunji.com/zh/" title="ğŸ ä¸»é¡µ"><span>ğŸ ä¸»é¡µ</span></a></li><li><a accesskey="/" href="https://xiaokunji.com/zh/search" title="ğŸ”æœç´¢ (Alt + /)"><span>ğŸ”æœç´¢</span></a></li><li><a href="https://xiaokunji.com/zh/post.html" title="ğŸ“šæ–‡ç« "><span>ğŸ“šæ–‡ç« </span></a></li><li><a href="https://xiaokunji.com/zh/archives.html" title="â±æ—¶é—´è½´"><span>â±æ—¶é—´è½´</span></a></li><li><a href="https://xiaokunji.com/zh/tags.html" title="ğŸ”–æ ‡ç­¾"><span>ğŸ”–æ ‡ç­¾</span></a></li><li><a href="https://xiaokunji.com/zh/categories.html" title="ğŸ“–åˆ†ç±»"><span>ğŸ“–åˆ†ç±»</span></a></li><li><a href="https://xiaokunji.com/zh/links.html" title="ğŸ¤å‹é“¾"><span>ğŸ¤å‹é“¾</span></a></li></ul></nav></header><main class="main"><article class="post-single"><header class="post-header"><nav aria-label="breadcrumb"><ul><a href="https://xiaokunji.com/zh/">ğŸ </a> <span>&gt;</span>
<a href="https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88.html">hadoopç”Ÿæ€åœˆ</a> <span>&gt;</span>
<a href="https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/%E9%9D%A2%E8%AF%95.html">é¢è¯•</a> <span>&gt;</span></ul></nav><h1 class="post-title">spark</h1><div class="post-description"></div><div class="post-meta">åˆ›å»º:Â <span title="2023-08-22 00:00:00 +0000 UTC">2023-08-22</span>Â Â·Â æ›´æ–°:Â 2023-08-29Â Â·Â xkj
Â |Â åˆ†ç±»: Â <ul class="post-categories-meta" style="display:inline"><a href="https://xiaokunji.com/zh/categories/Hadoop%E7%94%9F%E6%80%81%E5%9C%88.html">Hadoopç”Ÿæ€åœˆ</a></ul><span id="busuanzi_container_page_pv">Â | è®¿é—®: <span id="busuanzi_value_page_pv">1</span></span></div></header><aside class="toc-container wide" id="toc-container"><div class="toc"><details open=""><summary accesskey="c" title="(Alt + C)"><span class="details">ç›®å½•</span></summary><div class="inner"><ul><li><a aria-label="1. spark shuffleè¿‡ç¨‹" href="#1-spark-shuffle%e8%bf%87%e7%a8%8b"><strong>1. spark shuffleè¿‡ç¨‹</strong></a></li><li><a aria-label="2. spark streaming è¯»å–kafkaæ•°æ®çš„ä¸¤ç§æ–¹å¼" href="#2-spark-streaming-%e8%af%bb%e5%8f%96kafka%e6%95%b0%e6%8d%ae%e7%9a%84%e4%b8%a4%e7%a7%8d%e6%96%b9%e5%bc%8f"><strong>2. spark streaming è¯»å–kafkaæ•°æ®çš„ä¸¤ç§æ–¹å¼</strong></a></li><li><a aria-label="3. Sparkæä¾›çš„ä¸¤ç§å…±äº«å˜é‡" href="#3-spark%e6%8f%90%e4%be%9b%e7%9a%84%e4%b8%a4%e7%a7%8d%e5%85%b1%e4%ba%ab%e5%8f%98%e9%87%8f">3. Sparkæä¾›çš„ä¸¤ç§å…±äº«å˜é‡</a></li><li><a aria-label="4. è§£é‡Šä¸€ä¸‹Spark Masterçš„é€‰ä¸¾è¿‡ç¨‹" href="#4-%e8%a7%a3%e9%87%8a%e4%b8%80%e4%b8%8bspark-master%e7%9a%84%e9%80%89%e4%b8%be%e8%bf%87%e7%a8%8b"><strong>4.</strong> <strong>è§£é‡Šä¸€ä¸‹Spark Masterçš„é€‰ä¸¾è¿‡ç¨‹</strong></a></li><li><a aria-label="5. Spark Streamingå°æ–‡ä»¶é—®é¢˜" href="#5-spark-streaming%e5%b0%8f%e6%96%87%e4%bb%b6%e9%97%ae%e9%a2%98"><strong>5.</strong> <strong>Spark Streamingå°æ–‡ä»¶é—®é¢˜</strong></a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class="post-content"><p>[toc]</p><h1 id="1-spark-shuffleè¿‡ç¨‹"><strong>1. spark shuffleè¿‡ç¨‹</strong><a aria-hidden="true" class="anchor" hidden="" href="#1-spark-shuffleè¿‡ç¨‹">#</a></h1><p>sparkä¸­ç®¡ç†shuffleçš„è¿‡ç¨‹æœ‰ä¸€ä¸ªshuffleManageè´Ÿè´£ç®¡ç†, åœ¨spark 2.X ä¹‹å,ä¸»è¦è´Ÿè´£çš„æ˜¯sortshufflemanager, å…¶ä¸­ä¸»è¦çš„æ˜¯sortshuffle,shuffleåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ,shufflewriterå’Œshuffleread</p><p>a) map task çš„è®¡ç®—ç»“æœä¼šå†™å…¥åˆ°ä¸€ä¸ªå†…å­˜æ•°æ®ç»“æ„é‡Œé¢ï¼Œå†…å­˜æ•°æ®ç»“æ„é»˜è®¤æ˜¯5M</p><p>b) åœ¨shuffleçš„æ—¶å€™ä¼šæœ‰ä¸€ä¸ªå®šæ—¶å™¨ï¼Œä¸å®šæœŸçš„å»ä¼°ç®—è¿™ä¸ªå†…å­˜ç»“æ„çš„å¤§å°ï¼Œå½“å†…å­˜ç»“æ„ä¸­çš„æ•°æ®è¶…è¿‡5Mæ—¶ï¼Œæ¯”å¦‚ç°åœ¨å†…å­˜ç»“æ„ä¸­çš„æ•°æ®ä¸º5.01Mï¼Œé‚£ä¹ˆä»–ä¼šç”³è¯·5.01*2-5=5.02Må†…å­˜ç»™å†…å­˜æ•°æ®ç»“æ„ã€‚</p><p>c) å¦‚æœç”³è¯·æˆåŠŸä¸ä¼šè¿›è¡Œæº¢å†™ï¼Œå¦‚æœç”³è¯·ä¸æˆåŠŸï¼Œè¿™æ—¶å€™ä¼šå‘ç”Ÿæº¢å†™ç£ç›˜ã€‚</p><p>d) åœ¨æº¢å†™ä¹‹å‰å†…å­˜ç»“æ„ä¸­çš„æ•°æ®ä¼šè¿›è¡Œæ’åºåˆ†åŒº</p><p>e) ç„¶åå¼€å§‹æº¢å†™ç£ç›˜ï¼Œå†™ç£ç›˜æ˜¯ä»¥batchçš„å½¢å¼å»å†™ï¼Œä¸€ä¸ªbatchæ˜¯1ä¸‡æ¡æ•°æ®ï¼Œ</p><p>f) map taskæ‰§è¡Œå®Œæˆåï¼Œä¼šå°†è¿™äº›ç£ç›˜å°æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªå¤§çš„ç£ç›˜æ–‡ä»¶ï¼ŒåŒæ—¶ç”Ÿæˆä¸€ä¸ªç´¢å¼•æ–‡ä»¶ã€‚</p><p>g) reduce taskå»mapç«¯æ‹‰å–æ•°æ®çš„æ—¶å€™ï¼Œé¦–å…ˆè§£æç´¢å¼•æ–‡ä»¶ï¼Œæ ¹æ®ç´¢å¼•æ–‡ä»¶å†å»æ‹‰å–å¯¹åº”çš„æ•°æ®ã€‚</p><blockquote><p><a href="https://blog.csdn.net/qq_21835703/article/details/79104733" rel="noopener" target="_blank">https://blog.csdn.net/qq_21835703/article/details/79104733</a></p></blockquote><h1 id="2-spark-streaming-è¯»å–kafkaæ•°æ®çš„ä¸¤ç§æ–¹å¼"><strong>2. spark streaming è¯»å–kafkaæ•°æ®çš„ä¸¤ç§æ–¹å¼</strong><a aria-hidden="true" class="anchor" hidden="" href="#2-spark-streaming-è¯»å–kafkaæ•°æ®çš„ä¸¤ç§æ–¹å¼">#</a></h1><p>è¿™ä¸¤ç§æ–¹å¼åˆ†åˆ«æ˜¯ï¼š</p><ol><li><strong>Receiver-base</strong></li></ol><p>ä½¿ç”¨Kafkaçš„é«˜å±‚æ¬¡Consumer APIæ¥å®ç°ã€‚receiverä»Kafkaä¸­è·å–çš„æ•°æ®éƒ½å­˜å‚¨åœ¨Spark Executorçš„å†…å­˜ä¸­ï¼Œç„¶åSpark Streamingå¯åŠ¨çš„jobä¼šå»å¤„ç†é‚£äº›æ•°æ®ã€‚ç„¶è€Œï¼Œåœ¨é»˜è®¤çš„é…ç½®ä¸‹ï¼Œè¿™ç§æ–¹å¼å¯èƒ½ä¼šå› ä¸ºåº•å±‚çš„å¤±è´¥è€Œä¸¢å¤±æ•°æ®ã€‚å¦‚æœè¦å¯ç”¨é«˜å¯é æœºåˆ¶ï¼Œè®©æ•°æ®é›¶ä¸¢å¤±ï¼Œå°±å¿…é¡»å¯ç”¨Spark Streamingçš„é¢„å†™æ—¥å¿—æœºåˆ¶ï¼ˆWrite Ahead Logï¼ŒWALï¼‰ã€‚è¯¥æœºåˆ¶ä¼šåŒæ­¥åœ°å°†æ¥æ”¶åˆ°çš„Kafkaæ•°æ®å†™å…¥åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ˆæ¯”å¦‚HDFSï¼‰ä¸Šçš„é¢„å†™æ—¥å¿—ä¸­ã€‚æ‰€ä»¥ï¼Œå³ä½¿åº•å±‚èŠ‚ç‚¹å‡ºç°äº†å¤±è´¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é¢„å†™æ—¥å¿—ä¸­çš„æ•°æ®è¿›è¡Œæ¢å¤ã€‚</p><ol start="2"><li><strong>Direct</strong></li></ol><p>Spark1.3ä¸­å¼•å…¥Directæ–¹å¼ï¼Œç”¨æ¥æ›¿ä»£æ‰ä½¿ç”¨Receiveræ¥æ”¶æ•°æ®ï¼Œè¿™ç§æ–¹å¼ä¼šå‘¨æœŸæ€§åœ°æŸ¥è¯¢Kafkaï¼Œè·å¾—æ¯ä¸ªtopic+partitionçš„æœ€æ–°çš„offsetï¼Œä»è€Œå®šä¹‰æ¯ä¸ªbatchçš„offsetçš„èŒƒå›´ã€‚å½“å¤„ç†æ•°æ®çš„jobå¯åŠ¨æ—¶ï¼Œå°±ä¼šä½¿ç”¨Kafkaçš„ç®€å•consumer apiæ¥è·å–KafkaæŒ‡å®šoffsetèŒƒå›´çš„æ•°æ®ã€‚(ä½¿ç”¨æ¯”receivedæ›´åº•å±‚çš„api)</p><h1 id="3-sparkæä¾›çš„ä¸¤ç§å…±äº«å˜é‡">3. Sparkæä¾›çš„ä¸¤ç§å…±äº«å˜é‡<a aria-hidden="true" class="anchor" hidden="" href="#3-sparkæä¾›çš„ä¸¤ç§å…±äº«å˜é‡">#</a></h1><p>Spark ç¨‹åºçš„å¤§éƒ¨åˆ†æ“ä½œéƒ½æ˜¯ RDD æ“ä½œï¼Œé€šè¿‡ä¼ å…¥å‡½æ•°ç»™ RDD æ“ä½œå‡½æ•°æ¥è®¡ç®—ï¼Œè¿™äº›å‡½æ•°åœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šå¹¶å‘æ‰§è¡Œï¼Œå†…éƒ¨çš„å˜é‡æœ‰ä¸åŒçš„ä½œç”¨åŸŸï¼Œä¸èƒ½ç›¸äº’è®¿é—®ï¼Œæœ‰äº›æƒ…å†µä¸‹ä¸å¤ªæ–¹ä¾¿ã€‚</p><ol><li>å¹¿æ’­å˜é‡ï¼Œ<strong>æ˜¯ä¸€ä¸ªåªè¯»å¯¹è±¡</strong>ï¼Œåœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šéƒ½æœ‰ä¸€ä»½ç¼“å­˜ï¼Œåˆ›å»ºæ–¹æ³•æ˜¯ SparkContext.broadcast()ã€‚åˆ›å»ºä¹‹åå†æ›´æ–°å®ƒçš„å€¼æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œä¸€èˆ¬ç”¨ val æ¥ä¿®æ”¹å®šä¹‰ã€‚</li><li>è®¡æ•°å™¨ï¼Œ<strong>åªèƒ½å¢åŠ ï¼Œå¯ä»¥ç”¨è®¡æ•°æˆ–æ±‚å’Œï¼Œæ”¯æŒè‡ªå®šä¹‰ç±»å‹</strong>ã€‚åˆ›å»ºæ–¹æ³•æ˜¯ SparkContext.accumulator(V, name)ã€‚åªæœ‰ Driver ç¨‹åºå¯ä»¥è¯»è¿™ä¸ªè®¡ç®—å™¨çš„å˜é‡ï¼ŒRDD æ“ä½œä¸­è¯»å–è®¡æ•°å™¨å˜é‡æ˜¯æ— æ„ä¹‰çš„ã€‚ä½†èŠ‚ç‚¹å¯ä»¥å¯¹è¯¥è®¡ç®—å™¨è¿›è¡Œå¢åŠ ï¼ˆï¼Ÿï¼Ÿï¼Ÿï¼‰</li></ol><p>ä»¥ä¸Šä¸¤ç§ç±»å‹éƒ½æ˜¯ Spark çš„å…±äº«å˜é‡ã€‚</p><blockquote><p><a href="https://zhuanlan.zhihu.com/p/49169166" rel="noopener" target="_blank">https://zhuanlan.zhihu.com/p/49169166</a></p></blockquote><h1 id="4-è§£é‡Šä¸€ä¸‹spark-masterçš„é€‰ä¸¾è¿‡ç¨‹"><strong>4.</strong> <strong>è§£é‡Šä¸€ä¸‹Spark Masterçš„é€‰ä¸¾è¿‡ç¨‹</strong><a aria-hidden="true" class="anchor" hidden="" href="#4-è§£é‡Šä¸€ä¸‹spark-masterçš„é€‰ä¸¾è¿‡ç¨‹">#</a></h1><p>ä¸hadoopä¸€æ ·ï¼Œsparkä¹Ÿå­˜åœ¨å•ç‚¹æ•…éšœé—®é¢˜ï¼Œä¸ºæ­¤ï¼Œsparkçš„standaloneæ¨¡å¼æä¾›äº†masterçš„HAï¼Œä¸hadoopä¸€æ ·ï¼Œä¸€ä¸ªæ˜¯activeï¼Œä¸€ä¸ªæ˜¯standbyçŠ¶æ€ï¼Œå½“activeæŒ‚äº†ï¼Œstandbyä¼šé¡¶ä¸Šã€‚</p><p>spark HAçš„ä¸»å¤‡åˆ‡æ¢ä¸»è¦åŸºäºä¸¤ç§æœºåˆ¶ï¼š</p><ol><li><p>åŸºäºæ–‡ä»¶ç³»ç»Ÿ</p></li><li><p>åŸºäºzké›†ç¾¤ã€‚</p></li></ol><p>å‰è€…åœ¨æŒ‚äº†åéœ€è¦æ‰‹åŠ¨åˆ‡æ¢ï¼Œè€ŒåŸºäºzkçš„HAå¯ä»¥è‡ªåŠ¨å®ç°åˆ‡æ¢ã€‚ç­–ç•¥å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶spark-env.shé…ç½®spark.deploy.recoveryMode</p><p><strong>åˆ‡æ¢çš„è¿‡ç¨‹</strong>å¦‚ä¸‹ï¼š</p><p>é¦–å…ˆï¼Œstandbyçš„masterå»è¯»å–æŒä¹…åŒ–ï¼ˆå¯èƒ½æ˜¯ç£ç›˜æˆ–è€…zkï¼‰çš„storedAPPï¼Œstoreddriverï¼Œstoredworkerçš„ç›¸å…³ä¿¡æ¯ã€‚è¯»å–åï¼Œå¦‚æœstoredAPPï¼Œstoreddriverï¼Œstoredworkeræœ‰ä»»ä½•ä¸€ä¸ªéç©ºï¼Œé‚£ä¹ˆå°±ä¼šå¯åŠ¨masteræ¢å¤æœºåˆ¶ï¼Œå°†æŒä¹…åŒ–çš„APPï¼Œdriverï¼Œworkerä¿¡æ¯é‡æ–°æ³¨å†Œåˆ°å†…å­˜ä¸­ï¼Œå°†applicationå’Œworkerçš„çŠ¶æ€ä¿®æ”¹ä¸ºUNknownï¼Œç„¶åå‘è¯¥APPå¯¹åº”çš„driverï¼Œworerå‘é€è‡ªå·±çš„åœ°å€ä¿¡æ¯ï¼Œdriverï¼Œworerå¦‚æœæ²¡æœ‰æŒ‚ï¼Œé‚£ä¹ˆåœ¨æ¥æ”¶åˆ°masterå‘é€çš„åœ°å€åï¼Œå°±ä¼šè¿”å›å“åº”æ¶ˆæ¯ç»™æ–°çš„masterã€‚æ­¤æ—¶ï¼Œmasteråœ¨æ¥æ”¶åˆ°driverï¼Œworkerçš„æ¶ˆæ¯åï¼Œä¼šä½¿ç”¨completeRecoryå¯¹æ²¡æœ‰å“åº”çš„ç»„ä»¶è¿›è¡Œæ¸…ç†ï¼Œæœ€åè°ƒç”¨masterçš„schedulæ–¹æ³•ï¼Œå¯¹æ­£åœ¨ç­‰å¾…çš„driverå’Œappè°ƒåº¦ï¼Œå¦‚å¯åŠ¨executorã€‚</p><p><img alt="img" loading="lazy" src="https://gitee.com/xiaokunji/my-images/raw/master/myMD/20210711173608.png"/></p><blockquote><p>åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/englishsname/article/details/50631372</p><p><a href="https://blog.csdn.net/zhanglh046/article/details/78485745" rel="noopener" target="_blank">https://blog.csdn.net/zhanglh046/article/details/78485745</a></p></blockquote><h1 id="5-spark-streamingå°æ–‡ä»¶é—®é¢˜"><strong>5.</strong> <strong>Spark Streamingå°æ–‡ä»¶é—®é¢˜</strong><a aria-hidden="true" class="anchor" hidden="" href="#5-spark-streamingå°æ–‡ä»¶é—®é¢˜">#</a></h1><p>â€‹ ä½¿ç”¨ Spark Streaming æ—¶ï¼Œå¦‚æœå®æ—¶è®¡ç®—ç»“æœè¦å†™å…¥åˆ° HDFSï¼Œé‚£ä¹ˆä¸å¯é¿å…çš„ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯åœ¨é»˜è®¤æƒ…å†µä¸‹ä¼šäº§ç”Ÿéå¸¸å¤šçš„å°æ–‡ä»¶ï¼Œè¿™æ˜¯ç”± Spark Streaming çš„å¾®æ‰¹å¤„ç†æ¨¡å¼å’Œ DStream(RDD) çš„åˆ†å¸ƒå¼(partition)ç‰¹æ€§å¯¼è‡´çš„ï¼ŒSpark Streaming ä¸ºæ¯ä¸ª Partition å¯åŠ¨ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ï¼ˆä¸€ä¸ª task/partition ä¸€ä¸ªçº¿ç¨‹ï¼‰æ¥å¤„ç†æ•°æ®ï¼Œä¸€æ—¦æ–‡ä»¶è¾“å‡ºåˆ° HDFSï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶æµå°±å…³é—­äº†.</p><p>å¤„ç† Spark Streaming å°æ–‡ä»¶çš„å…¸å‹æ–¹æ³•(å¤§è‡´å¦‚ä¸‹):</p><ol><li><p>å¢åŠ  batch å¤§å°</p></li><li><p>Coalesceå¤§æ³•å¥½ , å°æ–‡ä»¶çš„åŸºæ•°æ˜¯ batch_number * partition_number, æ‰€ä»¥å°±æ˜¯åˆå¹¶åˆ†åŒºæ•°</p></li><li><p>Spark Streaming å¤–éƒ¨æ¥å¤„ç†: ç”¨ Hive æˆ–è€… Spark Sql è¿™æ ·çš„â€œsql on hadoopâ€ç³»ç»Ÿç±»è¿›ä¸€æ­¥è¿›è¡Œæ•°æ®åˆ†æï¼Œè€Œè¿™äº›è¡¨ä¸€èˆ¬éƒ½æ˜¯æŒ‰ç…§åŠå°æ—¶æˆ–è€…ä¸€å°æ—¶ã€ä¸€å¤©</p></li><li><p>è‡ªå·±è°ƒç”¨ foreach å» append, å†™å…¥æ–‡ä»¶æ—¶,ä¸è¦æ–°å»º,è€Œæ˜¯è¿½åŠ å·²æœ‰çš„</p></li></ol><blockquote><p><a href="https://zhuanlan.zhihu.com/p/49169166" rel="noopener" target="_blank">https://zhuanlan.zhihu.com/p/49169166</a></p></blockquote></div><footer class="post-footer"><ul class="post-tags"><li><a href="https://xiaokunji.com/zh/tags/%E9%9D%A2%E8%AF%95.html">é¢è¯•</a></li><li><a href="https://xiaokunji.com/zh/tags/Hadoop%E7%94%9F%E6%80%81%E5%9C%88.html">Hadoopç”Ÿæ€åœˆ</a></li></ul></footer></article></main><script async="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><footer class="footer"><span>Copyright
Â©
-2023
<a href="https://xiaokunji.com/zh/" style="color:#939393">ç±³äºŒ</a>
All Rights Reserved</span>
<span id="busuanzi_container"><span class="fa fa-user">ç”¨æˆ·æ•°:</span><span id="busuanzi_value_site_uv"></span>
<span class="fa fa-eye">è®¿é—®æ•°:</span><span id="busuanzi_value_site_pv"></span></span></footer><a accesskey="g" aria-label="go to top" class="top-link" href="#top" id="top-link" title="Go to Top (Alt + G)"><svg fill="currentcolor" viewbox="0 0 12 6" xmlns="http://www.w3.org/2000/svg"><path d="M12 6H0l6-6z"></path></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="å¤åˆ¶";function s(){t.innerHTML="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerHTML="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>