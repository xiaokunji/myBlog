<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>SparkStreaming | ç±³äºŒ</title><meta name=keywords content=" **1.æ¦‚è¿°**, **2. Streamingæ¶æ„**, **2.1 è®¡ç®—æµç¨‹ï¼š**, **2.2 å®¹é”™æ€§ï¼š**, **2.3 å®æ—¶æ€§ï¼š**, **2.4 æ‰©å±•æ€§ä¸ååé‡ï¼š**, **3.ä½¿ç”¨**, **3.1 åŸºæœ¬ä½¿ç”¨(æ¥æ”¶å¥—æ¥å­—)**, **3.2 HDFSæ¥æ”¶**, **3.3 windowsçª—å£å‡½æ•°**, **3.4 è¿æ¥kafka**"><meta name=description content="     "><meta name=author content="xkj"><link rel=canonical href=https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/spark/sparkstreaming.html><link crossorigin=anonymous href=/assets/css/stylesheet.b3faf608c544858ba700943ffe182cb647f38432d29a07d73234965beacb26f6.css integrity="sha256-s/r2CMVEhYunAJQ//hgstkfzhDLSmgfXMjSWW+rLJvY=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://xiaokunji.com/img/Q.svg><link rel=icon type=image/png sizes=16x16 href=https://xiaokunji.com/img/Q.svg><link rel=icon type=image/png sizes=32x32 href=https://xiaokunji.com/img/Q.svg><link rel=apple-touch-icon href=https://xiaokunji.com/Q.svg><link rel=mask-icon href=https://xiaokunji.com/Q.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/spark/sparkstreaming.html><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="SparkStreaming"><meta property="og:description" content="     "><meta property="og:type" content="article"><meta property="og:url" content="https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/spark/sparkstreaming.html"><meta property="article:section" content="Hadoopç”Ÿæ€åœˆ"><meta property="article:published_time" content="2023-08-22T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-28T16:39:17+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="SparkStreaming"><meta name=twitter:description content="     "><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":4,"name":"SparkStreaming","item":"https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/spark/sparkstreaming.html"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"SparkStreaming","name":"SparkStreaming","description":"     ","keywords":[" **1.æ¦‚è¿°**"," **2. Streamingæ¶æ„**"," **2.1 è®¡ç®—æµç¨‹ï¼š**"," **2.2 å®¹é”™æ€§ï¼š**"," **2.3 å®æ—¶æ€§ï¼š**"," **2.4 æ‰©å±•æ€§ä¸ååé‡ï¼š**"," **3.ä½¿ç”¨**"," **3.1 åŸºæœ¬ä½¿ç”¨(æ¥æ”¶å¥—æ¥å­—)**"," **3.2 HDFSæ¥æ”¶**"," **3.3 windowsçª—å£å‡½æ•°**"," **3.4 è¿æ¥kafka**"],"articleBody":"[toc]\n1.æ¦‚è¿° Spark Streaming æ˜¯Sparkæ ¸å¿ƒAPIçš„ä¸€ä¸ªæ‰©å±•ï¼Œå¯ä»¥å®ç°é«˜ååé‡çš„ã€å…·å¤‡å®¹é”™æœºåˆ¶çš„å®æ—¶æµæ•°æ®çš„å¤„ç†ã€‚æ”¯æŒä»å¤šç§æ•°æ®æºè·å–æ•°æ®ï¼ŒåŒ…æ‹¬Kafkã€Flumeã€Twitterã€ZeroMQã€Kinesis ä»¥åŠTCP socketsï¼Œä»æ•°æ®æºè·å–æ•°æ®ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨è¯¸å¦‚mapã€reduceã€joinå’Œwindowç­‰é«˜çº§å‡½æ•°è¿›è¡Œå¤æ‚ç®—æ³•çš„å¤„ç†ã€‚æœ€åè¿˜å¯ä»¥å°†å¤„ç†ç»“æœå­˜å‚¨åˆ°æ–‡ä»¶ç³»ç»Ÿï¼Œæ•°æ®åº“å’Œç°åœºä»ªè¡¨ç›˜ã€‚\næ¥è‡ª* \u003chttp://www.cnblogs.com/shishanyuan/p/4747735.html \u003e\n2. Streamingæ¶æ„ 2.1 è®¡ç®—æµç¨‹ï¼š Spark Streamingæ˜¯å°†æµå¼è®¡ç®—åˆ†è§£æˆä¸€ç³»åˆ—çŸ­å°çš„æ‰¹å¤„ç†ä½œä¸šã€‚è¿™é‡Œçš„æ‰¹å¤„ç†å¼•æ“æ˜¯Spark Coreï¼Œä¹Ÿå°±æ˜¯æŠŠSpark Streamingçš„è¾“å…¥æ•°æ®æŒ‰ç…§batch sizeï¼ˆå¦‚1ç§’ï¼‰åˆ†æˆä¸€æ®µä¸€æ®µçš„æ•°æ®ï¼ˆDiscretized Streamï¼‰ï¼Œæ¯ä¸€æ®µæ•°æ®éƒ½è½¬æ¢æˆSparkä¸­çš„RDDï¼ˆResilient Distributed Datasetï¼‰ï¼Œç„¶åå°†Spark Streamingä¸­å¯¹DStreamçš„Transformationæ“ä½œå˜ä¸ºé’ˆå¯¹Sparkä¸­å¯¹RDDçš„Transformationæ“ä½œï¼Œå°†RDDç»è¿‡æ“ä½œå˜æˆä¸­é—´ç»“æœä¿å­˜åœ¨å†…å­˜ä¸­ã€‚æ•´ä¸ªæµå¼è®¡ç®—æ ¹æ®ä¸šåŠ¡çš„éœ€æ±‚å¯ä»¥å¯¹ä¸­é—´çš„ç»“æœè¿›è¡Œå åŠ æˆ–è€…å­˜å‚¨åˆ°å¤–éƒ¨è®¾å¤‡ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†Spark Streamingçš„æ•´ä¸ªæµç¨‹ã€‚\nå›¾Spark Streamingæ„æ¶\n2.2 å®¹é”™æ€§ï¼š å¯¹äºæµå¼è®¡ç®—æ¥è¯´ï¼Œå®¹é”™æ€§è‡³å…³é‡è¦ã€‚é¦–å…ˆæˆ‘ä»¬è¦æ˜ç¡®ä¸€ä¸‹Sparkä¸­RDDçš„å®¹é”™æœºåˆ¶ã€‚æ¯ä¸€ä¸ªRDDéƒ½æ˜¯ä¸€ä¸ªä¸å¯å˜çš„åˆ†å¸ƒå¼å¯é‡ç®—çš„æ•°æ®é›†ï¼Œå…¶è®°å½•ç€ç¡®å®šæ€§çš„æ“ä½œç»§æ‰¿å…³ç³»ï¼ˆlineageï¼‰ï¼Œæ‰€ä»¥åªè¦è¾“å…¥æ•°æ®æ˜¯å¯å®¹é”™çš„ï¼Œé‚£ä¹ˆä»»æ„ä¸€ä¸ªRDDçš„åˆ†åŒºï¼ˆPartitionï¼‰å‡ºé”™æˆ–ä¸å¯ç”¨ï¼Œéƒ½æ˜¯å¯ä»¥åˆ©ç”¨åŸå§‹è¾“å…¥æ•°æ®é€šè¿‡è½¬æ¢æ“ä½œè€Œé‡æ–°ç®—å‡ºçš„ã€‚\nå¯¹äºSpark Streamingæ¥è¯´ï¼Œå…¶RDDçš„ä¼ æ‰¿å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå›¾ä¸­çš„æ¯ä¸€ä¸ªæ¤­åœ†å½¢è¡¨ç¤ºä¸€ä¸ªRDDï¼Œæ¤­åœ†å½¢ä¸­çš„æ¯ä¸ªåœ†å½¢ä»£è¡¨ä¸€ä¸ªRDDä¸­çš„ä¸€ä¸ªPartitionï¼Œå›¾ä¸­çš„æ¯ä¸€åˆ—çš„å¤šä¸ªRDDè¡¨ç¤ºä¸€ä¸ªDStreamï¼ˆå›¾ä¸­æœ‰ä¸‰ä¸ªDStreamï¼‰ï¼Œè€Œæ¯ä¸€è¡Œæœ€åä¸€ä¸ªRDDåˆ™è¡¨ç¤ºæ¯ä¸€ä¸ªBatch Sizeæ‰€äº§ç”Ÿçš„ä¸­é—´ç»“æœRDDã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å›¾ä¸­çš„æ¯ä¸€ä¸ªRDDéƒ½æ˜¯é€šè¿‡lineageç›¸è¿æ¥çš„ï¼Œç”±äºSpark Streamingè¾“å…¥æ•°æ®å¯ä»¥æ¥è‡ªäºç£ç›˜ï¼Œä¾‹å¦‚HDFSï¼ˆå¤šä»½æ‹·è´ï¼‰æˆ–æ˜¯æ¥è‡ªäºç½‘ç»œçš„æ•°æ®æµï¼ˆSpark Streamingä¼šå°†ç½‘ç»œè¾“å…¥æ•°æ®çš„æ¯ä¸€ä¸ªæ•°æ®æµæ‹·è´ä¸¤ä»½åˆ°å…¶ä»–çš„æœºå™¨ï¼‰éƒ½èƒ½ä¿è¯å®¹é”™æ€§ï¼Œæ‰€ä»¥RDDä¸­ä»»æ„çš„Partitionå‡ºé”™ï¼Œéƒ½å¯ä»¥å¹¶è¡Œåœ°åœ¨å…¶ä»–æœºå™¨ä¸Šå°†ç¼ºå¤±çš„Partitionè®¡ç®—å‡ºæ¥ã€‚è¿™ä¸ªå®¹é”™æ¢å¤æ–¹å¼æ¯”è¿ç»­è®¡ç®—æ¨¡å‹ï¼ˆå¦‚Stormï¼‰çš„æ•ˆç‡æ›´é«˜ã€‚\nSpark Streamingä¸­RDDçš„lineageå…³ç³»å›¾\n2.3 å®æ—¶æ€§ï¼š å¯¹äºå®æ—¶æ€§çš„è®¨è®ºï¼Œä¼šç‰µæ¶‰åˆ°æµå¼å¤„ç†æ¡†æ¶çš„åº”ç”¨åœºæ™¯ã€‚Spark Streamingå°†æµå¼è®¡ç®—åˆ†è§£æˆå¤šä¸ªSpark Jobï¼Œå¯¹äºæ¯ä¸€æ®µæ•°æ®çš„å¤„ç†éƒ½ä¼šç»è¿‡Spark DAGå›¾åˆ†è§£ä»¥åŠSparkçš„ä»»åŠ¡é›†çš„è°ƒåº¦è¿‡ç¨‹ã€‚å¯¹äºç›®å‰ç‰ˆæœ¬çš„Spark Streamingè€Œè¨€ï¼Œå…¶æœ€å°çš„Batch Sizeçš„é€‰å–åœ¨0.5~2ç§’é’Ÿä¹‹é—´ï¼ˆStormç›®å‰æœ€å°çš„å»¶è¿Ÿæ˜¯100mså·¦å³ï¼‰\n2.4 æ‰©å±•æ€§ä¸ååé‡ï¼š Sparkç›®å‰åœ¨EC2ä¸Šå·²èƒ½å¤Ÿçº¿æ€§æ‰©å±•åˆ°100ä¸ªèŠ‚ç‚¹ï¼ˆæ¯ä¸ªèŠ‚ç‚¹4Coreï¼‰ï¼Œå¯ä»¥ä»¥æ•°ç§’çš„å»¶è¿Ÿå¤„ç†6GB/sçš„æ•°æ®é‡ï¼ˆ60M records/sï¼‰ï¼Œå…¶ååé‡ä¹Ÿæ¯”æµè¡Œçš„Stormé«˜2ï½5å€ã€‚\næ¥è‡ª* \u003chttp://www.cnblogs.com/shishanyuan/p/4747735.html \u003e\n3.ä½¿ç”¨ 3.1 åŸºæœ¬ä½¿ç”¨(æ¥æ”¶å¥—æ¥å­—) import org.apache.spark._ import org.apache.spark.streaming._ import org.apache.spark.streaming.StreamingContext._ // Create a local StreamingContext with two working thread and batch interval of 1 second. // The master requires 2 cores to prevent from a starvation scenario. val conf = new SparkConf().setMaster(\"local[2]\").setAppName(\"NetworkWordCount\") val ssc = new StreamingContext(conf, Seconds(5)) // åé¢æ—¶é—´çš„å«ä¹‰: //1. æ¯éš”5ç§’åˆ‡ä¸€æ¬¡RDD(å¯èƒ½åŒ…å«å¤šä¸ª) //2. æ¯éš”5ç§’æäº¤ä¸€ä¸ªjob,æˆ–è€…è¯´æ¯éš”5ç§’æ‰§è¡Œä¸€æ¬¡ //3. è¿™ä¸ªjobéœ€5ç§’å†…ç®—å®Œ,ä¸ç„¶ä¸‹æ¬¡å°±è¦æ¥äº†,é€ æˆå¤„ç†ç§¯å‹ // Create a DStream that will connect to hostname:port, like localhost:9999 val lines = ssc.socketTextStream(\"localhost\", 9999) // Split each line into words val words = lines.flatMap(_.split(\" \")) import org.apache.spark.streaming.StreamingContext._ // Count each word in each batch val pairs = words.map(word =\u003e (word, 1)) val wordCounts = pairs.reduceByKey(_ + _) // Print the first ten elements of each RDD generated in this DStream to the console wordCounts.print() ssc.start() // Start the computation ssc.awaitTermination() // Wait for the computation to terminate ä½¿ç”¨:\n1.åœ¨é›†ç¾¤ä¸­æ‰§è¡Œå‘½ä»¤: nc -lk 9999\n2.ç„¶åè¾“å…¥å†…å®¹,ç”¨ç©ºæ ¼éš”å¼€, 3.ç„¶ååœ¨IDEæ§åˆ¶å°å°±èƒ½çœ‹è§å•è¯è®¡æ•°ç»“æœ è§£é‡Š: 1.åˆ›å»ºStreamingContextå¯¹è±¡ åŒSparkåˆå§‹åŒ–éœ€è¦åˆ›å»ºSparkContextå¯¹è±¡ä¸€æ ·ï¼Œä½¿ç”¨Spark Streamingå°±éœ€è¦åˆ›å»ºStreamingContextå¯¹è±¡ã€‚åˆ›å»ºStreamingContextå¯¹è±¡æ‰€éœ€çš„å‚æ•°ä¸SparkContextåŸºæœ¬ä¸€è‡´ï¼ŒåŒ…æ‹¬æŒ‡æ˜Masterï¼Œè®¾å®šåç§°(å¦‚NetworkWordCount)ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å‚æ•°Seconds(1)ï¼ŒSpark Streamingéœ€è¦æŒ‡å®šå¤„ç†æ•°æ®çš„æ—¶é—´é—´éš”ï¼Œå¦‚ä¸Šä¾‹æ‰€ç¤ºçš„1sï¼Œé‚£ä¹ˆSpark Streamingä¼šä»¥1sä¸ºæ—¶é—´çª—å£è¿›è¡Œæ•°æ®å¤„ç†ã€‚æ­¤å‚æ•°éœ€è¦æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚å’Œé›†ç¾¤çš„å¤„ç†èƒ½åŠ›è¿›è¡Œé€‚å½“çš„è®¾ç½®ï¼› 2.åˆ›å»ºInputDStream â€‹ å¦‚åŒStormçš„Spoutï¼ŒSpark Streamingéœ€è¦æŒ‡æ˜æ•°æ®æºã€‚å¦‚ä¸Šä¾‹æ‰€ç¤ºçš„socketTextStreamï¼ŒSpark Streamingä»¥socketè¿æ¥ä½œä¸ºæ•°æ®æºè¯»å–æ•°æ®ã€‚å½“ç„¶Spark Streamingæ”¯æŒå¤šç§ä¸åŒçš„æ•°æ®æºï¼ŒåŒ…æ‹¬Kafkaã€ Flumeã€HDFS/S3ã€Kinesiså’ŒTwitterç­‰æ•°æ®æºï¼› 3.æ“ä½œDstream â€‹ å¯¹äºä»æ•°æ®æºå¾—åˆ°çš„DStreamï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶åŸºç¡€ä¸Šè¿›è¡Œå„ç§æ“ä½œï¼Œå¦‚ä¸Šä¾‹æ‰€ç¤ºçš„æ“ä½œå°±æ˜¯ä¸€ä¸ªå…¸å‹çš„WordCountæ‰§è¡Œæµç¨‹ï¼šå¯¹äºå½“å‰æ—¶é—´çª—å£å†…ä»æ•°æ®æºå¾—åˆ°çš„æ•°æ®é¦–å…ˆè¿›è¡Œåˆ†å‰²ï¼Œç„¶ååˆ©ç”¨Mapå’ŒReduceByKeyæ–¹æ³•è¿›è¡Œè®¡ç®—ï¼Œå½“ç„¶æœ€åè¿˜æœ‰ä½¿ç”¨print()æ–¹æ³•è¾“å‡ºç»“æœï¼› 4.å¯åŠ¨Spark Streaming â€‹ ä¹‹å‰æ‰€ä½œçš„æ‰€æœ‰æ­¥éª¤åªæ˜¯åˆ›å»ºäº†æ‰§è¡Œæµç¨‹ï¼Œç¨‹åºæ²¡æœ‰çœŸæ­£è¿æ¥ä¸Šæ•°æ®æºï¼Œä¹Ÿæ²¡æœ‰å¯¹æ•°æ®è¿›è¡Œä»»ä½•æ“ä½œï¼Œåªæ˜¯è®¾å®šå¥½äº†æ‰€æœ‰çš„æ‰§è¡Œè®¡åˆ’ï¼Œå½“ssc.start()å¯åŠ¨åç¨‹åºæ‰çœŸæ­£è¿›è¡Œæ‰€æœ‰é¢„æœŸçš„æ“ä½œã€‚\næ¥è‡ª \u003chttp://www.cnblogs.com/shishanyuan/p/4747735.html \u003ehttp://spark.apache.org/docs/2.2.1/streaming-programming-guide.html 3.2 HDFSæ¥æ”¶ streamingContext.fileStream[KeyClass, ValueClass, InputFormatClass](dataDirectory) eg. streamingContext.fileStream(\"hdfs://192.168.2.101:8020/data/\") Spark Streamingå°†ç›‘è§†ç›®å½•dataDirectoryå¹¶å¤„ç†åœ¨è¯¥ç›®å½•ä¸­åˆ›å»ºçš„ä»»ä½•æ–‡ä»¶ï¼ˆä¸æ”¯æŒåœ¨åµŒå¥—ç›®å½•ä¸­å†™å…¥çš„æ–‡ä»¶ï¼‰ã€‚æ³¨æ„\næ–‡ä»¶å¿…é¡»å…·æœ‰ç›¸åŒçš„æ•°æ®æ ¼å¼ã€‚ å¿…é¡»dataDirectoryé€šè¿‡åŸå­åœ°å°†æ–‡ä»¶ç§»åŠ¨æˆ–é‡å‘½ååˆ°æ•°æ®ç›®å½•ä¸­æ¥åˆ›å»ºæ–‡ä»¶ã€‚ ç§»åŠ¨åï¼Œä¸å¾—æ›´æ”¹æ–‡ä»¶ã€‚å› æ­¤ï¼Œå¦‚æœæ–‡ä»¶è¢«è¿ç»­è¿½åŠ ï¼Œåˆ™ä¸ä¼šè¯»å–æ–°æ•°æ®ã€‚ å¯¹äºç®€å•çš„æ–‡æœ¬æ–‡ä»¶ï¼Œæœ‰ä¸€ä¸ªæ›´ç®€å•çš„æ–¹æ³•streamingContext.textFileStream(dataDirectory)ã€‚æ–‡ä»¶æµä¸éœ€è¦è¿è¡Œæ¥æ”¶å™¨ï¼Œå› æ­¤ä¸éœ€è¦åˆ†é…å†…æ ¸ã€‚\n**åŸºäºè‡ªå®šä¹‰æ¥æ”¶å™¨çš„æµï¼š**å¯ä»¥ä½¿ç”¨é€šè¿‡è‡ªå®šä¹‰æ¥æ”¶å™¨æ¥æ”¶çš„æ•°æ®æµåˆ›å»ºDStreamã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ã€Šå®šåˆ¶æ¥æ”¶å™¨æŒ‡å—ã€‹ ã€‚ **RDDé˜Ÿåˆ—ä½œä¸ºæµï¼š**ä¸ºäº†ä½¿ç”¨æµ‹è¯•æ•°æ®æµ‹è¯•Spark Streamingåº”ç”¨ç¨‹åºï¼Œè¿˜å¯ä»¥ä½¿ç”¨ï¼ŒåŸºäºRDDé˜Ÿåˆ—åˆ›å»ºDStream streamingContext.queueStream(queueOfRDDs)ã€‚æ¨é€åˆ°é˜Ÿåˆ—ä¸­çš„æ¯ä¸ªRDDå°†è¢«è§†ä¸ºDStreamä¸­çš„ä¸€æ‰¹æ•°æ®ï¼Œå¹¶åƒæµä¸€æ ·è¿›è¡Œå¤„ç†ã€‚ 3.3 windowsçª—å£å‡½æ•° ï¼ˆå®ç°ä¸€é˜¶æ®µå†…çš„ç´¯åŠ  ï¼Œè€Œä¸æ˜¯ç¨‹åºå¯åŠ¨æ—¶ï¼‰\nâ€‹ å‡è®¾æ¯éš”5s 1ä¸ªbatch,ä¸Šå›¾ä¸­çª—å£é•¿åº¦ä¸º15sï¼Œçª—å£æ»‘åŠ¨é—´éš”10sã€‚\nâ€‹ çª—å£é•¿åº¦å’Œæ»‘åŠ¨é—´éš”å¿…é¡»æ˜¯batchIntervalçš„æ•´æ•°å€ã€‚å¦‚æœä¸æ˜¯æ•´æ•°å€ä¼šæ£€æµ‹æŠ¥é”™ã€‚\nâ€‹ ä¼˜åŒ–åçš„windowæ“ä½œè¦ä¿å­˜çŠ¶æ€æ‰€ä»¥è¦è®¾ç½®checkpointè·¯å¾„ï¼Œæ²¡æœ‰ä¼˜åŒ–çš„windowæ“ä½œå¯ä»¥ä¸è®¾ç½®checkpointè·¯å¾„ã€‚\nval sc = new SparkConf().setMaster(\"local[3]\").setAppName(\"WindowsFunc\") val ssc = new StreamingContext(sc,Seconds(2)) // æ¯éš”5ç§’æ¥æ”¶ä¸€æ¬¡(ä»¥å‰çš„ä¹Ÿä¿ç•™) ssc.checkpoint(\"./checkPoint\") val line = ssc.socketTextStream(\"192.168.2.101\",9999)// Receiveræœºåˆ¶ä¼šå ç”¨ä¸€ä¸ªçº¿ç¨‹ val wc = line.flatMap(_.split(\" \")).map((_,1)) wc.reduceByKeyAndWindow(_+_,Seconds(8),Seconds(2)).print()// æ¯éš”å››ç§’ç®—å‰å…«ç§’çš„æ•°æ® reduceByKeyAndWindow å‡½æ•°\n`reduceByKeyAndWindow(func, invFunc,windowLength, slideInterval, [numTasks])``\nå‰é¢çš„funcä½œç”¨å’Œä¸Šä¸€ä¸ªreduceByKeyAndWindowç›¸åŒï¼Œåé¢çš„invFuncæ˜¯ç”¨äºå¤„ç†æµå‡ºrddçš„ã€‚ å› ä¸ºçª—å£æ»‘åŠ¨çš„åŸå› ,å°±ä¼šé€ æˆæ•°æ®é‡å¤è®¡ç®—(å¦‚ä¸Šå›¾çš„time3),ä½¿ç”¨è¯¥å‡½æ•°å¯ä»¥å‡å°‘è®¡ç®—(ä¼šè®¡ç®—å‡ºé‡å¤é‡.å†è®¡ç®—å‡ºå¢é‡,å†åˆå¹¶)\nåœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœæŠŠ3ç§’çš„æ—¶é—´çª—å£å½“æˆä¸€ä¸ªæ± å¡˜ï¼Œæ± å¡˜æ¯ä¸€ç§’éƒ½ä¼šæœ‰é±¼æ¸¸è¿›æˆ–è€…æ¸¸å‡ºï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå‡½æ•°è¡¨ç¤ºæ¯ç”±è¿›æ¥ä¸€æ¡é±¼ï¼Œå°±åœ¨è¯¥ç±»é±¼çš„æ•°é‡ä¸Šç´¯åŠ ã€‚è€Œç¬¬äºŒä¸ªå‡½æ•°æ˜¯ï¼Œæ¯ç”±å‡ºå»ä¸€æ¡é±¼ï¼Œå°±å°†è¯¥é±¼çš„æ€»æ•°å‡å»ä¸€ã€‚(ç®€å•è¿™ä¹ˆç†è§£,å½“æ•°æ®å‡ºçª—æ—¶,å°±ä¼šæ‰§è¡Œè¿™ä¸ªåå‘å‡½æ•°)\n`wc.reduceByKeyAndWindow(+,-,Seconds(8),Seconds(2)).print()// æ¯éš”å››ç§’ç®—å‰å…«ç§’çš„æ•°æ®(å…¶ç»“æœä¸ä¸Šæ–¹ä¸€ç›´)``\nä»¥åç”¨åˆ°äº†å†çœ‹å§\nhttps://www.cnblogs.com/yjd_hycf_space/p/7053722.html http://www.freesion.com/article/487428411/ https://www.iteye.com/blog/humingminghz-2308138 https://blog.csdn.net/legotime/article/details/51836040 3.4 è¿æ¥kafka package xkj.sparkStream import com.alibaba.fastjson.JSON import entity.MyPerson import org.apache.kafka.common.serialization.StringDeserializer import org.apache.log4j.Level import org.apache.log4j.Logger._ import org.apache.spark.rdd.RDD import org.apache.spark.sql.{SaveMode, SparkSession} import org.apache.spark.streaming.kafka010.{ConsumerStrategies, KafkaUtils, LocationStrategies} import org.apache.spark.streaming.{Seconds, StreamingContext} object KafkaTest { def main(args: Array[String]): Unit = { getLogger(\"org.apache.hadoop\").setLevel(Level.ERROR) getLogger(\"org.apache.zookeeper\").setLevel(Level.WARN) getLogger(\"org.apache.hive\").setLevel(Level.WARN) getLogger(\"org.apache\").setLevel(Level.WARN) val spark = SparkSession.builder().master(\"local[3]\").appName(\"KafkaTest\").getOrCreate() import spark.implicits._ val ssc = new StreamingContext(spark.sparkContext, Seconds(4)) ssc.checkpoint(\"./checkPoint\") val kafkaParams = Map[String, Object]( \"bootstrap.servers\" -\u003e \"192.168.2.101:9092\", \"key.deserializer\" -\u003e classOf[StringDeserializer], \"value.deserializer\" -\u003e classOf[StringDeserializer], \"group.id\" -\u003e \"xkj\" ) val topics: Set[String] = Set(\"mystream\") // val stream = KafkaUtils.createDirectStream(ssc, LocationStrategies.PreferConsistent, ConsumerStrategies.Subscribe[String, String](topics, kafkaParams)) // stream.foreachRDD(rdd =\u003e { // rdd.foreach(line =\u003e { // println(\"key=\" + line.key() + \", value=\" + line.value() + \", offset=\" + line.offset()) // }) // }) val streamPerson = KafkaUtils.createDirectStream(ssc,LocationStrategies.PreferConsistent,ConsumerStrategies.Subscribe[String,String](topics,kafkaParams)) streamPerson.foreachRDD(rdd=\u003e{ val v: RDD[String] = rdd.map(_.value()) val rddP: RDD[MyPerson] = v.map(JSON.parseObject(_, classOf[MyPerson])) val df = rddP.toDF() df.show() df.write.mode(SaveMode.Append).json(\"hdfs://192.168.2.101:9000/user\") }) ssc.start() ssc.awaitTermination() } } ç‰¹åˆ«æ³¨æ„ç‰ˆæœ¬:\npom.xml\n2.3.0 org.apache.spark spark-streaming_2.11 ${spark.version} org.apache.spark spark-streaming-kafka-0-10_2.11 ${spark.version} https://blog.csdn.net/zhaolq1024/article/details/85685189 https://blog.51cto.com/simplelife/2311296 ","wordCount":"3539","inLanguage":"zh","datePublished":"2023-08-22T00:00:00Z","dateModified":"2023-08-28T16:39:17.896916742Z","author":{"@type":"Person","name":"xkj"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/spark/sparkstreaming.html"},"publisher":{"@type":"Organization","name":"ç±³äºŒ","logo":{"@type":"ImageObject","url":"https://xiaokunji.com/img/Q.svg"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://xiaokunji.com/zh/ accesskey=h title="ç±³äºŒ (Alt + H)"><img src=https://xiaokunji.com/img/Q.svg alt aria-label=logo height=35>ç±³äºŒ</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://xiaokunji.com/en/ title=English aria-label=English>English</a></li></ul></div></div><ul id=menu><li><a href=https://xiaokunji.com/zh/ title=ğŸ ä¸»é¡µ><span>ğŸ ä¸»é¡µ</span></a></li><li><a href=https://xiaokunji.com/zh/search.html title="ğŸ”æœç´¢ (Alt + /)" accesskey=/><span>ğŸ”æœç´¢</span></a></li><li><a href=https://xiaokunji.com/zh/post.html title=ğŸ“šæ–‡ç« ><span>ğŸ“šæ–‡ç« </span></a></li><li><a href=https://xiaokunji.com/zh/archives.html title=â±æ—¶é—´è½´><span>â±æ—¶é—´è½´</span></a></li><li><a href=https://xiaokunji.com/zh/tags.html title=ğŸ”–æ ‡ç­¾><span>ğŸ”–æ ‡ç­¾</span></a></li><li><a href=https://xiaokunji.com/zh/categories.html title=ğŸ“–åˆ†ç±»><span>ğŸ“–åˆ†ç±»</span></a></li><li><a href=https://xiaokunji.com/zh/links.html title=ğŸ¤å‹é“¾><span>ğŸ¤å‹é“¾</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><nav aria-label=breadcrumb><ul><a href=https://xiaokunji.com/zh/>ğŸ </a> <span>></span>
<a href=https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88.html>hadoopç”Ÿæ€åœˆ</a> <span>></span>
<a href=https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/spark.html>Spark</a> <span>></span></ul></nav><h1 class=post-title>SparkStreaming</h1><div class=post-description></div><div class=post-meta><span title='2023-08-22 00:00:00 +0000 UTC'>2023-08-22</span>&nbsp;Â·&nbsp;8 åˆ†é’Ÿ&nbsp;Â·&nbsp;xkj
&nbsp;|&nbsp;åˆ†ç±»: &nbsp;<ul class=post-categories-meta><a href=https://xiaokunji.com/zh/categories/hadoop%E7%94%9F%E6%80%81%E5%9C%88.html>Hadoopç”Ÿæ€åœˆ</a></ul><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<span id=busuanzi_container_page_pv>&nbsp;| è®¿é—®: <span id=busuanzi_value_page_pv></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#1%e6%a6%82%e8%bf%b0 aria-label=1.æ¦‚è¿°><strong>1.æ¦‚è¿°</strong></a></li><li><a href=#2-streaming%e6%9e%b6%e6%9e%84 aria-label="2. Streamingæ¶æ„"><strong>2. Streamingæ¶æ„</strong></a><ul><li><a href=#21-%e8%ae%a1%e7%ae%97%e6%b5%81%e7%a8%8b aria-label="2.1 è®¡ç®—æµç¨‹ï¼š"><strong>2.1 è®¡ç®—æµç¨‹ï¼š</strong></a></li><li><a href=#22-%e5%ae%b9%e9%94%99%e6%80%a7 aria-label="2.2 å®¹é”™æ€§ï¼š"><strong>2.2 å®¹é”™æ€§ï¼š</strong></a></li><li><a href=#23-%e5%ae%9e%e6%97%b6%e6%80%a7 aria-label="2.3 å®æ—¶æ€§ï¼š"><strong>2.3 å®æ—¶æ€§ï¼š</strong></a></li><li><a href=#24-%e6%89%a9%e5%b1%95%e6%80%a7%e4%b8%8e%e5%90%9e%e5%90%90%e9%87%8f aria-label="2.4 æ‰©å±•æ€§ä¸ååé‡ï¼š"><strong>2.4 æ‰©å±•æ€§ä¸ååé‡ï¼š</strong></a></li></ul></li><li><a href=#3%e4%bd%bf%e7%94%a8 aria-label=3.ä½¿ç”¨><strong>3.ä½¿ç”¨</strong></a><ul><li><a href=#31-%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8%e6%8e%a5%e6%94%b6%e5%a5%97%e6%8e%a5%e5%ad%97 aria-label="3.1 åŸºæœ¬ä½¿ç”¨(æ¥æ”¶å¥—æ¥å­—)"><strong>3.1 åŸºæœ¬ä½¿ç”¨(æ¥æ”¶å¥—æ¥å­—)</strong></a></li><li><a href=#32-hdfs%e6%8e%a5%e6%94%b6 aria-label="3.2 HDFSæ¥æ”¶"><strong>3.2 HDFSæ¥æ”¶</strong></a></li><li><a href=#33-windows%e7%aa%97%e5%8f%a3%e5%87%bd%e6%95%b0 aria-label="3.3 windowsçª—å£å‡½æ•°"><strong>3.3 windowsçª—å£å‡½æ•°</strong></a></li><li><a href=#34-%e8%bf%9e%e6%8e%a5kafka aria-label="3.4 è¿æ¥kafka"><strong>3.4 è¿æ¥kafka</strong></a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>[toc]</p><h1 id=1æ¦‚è¿°><strong>1.æ¦‚è¿°</strong><a hidden class=anchor aria-hidden=true href=#1æ¦‚è¿°>#</a></h1><p>Spark Streaming æ˜¯Sparkæ ¸å¿ƒAPIçš„ä¸€ä¸ªæ‰©å±•ï¼Œå¯ä»¥å®ç°é«˜ååé‡çš„ã€å…·å¤‡å®¹é”™æœºåˆ¶çš„å®æ—¶æµæ•°æ®çš„å¤„ç†ã€‚æ”¯æŒä»å¤šç§æ•°æ®æºè·å–æ•°æ®ï¼ŒåŒ…æ‹¬Kafkã€Flumeã€Twitterã€ZeroMQã€Kinesis ä»¥åŠTCP socketsï¼Œä»æ•°æ®æºè·å–æ•°æ®ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨è¯¸å¦‚mapã€reduceã€joinå’Œwindowç­‰é«˜çº§å‡½æ•°è¿›è¡Œå¤æ‚ç®—æ³•çš„å¤„ç†ã€‚æœ€åè¿˜å¯ä»¥å°†å¤„ç†ç»“æœå­˜å‚¨åˆ°æ–‡ä»¶ç³»ç»Ÿï¼Œæ•°æ®åº“å’Œç°åœºä»ªè¡¨ç›˜ã€‚</p><p><img loading=lazy src=F:%5c%e5%ad%a6%e4%b9%a0%e8%b5%84%e6%96%99%5c%e4%b8%aa%e4%ba%ba%e7%ac%94%e8%ae%b0%5cMDImages%5cip_image001-1598543590569.jpeg alt=img></p><blockquote><p>æ¥è‡ª* <em>&lt;</em><a href=http://www.cnblogs.com/shishanyuan/p/4747735.html target=_blank rel=noopener><em>http://www.cnblogs.com/shishanyuan/p/4747735.html</em></a>
<em>></em></p></blockquote><h1 id=2-streamingæ¶æ„><strong>2. Streamingæ¶æ„</strong><a hidden class=anchor aria-hidden=true href=#2-streamingæ¶æ„>#</a></h1><h2 id=21-è®¡ç®—æµç¨‹><strong>2.1 è®¡ç®—æµç¨‹ï¼š</strong><a hidden class=anchor aria-hidden=true href=#21-è®¡ç®—æµç¨‹>#</a></h2><p>Spark Streamingæ˜¯å°†æµå¼è®¡ç®—åˆ†è§£æˆä¸€ç³»åˆ—çŸ­å°çš„æ‰¹å¤„ç†ä½œä¸šã€‚è¿™é‡Œçš„æ‰¹å¤„ç†å¼•æ“æ˜¯Spark Coreï¼Œä¹Ÿå°±æ˜¯æŠŠSpark Streamingçš„è¾“å…¥æ•°æ®æŒ‰ç…§batch sizeï¼ˆå¦‚1ç§’ï¼‰åˆ†æˆä¸€æ®µä¸€æ®µçš„æ•°æ®ï¼ˆDiscretized Streamï¼‰ï¼Œæ¯ä¸€æ®µæ•°æ®éƒ½è½¬æ¢æˆSparkä¸­çš„RDDï¼ˆResilient Distributed Datasetï¼‰ï¼Œç„¶åå°†Spark Streamingä¸­å¯¹DStreamçš„Transformationæ“ä½œå˜ä¸ºé’ˆå¯¹Sparkä¸­å¯¹RDDçš„Transformationæ“ä½œï¼Œå°†RDDç»è¿‡æ“ä½œå˜æˆä¸­é—´ç»“æœä¿å­˜åœ¨å†…å­˜ä¸­ã€‚æ•´ä¸ªæµå¼è®¡ç®—æ ¹æ®ä¸šåŠ¡çš„éœ€æ±‚å¯ä»¥å¯¹ä¸­é—´çš„ç»“æœè¿›è¡Œå åŠ æˆ–è€…å­˜å‚¨åˆ°å¤–éƒ¨è®¾å¤‡ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†Spark Streamingçš„æ•´ä¸ªæµç¨‹ã€‚</p><p><img loading=lazy src=F:%5c%e5%ad%a6%e4%b9%a0%e8%b5%84%e6%96%99%5c%e4%b8%aa%e4%ba%ba%e7%ac%94%e8%ae%b0%5cMDImages%5cip_image002-1598543590569.jpeg alt=img></p><p>å›¾Spark Streamingæ„æ¶</p><h2 id=22-å®¹é”™æ€§><strong>2.2 å®¹é”™æ€§ï¼š</strong><a hidden class=anchor aria-hidden=true href=#22-å®¹é”™æ€§>#</a></h2><p>å¯¹äºæµå¼è®¡ç®—æ¥è¯´ï¼Œå®¹é”™æ€§è‡³å…³é‡è¦ã€‚é¦–å…ˆæˆ‘ä»¬è¦æ˜ç¡®ä¸€ä¸‹Sparkä¸­RDDçš„å®¹é”™æœºåˆ¶ã€‚æ¯ä¸€ä¸ªRDDéƒ½æ˜¯ä¸€ä¸ªä¸å¯å˜çš„åˆ†å¸ƒå¼å¯é‡ç®—çš„æ•°æ®é›†ï¼Œå…¶è®°å½•ç€ç¡®å®šæ€§çš„æ“ä½œç»§æ‰¿å…³ç³»ï¼ˆlineageï¼‰ï¼Œæ‰€ä»¥åªè¦è¾“å…¥æ•°æ®æ˜¯å¯å®¹é”™çš„ï¼Œé‚£ä¹ˆä»»æ„ä¸€ä¸ªRDDçš„åˆ†åŒºï¼ˆPartitionï¼‰å‡ºé”™æˆ–ä¸å¯ç”¨ï¼Œéƒ½æ˜¯å¯ä»¥åˆ©ç”¨åŸå§‹è¾“å…¥æ•°æ®é€šè¿‡è½¬æ¢æ“ä½œè€Œé‡æ–°ç®—å‡ºçš„ã€‚</p><p>å¯¹äºSpark Streamingæ¥è¯´ï¼Œå…¶RDDçš„ä¼ æ‰¿å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå›¾ä¸­çš„æ¯ä¸€ä¸ªæ¤­åœ†å½¢è¡¨ç¤ºä¸€ä¸ªRDDï¼Œæ¤­åœ†å½¢ä¸­çš„æ¯ä¸ªåœ†å½¢ä»£è¡¨ä¸€ä¸ªRDDä¸­çš„ä¸€ä¸ªPartitionï¼Œå›¾ä¸­çš„æ¯ä¸€åˆ—çš„å¤šä¸ªRDDè¡¨ç¤ºä¸€ä¸ªDStreamï¼ˆå›¾ä¸­æœ‰ä¸‰ä¸ªDStreamï¼‰ï¼Œè€Œæ¯ä¸€è¡Œæœ€åä¸€ä¸ªRDDåˆ™è¡¨ç¤ºæ¯ä¸€ä¸ªBatch Sizeæ‰€äº§ç”Ÿçš„ä¸­é—´ç»“æœRDDã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å›¾ä¸­çš„æ¯ä¸€ä¸ªRDDéƒ½æ˜¯é€šè¿‡lineageç›¸è¿æ¥çš„ï¼Œç”±äºSpark Streamingè¾“å…¥æ•°æ®å¯ä»¥æ¥è‡ªäºç£ç›˜ï¼Œä¾‹å¦‚HDFSï¼ˆå¤šä»½æ‹·è´ï¼‰æˆ–æ˜¯æ¥è‡ªäºç½‘ç»œçš„æ•°æ®æµï¼ˆSpark Streamingä¼šå°†ç½‘ç»œè¾“å…¥æ•°æ®çš„æ¯ä¸€ä¸ªæ•°æ®æµæ‹·è´ä¸¤ä»½åˆ°å…¶ä»–çš„æœºå™¨ï¼‰éƒ½èƒ½ä¿è¯å®¹é”™æ€§ï¼Œæ‰€ä»¥RDDä¸­ä»»æ„çš„Partitionå‡ºé”™ï¼Œéƒ½å¯ä»¥å¹¶è¡Œåœ°åœ¨å…¶ä»–æœºå™¨ä¸Šå°†ç¼ºå¤±çš„Partitionè®¡ç®—å‡ºæ¥ã€‚è¿™ä¸ªå®¹é”™æ¢å¤æ–¹å¼æ¯”è¿ç»­è®¡ç®—æ¨¡å‹ï¼ˆå¦‚Stormï¼‰çš„æ•ˆç‡æ›´é«˜ã€‚</p><p><img loading=lazy src=F:%5c%e5%ad%a6%e4%b9%a0%e8%b5%84%e6%96%99%5c%e4%b8%aa%e4%ba%ba%e7%ac%94%e8%ae%b0%5cMDImages%5cip_image003-1598543590569.jpeg alt=img></p><p>Spark Streamingä¸­RDDçš„lineageå…³ç³»å›¾</p><h2 id=23-å®æ—¶æ€§><strong>2.3 å®æ—¶æ€§ï¼š</strong><a hidden class=anchor aria-hidden=true href=#23-å®æ—¶æ€§>#</a></h2><p>å¯¹äºå®æ—¶æ€§çš„è®¨è®ºï¼Œä¼šç‰µæ¶‰åˆ°æµå¼å¤„ç†æ¡†æ¶çš„åº”ç”¨åœºæ™¯ã€‚Spark Streamingå°†æµå¼è®¡ç®—åˆ†è§£æˆå¤šä¸ªSpark Jobï¼Œå¯¹äºæ¯ä¸€æ®µæ•°æ®çš„å¤„ç†éƒ½ä¼šç»è¿‡Spark DAGå›¾åˆ†è§£ä»¥åŠSparkçš„ä»»åŠ¡é›†çš„è°ƒåº¦è¿‡ç¨‹ã€‚å¯¹äºç›®å‰ç‰ˆæœ¬çš„Spark Streamingè€Œè¨€ï¼Œå…¶æœ€å°çš„Batch Sizeçš„é€‰å–åœ¨0.5~2ç§’é’Ÿä¹‹é—´ï¼ˆStormç›®å‰æœ€å°çš„å»¶è¿Ÿæ˜¯100mså·¦å³ï¼‰</p><h2 id=24-æ‰©å±•æ€§ä¸ååé‡><strong>2.4 æ‰©å±•æ€§ä¸ååé‡ï¼š</strong><a hidden class=anchor aria-hidden=true href=#24-æ‰©å±•æ€§ä¸ååé‡>#</a></h2><p>Sparkç›®å‰åœ¨EC2ä¸Šå·²èƒ½å¤Ÿçº¿æ€§æ‰©å±•åˆ°100ä¸ªèŠ‚ç‚¹ï¼ˆæ¯ä¸ªèŠ‚ç‚¹4Coreï¼‰ï¼Œå¯ä»¥ä»¥æ•°ç§’çš„å»¶è¿Ÿå¤„ç†6GB/sçš„æ•°æ®é‡ï¼ˆ60M records/sï¼‰ï¼Œå…¶ååé‡ä¹Ÿæ¯”æµè¡Œçš„Stormé«˜2ï½5å€ã€‚</p><blockquote><p>æ¥è‡ª* <em>&lt;</em><a href=http://www.cnblogs.com/shishanyuan/p/4747735.html target=_blank rel=noopener><em>http://www.cnblogs.com/shishanyuan/p/4747735.html</em></a>
<em>></em></p></blockquote><h1 id=3ä½¿ç”¨><strong>3.ä½¿ç”¨</strong><a hidden class=anchor aria-hidden=true href=#3ä½¿ç”¨>#</a></h1><h2 id=31-åŸºæœ¬ä½¿ç”¨æ¥æ”¶å¥—æ¥å­—><strong>3.1 åŸºæœ¬ä½¿ç”¨(æ¥æ”¶å¥—æ¥å­—)</strong><a hidden class=anchor aria-hidden=true href=#31-åŸºæœ¬ä½¿ç”¨æ¥æ”¶å¥—æ¥å­—>#</a></h2><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.apache.spark._</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.apache.spark.streaming._</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.apache.spark.streaming.StreamingContext._</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Create a local StreamingContext with two working thread and batch interval of 1 second.
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// The master requires 2 cores to prevent from a starvation scenario.
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>val</span> conf <span style=color:#ff7b72>=</span> <span style=color:#ff7b72>new</span> <span style=color:#f0883e;font-weight:700>SparkConf</span><span style=color:#ff7b72;font-weight:700>().</span>setMaster<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;local[2]&#34;</span><span style=color:#ff7b72;font-weight:700>).</span>setAppName<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;NetworkWordCount&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>val</span> ssc <span style=color:#ff7b72>=</span> <span style=color:#ff7b72>new</span> <span style=color:#f0883e;font-weight:700>StreamingContext</span><span style=color:#ff7b72;font-weight:700>(</span>conf<span style=color:#ff7b72;font-weight:700>,</span> <span style=color:#f0883e;font-weight:700>Seconds</span><span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>5</span><span style=color:#ff7b72;font-weight:700>))</span> 
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// åé¢æ—¶é—´çš„å«ä¹‰: 
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>//1. æ¯éš”5ç§’åˆ‡ä¸€æ¬¡RDD(å¯èƒ½åŒ…å«å¤šä¸ª)
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>//2. æ¯éš”5ç§’æäº¤ä¸€ä¸ªjob,æˆ–è€…è¯´æ¯éš”5ç§’æ‰§è¡Œä¸€æ¬¡
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>//3. è¿™ä¸ªjobéœ€5ç§’å†…ç®—å®Œ,ä¸ç„¶ä¸‹æ¬¡å°±è¦æ¥äº†,é€ æˆå¤„ç†ç§¯å‹
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Create a DStream that will connect to hostname:port, like localhost:9999
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>val</span> lines <span style=color:#ff7b72>=</span> ssc<span style=color:#ff7b72;font-weight:700>.</span>socketTextStream<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;localhost&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> <span style=color:#a5d6ff>9999</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Split each line into words
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>val</span> words <span style=color:#ff7b72>=</span> lines<span style=color:#ff7b72;font-weight:700>.</span>flatMap<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#ff7b72>_</span><span style=color:#ff7b72;font-weight:700>.</span>split<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34; &#34;</span><span style=color:#ff7b72;font-weight:700>))</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.apache.spark.streaming.StreamingContext._</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Count each word in each batch
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>val</span> pairs <span style=color:#ff7b72>=</span> words<span style=color:#ff7b72;font-weight:700>.</span>map<span style=color:#ff7b72;font-weight:700>(</span>word <span style=color:#ff7b72>=&gt;</span> <span style=color:#ff7b72;font-weight:700>(</span>word<span style=color:#ff7b72;font-weight:700>,</span> <span style=color:#a5d6ff>1</span><span style=color:#ff7b72;font-weight:700>))</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>val</span> wordCounts <span style=color:#ff7b72>=</span> pairs<span style=color:#ff7b72;font-weight:700>.</span>reduceByKey<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#ff7b72>_</span> <span style=color:#ff7b72;font-weight:700>+</span> <span style=color:#ff7b72>_</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>// Print the first ten elements of each RDD generated in this DStream to the console
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>wordCounts<span style=color:#ff7b72;font-weight:700>.</span>print<span style=color:#ff7b72;font-weight:700>()</span>
</span></span><span style=display:flex><span>ssc<span style=color:#ff7b72;font-weight:700>.</span>start<span style=color:#ff7b72;font-weight:700>()</span>              <span style=color:#8b949e;font-style:italic>// Start the computation
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>ssc<span style=color:#ff7b72;font-weight:700>.</span>awaitTermination<span style=color:#ff7b72;font-weight:700>()</span>  <span style=color:#8b949e;font-style:italic>// Wait for the computation to terminate
</span></span></span></code></pre></div><blockquote><p>ä½¿ç”¨:</p><p>1.åœ¨é›†ç¾¤ä¸­æ‰§è¡Œå‘½ä»¤: nc -lk 9999<br>2.ç„¶åè¾“å…¥å†…å®¹,ç”¨ç©ºæ ¼éš”å¼€,
3.ç„¶ååœ¨IDEæ§åˆ¶å°å°±èƒ½çœ‹è§å•è¯è®¡æ•°ç»“æœ
è§£é‡Š:
<strong>1.åˆ›å»ºStreamingContextå¯¹è±¡</strong>
åŒSparkåˆå§‹åŒ–éœ€è¦åˆ›å»ºSparkContextå¯¹è±¡ä¸€æ ·ï¼Œä½¿ç”¨Spark Streamingå°±éœ€è¦åˆ›å»ºStreamingContextå¯¹è±¡ã€‚åˆ›å»ºStreamingContextå¯¹è±¡æ‰€éœ€çš„å‚æ•°ä¸SparkContextåŸºæœ¬ä¸€è‡´ï¼ŒåŒ…æ‹¬æŒ‡æ˜Masterï¼Œè®¾å®šåç§°(å¦‚NetworkWordCount)ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å‚æ•°Seconds(1)ï¼ŒSpark Streamingéœ€è¦æŒ‡å®šå¤„ç†æ•°æ®çš„æ—¶é—´é—´éš”ï¼Œå¦‚ä¸Šä¾‹æ‰€ç¤ºçš„1sï¼Œé‚£ä¹ˆSpark Streamingä¼šä»¥1sä¸ºæ—¶é—´çª—å£è¿›è¡Œæ•°æ®å¤„ç†ã€‚æ­¤å‚æ•°éœ€è¦æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚å’Œé›†ç¾¤çš„å¤„ç†èƒ½åŠ›è¿›è¡Œé€‚å½“çš„è®¾ç½®ï¼›
<strong>2.åˆ›å»ºInputDStream</strong>
â€‹ å¦‚åŒStormçš„Spoutï¼ŒSpark Streamingéœ€è¦æŒ‡æ˜æ•°æ®æºã€‚å¦‚ä¸Šä¾‹æ‰€ç¤ºçš„socketTextStreamï¼ŒSpark Streamingä»¥socketè¿æ¥ä½œä¸ºæ•°æ®æºè¯»å–æ•°æ®ã€‚å½“ç„¶Spark Streamingæ”¯æŒå¤šç§ä¸åŒçš„æ•°æ®æºï¼ŒåŒ…æ‹¬Kafkaã€ Flumeã€HDFS/S3ã€Kinesiså’ŒTwitterç­‰æ•°æ®æºï¼›
<strong>3.æ“ä½œDstream</strong>
â€‹ å¯¹äºä»æ•°æ®æºå¾—åˆ°çš„DStreamï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶åŸºç¡€ä¸Šè¿›è¡Œå„ç§æ“ä½œï¼Œå¦‚ä¸Šä¾‹æ‰€ç¤ºçš„æ“ä½œå°±æ˜¯ä¸€ä¸ªå…¸å‹çš„WordCountæ‰§è¡Œæµç¨‹ï¼šå¯¹äºå½“å‰æ—¶é—´çª—å£å†…ä»æ•°æ®æºå¾—åˆ°çš„æ•°æ®é¦–å…ˆè¿›è¡Œåˆ†å‰²ï¼Œç„¶ååˆ©ç”¨Mapå’ŒReduceByKeyæ–¹æ³•è¿›è¡Œè®¡ç®—ï¼Œå½“ç„¶æœ€åè¿˜æœ‰ä½¿ç”¨print()æ–¹æ³•è¾“å‡ºç»“æœï¼›
<strong>4.å¯åŠ¨Spark Streaming</strong>
â€‹ ä¹‹å‰æ‰€ä½œçš„æ‰€æœ‰æ­¥éª¤åªæ˜¯åˆ›å»ºäº†æ‰§è¡Œæµç¨‹ï¼Œç¨‹åºæ²¡æœ‰çœŸæ­£è¿æ¥ä¸Šæ•°æ®æºï¼Œä¹Ÿæ²¡æœ‰å¯¹æ•°æ®è¿›è¡Œä»»ä½•æ“ä½œï¼Œåªæ˜¯è®¾å®šå¥½äº†æ‰€æœ‰çš„æ‰§è¡Œè®¡åˆ’ï¼Œå½“ssc.start()å¯åŠ¨åç¨‹åºæ‰çœŸæ­£è¿›è¡Œæ‰€æœ‰é¢„æœŸçš„æ“ä½œã€‚</p><p><em>æ¥è‡ª</em> <em>&lt;</em><a href=http://www.cnblogs.com/shishanyuan/p/4747735.html target=_blank rel=noopener><em>http://www.cnblogs.com/shishanyuan/p/4747735.html</em></a>
<em>></em><a href=http://spark.apache.org/docs/2.2.1/streaming-programming-guide.html target=_blank rel=noopener><em>http://spark.apache.org/docs/2.2.1/streaming-programming-guide.html</em></a></p></blockquote><h2 id=32-hdfsæ¥æ”¶><strong>3.2 HDFSæ¥æ”¶</strong><a hidden class=anchor aria-hidden=true href=#32-hdfsæ¥æ”¶>#</a></h2><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>streamingContext.fileStream<span style=color:#ff7b72;font-weight:700>[</span>KeyClass, ValueClass, InputFormatClass<span style=color:#ff7b72;font-weight:700>](</span>dataDirectory<span style=color:#ff7b72;font-weight:700>)</span> 
</span></span><span style=display:flex><span>eg.  streamingContext.fileStream<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;hdfs://192.168.2.101:8020/data/&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span></code></pre></div><p>Spark Streamingå°†ç›‘è§†ç›®å½•dataDirectoryå¹¶å¤„ç†åœ¨è¯¥ç›®å½•ä¸­åˆ›å»ºçš„ä»»ä½•æ–‡ä»¶ï¼ˆä¸æ”¯æŒåœ¨åµŒå¥—ç›®å½•ä¸­å†™å…¥çš„æ–‡ä»¶ï¼‰ã€‚æ³¨æ„</p><ul><li>æ–‡ä»¶å¿…é¡»å…·æœ‰ç›¸åŒçš„æ•°æ®æ ¼å¼ã€‚</li><li>å¿…é¡»dataDirectoryé€šè¿‡åŸå­åœ°<em>å°†</em>æ–‡ä»¶<em>ç§»åŠ¨</em>æˆ–<em>é‡å‘½å</em>åˆ°æ•°æ®ç›®å½•ä¸­æ¥åˆ›å»ºæ–‡ä»¶ã€‚</li><li>ç§»åŠ¨åï¼Œä¸å¾—æ›´æ”¹æ–‡ä»¶ã€‚å› æ­¤ï¼Œå¦‚æœæ–‡ä»¶è¢«è¿ç»­è¿½åŠ ï¼Œåˆ™ä¸ä¼šè¯»å–æ–°æ•°æ®ã€‚</li></ul><p>å¯¹äºç®€å•çš„æ–‡æœ¬æ–‡ä»¶ï¼Œæœ‰ä¸€ä¸ªæ›´ç®€å•çš„æ–¹æ³•streamingContext.textFileStream(dataDirectory)ã€‚æ–‡ä»¶æµä¸éœ€è¦è¿è¡Œæ¥æ”¶å™¨ï¼Œå› æ­¤ä¸éœ€è¦åˆ†é…å†…æ ¸ã€‚</p><ul><li>**åŸºäºè‡ªå®šä¹‰æ¥æ”¶å™¨çš„æµï¼š**å¯ä»¥ä½¿ç”¨é€šè¿‡è‡ªå®šä¹‰æ¥æ”¶å™¨æ¥æ”¶çš„æ•°æ®æµåˆ›å»ºDStreamã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ã€Š<a href=http://spark.apache.org/docs/2.2.1/streaming-custom-receivers.html target=_blank rel=noopener>å®šåˆ¶æ¥æ”¶å™¨æŒ‡å—ã€‹</a>
ã€‚</li><li>**RDDé˜Ÿåˆ—ä½œä¸ºæµï¼š**ä¸ºäº†ä½¿ç”¨æµ‹è¯•æ•°æ®æµ‹è¯•Spark Streamingåº”ç”¨ç¨‹åºï¼Œè¿˜å¯ä»¥ä½¿ç”¨ï¼ŒåŸºäºRDDé˜Ÿåˆ—åˆ›å»ºDStream streamingContext.queueStream(queueOfRDDs)ã€‚æ¨é€åˆ°é˜Ÿåˆ—ä¸­çš„æ¯ä¸ªRDDå°†è¢«è§†ä¸ºDStreamä¸­çš„ä¸€æ‰¹æ•°æ®ï¼Œå¹¶åƒæµä¸€æ ·è¿›è¡Œå¤„ç†ã€‚</li></ul><h2 id=33-windowsçª—å£å‡½æ•°><strong>3.3 windowsçª—å£å‡½æ•°</strong><a hidden class=anchor aria-hidden=true href=#33-windowsçª—å£å‡½æ•°>#</a></h2><p><strong>ï¼ˆå®ç°ä¸€é˜¶æ®µå†…çš„ç´¯åŠ  ï¼Œè€Œä¸æ˜¯ç¨‹åºå¯åŠ¨æ—¶ï¼‰</strong></p><p><img loading=lazy src=F:%5c%e5%ad%a6%e4%b9%a0%e8%b5%84%e6%96%99%5c%e4%b8%aa%e4%ba%ba%e7%ac%94%e8%ae%b0%5cMDImages%5c1-1882315162.png alt=img></p><p>â€‹ <strong>å‡è®¾æ¯éš”5s 1ä¸ªbatch,ä¸Šå›¾ä¸­çª—å£é•¿åº¦ä¸º15sï¼Œçª—å£æ»‘åŠ¨é—´éš”10sã€‚</strong></p><p>â€‹ <strong>çª—å£é•¿åº¦å’Œæ»‘åŠ¨é—´éš”å¿…é¡»æ˜¯batchIntervalçš„æ•´æ•°å€ã€‚å¦‚æœä¸æ˜¯æ•´æ•°å€ä¼šæ£€æµ‹æŠ¥é”™</strong>ã€‚</p><p>â€‹ <strong>ä¼˜åŒ–åçš„windowæ“ä½œè¦ä¿å­˜çŠ¶æ€æ‰€ä»¥è¦è®¾ç½®checkpointè·¯å¾„ï¼Œæ²¡æœ‰ä¼˜åŒ–çš„windowæ“ä½œå¯ä»¥ä¸è®¾ç½®checkpointè·¯å¾„ã€‚</strong></p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#ff7b72>val</span> sc <span style=color:#ff7b72>=</span> <span style=color:#ff7b72>new</span> <span style=color:#f0883e;font-weight:700>SparkConf</span><span style=color:#ff7b72;font-weight:700>().</span>setMaster<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;local[3]&#34;</span><span style=color:#ff7b72;font-weight:700>).</span>setAppName<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;WindowsFunc&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>val</span> ssc <span style=color:#ff7b72>=</span> <span style=color:#ff7b72>new</span> <span style=color:#f0883e;font-weight:700>StreamingContext</span><span style=color:#ff7b72;font-weight:700>(</span>sc<span style=color:#ff7b72;font-weight:700>,</span><span style=color:#f0883e;font-weight:700>Seconds</span><span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>2</span><span style=color:#ff7b72;font-weight:700>))</span> <span style=color:#8b949e;font-style:italic>// æ¯éš”5ç§’æ¥æ”¶ä¸€æ¬¡(ä»¥å‰çš„ä¹Ÿä¿ç•™)
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>ssc<span style=color:#ff7b72;font-weight:700>.</span>checkpoint<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;./checkPoint&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>val</span> line <span style=color:#ff7b72>=</span> ssc<span style=color:#ff7b72;font-weight:700>.</span>socketTextStream<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;192.168.2.101&#34;</span><span style=color:#ff7b72;font-weight:700>,</span><span style=color:#a5d6ff>9999</span><span style=color:#ff7b72;font-weight:700>)</span><span style=color:#8b949e;font-style:italic>// Receiveræœºåˆ¶ä¼šå ç”¨ä¸€ä¸ªçº¿ç¨‹
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#ff7b72>val</span> wc <span style=color:#ff7b72>=</span> line<span style=color:#ff7b72;font-weight:700>.</span>flatMap<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#ff7b72>_</span><span style=color:#ff7b72;font-weight:700>.</span>split<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34; &#34;</span><span style=color:#ff7b72;font-weight:700>)).</span>map<span style=color:#ff7b72;font-weight:700>((</span><span style=color:#ff7b72>_</span><span style=color:#ff7b72;font-weight:700>,</span><span style=color:#a5d6ff>1</span><span style=color:#ff7b72;font-weight:700>))</span>
</span></span><span style=display:flex><span>wc<span style=color:#ff7b72;font-weight:700>.</span>reduceByKeyAndWindow<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#ff7b72>_</span><span style=color:#ff7b72;font-weight:700>+</span><span style=color:#ff7b72>_</span><span style=color:#ff7b72;font-weight:700>,</span><span style=color:#f0883e;font-weight:700>Seconds</span><span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>8</span><span style=color:#ff7b72;font-weight:700>),</span><span style=color:#f0883e;font-weight:700>Seconds</span><span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>2</span><span style=color:#ff7b72;font-weight:700>)).</span>print<span style=color:#ff7b72;font-weight:700>()</span><span style=color:#8b949e;font-style:italic>// æ¯éš”å››ç§’ç®—å‰å…«ç§’çš„æ•°æ®
</span></span></span></code></pre></div><p>reduceByKeyAndWindow å‡½æ•°</p><p>`reduceByKeyAndWindow(func, invFunc,windowLength, slideInterval, [numTasks])``</p><p>ã€€ã€€å‰é¢çš„funcä½œç”¨å’Œä¸Šä¸€ä¸ªreduceByKeyAndWindowç›¸åŒï¼Œåé¢çš„invFuncæ˜¯ç”¨äºå¤„ç†æµå‡ºrddçš„ã€‚ å› ä¸ºçª—å£æ»‘åŠ¨çš„åŸå› ,å°±ä¼šé€ æˆæ•°æ®é‡å¤è®¡ç®—(å¦‚ä¸Šå›¾çš„time3),ä½¿ç”¨è¯¥å‡½æ•°å¯ä»¥å‡å°‘è®¡ç®—(ä¼šè®¡ç®—å‡ºé‡å¤é‡.å†è®¡ç®—å‡ºå¢é‡,å†åˆå¹¶)</p><p>ã€€ã€€åœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœæŠŠ3ç§’çš„æ—¶é—´çª—å£å½“æˆä¸€ä¸ªæ± å¡˜ï¼Œæ± å¡˜æ¯ä¸€ç§’éƒ½ä¼šæœ‰é±¼æ¸¸è¿›æˆ–è€…æ¸¸å‡ºï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå‡½æ•°è¡¨ç¤ºæ¯ç”±è¿›æ¥ä¸€æ¡é±¼ï¼Œå°±åœ¨è¯¥ç±»é±¼çš„æ•°é‡ä¸Šç´¯åŠ ã€‚è€Œç¬¬äºŒä¸ªå‡½æ•°æ˜¯ï¼Œæ¯ç”±å‡ºå»ä¸€æ¡é±¼ï¼Œå°±å°†è¯¥é±¼çš„æ€»æ•°å‡å»ä¸€ã€‚(ç®€å•è¿™ä¹ˆç†è§£,å½“æ•°æ®å‡ºçª—æ—¶,å°±ä¼šæ‰§è¡Œè¿™ä¸ªåå‘å‡½æ•°)</p><p>`wc.reduceByKeyAndWindow(<em>+</em>,<em>-</em>,Seconds(8),Seconds(2)).print()// æ¯éš”å››ç§’ç®—å‰å…«ç§’çš„æ•°æ®(å…¶ç»“æœä¸ä¸Šæ–¹ä¸€ç›´)``</p><blockquote><p>ä»¥åç”¨åˆ°äº†å†çœ‹å§</p><p><a href=https://www.cnblogs.com/yjd_hycf_space/p/7053722.html target=_blank rel=noopener>https://www.cnblogs.com/yjd_hycf_space/p/7053722.html</a></p><p><a href=http://www.freesion.com/article/487428411/ target=_blank rel=noopener>http://www.freesion.com/article/487428411/</a></p><p><a href=https://www.iteye.com/blog/humingminghz-2308138 target=_blank rel=noopener>https://www.iteye.com/blog/humingminghz-2308138</a></p><p><a href=https://blog.csdn.net/legotime/article/details/51836040 target=_blank rel=noopener>https://blog.csdn.net/legotime/article/details/51836040</a></p></blockquote><h2 id=34-è¿æ¥kafka><strong>3.4 è¿æ¥kafka</strong><a hidden class=anchor aria-hidden=true href=#34-è¿æ¥kafka>#</a></h2><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#ff7b72>package</span> <span style=color:#ff7b72>xkj.sparkStream</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>com.alibaba.fastjson.JSON</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>entity.MyPerson</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.apache.kafka.common.serialization.StringDeserializer</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.apache.log4j.Level</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.apache.log4j.Logger._</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.apache.spark.rdd.RDD</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.apache.spark.sql.</span><span style=color:#ff7b72;font-weight:700>{</span><span style=color:#f0883e;font-weight:700>SaveMode</span><span style=color:#ff7b72;font-weight:700>,</span> <span style=color:#f0883e;font-weight:700>SparkSession</span><span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.apache.spark.streaming.kafka010.</span><span style=color:#ff7b72;font-weight:700>{</span><span style=color:#f0883e;font-weight:700>ConsumerStrategies</span><span style=color:#ff7b72;font-weight:700>,</span> <span style=color:#f0883e;font-weight:700>KafkaUtils</span><span style=color:#ff7b72;font-weight:700>,</span> <span style=color:#f0883e;font-weight:700>LocationStrategies</span><span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.apache.spark.streaming.</span><span style=color:#ff7b72;font-weight:700>{</span><span style=color:#f0883e;font-weight:700>Seconds</span><span style=color:#ff7b72;font-weight:700>,</span> <span style=color:#f0883e;font-weight:700>StreamingContext</span><span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>object</span> <span style=color:#f0883e;font-weight:700>KafkaTest</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72>def</span> main<span style=color:#ff7b72;font-weight:700>(</span>args<span style=color:#ff7b72>:</span> <span style=color:#ff7b72>Array</span><span style=color:#ff7b72;font-weight:700>[</span><span style=color:#ff7b72>String</span><span style=color:#ff7b72;font-weight:700>])</span><span style=color:#ff7b72>:</span> <span style=color:#ff7b72>Unit</span> <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    getLogger<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;org.apache.hadoop&#34;</span><span style=color:#ff7b72;font-weight:700>).</span>setLevel<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#f0883e;font-weight:700>Level</span><span style=color:#ff7b72;font-weight:700>.</span><span style=color:#f0883e;font-weight:700>ERROR</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>    getLogger<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;org.apache.zookeeper&#34;</span><span style=color:#ff7b72;font-weight:700>).</span>setLevel<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#f0883e;font-weight:700>Level</span><span style=color:#ff7b72;font-weight:700>.</span><span style=color:#f0883e;font-weight:700>WARN</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>    getLogger<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;org.apache.hive&#34;</span><span style=color:#ff7b72;font-weight:700>).</span>setLevel<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#f0883e;font-weight:700>Level</span><span style=color:#ff7b72;font-weight:700>.</span><span style=color:#f0883e;font-weight:700>WARN</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>    getLogger<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;org.apache&#34;</span><span style=color:#ff7b72;font-weight:700>).</span>setLevel<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#f0883e;font-weight:700>Level</span><span style=color:#ff7b72;font-weight:700>.</span><span style=color:#f0883e;font-weight:700>WARN</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>val</span> spark <span style=color:#ff7b72>=</span> <span style=color:#f0883e;font-weight:700>SparkSession</span><span style=color:#ff7b72;font-weight:700>.</span>builder<span style=color:#ff7b72;font-weight:700>().</span>master<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;local[3]&#34;</span><span style=color:#ff7b72;font-weight:700>).</span>appName<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;KafkaTest&#34;</span><span style=color:#ff7b72;font-weight:700>).</span>getOrCreate<span style=color:#ff7b72;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>import</span> <span style=color:#ff7b72>spark.implicits._</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>val</span> ssc <span style=color:#ff7b72>=</span> <span style=color:#ff7b72>new</span> <span style=color:#f0883e;font-weight:700>StreamingContext</span><span style=color:#ff7b72;font-weight:700>(</span>spark<span style=color:#ff7b72;font-weight:700>.</span>sparkContext<span style=color:#ff7b72;font-weight:700>,</span> <span style=color:#f0883e;font-weight:700>Seconds</span><span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>4</span><span style=color:#ff7b72;font-weight:700>))</span>
</span></span><span style=display:flex><span>    ssc<span style=color:#ff7b72;font-weight:700>.</span>checkpoint<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;./checkPoint&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>val</span> kafkaParams <span style=color:#ff7b72>=</span> <span style=color:#f0883e;font-weight:700>Map</span><span style=color:#ff7b72;font-weight:700>[</span><span style=color:#ff7b72>String</span>, <span style=color:#ff7b72>Object</span><span style=color:#ff7b72;font-weight:700>](</span>
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#34;bootstrap.servers&#34;</span> <span style=color:#ff7b72;font-weight:700>-&gt;</span> <span style=color:#a5d6ff>&#34;192.168.2.101:9092&#34;</span><span style=color:#ff7b72;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#34;key.deserializer&#34;</span> <span style=color:#ff7b72;font-weight:700>-&gt;</span> classOf<span style=color:#ff7b72;font-weight:700>[</span><span style=color:#ff7b72>StringDeserializer</span><span style=color:#ff7b72;font-weight:700>],</span>
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#34;value.deserializer&#34;</span> <span style=color:#ff7b72;font-weight:700>-&gt;</span> classOf<span style=color:#ff7b72;font-weight:700>[</span><span style=color:#ff7b72>StringDeserializer</span><span style=color:#ff7b72;font-weight:700>],</span>
</span></span><span style=display:flex><span>      <span style=color:#a5d6ff>&#34;group.id&#34;</span> <span style=color:#ff7b72;font-weight:700>-&gt;</span> <span style=color:#a5d6ff>&#34;xkj&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>val</span> topics<span style=color:#ff7b72>:</span> <span style=color:#ff7b72>Set</span><span style=color:#ff7b72;font-weight:700>[</span><span style=color:#ff7b72>String</span><span style=color:#ff7b72;font-weight:700>]</span> <span style=color:#ff7b72>=</span> <span style=color:#f0883e;font-weight:700>Set</span><span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;mystream&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>//    val stream = KafkaUtils.createDirectStream(ssc, LocationStrategies.PreferConsistent, ConsumerStrategies.Subscribe[String, String](topics, kafkaParams))
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>//    stream.foreachRDD(rdd =&gt; {
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>//      rdd.foreach(line =&gt; {
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>//        println(&#34;key=&#34; + line.key() + &#34;,  value=&#34; + line.value() + &#34;, offset=&#34; + line.offset())
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>//      })
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>//    })
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>val</span> streamPerson <span style=color:#ff7b72>=</span> <span style=color:#f0883e;font-weight:700>KafkaUtils</span><span style=color:#ff7b72;font-weight:700>.</span>createDirectStream<span style=color:#ff7b72;font-weight:700>(</span>ssc<span style=color:#ff7b72;font-weight:700>,</span><span style=color:#f0883e;font-weight:700>LocationStrategies</span><span style=color:#ff7b72;font-weight:700>.</span><span style=color:#f0883e;font-weight:700>PreferConsistent</span><span style=color:#ff7b72;font-weight:700>,</span><span style=color:#f0883e;font-weight:700>ConsumerStrategies</span><span style=color:#ff7b72;font-weight:700>.</span><span style=color:#f0883e;font-weight:700>Subscribe</span><span style=color:#ff7b72;font-weight:700>[</span><span style=color:#ff7b72>String</span>,<span style=color:#ff7b72>String</span><span style=color:#ff7b72;font-weight:700>](</span>topics<span style=color:#ff7b72;font-weight:700>,</span>kafkaParams<span style=color:#ff7b72;font-weight:700>))</span>
</span></span><span style=display:flex><span>    streamPerson<span style=color:#ff7b72;font-weight:700>.</span>foreachRDD<span style=color:#ff7b72;font-weight:700>(</span>rdd<span style=color:#ff7b72;font-weight:700>=&gt;{</span>
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>val</span> v<span style=color:#ff7b72>:</span> <span style=color:#ff7b72>RDD</span><span style=color:#ff7b72;font-weight:700>[</span><span style=color:#ff7b72>String</span><span style=color:#ff7b72;font-weight:700>]</span> <span style=color:#ff7b72>=</span> rdd<span style=color:#ff7b72;font-weight:700>.</span>map<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#ff7b72>_</span><span style=color:#ff7b72;font-weight:700>.</span>value<span style=color:#ff7b72;font-weight:700>())</span>
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>val</span> rddP<span style=color:#ff7b72>:</span> <span style=color:#ff7b72>RDD</span><span style=color:#ff7b72;font-weight:700>[</span><span style=color:#ff7b72>MyPerson</span><span style=color:#ff7b72;font-weight:700>]</span> <span style=color:#ff7b72>=</span> v<span style=color:#ff7b72;font-weight:700>.</span>map<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#f0883e;font-weight:700>JSON</span><span style=color:#ff7b72;font-weight:700>.</span>parseObject<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#ff7b72>_</span><span style=color:#ff7b72;font-weight:700>,</span> classOf<span style=color:#ff7b72;font-weight:700>[</span><span style=color:#ff7b72>MyPerson</span><span style=color:#ff7b72;font-weight:700>]))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#ff7b72>val</span> df <span style=color:#ff7b72>=</span> rddP<span style=color:#ff7b72;font-weight:700>.</span>toDF<span style=color:#ff7b72;font-weight:700>()</span>
</span></span><span style=display:flex><span>      df<span style=color:#ff7b72;font-weight:700>.</span>show<span style=color:#ff7b72;font-weight:700>()</span>
</span></span><span style=display:flex><span>      df<span style=color:#ff7b72;font-weight:700>.</span>write<span style=color:#ff7b72;font-weight:700>.</span>mode<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#f0883e;font-weight:700>SaveMode</span><span style=color:#ff7b72;font-weight:700>.</span><span style=color:#f0883e;font-weight:700>Append</span><span style=color:#ff7b72;font-weight:700>).</span>json<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;hdfs://192.168.2.101:9000/user&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>})</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ssc<span style=color:#ff7b72;font-weight:700>.</span>start<span style=color:#ff7b72;font-weight:700>()</span>
</span></span><span style=display:flex><span>    ssc<span style=color:#ff7b72;font-weight:700>.</span>awaitTermination<span style=color:#ff7b72;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>}</span>
</span></span></code></pre></div><p>ç‰¹åˆ«æ³¨æ„ç‰ˆæœ¬:</p><p>pom.xml</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#7ee787>&lt;properties&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#7ee787>&lt;spark.version&gt;</span>2.3.0<span style=color:#7ee787>&lt;/spark.version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#7ee787>&lt;/properties&gt;</span>
</span></span><span style=display:flex><span><span style=color:#7ee787>&lt;dependencies&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#7ee787>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;groupId&gt;</span>org.apache.spark<span style=color:#7ee787>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;artifactId&gt;</span>spark-streaming_2.11<span style=color:#7ee787>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;version&gt;</span>${spark.version}<span style=color:#7ee787>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#7ee787>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#7ee787>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;groupId&gt;</span>org.apache.spark<span style=color:#7ee787>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;artifactId&gt;</span>spark-streaming-kafka-0-10_2.11<span style=color:#7ee787>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;version&gt;</span>${spark.version}<span style=color:#7ee787>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#7ee787>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#7ee787>&lt;/dependencies&gt;</span>
</span></span></code></pre></div><blockquote><p><a href=https://blog.csdn.net/zhaolq1024/article/details/85685189 target=_blank rel=noopener>https://blog.csdn.net/zhaolq1024/article/details/85685189</a></p><p><a href=https://blog.51cto.com/simplelife/2311296 target=_blank rel=noopener>https://blog.51cto.com/simplelife/2311296</a></p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://xiaokunji.com/zh/tags/spark.html>Spark</a></li><li><a href=https://xiaokunji.com/zh/tags/hadoop%E7%94%9F%E6%80%81%E5%9C%88.html>Hadoopç”Ÿæ€åœˆ</a></li></ul><nav class=paginav><a class=prev href=https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/spark/sparksql.html><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>SparkSQL</span></a>
<a class=next href=https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/java%E5%9F%BA%E7%A1%80/spi.html><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>SPI</span></a></nav></footer></article></main><footer class=footer><span>Copyright
&copy;
-2023
<a href=https://xiaokunji.com/zh/ style=color:#939393>ç±³äºŒ</a>
All Rights Reserved</span>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<span id=busuanzi_container><span class="fa fa-user">ç”¨æˆ·æ•°:</span><span id=busuanzi_value_site_uv></span>
<span class="fa fa-eye">è®¿é—®æ•°:</span><span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="å¤åˆ¶";function s(){t.innerHTML="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerHTML="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>