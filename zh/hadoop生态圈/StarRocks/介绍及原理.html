<!DOCTYPE html>
<html dir="auto" lang="zh"><head><meta charset="utf-8"/><meta content="IE=edge" http-equiv="x-ua-compatible"/><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name="viewport"/><meta content="index, follow" name="robots"/><title>StartRocks介绍及原理 | 米二</title><meta content="StartRocks介绍,StartRocks架构" name="keywords"/><meta content="StarRocks是一款极速统一的Lakehouse产品,致力于在全场景 OLAP 业务上为用户提供统一的解决方案，适用于对性能，实时性，并发能力和灵活性有较高要求的各类应用场景" name="description"/><meta content="xkj" name="author"/><link href="https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/StarRocks/%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%8E%9F%E7%90%86.html" rel="canonical"/><link as="style" crossorigin="anonymous" href="/assets/css/stylesheet.dc6bd2c841ee388e899e13872ae986c0e847e8b957d6714ad6ddc628ef2d17ff.css" integrity="sha256-3GvSyEHuOI6JnhOHKumGwOhH6LlX1nFK1t3GKO8tF/8=" rel="preload stylesheet"/><script crossorigin="anonymous" defer="" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload="hljs.initHighlightingOnLoad()" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js"></script>
<link href="https://xiaokunji.com/img/Q.svg" rel="icon"/><link href="https://xiaokunji.com/img/Q.svg" rel="icon" sizes="16x16" type="image/png"/><link href="https://xiaokunji.com/img/Q.svg" rel="icon" sizes="32x32" type="image/png"/><link href="https://xiaokunji.com/Q.svg" rel="apple-touch-icon"/><link href="https://xiaokunji.com/Q.svg" rel="mask-icon"/><meta content="#2e2e33" name="theme-color"/><meta content="#2e2e33" name="msapplication-TileColor"/><link href="https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/StarRocks/%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%8E%9F%E7%90%86.html" hreflang="zh" rel="alternate"/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta content="StartRocks介绍及原理" property="og:title"/><meta content="StarRocks是一款极速统一的Lakehouse产品,致力于在全场景 OLAP 业务上为用户提供统一的解决方案，适用于对性能，实时性，并发能力和灵活性有较高要求的各类应用场景" property="og:description"/><meta content="article" property="og:type"/><meta content="https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/StarRocks/%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%8E%9F%E7%90%86.html" property="og:url"/><meta content="hadoop生态圈" property="article:section"/><meta content="2024-02-22T00:00:00+00:00" property="article:published_time"/><meta content="2024-03-11T10:21:55+08:00" property="article:modified_time"/><meta content="summary" name="twitter:card"/><meta content="StartRocks介绍及原理" name="twitter:title"/><meta content="StarRocks是一款极速统一的Lakehouse产品,致力于在全场景 OLAP 业务上为用户提供统一的解决方案，适用于对性能，实时性，并发能力和灵活性有较高要求的各类应用场景" name="twitter:description"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":4,"name":"StartRocks介绍及原理","item":"https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/StarRocks/%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%8E%9F%E7%90%86.html"}]}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"StartRocks介绍及原理","name":"StartRocks介绍及原理","description":"StarRocks是一款极速统一的Lakehouse产品,致力于在全场景 OLAP 业务上为用户提供统一的解决方案，适用于对性能，实时性，并发能力和灵活性有较高要求的各类应用场景","keywords":["StartRocks介绍","StartRocks架构"],"articleBody":"介绍 StarRocks 是一款极速统一的Lakehouse产品，具备水平在线扩缩容，金融级高可用，兼容 MySQL 5.7 协议和 MySQL 生态，提供全面向量化引擎与多种数据源联邦查询等重要特性。StarRocks 致力于在全场景 OLAP 业务上为用户提供统一的解决方案，适用于对性能，实时性，并发能力和灵活性有较高要求的各类应用场景\n核心特性\n列式存储: StarRocks 采用列式存储模式，这意味着数据按列而非行组织，有利于提高分析查询速度，特别是在只需要处理少数几个字段的查询中表现出色。 向量化查询引擎: 该引擎能够有效地利用现代 CPU 的 SIMD 指令，加速数据处理和计算。 MPP 架构: 作为一个具有大规模并行处理（MPP）能力的数据库，StarRocks 能够在多个节点上并行执行查询，从而加快处理速度。 实时更新: StarRocks 支持实时数据更新和删除，适用于需要频繁更新数据的场景。 原有的以 Hadoop 为核心的大数据生态，在性能、实效性、运维难度及灵活性等方面都难以满足企业的需求。OLAP 数据库面临着越来越多的挑战，很难有一种数据库能够适配大部分的业务。在这种情况下，我们一般会使用不同的数据库处理不同类型的业务，充分发挥每种分析型数据库的优势，比如说：\n•对于 T+1 的报表业务，我们一般是将数据放在 Hive 中定时跑批完成\n•对于高并发的分析类查询，我们会使用 Druid，缓解高峰时期大量用户集中使用给系统带来的查询压力\n•对于像固定报表业务，我们预先知道了大部分的查询请求，将可以将数据打平成宽表的，放在 ClickHouse 中，充分发挥 ClickHouse 在单表查询的性能优势\n•对于明细数据的查询或者全文检索的需求，我们可以使用 Elasticsearch 中，发挥倒排索引的优势\n•对于多表关联的需求，我们可以通过 Presto 跨数据源完成多表的 join 操作\n一方面，多种技术栈的堆叠确实能够解决我们的问题，另一方面这样的复杂架构也大大增加了开发与运维的成本。这也是 StarRocks 要解决的痛点问题，我们希望把简单的事情回归到简单，能够使用一种统一 OLAP 数据库完成大数据生态中分析层的构建。\nStarRocks大数据生态定位 作为一款 MPP 架构的分析性数据库，StarRocks 能够支撑 PB 级别的数据量，拥有灵活的建模方式，可以通过向量化引擎、物化视图、位图索引、稀疏索引等优化手段构建极速统一的分析层数据存储系统。\n重构企业数据基础设施 可以说，StarRocks 重构了企业数据基础设施，把复杂的多模分析结构变得简单⽽统⼀。\nStarRocks 不依赖于某⼀种技术栈，⽽又能够兼容⼤数据平台的绝⼤部分技术栈：\n• 在数据导⼊层⾯上，StarRock 可以拉取 HDFS、S3、OSS 中的数据，也可以导⼊平⾯ ⽂件，或者是消费 Kafka 中的增量数据\n• 对于像 MySQL 或者 Oceanbase 这样的 TP 业务库，全量数据我们可以通过 dataX， sqoop 等⼯具进⾏同步，增量数据我们可以通过 canal 这样的 CDC ⼯具实时同步。\n• 如果在同步的过程中，我们需要进⾏⼀些清洗或者数据转换操作，可以使⽤ Flink 或 者 Spark\n• 此外 StarRocks 还⽀持外表联邦查询，可以拉取 Hive、MySQL、ES 以及 Iceberg 中的 数据，与 StarRocks 中的表进⾏关联，避免数据孤岛的存在\n• 从顶层协议来看，StarRocks 兼容了 MySQL 协议，可以轻松平稳的对接多种开源或者 商业 BI ⼯具，⽐如说 Tableau，FineBI，SmartBI，Superset 等\nStarRocks架构 StarRocks 整体上架构⽐较简单，有两层结构，黄⾊的是 FrontEnd 节点，蓝⾊的是 BackEnd 节点：\n• FrontEnd 节点主要负责元数据的管理和客户端链接的管理，并且根据元数据信息进⾏ 查询的规划和查询的调度。从 MySQL 客户端发起的请求通过 FrontEnd 节点转化成分 布式的 AST，也就是我们所说的执⾏计划树，推送给对应的 BackEnd 节点。每⼀个 FrontEnd 节点都存储全量的元数据，通过类 Paxos 协议进⾏数据同步，这种多数派的 数据同步协议也保证了我们可以线上⽔平阔所容 FrontEnd 节点。\n• BackEnd 节点主要负责数据存储及 SQL 的计算⼯作。FrontEnd 节点按照⼀定的策略 将数据分配给对应的 BackEnd 节点。在执⾏ SQL 计算时，⼀条 SQL 语句⾸先会按照 具体的语义规划成逻辑执⾏单元，然后再按照数据的分布情况拆分成具体的物理执⾏ 单元在 BackEnd 中进⾏计算。BackEnd 节点是完全对等的，数据通过 Qurom 协议进 ⾏同步。BackEnd 节点同样也⽀持在线⽔平阔缩容。\n向量化引擎 StarRocks 执⾏器的⼀个重⼤的特性就是向量化引擎。通过向量化引擎，可以极⼤程度的提 ⾼查询性能。\n作为⼀个列存数据库，StarRocks 的数据在 BackEnd 存储层是以列的形式组织的。 在没有做向量化引擎之前，数据以列的形式存储，但以⾏的形式被加载到内存中。⽐如说我 们要计算 A 列与 B 列的和，会以⾏的维度不停的调⽤ CPU 的加指令，循环迭代 A0 + B0， A1 + B1，A2 + B2。\n有了向量化引擎之后，StarRocks 在将数据加载到内存中时，也是按照列的形式进⾏布局。 通过调⽤ CPU 的 SIMD 指令集，计算 A 列与 B 列相加，减少了连续的虚函数调⽤，避免 CPU 流⽔线被打断。\n通过向量化引擎的加速，过滤操作⼤概有 5 倍左右的性能提升，聚合操作有 15 倍的性能提 升，关联操作有⼤概 3-4 倍的性能提升。\n多种分布式Join方式 对于实时 Join 的支持是 StarRocks 的一个非常重要的功能。我们提供了不同的 Join 的类型， 比如说小表与大表关联，可以使用 broadcast join，将小表以广播的方式推到不同 server 的内 存中进行关联操作。大表与大表的关联，可以使用 shuffle join 的模式，这也是 MPP 数据库 独有的一种 join 的模式。将数据分割后重新分发到不同的 server 上，利用每一台机器的内存 与 CPU 资源进行计算。当然，在数据 shuffle 的过程中，会带来大量的 IO 开销与网络开 销，可能会影响到查询的性能。\n此时可以人工的进行干预，选择 colocation join 的模式。比如我们在使用星型模型的时候， 预先就会计划好，事实表的 ID 列一定会与维度表的 ID 列进行关联，那么我们在数据导入的 过程中，可以人为的将两张表的 ID 列存储到同一台机器上，查询的时候就不需要进行数据 shuffle，直接在这台机器上进行 join 就可以，最大程度的减少了网络开销带来的性能影响。 通过 CBO 的优化，StarRocks 会根据表的统计信息自动选择出最为合适的 Join 类型。如果我 们对查询的性能有更高的要求，也可以手动的指定 colocation join 这种模式，进行特殊优化 的操作。\n高并发查询 和大多数的 MPP 数据库不同，StarRocks 支持高并发查询。这得益于 StarRocks 对表的两级 分区管理。 首先我们会根据数据的业务属性对表进行分区，一般来说我们会将时间列作为分区键，这样 做可以优化根据时间，删除过期数据所带来的性能问题，也方便了冷热数据的分级存储。 分区的下一级是分桶，StarRocks 采用 Hash 算法对分区数据进行分片管理。在同一分区内， 分桶键的哈希值相同的数据被聚集到一起，形成一个子表，我们称之为 tablet。每一个 tablet 都以多副本的形式进行数据冗余存储。同时 tablet 也是做扩容缩容，failover 与 failback 的最小物理单位。\n当表经过分区分桶后，数据的指向性有了显著的提高。如果分区分桶恰好可以有效的覆盖大 部分的查询条件的，那么就可以利用分区分桶剪裁，避免全表扫描。比如在这个例子中，我 们根据 date 列进行了分区操作，又根据 site id 列进行了分桶的操作。查询中，我们既使用 了 date 列，又使用了 site id 列进行条件过滤，通过 date 列的分区我们可能过滤了十几分之 一，再通过 site id 列分桶，又过滤了几十分之一的数据，两者相乘，扫描的数据量可能只是 全表的千分之一甚至万分之一，这样可以降低单个查询的资源消耗，从而实现业务的高并发 查询。在以往的案例中，我们经过分区分桶的操作，加上 StarRocks 的水平扩容的能力，可 以支撑万级别的并发量。\n10分钟带你全面了解StarRocks！ - 知乎 (zhihu.com) StarRocks：从概念到应用的下一代分析型数据库-腾讯云开发者社区-腾讯云 (tencent.com) QPS 提升 10 倍！滴滴借助 StarRocks 物化视图实现低成本精确去重 (qq.com) ","wordCount":"3023","inLanguage":"zh","datePublished":"2024-02-22T00:00:00Z","dateModified":"2024-03-11T10:21:55+08:00","author":{"@type":"Person","name":"xkj"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/StarRocks/%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%8E%9F%E7%90%86.html"},"publisher":{"@type":"Organization","name":"米二","logo":{"@type":"ImageObject","url":"https://xiaokunji.com/img/Q.svg"}}}</script></head><body class="dark" id="top"><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class="header"><nav class="nav"><div class="logo"><a accesskey="h" href="https://xiaokunji.com/zh/" title="米二 (Alt + H)"><img alt="" aria-label="logo" height="35" src="https://xiaokunji.com/img/Q.svg"/>米二</a><div class="logo-switches"><button accesskey="t" id="theme-toggle" title="(Alt + T)"><svg fill="none" height="18" id="moon" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path></svg><svg fill="none" height="18" id="sun" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="5"></circle><line x1="12" x2="12" y1="1" y2="3"></line><line x1="12" x2="12" y1="21" y2="23"></line><line x1="4.22" x2="5.64" y1="4.22" y2="5.64"></line><line x1="18.36" x2="19.78" y1="18.36" y2="19.78"></line><line x1="1" x2="3" y1="12" y2="12"></line><line x1="21" x2="23" y1="12" y2="12"></line><line x1="4.22" x2="5.64" y1="19.78" y2="18.36"></line><line x1="18.36" x2="19.78" y1="5.64" y2="4.22"></line></svg></button><ul class="lang-switch"><li>|</li><li><a aria-label="English" href="https://xiaokunji.com/en/" title="English">English</a></li></ul></div></div><ul id="menu"><li><a href="https://xiaokunji.com/zh/" title="🏠主页"><span>🏠主页</span></a></li><li><a accesskey="/" href="https://xiaokunji.com/zh/search" title="🔍搜索 (Alt + /)"><span>🔍搜索</span></a></li><li><a href="https://xiaokunji.com/zh/post.html" title="📚文章"><span>📚文章</span></a></li><li><a href="https://xiaokunji.com/zh/archives.html" title="⏱时间轴"><span>⏱时间轴</span></a></li><li><a href="https://xiaokunji.com/zh/tags.html" title="🔖标签"><span>🔖标签</span></a></li><li><a href="https://xiaokunji.com/zh/categories.html" title="📖分类"><span>📖分类</span></a></li><li><a href="https://xiaokunji.com/zh/links.html" title="🤝友链"><span>🤝友链</span></a></li></ul></nav></header><main class="main"><article class="post-single"><header class="post-header"><nav aria-label="breadcrumb"><ul><a href="https://xiaokunji.com/zh/">🏠</a> <span>&gt;</span>
<a href="https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88.html">hadoop生态圈</a> <span>&gt;</span>
<a href="https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/StarRocks.html">StarRocks</a> <span>&gt;</span></ul></nav><h1 class="post-title">StartRocks介绍及原理</h1><div class="post-description">StarRocks是一款极速统一的Lakehouse产品,致力于在全场景 OLAP 业务上为用户提供统一的解决方案，适用于对性能，实时性，并发能力和灵活性有较高要求的各类应用场景</div><div class="post-meta">创建: <span title="2024-02-22 00:00:00 +0000 UTC">2024-02-22</span> · 更新: 2024-03-11 · xkj
 | 分类:  <ul class="post-categories-meta" style="display:inline"><a href="https://xiaokunji.com/zh/categories/Hadoop%E7%94%9F%E6%80%81%E5%9C%88.html">Hadoop生态圈</a></ul><span id="busuanzi_container_page_pv"> | 访问: <span id="busuanzi_value_page_pv">1</span></span></div></header><aside class="toc-container wide" id="toc-container"><div class="toc"><details open=""><summary accesskey="c" title="(Alt + C)"><span class="details">目录</span></summary><div class="inner"><ul><li><a aria-label="介绍" href="#%e4%bb%8b%e7%bb%8d">介绍</a></li><li><a aria-label="StarRocks大数据生态定位" href="#starrocks%e5%a4%a7%e6%95%b0%e6%8d%ae%e7%94%9f%e6%80%81%e5%ae%9a%e4%bd%8d">StarRocks大数据生态定位</a></li><li><a aria-label="重构企业数据基础设施" href="#%e9%87%8d%e6%9e%84%e4%bc%81%e4%b8%9a%e6%95%b0%e6%8d%ae%e5%9f%ba%e7%a1%80%e8%ae%be%e6%96%bd">重构企业数据基础设施</a></li><li><a aria-label="StarRocks架构" href="#starrocks%e6%9e%b6%e6%9e%84">StarRocks架构</a></li><li><a aria-label="向量化引擎" href="#%e5%90%91%e9%87%8f%e5%8c%96%e5%bc%95%e6%93%8e">向量化引擎</a></li><li><a aria-label="多种分布式Join方式" href="#%e5%a4%9a%e7%a7%8d%e5%88%86%e5%b8%83%e5%bc%8fjoin%e6%96%b9%e5%bc%8f">多种分布式Join方式</a></li><li><a aria-label="高并发查询" href="#%e9%ab%98%e5%b9%b6%e5%8f%91%e6%9f%a5%e8%af%a2">高并发查询</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class="post-content"><h1 id="介绍">介绍<a aria-hidden="true" class="anchor" hidden="" href="#介绍">#</a></h1><p>StarRocks 是一款极速统一的Lakehouse产品，具备水平在线扩缩容，金融级高可用，兼容 MySQL 5.7 协议和 MySQL 生态，提供全面向量化引擎与多种数据源联邦查询等重要特性。StarRocks 致力于在全场景 OLAP 业务上为用户提供统一的解决方案，适用于对性能，实时性，并发能力和灵活性有较高要求的各类应用场景</p><p><strong>核心特性</strong></p><ul><li><strong>列式存储</strong>: StarRocks 采用列式存储模式，这意味着数据按列而非行组织，有利于提高分析查询速度，特别是在只需要处理少数几个字段的查询中表现出色。</li><li><strong>向量化查询引擎</strong>: 该引擎能够有效地利用现代 CPU 的 SIMD 指令，加速数据处理和计算。</li><li><strong>MPP 架构</strong>: 作为一个具有大规模并行处理（MPP）能力的数据库，StarRocks 能够在多个节点上并行执行查询，从而加快处理速度。</li><li><strong>实时更新</strong>: StarRocks 支持实时数据更新和删除，适用于需要频繁更新数据的场景。</li></ul><blockquote><p>原有的以 Hadoop 为核心的大数据生态，在性能、实效性、运维难度及灵活性等方面都难以满足企业的需求。OLAP 数据库面临着越来越多的挑战，很难有一种数据库能够适配大部分的业务。在这种情况下，我们一般会使用不同的数据库处理不同类型的业务，充分发挥每种分析型数据库的优势，比如说：</p><p>•对于 T+1 的报表业务，我们一般是将数据放在 Hive 中定时跑批完成</p><p>•对于高并发的分析类查询，我们会使用 Druid，缓解高峰时期大量用户集中使用给系统带来的查询压力</p><p>•对于像固定报表业务，我们预先知道了大部分的查询请求，将可以将数据打平成宽表的，放在 ClickHouse 中，充分发挥 ClickHouse 在单表查询的性能优势</p><p>•对于明细数据的查询或者全文检索的需求，我们可以使用 Elasticsearch 中，发挥倒排索引的优势</p><p>•对于多表关联的需求，我们可以通过 Presto 跨数据源完成多表的 join 操作</p><p>一方面，多种技术栈的堆叠确实能够解决我们的问题，另一方面这样的复杂架构也大大增加了开发与运维的成本。这也是 StarRocks 要解决的痛点问题，我们希望把简单的事情回归到简单，能够使用一种统一 OLAP 数据库完成大数据生态中分析层的构建。</p></blockquote><h1 id="starrocks大数据生态定位">StarRocks大数据生态定位<a aria-hidden="true" class="anchor" hidden="" href="#starrocks大数据生态定位">#</a></h1><p><img alt="img" loading="lazy" src="./%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%8E%9F%E7%90%86.assets/v2-8239f4bc13b21a6050ee4c198d618e5c_r.jpg"/></p><p>作为一款 MPP 架构的分析性数据库，StarRocks 能够支撑 PB 级别的数据量，拥有灵活的建模方式，可以通过向量化引擎、物化视图、位图索引、稀疏索引等优化手段构建极速统一的分析层数据存储系统。</p><h1 id="重构企业数据基础设施">重构企业数据基础设施<a aria-hidden="true" class="anchor" hidden="" href="#重构企业数据基础设施">#</a></h1><p><img alt="img" loading="lazy" src="./%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%8E%9F%E7%90%86.assets/v2-0eb15456478f7e673d5dd430e396c8f2_r.jpg"/></p><p>可以说，StarRocks 重构了企业数据基础设施，把复杂的多模分析结构变得简单⽽统⼀。</p><p>StarRocks 不依赖于某⼀种技术栈，⽽又能够兼容⼤数据平台的绝⼤部分技术栈：</p><p>• 在数据导⼊层⾯上，StarRock 可以拉取 HDFS、S3、OSS 中的数据，也可以导⼊平⾯ ⽂件，或者是消费 Kafka 中的增量数据</p><p>• 对于像 MySQL 或者 Oceanbase 这样的 TP 业务库，全量数据我们可以通过 dataX， sqoop 等⼯具进⾏同步，增量数据我们可以通过 canal 这样的 CDC ⼯具实时同步。</p><p>• 如果在同步的过程中，我们需要进⾏⼀些清洗或者数据转换操作，可以使⽤ Flink 或 者 Spark</p><p>• 此外 StarRocks 还⽀持外表联邦查询，可以拉取 Hive、MySQL、ES 以及 Iceberg 中的 数据，与 StarRocks 中的表进⾏关联，避免数据孤岛的存在</p><p>• 从顶层协议来看，StarRocks 兼容了 MySQL 协议，可以轻松平稳的对接多种开源或者 商业 BI ⼯具，⽐如说 Tableau，FineBI，SmartBI，Superset 等</p><h1 id="starrocks架构">StarRocks架构<a aria-hidden="true" class="anchor" hidden="" href="#starrocks架构">#</a></h1><p><img alt="img" loading="lazy" src="./%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%8E%9F%E7%90%86.assets/v2-a103a84d0d9d6d0d72d088d6400aa8b8_r.jpg"/></p><p>StarRocks 整体上架构⽐较简单，有两层结构，黄⾊的是 FrontEnd 节点，蓝⾊的是 BackEnd 节点：</p><p>• FrontEnd 节点主要负责元数据的管理和客户端链接的管理，并且根据元数据信息进⾏ 查询的规划和查询的调度。从 MySQL 客户端发起的请求通过 FrontEnd 节点转化成分 布式的 AST，也就是我们所说的执⾏计划树，推送给对应的 BackEnd 节点。每⼀个 FrontEnd 节点都存储全量的元数据，通过类 Paxos 协议进⾏数据同步，这种多数派的 数据同步协议也保证了我们可以线上⽔平阔所容 FrontEnd 节点。</p><p>• BackEnd 节点主要负责数据存储及 SQL 的计算⼯作。FrontEnd 节点按照⼀定的策略 将数据分配给对应的 BackEnd 节点。在执⾏ SQL 计算时，⼀条 SQL 语句⾸先会按照 具体的语义规划成逻辑执⾏单元，然后再按照数据的分布情况拆分成具体的物理执⾏ 单元在 BackEnd 中进⾏计算。BackEnd 节点是完全对等的，数据通过 Qurom 协议进 ⾏同步。BackEnd 节点同样也⽀持在线⽔平阔缩容。</p><h1 id="向量化引擎">向量化引擎<a aria-hidden="true" class="anchor" hidden="" href="#向量化引擎">#</a></h1><p><img alt="img" loading="lazy" src="./%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%8E%9F%E7%90%86.assets/v2-0d57a1ccf6b93226022026d6ca460342_r.jpg"/></p><p>StarRocks 执⾏器的⼀个重⼤的特性就是向量化引擎。通过向量化引擎，可以极⼤程度的提 ⾼查询性能。</p><p>作为⼀个列存数据库，StarRocks 的数据在 BackEnd 存储层是以列的形式组织的。 在没有做向量化引擎之前，数据以列的形式存储，但以⾏的形式被加载到内存中。⽐如说我 们要计算 A 列与 B 列的和，会以⾏的维度不停的调⽤ CPU 的加指令，循环迭代 A0 + B0， A1 + B1，A2 + B2。</p><p>有了向量化引擎之后，StarRocks 在将数据加载到内存中时，也是按照列的形式进⾏布局。 通过调⽤ CPU 的 SIMD 指令集，计算 A 列与 B 列相加，减少了连续的虚函数调⽤，避免 CPU 流⽔线被打断。</p><p>通过向量化引擎的加速，过滤操作⼤概有 5 倍左右的性能提升，聚合操作有 15 倍的性能提 升，关联操作有⼤概 3-4 倍的性能提升。</p><h1 id="多种分布式join方式">多种分布式Join方式<a aria-hidden="true" class="anchor" hidden="" href="#多种分布式join方式">#</a></h1><p><img alt="img" loading="lazy" src="./%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%8E%9F%E7%90%86.assets/v2-a6d978885afed45c8c4ac6a530b9e8bf_r.jpg"/></p><p>对于实时 Join 的支持是 StarRocks 的一个非常重要的功能。我们提供了不同的 Join 的类型， 比如说小表与大表关联，可以使用 broadcast join，将小表以广播的方式推到不同 server 的内 存中进行关联操作。大表与大表的关联，可以使用 shuffle join 的模式，这也是 MPP 数据库 独有的一种 join 的模式。将数据分割后重新分发到不同的 server 上，利用每一台机器的内存 与 CPU 资源进行计算。当然，在数据 shuffle 的过程中，会带来大量的 IO 开销与网络开 销，可能会影响到查询的性能。</p><p>此时可以人工的进行干预，选择 colocation join 的模式。比如我们在使用星型模型的时候， 预先就会计划好，事实表的 ID 列一定会与维度表的 ID 列进行关联，那么我们在数据导入的 过程中，可以人为的将两张表的 ID 列存储到同一台机器上，查询的时候就不需要进行数据 shuffle，直接在这台机器上进行 join 就可以，最大程度的减少了网络开销带来的性能影响。 通过 CBO 的优化，StarRocks 会根据表的统计信息自动选择出最为合适的 Join 类型。如果我 们对查询的性能有更高的要求，也可以手动的指定 colocation join 这种模式，进行特殊优化 的操作。</p><h1 id="高并发查询">高并发查询<a aria-hidden="true" class="anchor" hidden="" href="#高并发查询">#</a></h1><p><img alt="img" loading="lazy" src="./%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%8E%9F%E7%90%86.assets/v2-ae2c2dfa5e593c869f0a433ca4712eaa_r.jpg"/></p><p>和大多数的 MPP 数据库不同，StarRocks 支持高并发查询。这得益于 StarRocks 对表的两级 分区管理。
首先我们会根据数据的业务属性对表进行分区，一般来说我们会将时间列作为分区键，这样 做可以优化根据时间，删除过期数据所带来的性能问题，也方便了冷热数据的分级存储。 分区的下一级是分桶，StarRocks 采用 Hash 算法对分区数据进行分片管理。在同一分区内， 分桶键的哈希值相同的数据被聚集到一起，形成一个子表，我们称之为 tablet。每一个 tablet 都以多副本的形式进行数据冗余存储。同时 tablet 也是做扩容缩容，failover 与 failback 的最小物理单位。</p><p>当表经过分区分桶后，数据的指向性有了显著的提高。如果分区分桶恰好可以有效的覆盖大 部分的查询条件的，那么就可以利用分区分桶剪裁，避免全表扫描。比如在这个例子中，我 们根据 date 列进行了分区操作，又根据 site id 列进行了分桶的操作。查询中，我们既使用 了 date 列，又使用了 site id 列进行条件过滤，通过 date 列的分区我们可能过滤了十几分之 一，再通过 site id 列分桶，又过滤了几十分之一的数据，两者相乘，扫描的数据量可能只是 全表的千分之一甚至万分之一，这样可以降低单个查询的资源消耗，从而实现业务的高并发 查询。在以往的案例中，我们经过分区分桶的操作，加上 StarRocks 的水平扩容的能力，可 以支撑万级别的并发量。</p><p><a href="https://zhuanlan.zhihu.com/p/532302941" rel="noopener" target="_blank">10分钟带你全面了解StarRocks！ - 知乎 (zhihu.com)</a></p><p><a href="https://cloud.tencent.com/developer/article/2389974" rel="noopener" target="_blank">StarRocks：从概念到应用的下一代分析型数据库-腾讯云开发者社区-腾讯云 (tencent.com)</a></p><p><a href="https://mp.weixin.qq.com/s/kZvZBULSODdgW1A7aEI57w" rel="noopener" target="_blank">QPS 提升 10 倍！滴滴借助 StarRocks 物化视图实现低成本精确去重 (qq.com)</a></p></div><footer class="post-footer"><ul class="post-tags"><li><a href="https://xiaokunji.com/zh/tags/StartRocks.html">StartRocks</a></li><li><a href="https://xiaokunji.com/zh/tags/Hadoop%E7%94%9F%E6%80%81%E5%9C%88.html">Hadoop生态圈</a></li></ul><nav class="paginav"><a class="prev" href="https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/%E5%8D%95%E6%B5%8B%E6%A1%86%E6%9E%B6/spock.html"><span class="title">« 上一页</span><br/><span>简述spock以及使用</span></a>
<a class="next" href="https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/%E4%B8%AA%E4%BA%BA%E5%B0%8F%E7%9F%A5%E8%AF%86/%E5%A4%A7%E6%95%B0%E6%8D%AE/Quorum%E6%9C%BA%E5%88%B6.html"><span class="title">下一页 »</span><br/><span>分布式一致性协议 Quorum 机制</span></a></nav></footer></article></main><script async="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><footer class="footer"><span>Copyright
©
-2024
<a href="https://xiaokunji.com/zh/" style="color:#939393">米二</a>
All Rights Reserved</span>
<span id="busuanzi_container"><span class="fa fa-user">用户数:</span><span id="busuanzi_value_site_uv"></span>
<span class="fa fa-eye">访问数:</span><span id="busuanzi_value_site_pv"></span></span></footer><a accesskey="g" aria-label="go to top" class="top-link" href="#top" id="top-link" title="Go to Top (Alt + G)"><svg fill="currentcolor" viewbox="0 0 12 6" xmlns="http://www.w3.org/2000/svg"><path d="M12 6H0l6-6z"></path></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>