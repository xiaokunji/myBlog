<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>airflow | ç±³äºŒ</title><meta name=keywords content=" 1. ç®€ä»‹, 2ã€Airflow çš„æœåŠ¡æ„æˆ, 3. Airflow çš„ Web ç•Œé¢, 1ã€DAG åˆ—è¡¨, 2ã€ä½œä¸šæ“ä½œæ¡†, 4. DAG é…ç½®, -*- coding: utf-8 -*-, ç”¨[]å¯ä»¥å¹¶è¡Œæ‰§è¡Œå¤šä¸ªjob,task >> [job1,job2], ç­‰åŒäº task.set_downstream(run_this_last)"><meta name=description content="     "><meta name=author content="xkj"><link rel=canonical href=https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/airflow/airflow.html><link crossorigin=anonymous href=/assets/css/stylesheet.b3faf608c544858ba700943ffe182cb647f38432d29a07d73234965beacb26f6.css integrity="sha256-s/r2CMVEhYunAJQ//hgstkfzhDLSmgfXMjSWW+rLJvY=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://xiaokunji.com/img/Q.svg><link rel=icon type=image/png sizes=16x16 href=https://xiaokunji.com/img/Q.svg><link rel=icon type=image/png sizes=32x32 href=https://xiaokunji.com/img/Q.svg><link rel=apple-touch-icon href=https://xiaokunji.com/Q.svg><link rel=mask-icon href=https://xiaokunji.com/Q.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/airflow/airflow.html><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="airflow"><meta property="og:description" content="     "><meta property="og:type" content="article"><meta property="og:url" content="https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/airflow/airflow.html"><meta property="article:section" content="hadoopç”Ÿæ€åœˆ"><meta property="article:published_time" content="2022-08-22T00:00:00+00:00"><meta property="article:modified_time" content="2023-09-04T11:26:13+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="airflow"><meta name=twitter:description content="     "><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":4,"name":"airflow","item":"https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/airflow/airflow.html"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"airflow","name":"airflow","description":"     ","keywords":[" 1. ç®€ä»‹"," 2ã€Airflow çš„æœåŠ¡æ„æˆ"," 3. Airflow çš„ Web ç•Œé¢"," 1ã€DAG åˆ—è¡¨"," 2ã€ä½œä¸šæ“ä½œæ¡†"," 4. DAG é…ç½®"," -*- coding: utf-8 -*-"," ç”¨[]å¯ä»¥å¹¶è¡Œæ‰§è¡Œå¤šä¸ªjob, task \u003e\u003e [job1,job2]"," ç­‰åŒäº task.set_downstream(run_this_last)"],"articleBody":"[toc]\n1. ç®€ä»‹ Airflowæ˜¯ä¸€ä¸ªå¯ç¼–ç¨‹ï¼Œè°ƒåº¦å’Œç›‘æ§çš„å·¥ä½œæµå¹³å°ï¼ŒåŸºäºæœ‰å‘æ— ç¯å›¾(DAG)ï¼Œairflowå¯ä»¥å®šä¹‰ä¸€ç»„æœ‰ä¾èµ–çš„ä»»åŠ¡ï¼ŒæŒ‰ç…§ä¾èµ–ä¾æ¬¡æ‰§è¡Œã€‚airflowæä¾›äº†ä¸°å¯Œçš„å‘½ä»¤è¡Œå·¥å…·ç”¨äºç³»ç»Ÿç®¡æ§ï¼Œè€Œå…¶webç®¡ç†ç•Œé¢åŒæ ·ä¹Ÿå¯ä»¥æ–¹ä¾¿çš„ç®¡æ§è°ƒåº¦ä»»åŠ¡ï¼Œå¹¶ä¸”å¯¹ä»»åŠ¡è¿è¡ŒçŠ¶æ€è¿›è¡Œå®æ—¶ç›‘æ§ï¼Œæ–¹ä¾¿äº†ç³»ç»Ÿçš„è¿ç»´å’Œç®¡ç†ã€‚\nAirflow ä¸­å¸¸è§çš„åè¯æ¦‚å¿µï¼š\nDAG\nDAG æ„ä¸ºæœ‰å‘æ— å¾ªç¯å›¾ï¼Œåœ¨ Airflow ä¸­åˆ™å®šä¹‰äº†æ•´ä¸ªå®Œæ•´çš„ä½œä¸šã€‚åŒä¸€ä¸ª DAG ä¸­çš„æ‰€æœ‰ Task æ‹¥æœ‰ç›¸åŒçš„è°ƒåº¦æ—¶é—´ã€‚\nTask\nTask ä¸º DAG ä¸­å…·ä½“çš„ä½œä¸šä»»åŠ¡ï¼Œå®ƒå¿…é¡»å­˜åœ¨äºæŸä¸€ä¸ª DAG ä¹‹ä¸­ã€‚Task åœ¨ DAG ä¸­é…ç½®ä¾èµ–å…³ç³»ï¼Œè·¨ DAG çš„ä¾èµ–æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯å¹¶ä¸æ¨èã€‚è·¨ DAG ä¾èµ–ä¼šå¯¼è‡´ DAG å›¾çš„ç›´è§‚æ€§é™ä½ï¼Œå¹¶ç»™ä¾èµ–ç®¡ç†å¸¦æ¥éº»çƒ¦ã€‚\nDAG Run\nå½“ä¸€ä¸ª DAG æ»¡è¶³å®ƒçš„è°ƒåº¦æ—¶é—´ï¼Œæˆ–è€…è¢«å¤–éƒ¨è§¦å‘æ—¶ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ª DAG Runã€‚å¯ä»¥ç†è§£ä¸ºç”± DAG å®ä¾‹åŒ–çš„å®ä¾‹ã€‚\nTask Instance\nå½“ä¸€ä¸ª Task è¢«è°ƒåº¦å¯åŠ¨æ—¶ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ª Task Instanceã€‚å¯ä»¥ç†è§£ä¸ºç”± Task å®ä¾‹åŒ–çš„å®ä¾‹ã€‚\n2ã€Airflow çš„æœåŠ¡æ„æˆ ä¸€ä¸ªæ­£å¸¸è¿è¡Œçš„ Airflow ç³»ç»Ÿä¸€èˆ¬ç”±ä»¥ä¸‹å‡ ä¸ªæœåŠ¡æ„æˆ\nWebServer\nâ€‹\tAirflow æä¾›äº†ä¸€ä¸ªå¯è§†åŒ–çš„ Web ç•Œé¢ã€‚å¯åŠ¨ WebServer åï¼Œå°±å¯ä»¥åœ¨ Web ç•Œé¢ä¸ŠæŸ¥çœ‹å®šä¹‰å¥½çš„ DAG å¹¶ç›‘æ§åŠæ”¹å˜è¿è¡ŒçŠ¶å†µã€‚ä¹Ÿå¯ä»¥åœ¨ Web ç•Œé¢ä¸­å¯¹ä¸€äº›å˜é‡è¿›è¡Œé…ç½®ã€‚\nWorker\nâ€‹\tä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ç”¨ Celery Worker æ¥æ‰§è¡Œå…·ä½“çš„ä½œä¸šã€‚Worker å¯ä»¥éƒ¨ç½²åœ¨å¤šå°æœºå™¨ä¸Šï¼Œå¹¶å¯ä»¥åˆ†åˆ«è®¾ç½®æ¥æ”¶çš„é˜Ÿåˆ—ã€‚å½“æ¥æ”¶çš„é˜Ÿåˆ—ä¸­æœ‰ä½œä¸šä»»åŠ¡æ—¶ï¼ŒWorker å°±ä¼šæ¥æ”¶è¿™ä¸ªä½œä¸šä»»åŠ¡ï¼Œå¹¶å¼€å§‹æ‰§è¡Œã€‚Airflow ä¼šè‡ªåŠ¨åœ¨æ¯ä¸ªéƒ¨ç½² Worker çš„æœºå™¨ä¸ŠåŒæ—¶éƒ¨ç½²ä¸€ä¸ª Serve Logs æœåŠ¡ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ Web ç•Œé¢ä¸Šæ–¹ä¾¿çš„æµè§ˆåˆ†æ•£åœ¨ä¸åŒæœºå™¨ä¸Šçš„ä½œä¸šæ—¥å¿—äº†ã€‚\nScheduler\nâ€‹\tæ•´ä¸ª Airflow çš„è°ƒåº¦ç”± Scheduler è´Ÿè´£å‘èµ·ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´ Scheduler å°±ä¼šæ£€æŸ¥æ‰€æœ‰å®šä¹‰å®Œæˆçš„ DAG å’Œå®šä¹‰åœ¨å…¶ä¸­çš„ä½œä¸šï¼Œå¦‚æœæœ‰ç¬¦åˆè¿è¡Œæ¡ä»¶çš„ä½œä¸šï¼ŒScheduler å°±ä¼šå‘èµ·ç›¸åº”çš„ä½œä¸šä»»åŠ¡ä»¥ä¾› Worker æ¥æ”¶ã€‚\nFlower\nâ€‹\tFlower æä¾›äº†ä¸€ä¸ªå¯è§†åŒ–ç•Œé¢ä»¥ç›‘æ§æ‰€æœ‰ Celery Worker çš„è¿è¡ŒçŠ¶å†µã€‚è¿™ä¸ªæœåŠ¡å¹¶ä¸æ˜¯å¿…è¦çš„ã€‚\n3. Airflow çš„ Web ç•Œé¢ 1ã€DAG åˆ—è¡¨ DAG åˆ—è¡¨\nå·¦ä¾§ On/Off æŒ‰é’®æ§åˆ¶ DAG çš„è¿è¡ŒçŠ¶æ€ï¼ŒOff ä¸ºæš‚åœçŠ¶æ€ï¼ŒOn ä¸ºè¿è¡ŒçŠ¶æ€ã€‚æ³¨æ„ï¼šæ‰€æœ‰ DAG è„šæœ¬åˆæ¬¡éƒ¨ç½²å®Œæˆæ—¶å‡ä¸º Off çŠ¶æ€ã€‚ è‹¥ DAG åç§°å¤„äºä¸å¯ç‚¹å‡»çŠ¶æ€ï¼Œå¯èƒ½ä¸º DAG è¢«åˆ é™¤æˆ–æœªè½½å…¥ã€‚è‹¥ DAG æœªè½½å…¥ï¼Œå¯ç‚¹å‡»å³ä¾§åˆ·æ–°æŒ‰é’®è¿›è¡Œåˆ·æ–°ã€‚æ³¨æ„ï¼šç”±äºå¯ä»¥éƒ¨ç½²è‹¥å¹² WebServerï¼Œæ‰€ä»¥å•æ¬¡åˆ·æ–°å¯èƒ½æ— æ³•åˆ·æ–°æ‰€æœ‰ WebServer ç¼“å­˜ï¼Œå¯ä»¥å°è¯•å¤šæ¬¡åˆ·æ–°ã€‚ Recent Tasks ä¼šæ˜¾ç¤ºæœ€è¿‘ä¸€æ¬¡ DAG Runï¼ˆå¯ä»¥ç†è§£ä¸º DAG çš„æ‰§è¡Œè®°å½•ï¼‰ä¸­ Task Instancesï¼ˆå¯ä»¥ç†è§£ä¸ºä½œä¸šçš„æ‰§è¡Œè®°å½•ï¼‰çš„è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœ DAG Run çš„çŠ¶æ€ä¸º runningï¼Œæ­¤æ—¶æ˜¾ç¤ºæœ€è¿‘å®Œæˆçš„ä¸€æ¬¡ä»¥åŠæ­£åœ¨è¿è¡Œçš„ DAG Run ä¸­æ‰€æœ‰ Task Instances çš„çŠ¶æ€ã€‚ Last Run æ˜¾ç¤ºæœ€è¿‘ä¸€æ¬¡çš„ execution dateã€‚æ³¨æ„ï¼šexecution date å¹¶ä¸æ˜¯çœŸå®æ‰§è¡Œæ—¶é—´ï¼Œå…·ä½“ç»†èŠ‚åœ¨ä¸‹æ–‡ DAG é…ç½®ä¸­è¯¦è¿°ã€‚å°†é¼ æ ‡ç§»è‡³ execution date å³ä¾§ info æ ‡è®°ä¸Šï¼Œä¼šæ˜¾ç¤º start dateï¼Œstart date ä¸ºçœŸå®è¿è¡Œæ—¶é—´ã€‚start date ä¸€èˆ¬ä¸º execution date æ‰€å¯¹åº”çš„ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´ã€‚ 2ã€ä½œä¸šæ“ä½œæ¡† åœ¨ DAG çš„æ ‘çŠ¶å›¾å’Œ DAG å›¾ä¸­éƒ½å¯ä»¥ç‚¹å‡»å¯¹åº”çš„ Task Instance ä»¥å¼¹å‡º Task Instance æ¨¡æ€æ¡†ï¼Œä»¥è¿›è¡Œ Task Instance çš„ç›¸å…³æ“ä½œã€‚æ³¨æ„ï¼šé€‰æ‹©çš„ Task Instance ä¸ºå¯¹åº” DAG Run ä¸­çš„ Task Instanceã€‚\nä½œä¸šæ“ä½œæ¡†\nåœ¨ä½œä¸šåå­—çš„å³è¾¹æœ‰ä¸€ä¸ªæ¼æ–—ç¬¦å·ï¼Œç‚¹å‡»åæ•´ä¸ª DAG çš„ç•Œé¢å°†åªæ˜¾ç¤ºè¯¥ä½œä¸šåŠè¯¥ä½œä¸šçš„ä¾èµ–ä½œä¸šã€‚å½“è¯¥ä½œä¸šæ‰€å¤„çš„ DAG è¾ƒå¤§æ—¶ï¼Œæ­¤åŠŸèƒ½æœ‰è¾ƒå¤§çš„å¸®åŠ©ã€‚ Task Instance Details æ˜¾ç¤ºè¯¥ Task Instance çš„è¯¦æƒ…ï¼Œå¯ä»¥ä»ä¸­å¾—çŸ¥è¯¥ Task Instance çš„å½“å‰çŠ¶æ€ï¼Œä»¥åŠå¤„äºå½“å‰çŠ¶æ€çš„åŸå› ã€‚ä¾‹å¦‚ï¼Œè‹¥è¯¥ Task Instance ä¸º no status çŠ¶æ€ï¼Œè¿Ÿè¿Ÿä¸è¿›å…¥ queued åŠ running çŠ¶æ€ï¼Œæ­¤æ—¶å°±å¯é€šè¿‡ Task Instance Details ä¸­çš„ Dependency åŠ Reason å¾—çŸ¥åŸå› ã€‚ Rendered æ˜¾ç¤ºè¯¥ Task Instance è¢«æ¸²æŸ“åçš„å‘½ä»¤ã€‚ Run æŒ‡ä»¤å¯ä»¥ç›´æ¥æ‰§è¡Œå½“å‰ä½œä¸šã€‚ Clear æŒ‡ä»¤ä¸ºæ¸…é™¤å½“å‰ Task Instance çŠ¶æ€ï¼Œæ¸…é™¤ä»»æ„ä¸€ä¸ª Task Instance éƒ½ä¼šä½¿å½“å‰ DAG Run çš„çŠ¶æ€å˜æ›´ä¸º runningã€‚æ³¨æ„ï¼šå¦‚æœè¢«æ¸…é™¤çš„ Task Instance çš„çŠ¶æ€ä¸º runningï¼Œåˆ™ä¼šå°è¯• kill è¯¥ Task Instance æ‰€æ‰§è¡ŒæŒ‡ä»¤ï¼Œå¹¶è¿›å…¥ shutdown çŠ¶æ€ï¼Œå¹¶åœ¨ kill å®Œæˆåå°†æ­¤æ¬¡æ‰§è¡Œæ ‡è®°ä¸º failedï¼ˆå¦‚æœ retry æ¬¡æ•°æ²¡æœ‰ç”¨å®Œï¼Œå°†æ ‡è®°ä¸º up_for_retryï¼‰ã€‚Clear æœ‰é¢å¤–çš„5ä¸ªé€‰é¡¹ï¼Œå‡ä¸ºå¤šé€‰ï¼Œè¿™äº›é€‰é¡¹ä»å·¦åˆ°å³ä¾æ¬¡ä¸ºï¼š Past: åŒæ—¶æ¸…é™¤æ‰€æœ‰è¿‡å»çš„ DAG Run ä¸­æ­¤ Task Instance æ‰€å¯¹åº”çš„ Task Instanceã€‚ Future: åŒæ—¶æ¸…é™¤æ‰€æœ‰æœªæ¥çš„ DAG Run ä¸­æ­¤ Task Instance æ‰€å¯¹åº”çš„ Task Instanceã€‚æ³¨æ„ï¼šä»…æ¸…é™¤å·²ç”Ÿæˆçš„ DAG Run ä¸­çš„ Task Instanceã€‚ Upstream: åŒæ—¶æ¸…é™¤è¯¥ DAG Run ä¸­æ‰€æœ‰æ­¤ Task Instance ä¸Šæ¸¸çš„ Task Instanceã€‚ Downstream: åŒæ—¶æ¸…é™¤è¯¥ DAG Run ä¸­æ‰€æœ‰æ­¤ Task Instance ä¸‹æ¸¸çš„ Task Instanceã€‚ Recursive: å½“æ­¤ Task Instance ä¸º sub DAG æ—¶ï¼Œå¾ªç¯æ¸…é™¤æ‰€æœ‰è¯¥ sub DAG ä¸­çš„ Task Instanceã€‚æ³¨æ„ï¼šè‹¥å½“æ­¤ Task Instance ä¸æ˜¯ sub DAG åˆ™å¿½ç•¥æ­¤é€‰é¡¹ã€‚ Mark Success æŒ‡ä»¤ä¸ºè®²å½“å‰ Task Instance çŠ¶æ€æ ‡è®°ä¸º successã€‚æ³¨æ„ï¼šå¦‚æœè¯¥ Task Instance çš„çŠ¶æ€ä¸º runningï¼Œåˆ™ä¼šå°è¯• kill è¯¥ Task Instance æ‰€æ‰§è¡ŒæŒ‡ä»¤ï¼Œå¹¶è¿›å…¥ shutdown çŠ¶æ€ï¼Œå¹¶åœ¨ kill å®Œæˆåå°†æ­¤æ¬¡æ‰§è¡Œæ ‡è®°ä¸º failedï¼ˆå¦‚æœ retry æ¬¡æ•°æ²¡æœ‰ç”¨å®Œï¼Œå°†æ ‡è®°ä¸º up_for_retryï¼‰ã€‚ 4. DAG é…ç½® Airflow ä¸­çš„ DAG æ˜¯ç”± Python è„šæœ¬æ¥é…ç½®çš„ï¼Œå› è€Œå¯æ‰©å±•æ€§éå¸¸å¼ºã€‚Airflow æä¾›äº†ä¸€äº› DAG ä¾‹å­ï¼Œ\n# -*- coding: utf-8 -*- import airflow from airflow.operators.bash_operator import BashOperator from airflow.operators.dummy_operator import DummyOperator from airflow.models import DAG args = { 'owner': 'airflow', 'start_date': airflow.utils.dates.days_ago(2) # ä½œä¸šçš„å¼€å§‹æ—¶é—´ï¼Œå³ä½œä¸šå°†åœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä»¥åå¼€å§‹è°ƒåº¦ã€‚ } dag = DAG( dag_id='example_bash_operator', # ç»™ DAG å–ä¸€ä¸ªåå­—,ä¸èƒ½é‡å¤ default_args=args, schedule_interval='0 0 * * *' # é…ç½® DAG çš„æ‰§è¡Œå‘¨æœŸï¼Œè¯­æ³•å’Œ crontab çš„ä¸€è‡´ ) cmd = 'ls -l' run_this_last = DummyOperator(task_id='run_this_last', dag=dag) run_this = BashOperator( task_id='run_after_loop', bash_command='echo 1', dag=dag) run_this.set_downstream(run_this_last) for i in range(3): i = str(i) task = BashOperator( task_id='runme_'+i, bash_command='echo \"{{ task_instance_key_str }}\" \u0026\u0026 sleep 1', dag=dag) task.set_downstream(run_this) task = BashOperator( task_id='also_run_this', bash_command='echo \"run_id={{ run_id }} | dag_run={{ dag_run }}\"', dag=dag) # ç”¨[]å¯ä»¥å¹¶è¡Œæ‰§è¡Œå¤šä¸ªjob, task \u003e\u003e [job1,job2] # ç­‰åŒäº task.set_downstream(run_this_last) task \u003e\u003e run_this_last é‚£ä¹ˆç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å½“ä¸€ä¸ªæ–°é…ç½®çš„ DAG ç”Ÿæ•ˆåç¬¬ä¸€æ¬¡è°ƒåº¦ä¼šåœ¨ä»€ä¹ˆæ—¶å€™ã€‚å…¶å®ç¬¬ä¸€æ¬¡è°ƒåº¦æ—¶é—´æ˜¯åœ¨ä½œä¸šä¸­é…ç½®çš„ start date çš„ç¬¬äºŒä¸ªæ»¡è¶³ schedule interval çš„æ—¶é—´ç‚¹ï¼Œå¹¶ä¸”è®°å½•çš„ execution date ä¸ºä½œä¸šä¸­é…ç½®çš„ start date çš„ç¬¬ä¸€ä¸ªæ»¡è¶³ schedule interval çš„æ—¶é—´ç‚¹.\nå‡è®¾æˆ‘ä»¬é…ç½®äº†ä¸€ä¸ªä½œä¸šçš„ start date ä¸º 2017å¹´10æœˆ1æ—¥ï¼Œé…ç½®çš„ schedule interval ä¸º **00 12 * * *** é‚£ä¹ˆç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶é—´å°†æ˜¯ 2017å¹´10æœˆ2æ—¥ 12ç‚¹ è€Œæ­¤æ—¶è®°å½•çš„ execution date ä¸º 2017å¹´10æœˆ1æ—¥ 12ç‚¹ã€‚å› æ­¤ execution date å¹¶ä¸æ˜¯å¦‚å…¶å­—é¢è¯´çš„è¡¨ç¤ºæ‰§è¡Œæ—¶é—´ï¼ŒçœŸæ­£çš„æ‰§è¡Œæ—¶é—´æ˜¯ execution date æ‰€æ˜¾ç¤ºçš„æ—¶é—´çš„ä¸‹ä¸€ä¸ªæ»¡è¶³ schedule interval çš„æ—¶é—´ç‚¹ã€‚\næµ…è°ˆ å®æˆ˜ ä½¿ç”¨ æ­å»ºåŠé—®é¢˜ å®˜ç½‘ ","wordCount":"2298","inLanguage":"zh","datePublished":"2022-08-22T00:00:00Z","dateModified":"2023-09-04T11:26:13.519235124Z","author":{"@type":"Person","name":"xkj"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/airflow/airflow.html"},"publisher":{"@type":"Organization","name":"ç±³äºŒ","logo":{"@type":"ImageObject","url":"https://xiaokunji.com/img/Q.svg"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://xiaokunji.com/zh/ accesskey=h title="ç±³äºŒ (Alt + H)"><img src=https://xiaokunji.com/img/Q.svg alt aria-label=logo height=35>ç±³äºŒ</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://xiaokunji.com/en/ title=English aria-label=English>English</a></li></ul></div></div><ul id=menu><li><a href=https://xiaokunji.com/zh/ title=ğŸ ä¸»é¡µ><span>ğŸ ä¸»é¡µ</span></a></li><li><a href=https://xiaokunji.com/zh/search title="ğŸ”æœç´¢ (Alt + /)" accesskey=/><span>ğŸ”æœç´¢</span></a></li><li><a href=https://xiaokunji.com/zh/post.html title=ğŸ“šæ–‡ç« ><span>ğŸ“šæ–‡ç« </span></a></li><li><a href=https://xiaokunji.com/zh/archives.html title=â±æ—¶é—´è½´><span>â±æ—¶é—´è½´</span></a></li><li><a href=https://xiaokunji.com/zh/tags.html title=ğŸ”–æ ‡ç­¾><span>ğŸ”–æ ‡ç­¾</span></a></li><li><a href=https://xiaokunji.com/zh/categories.html title=ğŸ“–åˆ†ç±»><span>ğŸ“–åˆ†ç±»</span></a></li><li><a href=https://xiaokunji.com/zh/links.html title=ğŸ¤å‹é“¾><span>ğŸ¤å‹é“¾</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><nav aria-label=breadcrumb><ul><a href=https://xiaokunji.com/zh/>ğŸ </a> <span>></span>
<a href=https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88.html>hadoopç”Ÿæ€åœˆ</a> <span>></span>
<a href=https://xiaokunji.com/zh/hadoop%E7%94%9F%E6%80%81%E5%9C%88/airflow.html>airflow</a> <span>></span></ul></nav><h1 class=post-title>airflow</h1><div class=post-description></div><div class=post-meta>åˆ›å»º:&nbsp;<span title='2022-08-22 00:00:00 +0000 UTC'>2022-08-22</span>&nbsp;Â·&nbsp;æ›´æ–°:&nbsp;2023-09-04&nbsp;Â·&nbsp;xkj
&nbsp;|&nbsp;åˆ†ç±»: &nbsp;<ul class=post-categories-meta><a href=https://xiaokunji.com/zh/categories/Hadoop%E7%94%9F%E6%80%81%E5%9C%88.html>Hadoopç”Ÿæ€åœˆ</a></ul><span id=busuanzi_container_page_pv>&nbsp;| è®¿é—®: <span id=busuanzi_value_page_pv>1</span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#1-%e7%ae%80%e4%bb%8b aria-label="1. ç®€ä»‹">1. ç®€ä»‹</a></li><li><a href=#2airflow-%e7%9a%84%e6%9c%8d%e5%8a%a1%e6%9e%84%e6%88%90 aria-label="2ã€Airflow çš„æœåŠ¡æ„æˆ">2ã€Airflow çš„æœåŠ¡æ„æˆ</a></li><li><a href=#3-airflow-%e7%9a%84-web-%e7%95%8c%e9%9d%a2 aria-label="3. Airflow çš„ Web ç•Œé¢">3. Airflow çš„ Web ç•Œé¢</a><ul><li><a href=#1dag-%e5%88%97%e8%a1%a8 aria-label="1ã€DAG åˆ—è¡¨">1ã€DAG åˆ—è¡¨</a></li><li><a href=#2%e4%bd%9c%e4%b8%9a%e6%93%8d%e4%bd%9c%e6%a1%86 aria-label=2ã€ä½œä¸šæ“ä½œæ¡†>2ã€ä½œä¸šæ“ä½œæ¡†</a></li></ul></li><li><a href=#4-dag-%e9%85%8d%e7%bd%ae aria-label="4. DAG é…ç½®">4. DAG é…ç½®</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>[toc]</p><h1 id=1-ç®€ä»‹>1. ç®€ä»‹<a hidden class=anchor aria-hidden=true href=#1-ç®€ä»‹>#</a></h1><p>Airflowæ˜¯ä¸€ä¸ªå¯ç¼–ç¨‹ï¼Œè°ƒåº¦å’Œç›‘æ§çš„å·¥ä½œæµå¹³å°ï¼ŒåŸºäºæœ‰å‘æ— ç¯å›¾(DAG)ï¼Œairflowå¯ä»¥å®šä¹‰ä¸€ç»„æœ‰ä¾èµ–çš„ä»»åŠ¡ï¼ŒæŒ‰ç…§ä¾èµ–ä¾æ¬¡æ‰§è¡Œã€‚airflowæä¾›äº†ä¸°å¯Œçš„å‘½ä»¤è¡Œå·¥å…·ç”¨äºç³»ç»Ÿç®¡æ§ï¼Œè€Œå…¶webç®¡ç†ç•Œé¢åŒæ ·ä¹Ÿå¯ä»¥æ–¹ä¾¿çš„ç®¡æ§è°ƒåº¦ä»»åŠ¡ï¼Œå¹¶ä¸”å¯¹ä»»åŠ¡è¿è¡ŒçŠ¶æ€è¿›è¡Œå®æ—¶ç›‘æ§ï¼Œæ–¹ä¾¿äº†ç³»ç»Ÿçš„è¿ç»´å’Œç®¡ç†ã€‚</p><p>Airflow ä¸­å¸¸è§çš„åè¯æ¦‚å¿µï¼š</p><ul><li><p><strong>DAG</strong></p><p>DAG æ„ä¸ºæœ‰å‘æ— å¾ªç¯å›¾ï¼Œåœ¨ Airflow ä¸­åˆ™å®šä¹‰äº†æ•´ä¸ªå®Œæ•´çš„ä½œä¸šã€‚åŒä¸€ä¸ª DAG ä¸­çš„æ‰€æœ‰ Task æ‹¥æœ‰ç›¸åŒçš„è°ƒåº¦æ—¶é—´ã€‚</p></li><li><p><strong>Task</strong></p><p>Task ä¸º DAG ä¸­å…·ä½“çš„ä½œä¸šä»»åŠ¡ï¼Œå®ƒå¿…é¡»å­˜åœ¨äºæŸä¸€ä¸ª DAG ä¹‹ä¸­ã€‚Task åœ¨ DAG ä¸­é…ç½®ä¾èµ–å…³ç³»ï¼Œè·¨ DAG çš„ä¾èµ–æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯å¹¶ä¸æ¨èã€‚è·¨ DAG ä¾èµ–ä¼šå¯¼è‡´ DAG å›¾çš„ç›´è§‚æ€§é™ä½ï¼Œå¹¶ç»™ä¾èµ–ç®¡ç†å¸¦æ¥éº»çƒ¦ã€‚</p></li><li><p><strong>DAG Run</strong></p><p>å½“ä¸€ä¸ª DAG æ»¡è¶³å®ƒçš„è°ƒåº¦æ—¶é—´ï¼Œæˆ–è€…è¢«å¤–éƒ¨è§¦å‘æ—¶ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ª DAG Runã€‚å¯ä»¥ç†è§£ä¸ºç”± DAG å®ä¾‹åŒ–çš„å®ä¾‹ã€‚</p></li><li><p><strong>Task Instance</strong></p><p>å½“ä¸€ä¸ª Task è¢«è°ƒåº¦å¯åŠ¨æ—¶ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ª Task Instanceã€‚å¯ä»¥ç†è§£ä¸ºç”± Task å®ä¾‹åŒ–çš„å®ä¾‹ã€‚</p></li></ul><h1 id=2airflow-çš„æœåŠ¡æ„æˆ>2ã€Airflow çš„æœåŠ¡æ„æˆ<a hidden class=anchor aria-hidden=true href=#2airflow-çš„æœåŠ¡æ„æˆ>#</a></h1><p>ä¸€ä¸ªæ­£å¸¸è¿è¡Œçš„ Airflow ç³»ç»Ÿä¸€èˆ¬ç”±ä»¥ä¸‹å‡ ä¸ªæœåŠ¡æ„æˆ</p><ul><li><p><strong>WebServer</strong></p><p>â€‹ Airflow æä¾›äº†ä¸€ä¸ªå¯è§†åŒ–çš„ Web ç•Œé¢ã€‚å¯åŠ¨ WebServer åï¼Œå°±å¯ä»¥åœ¨ Web ç•Œé¢ä¸ŠæŸ¥çœ‹å®šä¹‰å¥½çš„ DAG å¹¶ç›‘æ§åŠæ”¹å˜è¿è¡ŒçŠ¶å†µã€‚ä¹Ÿå¯ä»¥åœ¨ Web ç•Œé¢ä¸­å¯¹ä¸€äº›å˜é‡è¿›è¡Œé…ç½®ã€‚</p></li><li><p><strong>Worker</strong></p><p>â€‹ ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ç”¨ Celery Worker æ¥æ‰§è¡Œå…·ä½“çš„ä½œä¸šã€‚Worker å¯ä»¥éƒ¨ç½²åœ¨å¤šå°æœºå™¨ä¸Šï¼Œå¹¶å¯ä»¥åˆ†åˆ«è®¾ç½®æ¥æ”¶çš„é˜Ÿåˆ—ã€‚å½“æ¥æ”¶çš„é˜Ÿåˆ—ä¸­æœ‰ä½œä¸šä»»åŠ¡æ—¶ï¼ŒWorker å°±ä¼šæ¥æ”¶è¿™ä¸ªä½œä¸šä»»åŠ¡ï¼Œå¹¶å¼€å§‹æ‰§è¡Œã€‚Airflow ä¼šè‡ªåŠ¨åœ¨æ¯ä¸ªéƒ¨ç½² Worker çš„æœºå™¨ä¸ŠåŒæ—¶éƒ¨ç½²ä¸€ä¸ª Serve Logs æœåŠ¡ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ Web ç•Œé¢ä¸Šæ–¹ä¾¿çš„æµè§ˆåˆ†æ•£åœ¨ä¸åŒæœºå™¨ä¸Šçš„ä½œä¸šæ—¥å¿—äº†ã€‚</p></li><li><p><strong>Scheduler</strong></p><p>â€‹ æ•´ä¸ª Airflow çš„è°ƒåº¦ç”± Scheduler è´Ÿè´£å‘èµ·ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´ Scheduler å°±ä¼šæ£€æŸ¥æ‰€æœ‰å®šä¹‰å®Œæˆçš„ DAG å’Œå®šä¹‰åœ¨å…¶ä¸­çš„ä½œä¸šï¼Œå¦‚æœæœ‰ç¬¦åˆè¿è¡Œæ¡ä»¶çš„ä½œä¸šï¼ŒScheduler å°±ä¼šå‘èµ·ç›¸åº”çš„ä½œä¸šä»»åŠ¡ä»¥ä¾› Worker æ¥æ”¶ã€‚</p></li><li><p><strong>Flower</strong></p><p>â€‹ Flower æä¾›äº†ä¸€ä¸ªå¯è§†åŒ–ç•Œé¢ä»¥ç›‘æ§æ‰€æœ‰ Celery Worker çš„è¿è¡ŒçŠ¶å†µã€‚è¿™ä¸ªæœåŠ¡å¹¶ä¸æ˜¯å¿…è¦çš„ã€‚</p></li></ul><p><img loading=lazy src=https://pic4.zhimg.com/80/v2-35a160b63e7389fe12f451e299ab0c00_720w.jpg alt=img></p><h1 id=3-airflow-çš„-web-ç•Œé¢>3. Airflow çš„ Web ç•Œé¢<a hidden class=anchor aria-hidden=true href=#3-airflow-çš„-web-ç•Œé¢>#</a></h1><h2 id=1dag-åˆ—è¡¨>1ã€DAG åˆ—è¡¨<a hidden class=anchor aria-hidden=true href=#1dag-åˆ—è¡¨>#</a></h2><p><img loading=lazy src=https://upload-images.jianshu.io/upload_images/9094111-c4d1bb23df2557e3.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/1169/format/webp alt=img></p><p>DAG åˆ—è¡¨</p><ol><li>å·¦ä¾§ On/Off æŒ‰é’®æ§åˆ¶ DAG çš„è¿è¡ŒçŠ¶æ€ï¼ŒOff ä¸ºæš‚åœçŠ¶æ€ï¼ŒOn ä¸ºè¿è¡ŒçŠ¶æ€ã€‚æ³¨æ„ï¼šæ‰€æœ‰ DAG è„šæœ¬åˆæ¬¡éƒ¨ç½²å®Œæˆæ—¶å‡ä¸º Off çŠ¶æ€ã€‚</li><li>è‹¥ DAG åç§°å¤„äºä¸å¯ç‚¹å‡»çŠ¶æ€ï¼Œå¯èƒ½ä¸º DAG è¢«åˆ é™¤æˆ–æœªè½½å…¥ã€‚è‹¥ DAG æœªè½½å…¥ï¼Œå¯ç‚¹å‡»å³ä¾§åˆ·æ–°æŒ‰é’®è¿›è¡Œåˆ·æ–°ã€‚æ³¨æ„ï¼šç”±äºå¯ä»¥éƒ¨ç½²è‹¥å¹² WebServerï¼Œæ‰€ä»¥å•æ¬¡åˆ·æ–°å¯èƒ½æ— æ³•åˆ·æ–°æ‰€æœ‰ WebServer ç¼“å­˜ï¼Œå¯ä»¥å°è¯•å¤šæ¬¡åˆ·æ–°ã€‚</li><li>Recent Tasks ä¼šæ˜¾ç¤ºæœ€è¿‘ä¸€æ¬¡ DAG Runï¼ˆå¯ä»¥ç†è§£ä¸º DAG çš„æ‰§è¡Œè®°å½•ï¼‰ä¸­ Task Instancesï¼ˆå¯ä»¥ç†è§£ä¸ºä½œä¸šçš„æ‰§è¡Œè®°å½•ï¼‰çš„è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœ DAG Run çš„çŠ¶æ€ä¸º runningï¼Œæ­¤æ—¶æ˜¾ç¤ºæœ€è¿‘å®Œæˆçš„ä¸€æ¬¡ä»¥åŠæ­£åœ¨è¿è¡Œçš„ DAG Run ä¸­æ‰€æœ‰ Task Instances çš„çŠ¶æ€ã€‚</li><li>Last Run æ˜¾ç¤ºæœ€è¿‘ä¸€æ¬¡çš„ execution dateã€‚æ³¨æ„ï¼šexecution date å¹¶ä¸æ˜¯çœŸå®æ‰§è¡Œæ—¶é—´ï¼Œå…·ä½“ç»†èŠ‚åœ¨ä¸‹æ–‡ DAG é…ç½®ä¸­è¯¦è¿°ã€‚å°†é¼ æ ‡ç§»è‡³ execution date å³ä¾§ info æ ‡è®°ä¸Šï¼Œä¼šæ˜¾ç¤º start dateï¼Œstart date ä¸ºçœŸå®è¿è¡Œæ—¶é—´ã€‚start date ä¸€èˆ¬ä¸º execution date æ‰€å¯¹åº”çš„ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´ã€‚</li></ol><h2 id=2ä½œä¸šæ“ä½œæ¡†>2ã€ä½œä¸šæ“ä½œæ¡†<a hidden class=anchor aria-hidden=true href=#2ä½œä¸šæ“ä½œæ¡†>#</a></h2><p>åœ¨ DAG çš„æ ‘çŠ¶å›¾å’Œ DAG å›¾ä¸­éƒ½å¯ä»¥ç‚¹å‡»å¯¹åº”çš„ Task Instance ä»¥å¼¹å‡º Task Instance æ¨¡æ€æ¡†ï¼Œä»¥è¿›è¡Œ Task Instance çš„ç›¸å…³æ“ä½œã€‚æ³¨æ„ï¼šé€‰æ‹©çš„ Task Instance ä¸ºå¯¹åº” DAG Run ä¸­çš„ Task Instanceã€‚</p><p><img loading=lazy src=https://upload-images.jianshu.io/upload_images/9094111-b857d859b23a2650.png?imageMogr2/auto-orient/strip%7cimageView2/2/w/649/format/webp alt=img></p><p>ä½œä¸šæ“ä½œæ¡†</p><ol><li>åœ¨ä½œä¸šåå­—çš„å³è¾¹æœ‰ä¸€ä¸ªæ¼æ–—ç¬¦å·ï¼Œç‚¹å‡»åæ•´ä¸ª DAG çš„ç•Œé¢å°†åªæ˜¾ç¤ºè¯¥ä½œä¸šåŠè¯¥ä½œä¸šçš„ä¾èµ–ä½œä¸šã€‚å½“è¯¥ä½œä¸šæ‰€å¤„çš„ DAG è¾ƒå¤§æ—¶ï¼Œæ­¤åŠŸèƒ½æœ‰è¾ƒå¤§çš„å¸®åŠ©ã€‚</li><li>Task Instance Details æ˜¾ç¤ºè¯¥ Task Instance çš„è¯¦æƒ…ï¼Œå¯ä»¥ä»ä¸­å¾—çŸ¥è¯¥ Task Instance çš„å½“å‰çŠ¶æ€ï¼Œä»¥åŠå¤„äºå½“å‰çŠ¶æ€çš„åŸå› ã€‚ä¾‹å¦‚ï¼Œè‹¥è¯¥ Task Instance ä¸º no status çŠ¶æ€ï¼Œè¿Ÿè¿Ÿä¸è¿›å…¥ queued åŠ running çŠ¶æ€ï¼Œæ­¤æ—¶å°±å¯é€šè¿‡ Task Instance Details ä¸­çš„ Dependency åŠ Reason å¾—çŸ¥åŸå› ã€‚</li><li>Rendered æ˜¾ç¤ºè¯¥ Task Instance è¢«æ¸²æŸ“åçš„å‘½ä»¤ã€‚</li><li>Run æŒ‡ä»¤å¯ä»¥ç›´æ¥æ‰§è¡Œå½“å‰ä½œä¸šã€‚</li><li>Clear æŒ‡ä»¤ä¸ºæ¸…é™¤å½“å‰ Task Instance çŠ¶æ€ï¼Œ<strong>æ¸…é™¤ä»»æ„ä¸€ä¸ª Task Instance éƒ½ä¼šä½¿å½“å‰ DAG Run çš„çŠ¶æ€å˜æ›´ä¸º running</strong>ã€‚æ³¨æ„ï¼šå¦‚æœè¢«æ¸…é™¤çš„ Task Instance çš„çŠ¶æ€ä¸º runningï¼Œåˆ™ä¼šå°è¯• kill è¯¥ Task Instance æ‰€æ‰§è¡ŒæŒ‡ä»¤ï¼Œå¹¶è¿›å…¥ shutdown çŠ¶æ€ï¼Œå¹¶åœ¨ kill å®Œæˆåå°†æ­¤æ¬¡æ‰§è¡Œæ ‡è®°ä¸º failedï¼ˆå¦‚æœ retry æ¬¡æ•°æ²¡æœ‰ç”¨å®Œï¼Œå°†æ ‡è®°ä¸º up_for_retryï¼‰ã€‚Clear æœ‰é¢å¤–çš„5ä¸ªé€‰é¡¹ï¼Œå‡ä¸ºå¤šé€‰ï¼Œè¿™äº›é€‰é¡¹ä»å·¦åˆ°å³ä¾æ¬¡ä¸ºï¼š<ul><li><strong>Past</strong>: åŒæ—¶æ¸…é™¤æ‰€æœ‰è¿‡å»çš„ DAG Run ä¸­æ­¤ Task Instance æ‰€å¯¹åº”çš„ Task Instanceã€‚</li><li><strong>Future</strong>: åŒæ—¶æ¸…é™¤æ‰€æœ‰æœªæ¥çš„ DAG Run ä¸­æ­¤ Task Instance æ‰€å¯¹åº”çš„ Task Instanceã€‚æ³¨æ„ï¼šä»…æ¸…é™¤å·²ç”Ÿæˆçš„ DAG Run ä¸­çš„ Task Instanceã€‚</li><li><strong>Upstream</strong>: åŒæ—¶æ¸…é™¤è¯¥ DAG Run ä¸­æ‰€æœ‰æ­¤ Task Instance ä¸Šæ¸¸çš„ Task Instanceã€‚</li><li><strong>Downstream</strong>: åŒæ—¶æ¸…é™¤è¯¥ DAG Run ä¸­æ‰€æœ‰æ­¤ Task Instance ä¸‹æ¸¸çš„ Task Instanceã€‚</li><li><strong>Recursive</strong>: å½“æ­¤ Task Instance ä¸º sub DAG æ—¶ï¼Œå¾ªç¯æ¸…é™¤æ‰€æœ‰è¯¥ sub DAG ä¸­çš„ Task Instanceã€‚æ³¨æ„ï¼šè‹¥å½“æ­¤ Task Instance ä¸æ˜¯ sub DAG åˆ™å¿½ç•¥æ­¤é€‰é¡¹ã€‚</li></ul></li><li>Mark Success æŒ‡ä»¤ä¸ºè®²å½“å‰ Task Instance çŠ¶æ€æ ‡è®°ä¸º successã€‚æ³¨æ„ï¼šå¦‚æœè¯¥ Task Instance çš„çŠ¶æ€ä¸º runningï¼Œåˆ™ä¼šå°è¯• kill è¯¥ Task Instance æ‰€æ‰§è¡ŒæŒ‡ä»¤ï¼Œå¹¶è¿›å…¥ shutdown çŠ¶æ€ï¼Œå¹¶åœ¨ kill å®Œæˆåå°†æ­¤æ¬¡æ‰§è¡Œæ ‡è®°ä¸º failedï¼ˆå¦‚æœ retry æ¬¡æ•°æ²¡æœ‰ç”¨å®Œï¼Œå°†æ ‡è®°ä¸º up_for_retryï¼‰ã€‚</li></ol><h1 id=4-dag-é…ç½®>4. DAG é…ç½®<a hidden class=anchor aria-hidden=true href=#4-dag-é…ç½®>#</a></h1><p>Airflow ä¸­çš„ DAG æ˜¯ç”± Python è„šæœ¬æ¥é…ç½®çš„ï¼Œå› è€Œå¯æ‰©å±•æ€§éå¸¸å¼ºã€‚Airflow æä¾›äº†ä¸€äº› DAG ä¾‹å­ï¼Œ</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b949e;font-style:italic># -*- coding: utf-8 -*-</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>airflow</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>airflow.operators.bash_operator</span> <span style=color:#ff7b72>import</span> BashOperator
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>airflow.operators.dummy_operator</span> <span style=color:#ff7b72>import</span> DummyOperator
</span></span><span style=display:flex><span><span style=color:#ff7b72>from</span> <span style=color:#ff7b72>airflow.models</span> <span style=color:#ff7b72>import</span> DAG
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>args <span style=color:#ff7b72;font-weight:700>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#39;owner&#39;</span>: <span style=color:#a5d6ff>&#39;airflow&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a5d6ff>&#39;start_date&#39;</span>: airflow<span style=color:#ff7b72;font-weight:700>.</span>utils<span style=color:#ff7b72;font-weight:700>.</span>dates<span style=color:#ff7b72;font-weight:700>.</span>days_ago(<span style=color:#a5d6ff>2</span>) <span style=color:#8b949e;font-style:italic># ä½œä¸šçš„å¼€å§‹æ—¶é—´ï¼Œå³ä½œä¸šå°†åœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä»¥åå¼€å§‹è°ƒåº¦ã€‚</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dag <span style=color:#ff7b72;font-weight:700>=</span> DAG(
</span></span><span style=display:flex><span>    dag_id<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;example_bash_operator&#39;</span>,  <span style=color:#8b949e;font-style:italic># ç»™ DAG å–ä¸€ä¸ªåå­—,ä¸èƒ½é‡å¤</span>
</span></span><span style=display:flex><span>    default_args<span style=color:#ff7b72;font-weight:700>=</span>args,
</span></span><span style=display:flex><span>    schedule_interval<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;0 0 * * *&#39;</span>  <span style=color:#8b949e;font-style:italic># é…ç½® DAG çš„æ‰§è¡Œå‘¨æœŸï¼Œè¯­æ³•å’Œ crontab çš„ä¸€è‡´</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cmd <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#39;ls -l&#39;</span>
</span></span><span style=display:flex><span>run_this_last <span style=color:#ff7b72;font-weight:700>=</span> DummyOperator(task_id<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;run_this_last&#39;</span>, dag<span style=color:#ff7b72;font-weight:700>=</span>dag)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>run_this <span style=color:#ff7b72;font-weight:700>=</span> BashOperator(
</span></span><span style=display:flex><span>    task_id<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;run_after_loop&#39;</span>, bash_command<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;echo 1&#39;</span>, dag<span style=color:#ff7b72;font-weight:700>=</span>dag)
</span></span><span style=display:flex><span>run_this<span style=color:#ff7b72;font-weight:700>.</span>set_downstream(run_this_last)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>for</span> i <span style=color:#ff7b72;font-weight:700>in</span> range(<span style=color:#a5d6ff>3</span>):
</span></span><span style=display:flex><span>    i <span style=color:#ff7b72;font-weight:700>=</span> str(i)
</span></span><span style=display:flex><span>    task <span style=color:#ff7b72;font-weight:700>=</span> BashOperator(
</span></span><span style=display:flex><span>        task_id<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;runme_&#39;</span><span style=color:#ff7b72;font-weight:700>+</span>i,
</span></span><span style=display:flex><span>        bash_command<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;echo &#34;{{ task_instance_key_str }}&#34; &amp;&amp; sleep 1&#39;</span>,
</span></span><span style=display:flex><span>        dag<span style=color:#ff7b72;font-weight:700>=</span>dag)
</span></span><span style=display:flex><span>    task<span style=color:#ff7b72;font-weight:700>.</span>set_downstream(run_this)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>task <span style=color:#ff7b72;font-weight:700>=</span> BashOperator(
</span></span><span style=display:flex><span>    task_id<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;also_run_this&#39;</span>,
</span></span><span style=display:flex><span>    bash_command<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;echo &#34;run_id={{ run_id }} | dag_run={{ dag_run }}&#34;&#39;</span>,
</span></span><span style=display:flex><span>    dag<span style=color:#ff7b72;font-weight:700>=</span>dag)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ç”¨[]å¯ä»¥å¹¶è¡Œæ‰§è¡Œå¤šä¸ªjob, task &gt;&gt; [job1,job2]</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># ç­‰åŒäº task.set_downstream(run_this_last)</span>
</span></span><span style=display:flex><span>task <span style=color:#ff7b72;font-weight:700>&gt;&gt;</span> run_this_last
</span></span></code></pre></div><blockquote><p>é‚£ä¹ˆç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å½“ä¸€ä¸ªæ–°é…ç½®çš„ DAG ç”Ÿæ•ˆåç¬¬ä¸€æ¬¡è°ƒåº¦ä¼šåœ¨ä»€ä¹ˆæ—¶å€™ã€‚å…¶å®ç¬¬ä¸€æ¬¡è°ƒåº¦æ—¶é—´æ˜¯åœ¨ä½œä¸šä¸­é…ç½®çš„ start date çš„ç¬¬äºŒä¸ªæ»¡è¶³ schedule interval çš„æ—¶é—´ç‚¹ï¼Œå¹¶ä¸”è®°å½•çš„ execution date ä¸ºä½œä¸šä¸­é…ç½®çš„ start date çš„ç¬¬ä¸€ä¸ªæ»¡è¶³ schedule interval çš„æ—¶é—´ç‚¹.</p><p>å‡è®¾æˆ‘ä»¬é…ç½®äº†ä¸€ä¸ªä½œä¸šçš„ start date ä¸º <strong>2017å¹´10æœˆ1æ—¥</strong>ï¼Œé…ç½®çš„ schedule interval ä¸º **00 12 * * *** é‚£ä¹ˆç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶é—´å°†æ˜¯ <strong>2017å¹´10æœˆ2æ—¥ 12ç‚¹</strong> è€Œæ­¤æ—¶è®°å½•çš„ execution date ä¸º <strong>2017å¹´10æœˆ1æ—¥ 12ç‚¹</strong>ã€‚å› æ­¤ execution date å¹¶ä¸æ˜¯å¦‚å…¶å­—é¢è¯´çš„è¡¨ç¤ºæ‰§è¡Œæ—¶é—´ï¼ŒçœŸæ­£çš„æ‰§è¡Œæ—¶é—´æ˜¯ execution date æ‰€æ˜¾ç¤ºçš„æ—¶é—´çš„ä¸‹ä¸€ä¸ªæ»¡è¶³ schedule interval çš„æ—¶é—´ç‚¹ã€‚</p></blockquote><blockquote><p><a href=https://www.jianshu.com/p/e878bbc9ead2 target=_blank rel=noopener>æµ…è°ˆ</a></p><p><a href=https://zhuanlan.zhihu.com/p/43383509 target=_blank rel=noopener>å®æˆ˜</a></p><p><a href=https://www.cnblogs.com/cord/p/9450910.html target=_blank rel=noopener>ä½¿ç”¨</a></p><p><a href=https://zhuanlan.zhihu.com/p/36043468 target=_blank rel=noopener>æ­å»ºåŠé—®é¢˜</a></p><p><a href=https://airflow.apache.org/docs/stable/project.html target=_blank rel=noopener>å®˜ç½‘</a></p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://xiaokunji.com/zh/tags/airflow.html>airflow</a></li><li><a href=https://xiaokunji.com/zh/tags/Hadoop%E7%94%9F%E6%80%81%E5%9C%88.html>Hadoopç”Ÿæ€åœˆ</a></li></ul></footer></article></main><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><footer class=footer><span>Copyright
&copy;
-2023
<a href=https://xiaokunji.com/zh/ style=color:#939393>ç±³äºŒ</a>
All Rights Reserved</span>
<span id=busuanzi_container><span class="fa fa-user">ç”¨æˆ·æ•°:</span><span id=busuanzi_value_site_uv></span>
<span class="fa fa-eye">è®¿é—®æ•°:</span><span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="å¤åˆ¶";function s(){t.innerHTML="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerHTML="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>