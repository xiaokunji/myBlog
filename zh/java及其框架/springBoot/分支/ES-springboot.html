<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ES-springboot | 米二</title><meta name=keywords content=" 前言, 1. Rest client, 1. application.properties, 2. pom.xml, 3. RestHighTest.java, 2. Springboot 方式, 1.application.properties, 2.pom.xml, 3.实体类, 4.代码"><meta name=description content="     "><meta name=author content="xkj"><link rel=canonical href=https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/springBoot/%E5%88%86%E6%94%AF/ES-springboot.html><link crossorigin=anonymous href=/assets/css/stylesheet.b3faf608c544858ba700943ffe182cb647f38432d29a07d73234965beacb26f6.css integrity="sha256-s/r2CMVEhYunAJQ//hgstkfzhDLSmgfXMjSWW+rLJvY=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://xiaokunji.com/img/Q.svg><link rel=icon type=image/png sizes=16x16 href=https://xiaokunji.com/img/Q.svg><link rel=icon type=image/png sizes=32x32 href=https://xiaokunji.com/img/Q.svg><link rel=apple-touch-icon href=https://xiaokunji.com/Q.svg><link rel=mask-icon href=https://xiaokunji.com/Q.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/springBoot/%E5%88%86%E6%94%AF/ES-springboot.html><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="ES-springboot"><meta property="og:description" content="     "><meta property="og:type" content="article"><meta property="og:url" content="https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/springBoot/%E5%88%86%E6%94%AF/ES-springboot.html"><meta property="article:section" content="java及其框架"><meta property="article:published_time" content="2023-08-22T00:00:00+00:00"><meta property="article:modified_time" content="2023-09-04T05:50:23+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="ES-springboot"><meta name=twitter:description content="     "><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":5,"name":"ES-springboot","item":"https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/springBoot/%E5%88%86%E6%94%AF/ES-springboot.html"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ES-springboot","name":"ES-springboot","description":"     ","keywords":[" 前言"," 1. Rest client"," 1. application.properties"," 2. pom.xml"," 3. RestHighTest.java"," 2. Springboot 方式"," 1.application.properties"," 2.pom.xml"," 3.实体类"," 4.代码"],"articleBody":"[TOC]\n前言 到目前为止，ES有4种客户端，分别是：Jest client、Rest client、Transport client、Node client，相信大家在项目集成中选择客户端比较纠结，搜索案例的时候一会是这个客户端实现的，一会儿又是别的客户端实现的，自己又不了解每个客户端的优劣势，但又想集成最好的，下面就来说说各个客户端的区别，以及优劣势\nES支持两种协议\nHTTP协议，支持的客户端有Jest client和Rest client Native Elasticsearch binary协议，也就是Transport client和Node client Jest client和Rest client区别\n​ Jest client非官方支持，在ES5.0之前官方提供的客户端只有Transport client、Node client。在5.0之后官方发布Rest client，并大力推荐\nTransport client和Node client区别\n​ Transport client（7.0弃用）和Node client（2.3弃用）区别：最早的两个客户端，Transport client是不需要单独一个节点。Node client需要单独建立一个节点，连接该节点进行操作，ES2.3之前有独立的API，ES2.3之后弃用该API，推荐用户创建一个节点，并用Transport client连接进行操作\n综合：以上就是各个客户端现在的基本情况，可以看出Rest client目前是官方推荐的，但是springBoot默认支持的依然Transport client，这可能和ES更新速度有关\nSpringboot 2.3.x版本开始, Spring Data Elasticsearch 4.0.x 开始使用 restClient\n版本对应-官方文档 1. Rest client 此处仅使用HighLevelClient\n1. application.properties spring.elasticsearch.rest.uris=http://127.0.0.1:9200 2. pom.xml org.elasticsearch.client elasticsearch-rest-client 6.4.0 org.elasticsearch.client elasticsearch-rest-high-level-client 6.4.0 3. RestHighTest.java package com.rancho.demo.elasticsearch; import org.apache.http.HttpHost; import org.elasticsearch.action.delete.DeleteRequest; import org.elasticsearch.action.delete.DeleteResponse; import org.elasticsearch.action.get.GetRequest; import org.elasticsearch.action.get.GetResponse; import org.elasticsearch.action.index.IndexRequest; import org.elasticsearch.action.index.IndexResponse; import org.elasticsearch.action.search.SearchRequest; import org.elasticsearch.action.search.SearchResponse; import org.elasticsearch.action.update.UpdateRequest; import org.elasticsearch.action.update.UpdateResponse; import org.elasticsearch.client.RequestOptions; import org.elasticsearch.client.RestHighLevelClient; import org.elasticsearch.index.query.MatchPhrasePrefixQueryBuilder; import org.elasticsearch.index.query.QueryBuilders; import org.elasticsearch.search.builder.SearchSourceBuilder; import org.junit.Test; import org.junit.runner.RunWith; import org.springframework.boot.test.context.SpringBootTest; import org.springframework.test.context.junit4.SpringRunner; import javax.annotation.Resource; import java.util.HashMap; import java.util.Map; @RunWith(SpringRunner.class) @SpringBootTest public class RestHighTest { @Resource private RestHighLevelClient restHighLevelClient; @Test public void add() { Map\u003cString, Object\u003e map = new HashMap\u003cString, Object\u003e(); map.put(\"id\", \"20190909\"); map.put(\"name\", \"测试\"); map.put(\"age\", 22); try { IndexRequest indexRequest = new IndexRequest(\"content\", \"doc\", map.get(\"id\").toString()).source(map); IndexResponse indexResponse = restHighLevelClient.index(indexRequest, RequestOptions.DEFAULT); System.out.println(indexResponse.toString()); } catch (Exception e) { e.printStackTrace(); } } @Test public void search() { SearchRequest searchRequest = new SearchRequest().indices(\"content\").types(\"doc\"); SearchSourceBuilder sourceBuilder = new SearchSourceBuilder(); MatchPhrasePrefixQueryBuilder mppqb = QueryBuilders.matchPhrasePrefixQuery(\"name\", \"测试\"); sourceBuilder.query(mppqb); try { SearchResponse sr = this.restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT); String result = sr.toString(); System.out.println(result); } catch (Exception e) { e.printStackTrace(); } } @Test public void update() { Map\u003cString, Object\u003e map = new HashMap\u003cString, Object\u003e(); map.put(\"id\", \"20190909\"); map.put(\"name\", \"测试-update\"); map.put(\"age\", 22); try { UpdateRequest request = new UpdateRequest(\"content\", \"doc\", map.get(\"id\").toString()).doc(map); UpdateResponse updateResponse = restHighLevelClient.update(request, RequestOptions.DEFAULT); System.out.println(updateResponse.toString()); } catch (Exception e) { } } @Test public void get() { try { GetRequest request = new GetRequest(\"content\", \"doc\", \"20190909\"); GetResponse getResponse = this.restHighLevelClient.get(request, RequestOptions.DEFAULT); System.out.println(getResponse.toString()); } catch (Exception e) { } } @Test public void delete() { try { DeleteRequest request = new DeleteRequest(\"content\", \"doc\", \"20190909\"); DeleteResponse deleteResponse = this.restHighLevelClient.delete(request, RequestOptions.DEFAULT); System.out.println(deleteResponse.toString()); } catch (Exception e) { } } } 因为它是直接用了client,所以是没有线程池的,可以利用 apache的 GenericObjectPool类来实现线程池\n有文章说 : Rest Client是长连接，而且内部有默认的线程池管理，因此一般无需自定义线程池管理连接\n源码分析1 线程池是访问es的http连接池\n源码分析2 详情见search服务代码\n2. Springboot 方式 1.application.properties 文件增加以下内容\nspring.data.elasticsearch.cluster-name=elasticsearch spring.data.elasticsearch.cluster-nodes=127.0.0.1:9300 #java的es默认连接端口是9300，9200是http端口 spring.data.elasticsearch.repositories.enabled=true 2.pom.xml org.springframework.boot spring-boot-starter-data-elasticsearch 这里用的是springboot DB的方式,还有其他方式也可连接,springboot 对应的Es版本关系有严格匹配,这里用的是,springboot 2.0.6版,es是5.6.16版\n1、None of the configured nodes are available 或者org.elasticsearch.transport.RemoteTransportException: Failed to deserialize exception response from stream\n原因：spring data elasticSearch 的版本与Spring boot、Elasticsearch版本不匹配。 这是版本之间的对应关系。Spring boot 1.3.5默认的elasticsearch版本是5.2，此时启动7.2版本以下的Elasticsearch客户端连接正常。\n2、Caused by: java.lang.IllegalArgumentException: @ConditionalOnMissingBean annotations must specify at least one bean (type, name or annotation)\n原因：spring boot是1.3.x版本(es用的是1.X版本)，而es采用了boot2.x版本。在es的boot2.x版本去除了一些类，而这些类在spring boot的1.3.x版本中仍然被使用，导致此错误 3、es在5.x版本中一个索引允许有两个type,在6.x版本中一个索引只允许有一个type,在7.x版中支持不要type;(这是es的type移除规划)\n3.实体类 @Document(indexName = \"jportal\", type = \"platformLogin\") public class PlatformLogin { /** * serialVersionUID */ private static final long serialVersionUID = 448279746126620954L; @Id private String id; private Date operateTime; // es存时间存的是时间戳, private String operateTimeStr;// 用来格式化时间 private String loginAcc; private String loginName; private String loginIp; private String loginType; private String operateContent; // get,set方法省略 } Spring-data-elasticsearch为我们提供了@Document、@Field等注解，如果某个实体需要建立索引，只需要加上这些注解即可\n1.类上注解：@Document (相当于Hibernate实体的@Entity/@Table)(==必写==)，加上了@Document注解之后，++默认情况下这个实体中所有的属性都会被建立索引、并且分词。++\n类型 属性名 默认值 说明 String indexName 无 索引库的名称，建议以项目的名称命名(只能是小写) String type “” 类型，建议以实体的名称命名 short shards 5 默认分区数 short replica 1 每个分区默认的备份数 String refreshInterval “1s” 刷新间隔 String indexStoreType “fs” 索引文件存储类型 2.主键注解：@Id (相当于Hibernate实体的主键@Id注解)(==必写==) 只是一个标识，并没有属性。\n3.属性注解 @Field (相当于Hibernate实体的@Column注解) @Field默认是可以不加的，默认所有属性都会添加到ES中。加上@Field之后，@document默认把所有字段加上索引失效，只有加@Field 才会被索引(同时也看设置索引的属性是否为no)\n类型 属性名 默认值 说明 FieldType type FieldType.Auto(大部分是text类型) 自动检测属性的类型 FieldIndex index FieldIndex.analyzed 默认情况下分词 boolean store false 默认情况下不存储原文 String searchAnalyzer “” 指定字段搜索时使用的分词器 String indexAnalyzer “” 指定字段建立索引时指定的分词器 String[] ignoreFields {} 如果某个字段需要被忽略 4.代码 需某个类继承ElasticsearchRepository,因为是demo,这里直接用dao层继承了,上面controller中的业务逻辑也可以写在impl中.\ndao.java\n也可以像redis那样,使用 template\n@Resource private ElasticsearchTemplate elasticsearchTemplate; public interface IEsDao extends ElasticsearchRepository { // 这种方式不用写具体实现,springboot会帮我们做,和访问mysql类型,反正项目中没用到 public PlatformLogin findByLoginNameLike(String string); } controller.java:\n@Autowired private IEsDao esDao; @RequestMapping(\"search\") public String search( ) { //按标题进行搜索 // 这里要写keyword, 在之后的查询中使用loginName是将loginName作为text类型查询，而使用loginName.keyword则是将loginName作为keyword类型查询。前者会对查询内容做分词处理之后再匹配，而后者则是直接对查询结果做精确匹配。 PrefixQueryBuilder queryBuilder = QueryBuilders.prefixQuery(\"loginName.keyword\", \"肖坤\"); ///ES的term query做的是精确匹配而不是分词查询，因此对text类型的字段做term查询将是查不到结果的（除非字段本身经过分词器处理后不变，未被转换或分词）。此时，必须使用foobar.keyword来对foobar字段以keyword类型进行精确匹配。 // 来自:https://segmentfault.com/q/1010000017312707 // es中存了两份数据,一份分词的(text类型),一份不分词的(keyword类型) //如果没写keyword则是用条件按分词之后查询 // 写了keyword则是对条件按整个文档搜索 //还有好多查询条件,慢慢看api //withfilter和withquery入参条件是一样的,但是es处理却是不一样的 //1.在查询(query)上下文中，查询会回答这个问题——“这个文档匹不匹配这个查询，它的相关度高么？”如何验证匹配很好理解，如何计算相关度呢？ES中索引的数据都会存储一个_score分值，分值越高就代表越匹配。另外关于某个搜索的分值计算还是很复杂的，因此也需要一定的时间。 //2. 在过滤器上下文中，查询会回答这个问题——“这个文档匹不匹配？”答案很简单，是或者不是。它不会去计算任何分值，也不会关心返回的排序问题，因此效率会高一点。过滤上下文 是在使用filter参数时候的执行环境，比如在bool查询中使用Must_not或者filter另外，经常使用过滤器，ES会自动的缓存过滤器的内容，这对于查询来说，会提高很多性能。 //原文：https://blog.csdn.net/qq_29580525/article/details/80908523 // QueryBuilder queryBuilder = QueryBuilders.termQuery(\"这里是你要查询的字段\", searchContent); SearchQuery searchQuery =new NativeSearchQueryBuilder().withQuery(queryBuilder).build(); System.out.println(\"查询的语句:\" + searchQuery.getQuery().toString()); Page searchPageResults = esDao.search(searchQuery); PlatformLogin jpfloginInfo = esDao.findByLoginNameLike(\"肖\"); logger.info(\"返回结果:{}\",searchPageResults.getContent()); logger.info(\"返回结果:{}\",jpfloginInfo); return LocalDateTime.now().toString(); } 参考链接:\n几种链接方式 ","wordCount":"3662","inLanguage":"zh","datePublished":"2023-08-22T00:00:00Z","dateModified":"2023-09-04T05:50:23.737349362Z","author":{"@type":"Person","name":"xkj"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/springBoot/%E5%88%86%E6%94%AF/ES-springboot.html"},"publisher":{"@type":"Organization","name":"米二","logo":{"@type":"ImageObject","url":"https://xiaokunji.com/img/Q.svg"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://xiaokunji.com/zh/ accesskey=h title="米二 (Alt + H)"><img src=https://xiaokunji.com/img/Q.svg alt aria-label=logo height=35>米二</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://xiaokunji.com/en/ title=English aria-label=English>English</a></li></ul></div></div><ul id=menu><li><a href=https://xiaokunji.com/zh/ title=🏠主页><span>🏠主页</span></a></li><li><a href=https://xiaokunji.com/zh/search title="🔍搜索 (Alt + /)" accesskey=/><span>🔍搜索</span></a></li><li><a href=https://xiaokunji.com/zh/post.html title=📚文章><span>📚文章</span></a></li><li><a href=https://xiaokunji.com/zh/archives.html title=⏱时间轴><span>⏱时间轴</span></a></li><li><a href=https://xiaokunji.com/zh/tags.html title=🔖标签><span>🔖标签</span></a></li><li><a href=https://xiaokunji.com/zh/categories.html title=📖分类><span>📖分类</span></a></li><li><a href=https://xiaokunji.com/zh/links.html title=🤝友链><span>🤝友链</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><nav aria-label=breadcrumb><ul><a href=https://xiaokunji.com/zh/>🏠</a> <span>></span>
<a href=https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6.html>java及其框架</a> <span>></span>
<a href=https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/springBoot.html>springBoot</a> <span>></span>
<a href=https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/springBoot/%E5%88%86%E6%94%AF.html>分支</a> <span>></span></ul></nav><h1 class=post-title>ES-springboot</h1><div class=post-description></div><div class=post-meta>创建:&nbsp;<span title='2023-08-22 00:00:00 +0000 UTC'>2023-08-22</span>&nbsp;·&nbsp;更新:&nbsp;2023-09-04&nbsp;·&nbsp;xkj
&nbsp;|&nbsp;分类: &nbsp;<ul class=post-categories-meta><a href=https://xiaokunji.com/zh/categories/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6.html>java及其框架</a></ul><span id=busuanzi_container_page_pv>&nbsp;| 访问: <span id=busuanzi_value_page_pv>1</span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e5%89%8d%e8%a8%80 aria-label=前言>前言</a></li><li><a href=#1-rest-client aria-label="1. Rest client">1. Rest client</a><ul><li><a href=#1-applicationproperties aria-label="1. application.properties">1. application.properties</a></li><li><a href=#2-pomxml aria-label="2. pom.xml">2. pom.xml</a></li><li><a href=#3-resthightestjava aria-label="3. RestHighTest.java">3. RestHighTest.java</a></li></ul></li><li><a href=#2-springboot-%e6%96%b9%e5%bc%8f aria-label="2. Springboot 方式">2. Springboot 方式</a><ul><li><a href=#1applicationproperties aria-label=1.application.properties>1.application.properties</a></li><li><a href=#2pomxml aria-label=2.pom.xml>2.pom.xml</a></li><li><a href=#3%e5%ae%9e%e4%bd%93%e7%b1%bb aria-label=3.实体类>3.实体类</a></li><li><a href=#4%e4%bb%a3%e7%a0%81 aria-label=4.代码>4.代码</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>[TOC]</p><h1 id=前言>前言<a hidden class=anchor aria-hidden=true href=#前言>#</a></h1><p>到目前为止，ES有4种客户端，分别是：Jest client、Rest client、Transport client、Node client，相信大家在项目集成中选择客户端比较纠结，搜索案例的时候一会是这个客户端实现的，一会儿又是别的客户端实现的，自己又不了解每个客户端的优劣势，但又想集成最好的，下面就来说说各个客户端的区别，以及优劣势</p><p>ES支持两种协议</p><ul><li>HTTP协议，支持的客户端有Jest client和Rest client</li><li>Native Elasticsearch binary协议，也就是Transport client和Node client</li></ul><p><strong>Jest client和Rest client区别</strong></p><p>​ Jest client非官方支持，在ES5.0之前官方提供的客户端只有Transport client、Node client。在5.0之后官方发布Rest client，并大力推荐</p><p><strong>Transport client和Node client区别</strong></p><p>​ Transport client（7.0弃用）和Node client（2.3弃用）区别：最早的两个客户端，Transport client是不需要单独一个节点。Node client需要单独建立一个节点，连接该节点进行操作，ES2.3之前有独立的API，ES2.3之后弃用该API，推荐用户创建一个节点，并用Transport client连接进行操作</p><p>综合：以上就是各个客户端现在的基本情况，可以看出Rest client目前是官方推荐的，但是springBoot默认支持的依然Transport client，这可能和ES更新速度有关</p><blockquote><p><strong>Springboot 2.3.x版本开始, Spring Data Elasticsearch 4.0.x 开始使用 restClient</strong></p><p><a href=https://docs.spring.io/spring-data/elasticsearch/docs/4.2.2/reference/html/#preface.versions target=_blank rel=noopener>版本对应-官方文档</a></p></blockquote><h1 id=1-rest-client>1. Rest client<a hidden class=anchor aria-hidden=true href=#1-rest-client>#</a></h1><blockquote><p>此处仅使用HighLevelClient</p></blockquote><h2 id=1-applicationproperties>1. application.properties<a hidden class=anchor aria-hidden=true href=#1-applicationproperties>#</a></h2><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span>spring.elasticsearch.rest.uris<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>http://127.0.0.1:9200</span>
</span></span></code></pre></div><h2 id=2-pomxml>2. pom.xml<a hidden class=anchor aria-hidden=true href=#2-pomxml>#</a></h2><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8b949e;font-style:italic>&lt;!--rest--&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#7ee787>&lt;groupId&gt;</span>org.elasticsearch.client<span style=color:#7ee787>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#7ee787>&lt;artifactId&gt;</span>elasticsearch-rest-client<span style=color:#7ee787>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#7ee787>&lt;version&gt;</span>6.4.0<span style=color:#7ee787>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#7ee787>&lt;groupId&gt;</span>org.elasticsearch.client<span style=color:#7ee787>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#7ee787>&lt;artifactId&gt;</span>elasticsearch-rest-high-level-client<span style=color:#7ee787>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#7ee787>&lt;version&gt;</span>6.4.0<span style=color:#7ee787>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;/dependency&gt;</span>
</span></span></code></pre></div><h2 id=3-resthightestjava>3. RestHighTest.java<a hidden class=anchor aria-hidden=true href=#3-resthightestjava>#</a></h2><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ff7b72>package</span> <span style=color:#ff7b72>com.rancho.demo.elasticsearch</span><span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.apache.http.HttpHost</span><span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.elasticsearch.action.delete.DeleteRequest</span><span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.elasticsearch.action.delete.DeleteResponse</span><span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.elasticsearch.action.get.GetRequest</span><span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.elasticsearch.action.get.GetResponse</span><span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.elasticsearch.action.index.IndexRequest</span><span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.elasticsearch.action.index.IndexResponse</span><span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.elasticsearch.action.search.SearchRequest</span><span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.elasticsearch.action.search.SearchResponse</span><span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.elasticsearch.action.update.UpdateRequest</span><span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.elasticsearch.action.update.UpdateResponse</span><span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.elasticsearch.client.RequestOptions</span><span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.elasticsearch.client.RestHighLevelClient</span><span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.elasticsearch.index.query.MatchPhrasePrefixQueryBuilder</span><span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.elasticsearch.index.query.QueryBuilders</span><span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.elasticsearch.search.builder.SearchSourceBuilder</span><span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.junit.Test</span><span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.junit.runner.RunWith</span><span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.springframework.boot.test.context.SpringBootTest</span><span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>org.springframework.test.context.junit4.SpringRunner</span><span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>javax.annotation.Resource</span><span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>java.util.HashMap</span><span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>import</span> <span style=color:#ff7b72>java.util.Map</span><span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@RunWith</span><span style=color:#ff7b72;font-weight:700>(</span>SpringRunner<span style=color:#ff7b72;font-weight:700>.</span>class<span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>public</span> <span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>RestHighTest</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@Resource</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>private</span> RestHighLevelClient restHighLevelClient<span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>public</span> <span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>add</span><span style=color:#ff7b72;font-weight:700>()</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>        Map<span style=color:#ff7b72;font-weight:700>&lt;</span>String<span style=color:#ff7b72;font-weight:700>,</span> Object<span style=color:#ff7b72;font-weight:700>&gt;</span> map <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> HashMap<span style=color:#ff7b72;font-weight:700>&lt;</span>String<span style=color:#ff7b72;font-weight:700>,</span> Object<span style=color:#ff7b72;font-weight:700>&gt;();</span>
</span></span><span style=display:flex><span>        map<span style=color:#ff7b72;font-weight:700>.</span>put<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;id&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> <span style=color:#a5d6ff>&#34;20190909&#34;</span><span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        map<span style=color:#ff7b72;font-weight:700>.</span>put<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;name&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> <span style=color:#a5d6ff>&#34;测试&#34;</span><span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        map<span style=color:#ff7b72;font-weight:700>.</span>put<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;age&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> 22<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>try</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>            IndexRequest indexRequest <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> IndexRequest<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;content&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> <span style=color:#a5d6ff>&#34;doc&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> map<span style=color:#ff7b72;font-weight:700>.</span>get<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;id&#34;</span><span style=color:#ff7b72;font-weight:700>).</span>toString<span style=color:#ff7b72;font-weight:700>()).</span>source<span style=color:#ff7b72;font-weight:700>(</span>map<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>            IndexResponse indexResponse <span style=color:#ff7b72;font-weight:700>=</span> restHighLevelClient<span style=color:#ff7b72;font-weight:700>.</span>index<span style=color:#ff7b72;font-weight:700>(</span>indexRequest<span style=color:#ff7b72;font-weight:700>,</span> RequestOptions<span style=color:#ff7b72;font-weight:700>.</span>DEFAULT<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>            System<span style=color:#ff7b72;font-weight:700>.</span>out<span style=color:#ff7b72;font-weight:700>.</span>println<span style=color:#ff7b72;font-weight:700>(</span>indexResponse<span style=color:#ff7b72;font-weight:700>.</span>toString<span style=color:#ff7b72;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72;font-weight:700>}</span> <span style=color:#ff7b72>catch</span> <span style=color:#ff7b72;font-weight:700>(</span>Exception e<span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#ff7b72;font-weight:700>.</span>printStackTrace<span style=color:#ff7b72;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>public</span> <span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>search</span><span style=color:#ff7b72;font-weight:700>()</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>        SearchRequest searchRequest <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> SearchRequest<span style=color:#ff7b72;font-weight:700>().</span>indices<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;content&#34;</span><span style=color:#ff7b72;font-weight:700>).</span>types<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;doc&#34;</span><span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        SearchSourceBuilder sourceBuilder <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> SearchSourceBuilder<span style=color:#ff7b72;font-weight:700>();</span>
</span></span><span style=display:flex><span>        MatchPhrasePrefixQueryBuilder mppqb <span style=color:#ff7b72;font-weight:700>=</span> QueryBuilders<span style=color:#ff7b72;font-weight:700>.</span>matchPhrasePrefixQuery<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;name&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> <span style=color:#a5d6ff>&#34;测试&#34;</span><span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        sourceBuilder<span style=color:#ff7b72;font-weight:700>.</span>query<span style=color:#ff7b72;font-weight:700>(</span>mppqb<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>try</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>            SearchResponse sr <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span><span style=color:#ff7b72;font-weight:700>.</span>restHighLevelClient<span style=color:#ff7b72;font-weight:700>.</span>search<span style=color:#ff7b72;font-weight:700>(</span>searchRequest<span style=color:#ff7b72;font-weight:700>,</span> RequestOptions<span style=color:#ff7b72;font-weight:700>.</span>DEFAULT<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>            String result <span style=color:#ff7b72;font-weight:700>=</span> sr<span style=color:#ff7b72;font-weight:700>.</span>toString<span style=color:#ff7b72;font-weight:700>();</span>
</span></span><span style=display:flex><span>            System<span style=color:#ff7b72;font-weight:700>.</span>out<span style=color:#ff7b72;font-weight:700>.</span>println<span style=color:#ff7b72;font-weight:700>(</span>result<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72;font-weight:700>}</span> <span style=color:#ff7b72>catch</span> <span style=color:#ff7b72;font-weight:700>(</span>Exception e<span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>            e<span style=color:#ff7b72;font-weight:700>.</span>printStackTrace<span style=color:#ff7b72;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>public</span> <span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>update</span><span style=color:#ff7b72;font-weight:700>()</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>        Map<span style=color:#ff7b72;font-weight:700>&lt;</span>String<span style=color:#ff7b72;font-weight:700>,</span> Object<span style=color:#ff7b72;font-weight:700>&gt;</span> map <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> HashMap<span style=color:#ff7b72;font-weight:700>&lt;</span>String<span style=color:#ff7b72;font-weight:700>,</span> Object<span style=color:#ff7b72;font-weight:700>&gt;();</span>
</span></span><span style=display:flex><span>        map<span style=color:#ff7b72;font-weight:700>.</span>put<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;id&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> <span style=color:#a5d6ff>&#34;20190909&#34;</span><span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        map<span style=color:#ff7b72;font-weight:700>.</span>put<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;name&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> <span style=color:#a5d6ff>&#34;测试-update&#34;</span><span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        map<span style=color:#ff7b72;font-weight:700>.</span>put<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;age&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> 22<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>try</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>            UpdateRequest request <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> UpdateRequest<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;content&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> <span style=color:#a5d6ff>&#34;doc&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> map<span style=color:#ff7b72;font-weight:700>.</span>get<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;id&#34;</span><span style=color:#ff7b72;font-weight:700>).</span>toString<span style=color:#ff7b72;font-weight:700>()).</span>doc<span style=color:#ff7b72;font-weight:700>(</span>map<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>            UpdateResponse updateResponse <span style=color:#ff7b72;font-weight:700>=</span> restHighLevelClient<span style=color:#ff7b72;font-weight:700>.</span>update<span style=color:#ff7b72;font-weight:700>(</span>request<span style=color:#ff7b72;font-weight:700>,</span> RequestOptions<span style=color:#ff7b72;font-weight:700>.</span>DEFAULT<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>            System<span style=color:#ff7b72;font-weight:700>.</span>out<span style=color:#ff7b72;font-weight:700>.</span>println<span style=color:#ff7b72;font-weight:700>(</span>updateResponse<span style=color:#ff7b72;font-weight:700>.</span>toString<span style=color:#ff7b72;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72;font-weight:700>}</span> <span style=color:#ff7b72>catch</span> <span style=color:#ff7b72;font-weight:700>(</span>Exception e<span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>public</span> <span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>get</span><span style=color:#ff7b72;font-weight:700>()</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>try</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>            GetRequest request <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> GetRequest<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;content&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> <span style=color:#a5d6ff>&#34;doc&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> <span style=color:#a5d6ff>&#34;20190909&#34;</span><span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>            GetResponse getResponse <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span><span style=color:#ff7b72;font-weight:700>.</span>restHighLevelClient<span style=color:#ff7b72;font-weight:700>.</span>get<span style=color:#ff7b72;font-weight:700>(</span>request<span style=color:#ff7b72;font-weight:700>,</span> RequestOptions<span style=color:#ff7b72;font-weight:700>.</span>DEFAULT<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>            System<span style=color:#ff7b72;font-weight:700>.</span>out<span style=color:#ff7b72;font-weight:700>.</span>println<span style=color:#ff7b72;font-weight:700>(</span>getResponse<span style=color:#ff7b72;font-weight:700>.</span>toString<span style=color:#ff7b72;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72;font-weight:700>}</span> <span style=color:#ff7b72>catch</span> <span style=color:#ff7b72;font-weight:700>(</span>Exception e<span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>public</span> <span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>delete</span><span style=color:#ff7b72;font-weight:700>()</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>try</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>            DeleteRequest request <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> DeleteRequest<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;content&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> <span style=color:#a5d6ff>&#34;doc&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> <span style=color:#a5d6ff>&#34;20190909&#34;</span><span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>            DeleteResponse deleteResponse <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>this</span><span style=color:#ff7b72;font-weight:700>.</span>restHighLevelClient<span style=color:#ff7b72;font-weight:700>.</span>delete<span style=color:#ff7b72;font-weight:700>(</span>request<span style=color:#ff7b72;font-weight:700>,</span> RequestOptions<span style=color:#ff7b72;font-weight:700>.</span>DEFAULT<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>            System<span style=color:#ff7b72;font-weight:700>.</span>out<span style=color:#ff7b72;font-weight:700>.</span>println<span style=color:#ff7b72;font-weight:700>(</span>deleteResponse<span style=color:#ff7b72;font-weight:700>.</span>toString<span style=color:#ff7b72;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72;font-weight:700>}</span> <span style=color:#ff7b72>catch</span> <span style=color:#ff7b72;font-weight:700>(</span>Exception e<span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>}</span>
</span></span></code></pre></div><blockquote><p>因为它是直接用了client,所以是没有线程池的,可以利用 apache的 <code>GenericObjectPool</code>类来实现线程池</p><blockquote><p><a href=https://www.jianshu.com/p/0b4f5e41405e target=_blank rel=noopener>有文章说</a>
: Rest Client是长连接，而且内部有默认的线程池管理，因此一般无需自定义线程池管理连接</p><p><a href=https://cloud.tencent.com/developer/article/1618394 target=_blank rel=noopener>源码分析1</a>
线程池是访问es的http连接池</p><p><a href=https://www.cnblogs.com/duanxz/p/5206304.html target=_blank rel=noopener>源码分析2</a></p></blockquote><p>详情见search服务代码</p></blockquote><h1 id=2-springboot-方式>2. Springboot 方式<a hidden class=anchor aria-hidden=true href=#2-springboot-方式>#</a></h1><h2 id=1applicationproperties>1.application.properties<a hidden class=anchor aria-hidden=true href=#1applicationproperties>#</a></h2><p>文件增加以下内容</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span>spring.data.elasticsearch.cluster-name<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>elasticsearch</span>
</span></span><span style=display:flex><span>spring.data.elasticsearch.cluster-nodes<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>127.0.0.1:9300  #java的es默认连接端口是9300，9200是http端口</span>
</span></span><span style=display:flex><span>spring.data.elasticsearch.repositories.enabled<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>true</span>
</span></span></code></pre></div><h2 id=2pomxml>2.pom.xml<a hidden class=anchor aria-hidden=true href=#2pomxml>#</a></h2><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span> <span style=color:#8b949e;font-style:italic>&lt;!--spring整合elasticsearch包--&gt;</span>
</span></span><span style=display:flex><span><span style=color:#7ee787>&lt;dependency&gt;</span>  
</span></span><span style=display:flex><span>   <span style=color:#7ee787>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#7ee787>&lt;/groupId&gt;</span>  
</span></span><span style=display:flex><span>   <span style=color:#7ee787>&lt;artifactId&gt;</span>spring-boot-starter-data-elasticsearch<span style=color:#7ee787>&lt;/artifactId&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#7ee787>&lt;/dependency&gt;</span>
</span></span></code></pre></div><blockquote><p>这里用的是springboot DB的方式,还有其他方式也可连接,springboot 对应的Es版本关系有严格匹配,这里用的是,springboot 2.0.6版,es是5.6.16版</p></blockquote><blockquote><p>1、None of the configured nodes are available 或者org.elasticsearch.transport.RemoteTransportException: Failed to deserialize exception response from stream<br>原因：spring data elasticSearch 的版本与Spring boot、Elasticsearch版本不匹配。
这是版本之间的对应关系。Spring boot 1.3.5默认的elasticsearch版本是5.2，此时启动7.2版本以下的Elasticsearch客户端连接正常。<br>2、Caused by: java.lang.IllegalArgumentException: @ConditionalOnMissingBean annotations must specify at least one bean (type, name or annotation)<br>原因：spring boot是1.3.x版本(es用的是1.X版本)，而es采用了boot2.x版本。在es的boot2.x版本去除了一些类，而这些类在spring boot的1.3.x版本中仍然被使用，导致此错误<br>3、es在5.x版本中一个索引允许有两个type,在6.x版本中一个索引只允许有一个type,在7.x版中支持不要type;(这是es的type移除规划)</p></blockquote><h2 id=3实体类>3.实体类<a hidden class=anchor aria-hidden=true href=#3实体类>#</a></h2><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>@Document(indexName = &#34;jportal&#34;, type = &#34;platformLogin&#34;)
</span></span><span style=display:flex><span>public class PlatformLogin  {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	/**
</span></span><span style=display:flex><span>	 * serialVersionUID
</span></span><span style=display:flex><span>	 */
</span></span><span style=display:flex><span>	private static final long serialVersionUID = 448279746126620954L;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	@Id
</span></span><span style=display:flex><span>	private String id;
</span></span><span style=display:flex><span>	private Date operateTime; // es存时间存的是时间戳,
</span></span><span style=display:flex><span>	private String operateTimeStr;// 用来格式化时间
</span></span><span style=display:flex><span>	private String loginAcc;
</span></span><span style=display:flex><span>	private String loginName;
</span></span><span style=display:flex><span>	private String loginIp;
</span></span><span style=display:flex><span>	private String loginType;
</span></span><span style=display:flex><span>	private String operateContent;
</span></span><span style=display:flex><span>	// get,set方法省略
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>Spring-data-elasticsearch</code>为我们提供了@Document、@Field等注解，如果某个实体需要建立索引，只需要加上这些注解即可</p><p>1.类上注解：@Document (相当于Hibernate实体的@Entity/@Table)(==必写==)，加上了@Document注解之后，++默认情况下这个实体中所有的属性都会被建立索引、并且分词。++</p><table><thead><tr><th>类型</th><th>属性名</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>String</td><td>indexName</td><td>无</td><td>索引库的名称，建议以项目的名称命名(只能是小写)</td></tr><tr><td>String</td><td>type</td><td>“”</td><td>类型，建议以实体的名称命名</td></tr><tr><td>short</td><td>shards</td><td>5</td><td>默认分区数</td></tr><tr><td>short</td><td>replica</td><td>1</td><td>每个分区默认的备份数</td></tr><tr><td>String</td><td>refreshInterval</td><td>“1s”</td><td>刷新间隔</td></tr><tr><td>String</td><td>indexStoreType</td><td>“fs”</td><td>索引文件存储类型</td></tr></tbody></table><p>2.主键注解：@Id (相当于Hibernate实体的主键@Id注解)(==必写==)
只是一个标识，并没有属性。</p><p>3.属性注解 @Field (相当于Hibernate实体的@Column注解)
@Field默认是可以不加的，默认所有属性都会添加到ES中。加上@Field之后，@document默认把所有字段加上索引失效，只有加@Field 才会被索引(同时也看设置索引的属性是否为no)</p><table><thead><tr><th>类型</th><th>属性名</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>FieldType</td><td>type</td><td>FieldType.Auto(大部分是text类型)</td><td>自动检测属性的类型</td></tr><tr><td>FieldIndex</td><td>index</td><td>FieldIndex.analyzed</td><td>默认情况下分词</td></tr><tr><td>boolean</td><td>store</td><td>false</td><td>默认情况下不存储原文</td></tr><tr><td>String</td><td>searchAnalyzer</td><td>“”</td><td>指定字段搜索时使用的分词器</td></tr><tr><td>String</td><td>indexAnalyzer</td><td>“”</td><td>指定字段建立索引时指定的分词器</td></tr><tr><td>String[]</td><td>ignoreFields</td><td>{}</td><td>如果某个字段需要被忽略</td></tr></tbody></table><h2 id=4代码>4.代码<a hidden class=anchor aria-hidden=true href=#4代码>#</a></h2><p>需某个类继承ElasticsearchRepository,因为是demo,这里直接用dao层继承了,上面controller中的业务逻辑也可以写在impl中.<br>dao.java</p><blockquote><p>也可以像redis那样,使用 template</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@Resource</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>private</span> ElasticsearchTemplate elasticsearchTemplate<span style=color:#ff7b72;font-weight:700>;</span>
</span></span></code></pre></div></blockquote><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>public interface IEsDao extends ElasticsearchRepository&lt;PlatformLogin, String&gt; {
</span></span><span style=display:flex><span>   // 这种方式不用写具体实现,springboot会帮我们做,和访问mysql类型,反正项目中没用到
</span></span><span style=display:flex><span>   public PlatformLogin findByLoginNameLike(String string);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>controller.java:</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>	@Autowired
</span></span><span style=display:flex><span>	private IEsDao esDao;
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>@RequestMapping(&#34;search&#34;)
</span></span><span style=display:flex><span>	public String search( ) {
</span></span><span style=display:flex><span>		 //按标题进行搜索
</span></span><span style=display:flex><span>		 // 这里要写keyword, 在之后的查询中使用loginName是将loginName作为text类型查询，而使用loginName.keyword则是将loginName作为keyword类型查询。前者会对查询内容做分词处理之后再匹配，而后者则是直接对查询结果做精确匹配。
</span></span><span style=display:flex><span>         PrefixQueryBuilder queryBuilder = QueryBuilders.prefixQuery(&#34;loginName.keyword&#34;, &#34;肖坤&#34;);
</span></span><span style=display:flex><span>         ///ES的term query做的是精确匹配而不是分词查询，因此对text类型的字段做term查询将是查不到结果的（除非字段本身经过分词器处理后不变，未被转换或分词）。此时，必须使用foobar.keyword来对foobar字段以keyword类型进行精确匹配。
</span></span><span style=display:flex><span>         // 来自:https://segmentfault.com/q/1010000017312707
</span></span><span style=display:flex><span>         // es中存了两份数据,一份分词的(text类型),一份不分词的(keyword类型)
</span></span><span style=display:flex><span>		//如果没写keyword则是用条件按分词之后查询
</span></span><span style=display:flex><span>		// 写了keyword则是对条件按整个文档搜索
</span></span><span style=display:flex><span>        //还有好多查询条件,慢慢看api
</span></span><span style=display:flex><span>        //withfilter和withquery入参条件是一样的,但是es处理却是不一样的
</span></span><span style=display:flex><span>        //1.在查询(query)上下文中，查询会回答这个问题——“这个文档匹不匹配这个查询，它的相关度高么？”如何验证匹配很好理解，如何计算相关度呢？ES中索引的数据都会存储一个_score分值，分值越高就代表越匹配。另外关于某个搜索的分值计算还是很复杂的，因此也需要一定的时间。
</span></span><span style=display:flex><span>        //2. 在过滤器上下文中，查询会回答这个问题——“这个文档匹不匹配？”答案很简单，是或者不是。它不会去计算任何分值，也不会关心返回的排序问题，因此效率会高一点。过滤上下文 是在使用filter参数时候的执行环境，比如在bool查询中使用Must_not或者filter另外，经常使用过滤器，ES会自动的缓存过滤器的内容，这对于查询来说，会提高很多性能。
</span></span><span style=display:flex><span>        //原文：https://blog.csdn.net/qq_29580525/article/details/80908523 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>//        QueryBuilder queryBuilder = QueryBuilders.termQuery(&#34;这里是你要查询的字段&#34;, searchContent);
</span></span><span style=display:flex><span>        SearchQuery searchQuery =new NativeSearchQueryBuilder().withQuery(queryBuilder).build(); 
</span></span><span style=display:flex><span>       
</span></span><span style=display:flex><span>        System.out.println(&#34;查询的语句:&#34; + searchQuery.getQuery().toString());
</span></span><span style=display:flex><span>        Page&lt;PlatformLogin&gt; searchPageResults = esDao.search(searchQuery);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       PlatformLogin jpfloginInfo = esDao.findByLoginNameLike(&#34;肖&#34;);
</span></span><span style=display:flex><span>        logger.info(&#34;返回结果:{}&#34;,searchPageResults.getContent());
</span></span><span style=display:flex><span>        logger.info(&#34;返回结果:{}&#34;,jpfloginInfo);
</span></span><span style=display:flex><span>		return LocalDateTime.now().toString();
</span></span><span style=display:flex><span>	}
</span></span></code></pre></div><p>参考链接:</p><p><a href=https://blog.csdn.net/qq_25012687/article/details/101050412 target=_blank rel=noopener>几种链接方式</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://xiaokunji.com/zh/tags/%E5%88%86%E6%94%AF.html>分支</a></li><li><a href=https://xiaokunji.com/zh/tags/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6.html>java及其框架</a></li></ul><nav class=paginav><a class=prev href=https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/Docker/docker+SpringBoot.html><span class=title>« 上一页</span><br><span>docker+SpringBoot</span></a>
<a class=next href=https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/ELK/ElasticSearch/es%E4%BC%98%E5%8C%96.html><span class=title>下一页 »</span><br><span>es优化</span></a></nav></footer></article></main><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><footer class=footer><span>Copyright
&copy;
-2023
<a href=https://xiaokunji.com/zh/ style=color:#939393>米二</a>
All Rights Reserved</span>
<span id=busuanzi_container><span class="fa fa-user">用户数:</span><span id=busuanzi_value_site_uv></span>
<span class="fa fa-eye">访问数:</span><span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>