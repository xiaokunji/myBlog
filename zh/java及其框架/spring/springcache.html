<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>SpringCache | ç±³äºŒ</title><meta name=keywords content=" 1. ä»‹ç», 2. å¸¸ç”¨æ³¨è§£, 2.1 @EnableCaching, 2.2 @Cacheable, 2.3 @CachePut, 2.4 @CacheEvict, 2.5 @Caching, 2.6 @CacheConfigï¼š, 3. ç¼“å­˜å…·ä½“å®ç°, 4. ä½¿ç”¨, 4.1 å¼•å…¥ä¾èµ–, 4.2 é…ç½®ç±», 4.3 å¼€å¯å¹¶ä½¿ç”¨, 4.4 é…ç½®æ–‡ä»¶, 5. æ³¨æ„äº‹é¡¹"><meta name=description content="     "><meta name=author content="xkj"><link rel=canonical href=https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/spring/springcache.html><link crossorigin=anonymous href=/assets/css/stylesheet.b3faf608c544858ba700943ffe182cb647f38432d29a07d73234965beacb26f6.css integrity="sha256-s/r2CMVEhYunAJQ//hgstkfzhDLSmgfXMjSWW+rLJvY=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://xiaokunji.com/img/Q.svg><link rel=icon type=image/png sizes=16x16 href=https://xiaokunji.com/img/Q.svg><link rel=icon type=image/png sizes=32x32 href=https://xiaokunji.com/img/Q.svg><link rel=apple-touch-icon href=https://xiaokunji.com/Q.svg><link rel=mask-icon href=https://xiaokunji.com/Q.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/spring/springcache.html><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="SpringCache"><meta property="og:description" content="     "><meta property="og:type" content="article"><meta property="og:url" content="https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/spring/springcache.html"><meta property="article:section" content="javaåŠå…¶æ¡†æ¶"><meta property="article:published_time" content="2023-08-22T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-30T16:26:08+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="SpringCache"><meta name=twitter:description content="     "><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":4,"name":"SpringCache","item":"https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/spring/springcache.html"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"SpringCache","name":"SpringCache","description":"     ","keywords":[" 1. ä»‹ç»"," 2. å¸¸ç”¨æ³¨è§£"," 2.1 @EnableCaching"," 2.2 @Cacheable"," 2.3 @CachePut"," 2.4 @CacheEvict"," 2.5 @Caching"," 2.6 @CacheConfigï¼š"," 3. ç¼“å­˜å…·ä½“å®ç°"," 4. ä½¿ç”¨"," 4.1 å¼•å…¥ä¾èµ–"," 4.2 é…ç½®ç±»"," 4.3 å¼€å¯å¹¶ä½¿ç”¨"," 4.4 é…ç½®æ–‡ä»¶"," 5. æ³¨æ„äº‹é¡¹"],"articleBody":"[toc]\n1. ä»‹ç» SpringCacheæä¾›åŸºæœ¬çš„CacheæŠ½è±¡ï¼Œå¹¶æ²¡æœ‰å…·ä½“çš„ç¼“å­˜èƒ½åŠ›ï¼Œéœ€è¦é…åˆå…·ä½“çš„ç¼“å­˜å®ç°æ¥å®Œæˆï¼Œç›®å‰SpringCacheæ”¯æŒredisã€ehcacheã€simpleï¼ˆåŸºäºå†…å­˜,ä½¿ç”¨ConcurrentHashMapï¼‰ç­‰æ–¹å¼æ¥å®ç°ç¼“å­˜ã€‚\nå› ä¸ºspringçš„ç¼“å­˜æœºåˆ¶ä¼šå¼•å…¥ä¸€äº›é—®é¢˜, ä¸€äº›å¤§å‹é¡¹ç›®å¯èƒ½ä¸é€‚åˆ, æ¯”å¦‚å¹¶å‘åœºæ™¯ä¸‹å‡ºç°å¼‚å¸¸ç­‰ç­‰, ä½†å¤§éƒ¨åˆ†çš„é¡¹ç›®è¿˜æ˜¯å¯ä»¥é€‚ç”¨çš„(æ¯•ç«Ÿä¸­å›½æ²¡æœ‰å¤šå°‘å…·å¤‡é«˜å¹¶å‘çš„å…¬å¸)\n2. å¸¸ç”¨æ³¨è§£ 2.1 @EnableCaching å¼€å¯ç¼“å­˜åŠŸèƒ½ï¼Œä¸€èˆ¬ä½¿ç”¨åœ¨springbootçš„å¯åŠ¨ç±»æˆ–é…ç½®ç±»ä¸Š\n2.2 @Cacheable ä½¿ç”¨ç¼“å­˜ã€‚åœ¨æ–¹æ³•æ‰§è¡Œå‰Springå…ˆæŸ¥çœ‹ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰æ•°æ®ï¼Œåˆ™ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ï¼›æ²¡æœ‰åˆ™è°ƒç”¨æ–¹æ³•å¹¶å°†æ–¹æ³•è¿”å›å€¼æ”¾è¿›ç¼“å­˜ã€‚\n**æ³¨è§£å‚æ•°è§£é‡Š: **\n@Cacheableå±æ€§å ç”¨é€” å¤‡æ³¨ cacheNames/value æŒ‡å®šç¼“å­˜ç©ºé—´çš„åç§°ï¼Œä¸åŒç¼“å­˜ç©ºé—´çš„æ•°æ®æ˜¯å½¼æ­¤éš”ç¦»çš„ key åŒä¸€ä¸ªcacheNamesä¸­é€šè¿‡keyåŒºåˆ«ä¸åŒçš„ç¼“å­˜ã€‚å¦‚æœæŒ‡å®šè¦æŒ‰ç…§ SpEL è¡¨è¾¾å¼ç¼–å†™ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œåˆ™ç¼ºçœæŒ‰ç…§æ–¹æ³•çš„æ‰€æœ‰å‚æ•°è¿›è¡Œç»„åˆï¼Œå¦‚ï¼š@CachePut(value = â€œdemoâ€, key = â€œâ€˜userâ€™+#user.idâ€)ï¼Œå­—ç¬¦ä¸²ä¸­springè¡¨è¾¾å¼æ„å¤–çš„å­—ç¬¦ä¸²éƒ¨åˆ†éœ€è¦ç”¨å•å¼•å· SpringCacheæä¾›äº†ä¸ç¼“å­˜ç›¸å…³çš„ä¸“ç”¨å…ƒæ•°æ®ï¼Œå¦‚targetã€methodMameã€resultã€æ–¹æ³•å‚æ•°ç­‰ï¼Œå¦‚ï¼š@CachePut(value = â€œdemoâ€, key = â€œ#result==nullâ€)\nå½“æ–¹æ³•çš„å‚æ•°å’Œå€¼ä¸€æ ·æ—¶, ä¼šå¯¼è‡´é‡å¤; å¦‚æœæ˜¯åŸºæœ¬å‚æ•°: å‚æ•°å+å€¼ å¦‚æœæ˜¯å¯¹è±¡å‚æ•°: å‚æ•°çš„ç±»å+å¯¹è±¡çš„æˆå‘˜å˜é‡+å€¼ (ç±»ä¼¼äºtoStringçš„ç»“æœ) keyGenrator keyçš„ç”Ÿæˆç­–ç•¥ï¼ŒSpringCacheé»˜è®¤ä½¿ç”¨SimpleKeyGeneratorï¼Œé»˜è®¤æƒ…å†µä¸‹å°†å‚æ•°å€¼ä½œä¸ºé”®ï¼Œä½†æ˜¯å¯èƒ½ä¼šå¯¼è‡´keyé‡å¤å‡ºç°ï¼Œå› æ­¤ä¸€èˆ¬éœ€è¦è‡ªå®šä¹‰keyçš„ç”Ÿæˆç­–ç•¥ å’Œkeyå‚æ•°äºŒé€‰ä¸€ cacheManager æŒ‡å®šç¼“å­˜ç®¡ç†å™¨(ä¾‹å¦‚ConcurrentHashMapã€Redisç­‰)ã€‚ cacheResolver å’ŒcacheManagerä½œç”¨ä¸€æ ·ï¼Œä½¿ç”¨æ—¶äºŒé€‰ä¸€ã€‚ condition (æŒ‡å®šç¼“å­˜çš„æ¡ä»¶ï¼ˆå¯¹å‚æ•°åˆ¤æ–­ï¼Œæ»¡è¶³ä»€ä¹ˆæ¡ä»¶æ—¶æ‰ç¼“å­˜ï¼‰)\nconditionæ˜¯åœ¨è°ƒç”¨æ–¹æ³•ä¹‹å‰åˆ¤æ–­æ¡ä»¶ï¼Œæ»¡è¶³æ¡ä»¶æ‰ç¼“å­˜, æ”¯æŒspelè¯­æ³• @Cacheable(cacheNames=â€œbookâ€, condition=\"#name.length() \u003c 32\") unless (å¦å®šç¼“å­˜çš„æ¡ä»¶ï¼ˆå¯¹ç»“æœåˆ¤æ–­ï¼Œæ»¡è¶³ä»€ä¹ˆæ¡ä»¶æ—¶ä¸ç¼“å­˜ï¼‰)\nunlessæ˜¯åœ¨è°ƒç”¨æ–¹æ³•ä¹‹ååˆ¤æ–­æ¡ä»¶ï¼Œå¦‚æœSpELæ¡ä»¶æˆç«‹ï¼Œåˆ™ä¸ç¼“å­˜ã€æ¡ä»¶æ»¡è¶³ä¸ç¼“å­˜ã€‘,æ”¯æŒspelè¯­æ³• @Cacheable(cacheNames = â€œhelloâ€,unless=\"#result.id.contains(â€˜1â€™)\" ) sync ç¼“å­˜è¿‡æœŸä¹‹åï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è¯·æ±‚å¯¹æŸä¸ªæ•°æ®çš„è®¿é—®ï¼Œä¼šåŒæ—¶å»åˆ°æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“ç¬é—´è´Ÿè·å¢é«˜ã€‚Spring4.3ä¸º@Cacheableæ³¨è§£æä¾›äº†ä¸€ä¸ªæ–°çš„å‚æ•°â€œsyncâ€ï¼ˆé»˜è®¤ä¸ºfalseï¼‰ã€‚å½“è®¾ç½®å®ƒä¸ºtrueæ—¶ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„è¯·æ±‚ä¼šå»åˆ°æ•°æ®åº“ï¼Œå…¶ä»–çº¿ç¨‹éƒ½ä¼šç­‰å¾…ç›´åˆ°ç¼“å­˜å¯ç”¨ã€‚è¿™ä¸ªè®¾ç½®å¯ä»¥å‡å°‘å¯¹æ•°æ®åº“çš„ç¬é—´å¹¶å‘è®¿é—®ã€‚ 2.3 @CachePut æ›´æ–°ç¼“å­˜ï¼Œå°†æ–¹æ³•çš„è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¸­\n2.4 @CacheEvict æ¸…ç©ºç¼“å­˜\n2.5 @Caching @Cachingæ˜¯ä¸€ä¸ªç»„æ³¨è§£ï¼Œå¯ä»¥ä¸ºä¸€ä¸ªæ–¹æ³•å®šä¹‰æä¾›åŸºäº@Cacheableã€@CacheEvictæˆ–è€…@CachePutæ³¨è§£çš„æ•°ç»„ã€‚\nä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­, åœ¨æ–¹æ³•ä¸ŠåŠ  @cachingå¹¶æ ‡æ³¨éœ€è¦çš„é€»è¾‘, è¿™æ ·è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶å°±èƒ½åŒæ—¶è§¦å‘å¤šä¸ªæ“ä½œ\n@Caching( put = { @CachePut(value = \"myCache\", key = \"#result.id\") }, evict = { @CacheEvict(value = \"otherCache\", key = \"#id\") }, cacheable = { @Cacheable(value = \"myFifthCache\", key = \"#result.id\") } ) public MyEntity saveData(Long id, String name) { MyEntity entity = new MyEntity(id, name); return entity; } 2.6 @CacheConfigï¼š ä¸€ä¸ªç±»ä¸­å¯èƒ½ä¼šæœ‰å¤šä¸ªç¼“å­˜æ“ä½œï¼Œè€Œè¿™äº›ç¼“å­˜æ“ä½œå¯èƒ½æ˜¯é‡å¤çš„ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨ @CacheConfigæ˜¯ä¸€ä¸ªç±»çº§åˆ«çš„æ³¨è§£.\nå®ƒå¯ä»¥å­˜æ”¾è¯¥ç±»ä¸­æ‰€æœ‰ç¼“å­˜çš„å…¬æœ‰å±æ€§ï¼Œæ¯”å¦‚è®¾ç½®ç¼“å­˜ç©ºé—´çš„åå­—cacheNamesã€keyç”Ÿæˆç­–ç•¥keyGeneratorã€ç¼“å­˜ç®¡ç†å™¨cacheManager\n3. ç¼“å­˜å…·ä½“å®ç° æ”¯æŒå¤šç§ç¼“å­˜æä¾›ç¨‹åºï¼ŒåŒ…æ‹¬ Caffeineã€Hazelcast ã€ Rediså’ŒConcurrentHashMap(é»˜è®¤å€¼)ã€‚\nä¹Ÿå°±æ˜¯è¯´æ”¯æŒæœ¬åœ°ç¼“å­˜å’Œç¬¬ä¸‰æ–¹ç¼“å­˜æ¡†æ¶, å¦‚æœæ˜¯ç¬¬ä¸‰æ–¹çš„ç¼“å­˜å°±éœ€è¦é¢å¤–çš„pomåæ ‡æ”¯æŒ\næ¨ècaffeineè¿™ä¸ªæœ¬åœ°ç¼“å­˜æ¡†æ¶, æ€§èƒ½å¥½,åŠŸèƒ½å…¨, åªæ˜¯éœ€è¦é¢å¤–å¼•å…¥caffeineè¿™ä¸ªæ¡†æ¶,å°±æœ‰ç‚¹å°æˆæœ¬äº†\nå…¶æ¬¡æ¨èä½¿ç”¨redis, åŠŸèƒ½å…¨,æ€§èƒ½å¥½(æ²¡æœ‰caffeineè¿™ç§æœ¬åœ°ç¼“å­˜å¿«), é¡¹ç›®ä¸­åæ­£éƒ½è¦å¼•å…¥redisçš„, åˆšå¥½é¡ºä¾¿èƒ½ç”¨\nè¿™é‡Œä»¥redisä¸ºä¾‹\n4. ä½¿ç”¨ 4.1 å¼•å…¥ä¾èµ– org.springframework.boot spring-boot-starter-cache 2.3.0.RELEASE org.springframework.boot spring-boot-starter-data-redis 2.3.0.RELEASE 4.2 é…ç½®ç±» @Configuration public class RedisConfiguration { // ${cache} è·å–é…ç½®æ–‡ä»¶çš„é…ç½®ä¿¡æ¯ #{}æ˜¯springè¡¨è¾¾å¼ï¼Œè·å–Beanå¯¹è±¡çš„å±æ€§ @Value(\"#{${cache}}\") private Map\u003cString, Long\u003e ttlParams; /** * @param redisConnectionFactory * @åŠŸèƒ½æè¿° redisä½œä¸ºç¼“å­˜æ—¶é…ç½®ç¼“å­˜ç®¡ç†å™¨CacheManagerï¼Œä¸»è¦é…ç½®åºåˆ—åŒ–æ–¹å¼ã€è‡ªå®šä¹‰ * * æ³¨æ„ï¼šé…ç½®ç¼“å­˜ç®¡ç†å™¨CacheManageræœ‰ä¸¤ç§æ–¹å¼ï¼š * æ–¹å¼1ï¼šé€šè¿‡RedisCacheConfiguration.defaultCacheConfig()è·å–åˆ°é»˜è®¤çš„RedisCacheConfigurationå¯¹è±¡ï¼Œ * ä¿®æ”¹RedisCacheConfigurationå¯¹è±¡çš„åºåˆ—åŒ–æ–¹å¼ç­‰å‚æ•°ã€è¿™é‡Œå°±é‡‡ç”¨çš„è¿™ç§æ–¹å¼ã€‘ * æ–¹å¼2ï¼šé€šè¿‡ç»§æ‰¿CachingConfigurerSupportç±»è‡ªå®šä¹‰ç¼“å­˜ç®¡ç†å™¨ï¼Œè¦†å†™å„æ–¹æ³•ï¼Œå‚è€ƒï¼š * https://blog.csdn.net/echizao1839/article/details/102660649 * * åˆ‡è®°ï¼šåœ¨ç¼“å­˜é…ç½®ç±»ä¸­é…ç½®ä»¥åï¼Œyamlé…ç½®æ–‡ä»¶ä¸­å…³äºç¼“å­˜çš„redisé…ç½®å°±ä¸ä¼šç”Ÿæ•ˆï¼Œå¦‚æœéœ€è¦ç›¸å…³é…ç½®éœ€è¦é€šè¿‡@valueå»è¯»å– */ @Bean public CacheManager cacheManager(RedisConnectionFactory redisConnectionFactory) { RedisCacheConfiguration redisCacheConfiguration = RedisCacheConfiguration.defaultCacheConfig() // è®¾ç½®keyé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼ .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(StringRedisSerializer.UTF_8)) //è®¾ç½®valueåºåˆ—åŒ–æ–¹å¼é‡‡ç”¨jacksonæ–¹å¼åºåˆ—åŒ– .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(serializer())) //å½“valueä¸ºnullæ—¶ä¸è¿›è¡Œç¼“å­˜ .disableCachingNullValues() // é…ç½®ç¼“å­˜ç©ºé—´åç§°çš„å‰ç¼€ (è¿™é‡Œä¼šè¦†ç›– @cacheableæ³¨è§£çš„vauleå­—æ®µ) .prefixCacheNameWith(\"demo:\") //å…¨å±€é…ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´ã€å¯ä»¥ä¸é…ç½®ã€‘ .entryTtl(Duration.ofMinutes(30L)); //ä¸“é—¨æŒ‡å®šæŸäº›ç¼“å­˜ç©ºé—´çš„é…ç½®ï¼Œå¦‚æœè¿‡æœŸæ—¶é—´ã€ä¸»è¦è¿™é‡Œçš„keyä¸ºç¼“å­˜ç©ºé—´åç§°ã€‘ Map\u003cString, RedisCacheConfiguration\u003e map = new HashMap\u003c\u003e(); Set\u003cMap.Entry\u003cString, Long\u003e\u003e entries = ttlParams.entrySet(); for (Map.Entry\u003cString, Long\u003e entry : entries) { //æŒ‡å®šç‰¹å®šç¼“å­˜ç©ºé—´å¯¹åº”çš„è¿‡æœŸæ—¶é—´ map.put(\"user\", redisCacheConfiguration.entryTtl(Duration.ofSeconds(40))); map.put(entry.getKey(), redisCacheConfiguration.entryTtl(Duration.ofSeconds(entry.getValue()))); } return RedisCacheManager .builder(redisConnectionFactory) .cacheDefaults(redisCacheConfiguration) //é»˜è®¤é…ç½® .withInitialCacheConfigurations(map) //æŸäº›ç¼“å­˜ç©ºé—´çš„ç‰¹å®šé…ç½® .build(); } /** * è‡ªå®šä¹‰ç¼“å­˜çš„redisçš„KeyGeneratorã€keyç”Ÿæˆç­–ç•¥ã€‘ * æ³¨æ„: è¯¥æ–¹æ³•åªæ˜¯å£°æ˜äº†keyçš„ç”Ÿæˆç­–ç•¥,éœ€åœ¨@Cacheableæ³¨è§£ä¸­é€šè¿‡keyGeneratorå±æ€§æŒ‡å®šå…·ä½“çš„keyç”Ÿæˆç­–ç•¥ * å¯ä»¥æ ¹æ®ä¸šåŠ¡æƒ…å†µï¼Œé…ç½®å¤šä¸ªç”Ÿæˆç­–ç•¥ * å¦‚: @Cacheable(value = \"key\", keyGenerator = \"cacheKeyGenerator\") */ @Bean public KeyGenerator keyGenerator() { /** * target: ç±» * method: æ–¹æ³• * params: æ–¹æ³•å‚æ•° */ return (target, method, params) -\u003e { //è·å–ä»£ç†å¯¹è±¡çš„æœ€ç»ˆç›®æ ‡å¯¹è±¡ StringBuilder sb = new StringBuilder(); sb.append(target.getClass().getSimpleName()).append(\":\"); sb.append(method.getName()).append(\":\"); //è°ƒç”¨SimpleKeyçš„keyç”Ÿæˆå™¨ Object key = SimpleKeyGenerator.generateKey(params); return sb.append(key); }; } /** * @param redisConnectionFactoryï¼šé…ç½®ä¸åŒçš„å®¢æˆ·ç«¯ï¼Œè¿™é‡Œæ³¨å…¥çš„redisè¿æ¥å·¥å‚ä¸åŒï¼š JedisConnectionFactoryã€LettuceConnectionFactory * @åŠŸèƒ½æè¿° ï¼šé…ç½®Redisåºåˆ—åŒ–ï¼ŒåŸå› å¦‚ä¸‹ï¼š * ï¼ˆ1ï¼‰ StringRedisTemplateçš„åºåˆ—åŒ–æ–¹å¼ä¸ºå­—ç¬¦ä¸²åºåˆ—åŒ–ï¼Œ * RedisTemplateçš„åºåˆ—åŒ–æ–¹å¼é»˜ä¸ºjdkåºåˆ—åŒ–ï¼ˆå®ç°Serializableæ¥å£ï¼‰ * ï¼ˆ2ï¼‰ RedisTemplateçš„jdkåºåˆ—åŒ–æ–¹å¼åœ¨Redisçš„å®¢æˆ·ç«¯ä¸­ä¸ºä¹±ç ï¼Œä¸æ–¹ä¾¿æŸ¥çœ‹ï¼Œ * å› æ­¤ä¸€èˆ¬ä¿®æ”¹RedisTemplateçš„åºåˆ—åŒ–ä¸ºæ–¹å¼ä¸ºJSONæ–¹å¼ã€å»ºè®®ä½¿ç”¨GenericJackson2JsonRedisSerializerã€‘ */ @Bean public RedisTemplate\u003cString, Object\u003e redisTemplate(RedisConnectionFactory redisConnectionFactory) { GenericJackson2JsonRedisSerializer genericJackson2JsonRedisSerializer = serializer(); RedisTemplate\u003cString, Object\u003e redisTemplate = new RedisTemplate\u003c\u003e(); // keyé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼ redisTemplate.setKeySerializer(StringRedisSerializer.UTF_8); // valueåºåˆ—åŒ–æ–¹å¼é‡‡ç”¨jackson redisTemplate.setValueSerializer(genericJackson2JsonRedisSerializer); // hashçš„keyä¹Ÿé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼ redisTemplate.setHashKeySerializer(StringRedisSerializer.UTF_8); //hashçš„valueåºåˆ—åŒ–æ–¹å¼é‡‡ç”¨jackson redisTemplate.setHashValueSerializer(genericJackson2JsonRedisSerializer); redisTemplate.setConnectionFactory(redisConnectionFactory); return redisTemplate; } /** * æ­¤æ–¹æ³•ä¸èƒ½ç”¨@Benæ³¨è§£ï¼Œé¿å…æ›¿æ¢Springå®¹å™¨ä¸­çš„åŒç±»å‹å¯¹è±¡ */ public GenericJackson2JsonRedisSerializer serializer() { return new GenericJackson2JsonRedisSerializer(); } } 4.3 å¼€å¯å¹¶ä½¿ç”¨ @EnableCaching //å¼€å¯ç¼“å­˜çš„ä¸»é”® @SpringBootApplication public class RedisDemoApplication { public static void main(String[] args) { SpringApplication.run(RedisDemoApplication.class, args); } } @Service @CacheConfig(cacheNames = \"user\",keyGenerator = \"keyGenerator\") public class RedisServiceImpl implements RedisService { @Cacheable(value = \"user\", key = \"'list'\") @Override public List\u003cUser\u003e list() { System.out.println(\"=========list\"); List\u003cUser\u003e users = new ArrayList\u003c\u003e(); return users; } @CacheEvict(value = \"user\", key = \"'list'\") @Override public void del(Integer id) { System.out.println(\"************************************+id\"); } @CachePut(value = \"demo\", key = \"#result==null\") @Override public void select(Integer id) { System.out.println(\"===============dddd================\"); } } 4.4 é…ç½®æ–‡ä»¶ spring: cache: type: redis # æŒ‡å®šä½¿ç”¨çš„ç¼“å­˜ç±»å‹,ä¸ä¼ ä¼šè‡ªåŠ¨è¯†åˆ« redis: å½“è‡ªå®šä¹‰ChacheManageræ—¶ï¼Œå°±è¿™é‡Œçš„é…ç½®ä¸éœ€è¦é…ç½®ï¼Œé…ç½®äº†ä¹Ÿä¸èµ·ä½œç”¨ use-key-prefix: true key-prefix: \"demo:\" time-to-live: 60000 #ç¼“å­˜è¶…æ—¶æ—¶é—´ å•ä½ï¼šms cache-null-values: false #æ˜¯å¦ç¼“å­˜ç©ºå€¼ cache-names: user # åˆå§‹åŒ–ä¸€äº›ç¼“å­˜å ttl: '{\"user\":60,\"dept\":30}' #è‡ªå®šä¹‰æŸäº›ç¼“å­˜ç©ºé—´çš„è¿‡æœŸæ—¶é—´ ç½‘ä¸Šæœ‰äº›æ–‡ç« ä¼šä½¿ç”¨é…ç½®æ–‡ä»¶çš„æ–¹å¼, å…¶å®è¿™æ˜¯ spring-boot-autoconfigure è‡ªåŠ¨é…ç½®çš„èƒ½åŠ›, å®ƒä¼šæ ¹æ®ä½ å¼•å…¥çš„åŒ…(redis/caffeine), è‡ªåŠ¨æ³¨å…¥å¯¹åº”çš„ç¼“å­˜æœºåˆ¶ , æ¯”å¦‚redisçš„ org.springframework.boot.autoconfigure.cache.RedisCacheConfiguration\nå¦‚æœéœ€è¦è‡ªå®šä¹‰ä¸€äº›é…ç½®, å°±éœ€è¦æŒ‰4.1~4.3èŠ‚é‚£ç§é…ç½®\n5. æ³¨æ„äº‹é¡¹ @Cacheæ³¨è§£çš„æ–¹æ³•å¿…é¡»ä¸º public\né»˜è®¤æƒ…å†µä¸‹ï¼Œ@CacheEvictæ ‡æ³¨çš„æ–¹æ³•æ‰§è¡ŒæœŸé—´æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™ä¸ä¼šæ¸…ç©ºç¼“å­˜ã€‚\nåŸºäº proxy çš„ spring aop å¸¦æ¥çš„å†…éƒ¨è°ƒç”¨é—®é¢˜(aopçš„é€šç”¨é—®é¢˜)\nä½¿ç”¨å†…å­˜æ—¶ä¸€å®šè¦è®¾ç½®è¿‡æœŸæ—¶é—´å’Œå…è®¸ä½¿ç”¨å†…å­˜å¤§å° ç­‰ç­‰, ä¸ç„¶åœ¨æç«¯æƒ…å†µä¸‹ä¼šæŠŠå†…å­˜åƒæ»¡\né»˜è®¤çš„ ConcurrentHashMapä¸æ”¯æŒè®¾ç½®è¿‡æœŸæ—¶é—´å’Œå…è®¸ä½¿ç”¨çš„å†…å­˜å¤§å°\nredisä¸æ”¯æŒå…è®¸ä½¿ç”¨çš„å†…å­˜å¤§å°\ncaffeineéƒ½èƒ½æ”¯æŒ(è¿™ä¹Ÿæ˜¯æ¨èä½¿ç”¨å®ƒçš„åŸå› ä¹‹ä¸€)\nSpring Cache æ•´åˆ Redis åšç¼“å­˜ä½¿ç”¨~ å¿«é€Ÿä¸Šæ‰‹~ - æ˜é‡‘ (juejin.cn) SpringBootå®ç°Redisç¼“å­˜ï¼ˆSpringCache+Redisçš„æ•´åˆï¼‰_springboot redis cache_user2025çš„åšå®¢-CSDNåšå®¢ Spring Cacheï¼Œkeyé‡å¤é—®é¢˜ SpringBooté¡¹ç›®ä¸­ä½¿ç”¨ç¼“å­˜Cacheçš„æ­£ç¡®å§¿åŠ¿ï¼ï¼! - æ˜é‡‘ (juejin.cn) ","wordCount":"3846","inLanguage":"zh","datePublished":"2023-08-22T00:00:00Z","dateModified":"2023-08-30T16:26:08.731846727Z","author":{"@type":"Person","name":"xkj"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/spring/springcache.html"},"publisher":{"@type":"Organization","name":"ç±³äºŒ","logo":{"@type":"ImageObject","url":"https://xiaokunji.com/img/Q.svg"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://xiaokunji.com/zh/ accesskey=h title="ç±³äºŒ (Alt + H)"><img src=https://xiaokunji.com/img/Q.svg alt aria-label=logo height=35>ç±³äºŒ</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://xiaokunji.com/en/ title=English aria-label=English>English</a></li></ul></div></div><ul id=menu><li><a href=https://xiaokunji.com/zh/ title=ğŸ ä¸»é¡µ><span>ğŸ ä¸»é¡µ</span></a></li><li><a href=https://xiaokunji.com/zh/search.html title="ğŸ”æœç´¢ (Alt + /)" accesskey=/><span>ğŸ”æœç´¢</span></a></li><li><a href=https://xiaokunji.com/zh/post.html title=ğŸ“šæ–‡ç« ><span>ğŸ“šæ–‡ç« </span></a></li><li><a href=https://xiaokunji.com/zh/archives.html title=â±æ—¶é—´è½´><span>â±æ—¶é—´è½´</span></a></li><li><a href=https://xiaokunji.com/zh/tags.html title=ğŸ”–æ ‡ç­¾><span>ğŸ”–æ ‡ç­¾</span></a></li><li><a href=https://xiaokunji.com/zh/categories.html title=ğŸ“–åˆ†ç±»><span>ğŸ“–åˆ†ç±»</span></a></li><li><a href=https://xiaokunji.com/zh/links.html title=ğŸ¤å‹é“¾><span>ğŸ¤å‹é“¾</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><nav aria-label=breadcrumb><ul><a href=https://xiaokunji.com/zh/>ğŸ </a> <span>></span>
<a href=https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6.html>javaåŠå…¶æ¡†æ¶</a> <span>></span>
<a href=https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/spring.html>spring</a> <span>></span></ul></nav><h1 class=post-title>SpringCache</h1><div class=post-description></div><div class=post-meta>åˆ›å»º:&nbsp;<span title='2023-08-22 00:00:00 +0000 UTC'>2023-08-22</span>&nbsp;Â·&nbsp;æ›´æ–°:&nbsp;2023-08-30&nbsp;Â·&nbsp;8 åˆ†é’Ÿ&nbsp;Â·&nbsp;xkj
&nbsp;|&nbsp;åˆ†ç±»: &nbsp;<ul class=post-categories-meta><a href=https://xiaokunji.com/zh/categories/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6.html>javaåŠå…¶æ¡†æ¶</a></ul><span id=busuanzi_container_page_pv>&nbsp;| è®¿é—®: <span id=busuanzi_value_page_pv></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#1-%e4%bb%8b%e7%bb%8d aria-label="1. ä»‹ç»">1. ä»‹ç»</a></li><li><a href=#2-%e5%b8%b8%e7%94%a8%e6%b3%a8%e8%a7%a3 aria-label="2. å¸¸ç”¨æ³¨è§£">2. å¸¸ç”¨æ³¨è§£</a><ul><li><a href=#21-enablecaching aria-label="2.1 @EnableCaching">2.1 @EnableCaching</a></li><li><a href=#22-cacheable aria-label="2.2 @Cacheable">2.2 @Cacheable</a></li><li><a href=#23-cacheput aria-label="2.3 @CachePut">2.3 @CachePut</a></li><li><a href=#24-cacheevict aria-label="2.4 @CacheEvict">2.4 @CacheEvict</a></li><li><a href=#25-caching aria-label="2.5 @Caching">2.5 @Caching</a></li><li><a href=#26-cacheconfig aria-label="2.6 @CacheConfigï¼š">2.6 @CacheConfigï¼š</a></li></ul></li><li><a href=#3-%e7%bc%93%e5%ad%98%e5%85%b7%e4%bd%93%e5%ae%9e%e7%8e%b0 aria-label="3. ç¼“å­˜å…·ä½“å®ç°">3. ç¼“å­˜å…·ä½“å®ç°</a></li><li><a href=#4-%e4%bd%bf%e7%94%a8 aria-label="4. ä½¿ç”¨">4. ä½¿ç”¨</a><ul><li><a href=#41-%e5%bc%95%e5%85%a5%e4%be%9d%e8%b5%96 aria-label="4.1 å¼•å…¥ä¾èµ–">4.1 å¼•å…¥ä¾èµ–</a></li><li><a href=#42-%e9%85%8d%e7%bd%ae%e7%b1%bb aria-label="4.2 é…ç½®ç±»">4.2 é…ç½®ç±»</a></li><li><a href=#43-%e5%bc%80%e5%90%af%e5%b9%b6%e4%bd%bf%e7%94%a8 aria-label="4.3 å¼€å¯å¹¶ä½¿ç”¨">4.3 å¼€å¯å¹¶ä½¿ç”¨</a></li><li><a href=#44-%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label="4.4 é…ç½®æ–‡ä»¶">4.4 é…ç½®æ–‡ä»¶</a></li></ul></li><li><a href=#5-%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9 aria-label="5. æ³¨æ„äº‹é¡¹">5. æ³¨æ„äº‹é¡¹</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>[toc]</p><h1 id=1-ä»‹ç»>1. ä»‹ç»<a hidden class=anchor aria-hidden=true href=#1-ä»‹ç»>#</a></h1><p>SpringCacheæä¾›åŸºæœ¬çš„CacheæŠ½è±¡ï¼Œå¹¶æ²¡æœ‰å…·ä½“çš„ç¼“å­˜èƒ½åŠ›ï¼Œéœ€è¦é…åˆå…·ä½“çš„ç¼“å­˜å®ç°æ¥å®Œæˆï¼Œç›®å‰SpringCacheæ”¯æŒredisã€ehcacheã€simpleï¼ˆåŸºäºå†…å­˜,ä½¿ç”¨<code>ConcurrentHashMap</code>ï¼‰ç­‰æ–¹å¼æ¥å®ç°ç¼“å­˜ã€‚</p><blockquote><p>å› ä¸ºspringçš„ç¼“å­˜æœºåˆ¶ä¼šå¼•å…¥ä¸€äº›é—®é¢˜, ä¸€äº›å¤§å‹é¡¹ç›®å¯èƒ½ä¸é€‚åˆ, æ¯”å¦‚å¹¶å‘åœºæ™¯ä¸‹å‡ºç°å¼‚å¸¸ç­‰ç­‰, ä½†å¤§éƒ¨åˆ†çš„é¡¹ç›®è¿˜æ˜¯å¯ä»¥é€‚ç”¨çš„(æ¯•ç«Ÿä¸­å›½æ²¡æœ‰å¤šå°‘å…·å¤‡é«˜å¹¶å‘çš„å…¬å¸)</p></blockquote><h1 id=2-å¸¸ç”¨æ³¨è§£>2. å¸¸ç”¨æ³¨è§£<a hidden class=anchor aria-hidden=true href=#2-å¸¸ç”¨æ³¨è§£>#</a></h1><h2 id=21-enablecaching>2.1 @EnableCaching<a hidden class=anchor aria-hidden=true href=#21-enablecaching>#</a></h2><p>å¼€å¯ç¼“å­˜åŠŸèƒ½ï¼Œä¸€èˆ¬ä½¿ç”¨åœ¨springbootçš„å¯åŠ¨ç±»æˆ–é…ç½®ç±»ä¸Š</p><h2 id=22-cacheable>2.2 @Cacheable<a hidden class=anchor aria-hidden=true href=#22-cacheable>#</a></h2><p>ä½¿ç”¨ç¼“å­˜ã€‚åœ¨æ–¹æ³•æ‰§è¡Œå‰Springå…ˆæŸ¥çœ‹ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰æ•°æ®ï¼Œåˆ™ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ï¼›æ²¡æœ‰åˆ™è°ƒç”¨æ–¹æ³•å¹¶å°†æ–¹æ³•è¿”å›å€¼æ”¾è¿›ç¼“å­˜ã€‚</p><p>**æ³¨è§£å‚æ•°è§£é‡Š: **</p><table><thead><tr><th>@Cacheableå±æ€§å</th><th>ç”¨é€”</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>cacheNames/value</td><td>æŒ‡å®šç¼“å­˜ç©ºé—´çš„åç§°ï¼Œä¸åŒç¼“å­˜ç©ºé—´çš„æ•°æ®æ˜¯å½¼æ­¤éš”ç¦»çš„</td><td></td></tr><tr><td>key</td><td>åŒä¸€ä¸ªcacheNamesä¸­é€šè¿‡keyåŒºåˆ«ä¸åŒçš„ç¼“å­˜ã€‚å¦‚æœæŒ‡å®šè¦æŒ‰ç…§ SpEL è¡¨è¾¾å¼ç¼–å†™ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œåˆ™ç¼ºçœæŒ‰ç…§æ–¹æ³•çš„æ‰€æœ‰å‚æ•°è¿›è¡Œç»„åˆï¼Œå¦‚ï¼š@CachePut(value = â€œdemoâ€, key = â€œâ€˜userâ€™+#user.idâ€)ï¼Œå­—ç¬¦ä¸²ä¸­springè¡¨è¾¾å¼æ„å¤–çš„å­—ç¬¦ä¸²éƒ¨åˆ†éœ€è¦ç”¨å•å¼•å·</td><td>SpringCacheæä¾›äº†ä¸ç¼“å­˜ç›¸å…³çš„ä¸“ç”¨å…ƒæ•°æ®ï¼Œå¦‚targetã€methodMameã€resultã€æ–¹æ³•å‚æ•°ç­‰ï¼Œå¦‚ï¼š@CachePut(value = â€œdemoâ€, key = â€œ#result==nullâ€)<br>å½“æ–¹æ³•çš„å‚æ•°å’Œå€¼ä¸€æ ·æ—¶, ä¼šå¯¼è‡´é‡å¤;<br>å¦‚æœæ˜¯åŸºæœ¬å‚æ•°: å‚æ•°å+å€¼<br>å¦‚æœæ˜¯å¯¹è±¡å‚æ•°: å‚æ•°çš„ç±»å+å¯¹è±¡çš„æˆå‘˜å˜é‡+å€¼ (ç±»ä¼¼äºtoStringçš„ç»“æœ)</td></tr><tr><td>keyGenrator</td><td>keyçš„ç”Ÿæˆç­–ç•¥ï¼ŒSpringCacheé»˜è®¤ä½¿ç”¨SimpleKeyGeneratorï¼Œé»˜è®¤æƒ…å†µä¸‹å°†å‚æ•°å€¼ä½œä¸ºé”®ï¼Œä½†æ˜¯å¯èƒ½ä¼šå¯¼è‡´keyé‡å¤å‡ºç°ï¼Œå› æ­¤ä¸€èˆ¬éœ€è¦è‡ªå®šä¹‰keyçš„ç”Ÿæˆç­–ç•¥</td><td>å’Œkeyå‚æ•°äºŒé€‰ä¸€</td></tr><tr><td>cacheManager</td><td>æŒ‡å®šç¼“å­˜ç®¡ç†å™¨(ä¾‹å¦‚ConcurrentHashMapã€Redisç­‰)ã€‚</td><td></td></tr><tr><td>cacheResolver</td><td>å’ŒcacheManagerä½œç”¨ä¸€æ ·ï¼Œä½¿ç”¨æ—¶äºŒé€‰ä¸€ã€‚</td><td></td></tr><tr><td>condition</td><td>(æŒ‡å®šç¼“å­˜çš„æ¡ä»¶ï¼ˆå¯¹å‚æ•°åˆ¤æ–­ï¼Œæ»¡è¶³ä»€ä¹ˆæ¡ä»¶æ—¶æ‰ç¼“å­˜ï¼‰)<br>conditionæ˜¯åœ¨è°ƒç”¨æ–¹æ³•ä¹‹å‰åˆ¤æ–­æ¡ä»¶ï¼Œæ»¡è¶³æ¡ä»¶æ‰ç¼“å­˜, æ”¯æŒspelè¯­æ³•</td><td>@Cacheable(cacheNames=â€œbookâ€, condition="#name.length() &lt; 32")</td></tr><tr><td>unless</td><td>(å¦å®šç¼“å­˜çš„æ¡ä»¶ï¼ˆå¯¹ç»“æœåˆ¤æ–­ï¼Œæ»¡è¶³ä»€ä¹ˆæ¡ä»¶æ—¶ä¸ç¼“å­˜ï¼‰)<br>unlessæ˜¯åœ¨è°ƒç”¨æ–¹æ³•ä¹‹ååˆ¤æ–­æ¡ä»¶ï¼Œå¦‚æœSpELæ¡ä»¶æˆç«‹ï¼Œåˆ™ä¸ç¼“å­˜ã€æ¡ä»¶æ»¡è¶³ä¸ç¼“å­˜ã€‘,æ”¯æŒspelè¯­æ³•</td><td>@Cacheable(cacheNames = â€œhelloâ€,unless="#result.id.contains(â€˜1â€™)" )</td></tr><tr><td>sync</td><td>ç¼“å­˜è¿‡æœŸä¹‹åï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è¯·æ±‚å¯¹æŸä¸ªæ•°æ®çš„è®¿é—®ï¼Œä¼šåŒæ—¶å»åˆ°æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“ç¬é—´è´Ÿè·å¢é«˜ã€‚Spring4.3ä¸º@Cacheableæ³¨è§£æä¾›äº†ä¸€ä¸ªæ–°çš„å‚æ•°â€œsyncâ€ï¼ˆé»˜è®¤ä¸ºfalseï¼‰ã€‚å½“è®¾ç½®å®ƒä¸ºtrueæ—¶ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„è¯·æ±‚ä¼šå»åˆ°æ•°æ®åº“ï¼Œå…¶ä»–çº¿ç¨‹éƒ½ä¼šç­‰å¾…ç›´åˆ°ç¼“å­˜å¯ç”¨ã€‚è¿™ä¸ªè®¾ç½®å¯ä»¥å‡å°‘å¯¹æ•°æ®åº“çš„ç¬é—´å¹¶å‘è®¿é—®ã€‚</td><td></td></tr></tbody></table><h2 id=23-cacheput>2.3 @CachePut<a hidden class=anchor aria-hidden=true href=#23-cacheput>#</a></h2><p>æ›´æ–°ç¼“å­˜ï¼Œå°†æ–¹æ³•çš„è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¸­</p><h2 id=24-cacheevict>2.4 @CacheEvict<a hidden class=anchor aria-hidden=true href=#24-cacheevict>#</a></h2><p>æ¸…ç©ºç¼“å­˜</p><h2 id=25-caching>2.5 @Caching<a hidden class=anchor aria-hidden=true href=#25-caching>#</a></h2><p><code>@Caching</code>æ˜¯ä¸€ä¸ªç»„æ³¨è§£ï¼Œå¯ä»¥ä¸ºä¸€ä¸ªæ–¹æ³•å®šä¹‰æä¾›åŸºäº<code>@Cacheable</code>ã€<code>@CacheEvict</code>æˆ–è€…<code>@CachePut</code>æ³¨è§£çš„æ•°ç»„ã€‚</p><p>ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­, åœ¨æ–¹æ³•ä¸ŠåŠ  <code>@caching</code>å¹¶æ ‡æ³¨éœ€è¦çš„é€»è¾‘, è¿™æ ·è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶å°±èƒ½åŒæ—¶è§¦å‘å¤šä¸ªæ“ä½œ</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@Caching</span><span style=color:#ff7b72;font-weight:700>(</span>
</span></span><span style=display:flex><span>        put <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#d2a8ff;font-weight:700>@CachePut</span><span style=color:#ff7b72;font-weight:700>(</span>value <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;myCache&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> key <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;#result.id&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72;font-weight:700>},</span>
</span></span><span style=display:flex><span>        evict <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#d2a8ff;font-weight:700>@CacheEvict</span><span style=color:#ff7b72;font-weight:700>(</span>value <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;otherCache&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> key <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;#id&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72;font-weight:700>},</span>
</span></span><span style=display:flex><span>        cacheable <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#d2a8ff;font-weight:700>@Cacheable</span><span style=color:#ff7b72;font-weight:700>(</span>value <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;myFifthCache&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> key <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;#result.id&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>public</span> MyEntity <span style=color:#d2a8ff;font-weight:700>saveData</span><span style=color:#ff7b72;font-weight:700>(</span>Long id<span style=color:#ff7b72;font-weight:700>,</span> String name<span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>        MyEntity entity <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> MyEntity<span style=color:#ff7b72;font-weight:700>(</span>id<span style=color:#ff7b72;font-weight:700>,</span> name<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> entity<span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=26-cacheconfig>2.6 @CacheConfigï¼š<a hidden class=anchor aria-hidden=true href=#26-cacheconfig>#</a></h2><p>ä¸€ä¸ªç±»ä¸­å¯èƒ½ä¼šæœ‰å¤šä¸ªç¼“å­˜æ“ä½œï¼Œè€Œè¿™äº›ç¼“å­˜æ“ä½œå¯èƒ½æ˜¯é‡å¤çš„ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨ <code>@CacheConfig</code>æ˜¯ä¸€ä¸ªç±»çº§åˆ«çš„æ³¨è§£.</p><p>å®ƒå¯ä»¥å­˜æ”¾è¯¥ç±»ä¸­æ‰€æœ‰ç¼“å­˜çš„å…¬æœ‰å±æ€§ï¼Œæ¯”å¦‚è®¾ç½®ç¼“å­˜ç©ºé—´çš„åå­—cacheNamesã€keyç”Ÿæˆç­–ç•¥keyGeneratorã€ç¼“å­˜ç®¡ç†å™¨cacheManager</p><h1 id=3-ç¼“å­˜å…·ä½“å®ç°>3. ç¼“å­˜å…·ä½“å®ç°<a hidden class=anchor aria-hidden=true href=#3-ç¼“å­˜å…·ä½“å®ç°>#</a></h1><p>æ”¯æŒå¤šç§ç¼“å­˜æä¾›ç¨‹åºï¼ŒåŒ…æ‹¬ <code>Caffeine</code>ã€<code>Hazelcast</code> ã€ <code>Redis</code>å’Œ<code>ConcurrentHashMap</code>(é»˜è®¤å€¼)ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´æ”¯æŒæœ¬åœ°ç¼“å­˜å’Œç¬¬ä¸‰æ–¹ç¼“å­˜æ¡†æ¶, å¦‚æœæ˜¯ç¬¬ä¸‰æ–¹çš„ç¼“å­˜å°±éœ€è¦é¢å¤–çš„pomåæ ‡æ”¯æŒ</p><blockquote><p>æ¨è<code>caffeine</code>è¿™ä¸ªæœ¬åœ°ç¼“å­˜æ¡†æ¶, æ€§èƒ½å¥½,åŠŸèƒ½å…¨, åªæ˜¯éœ€è¦é¢å¤–å¼•å…¥<code>caffeine</code>è¿™ä¸ªæ¡†æ¶,å°±æœ‰ç‚¹å°æˆæœ¬äº†</p><p>å…¶æ¬¡æ¨èä½¿ç”¨<code>redis</code>, åŠŸèƒ½å…¨,æ€§èƒ½å¥½(æ²¡æœ‰caffeineè¿™ç§æœ¬åœ°ç¼“å­˜å¿«), é¡¹ç›®ä¸­åæ­£éƒ½è¦å¼•å…¥redisçš„, åˆšå¥½é¡ºä¾¿èƒ½ç”¨</p></blockquote><p>è¿™é‡Œä»¥redisä¸ºä¾‹</p><h1 id=4-ä½¿ç”¨>4. ä½¿ç”¨<a hidden class=anchor aria-hidden=true href=#4-ä½¿ç”¨>#</a></h1><h2 id=41-å¼•å…¥ä¾èµ–>4.1 å¼•å…¥ä¾èµ–<a hidden class=anchor aria-hidden=true href=#41-å¼•å…¥ä¾èµ–>#</a></h2><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span> <span style=color:#7ee787>&lt;dependencies&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>&lt;!--å¼•å…¥ç¼“å­˜--&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#7ee787>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#7ee787>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#7ee787>&lt;artifactId&gt;</span>spring-boot-starter-cache<span style=color:#7ee787>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#7ee787>&lt;version&gt;</span>2.3.0.RELEASE<span style=color:#7ee787>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>     	<span style=color:#8b949e;font-style:italic>&lt;!--å¼•å…¥redis--&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#7ee787>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#7ee787>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#7ee787>&lt;artifactId&gt;</span>spring-boot-starter-data-redis<span style=color:#7ee787>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#7ee787>&lt;version&gt;</span>2.3.0.RELEASE<span style=color:#7ee787>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#7ee787>&lt;/dependencies&gt;</span>
</span></span></code></pre></div><h2 id=42-é…ç½®ç±»>4.2 é…ç½®ç±»<a hidden class=anchor aria-hidden=true href=#42-é…ç½®ç±»>#</a></h2><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>public</span> <span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>RedisConfiguration</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ${cache} è·å–é…ç½®æ–‡ä»¶çš„é…ç½®ä¿¡æ¯   #{}æ˜¯springè¡¨è¾¾å¼ï¼Œè·å–Beanå¯¹è±¡çš„å±æ€§
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#d2a8ff;font-weight:700>@Value</span><span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;#{${cache}}&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>private</span> Map<span style=color:#ff7b72;font-weight:700>&lt;</span>String<span style=color:#ff7b72;font-weight:700>,</span> Long<span style=color:#ff7b72;font-weight:700>&gt;</span> ttlParams<span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * @param redisConnectionFactory
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * @åŠŸèƒ½æè¿° redisä½œä¸ºç¼“å­˜æ—¶é…ç½®ç¼“å­˜ç®¡ç†å™¨CacheManagerï¼Œä¸»è¦é…ç½®åºåˆ—åŒ–æ–¹å¼ã€è‡ªå®šä¹‰
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * æ³¨æ„ï¼šé…ç½®ç¼“å­˜ç®¡ç†å™¨CacheManageræœ‰ä¸¤ç§æ–¹å¼ï¼š
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * æ–¹å¼1ï¼šé€šè¿‡RedisCacheConfiguration.defaultCacheConfig()è·å–åˆ°é»˜è®¤çš„RedisCacheConfigurationå¯¹è±¡ï¼Œ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * ä¿®æ”¹RedisCacheConfigurationå¯¹è±¡çš„åºåˆ—åŒ–æ–¹å¼ç­‰å‚æ•°ã€è¿™é‡Œå°±é‡‡ç”¨çš„è¿™ç§æ–¹å¼ã€‘
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * æ–¹å¼2ï¼šé€šè¿‡ç»§æ‰¿CachingConfigurerSupportç±»è‡ªå®šä¹‰ç¼“å­˜ç®¡ç†å™¨ï¼Œè¦†å†™å„æ–¹æ³•ï¼Œå‚è€ƒï¼š
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * https://blog.csdn.net/echizao1839/article/details/102660649
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * åˆ‡è®°ï¼šåœ¨ç¼“å­˜é…ç½®ç±»ä¸­é…ç½®ä»¥åï¼Œyamlé…ç½®æ–‡ä»¶ä¸­å…³äºç¼“å­˜çš„redisé…ç½®å°±ä¸ä¼šç”Ÿæ•ˆï¼Œå¦‚æœéœ€è¦ç›¸å…³é…ç½®éœ€è¦é€šè¿‡@valueå»è¯»å–
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>public</span> CacheManager <span style=color:#d2a8ff;font-weight:700>cacheManager</span><span style=color:#ff7b72;font-weight:700>(</span>RedisConnectionFactory redisConnectionFactory<span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>        RedisCacheConfiguration redisCacheConfiguration <span style=color:#ff7b72;font-weight:700>=</span> RedisCacheConfiguration<span style=color:#ff7b72;font-weight:700>.</span>defaultCacheConfig<span style=color:#ff7b72;font-weight:700>()</span>
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic>// è®¾ç½®keyé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>              <span style=color:#ff7b72;font-weight:700>.</span>serializeKeysWith<span style=color:#ff7b72;font-weight:700>(</span>RedisSerializationContext<span style=color:#ff7b72;font-weight:700>.</span>SerializationPair<span style=color:#ff7b72;font-weight:700>.</span>fromSerializer<span style=color:#ff7b72;font-weight:700>(</span>StringRedisSerializer<span style=color:#ff7b72;font-weight:700>.</span>UTF_8<span style=color:#ff7b72;font-weight:700>))</span>
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic>//è®¾ç½®valueåºåˆ—åŒ–æ–¹å¼é‡‡ç”¨jacksonæ–¹å¼åºåˆ—åŒ–
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                <span style=color:#ff7b72;font-weight:700>.</span>serializeValuesWith<span style=color:#ff7b72;font-weight:700>(</span>RedisSerializationContext<span style=color:#ff7b72;font-weight:700>.</span>SerializationPair<span style=color:#ff7b72;font-weight:700>.</span>fromSerializer<span style=color:#ff7b72;font-weight:700>(</span>serializer<span style=color:#ff7b72;font-weight:700>()))</span>
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic>//å½“valueä¸ºnullæ—¶ä¸è¿›è¡Œç¼“å­˜
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                <span style=color:#ff7b72;font-weight:700>.</span>disableCachingNullValues<span style=color:#ff7b72;font-weight:700>()</span>
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic>// é…ç½®ç¼“å­˜ç©ºé—´åç§°çš„å‰ç¼€ (è¿™é‡Œä¼šè¦†ç›– @cacheableæ³¨è§£çš„vauleå­—æ®µ)
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                <span style=color:#ff7b72;font-weight:700>.</span>prefixCacheNameWith<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;demo:&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic>//å…¨å±€é…ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´ã€å¯ä»¥ä¸é…ç½®ã€‘
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                <span style=color:#ff7b72;font-weight:700>.</span>entryTtl<span style=color:#ff7b72;font-weight:700>(</span>Duration<span style=color:#ff7b72;font-weight:700>.</span>ofMinutes<span style=color:#ff7b72;font-weight:700>(</span>30L<span style=color:#ff7b72;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>//ä¸“é—¨æŒ‡å®šæŸäº›ç¼“å­˜ç©ºé—´çš„é…ç½®ï¼Œå¦‚æœè¿‡æœŸæ—¶é—´ã€ä¸»è¦è¿™é‡Œçš„keyä¸ºç¼“å­˜ç©ºé—´åç§°ã€‘
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        Map<span style=color:#ff7b72;font-weight:700>&lt;</span>String<span style=color:#ff7b72;font-weight:700>,</span> RedisCacheConfiguration<span style=color:#ff7b72;font-weight:700>&gt;</span> map <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> HashMap<span style=color:#ff7b72;font-weight:700>&lt;&gt;();</span>
</span></span><span style=display:flex><span>        Set<span style=color:#ff7b72;font-weight:700>&lt;</span>Map<span style=color:#ff7b72;font-weight:700>.</span>Entry<span style=color:#ff7b72;font-weight:700>&lt;</span>String<span style=color:#ff7b72;font-weight:700>,</span> Long<span style=color:#ff7b72;font-weight:700>&gt;&gt;</span> entries <span style=color:#ff7b72;font-weight:700>=</span> ttlParams<span style=color:#ff7b72;font-weight:700>.</span>entrySet<span style=color:#ff7b72;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> <span style=color:#ff7b72;font-weight:700>(</span>Map<span style=color:#ff7b72;font-weight:700>.</span>Entry<span style=color:#ff7b72;font-weight:700>&lt;</span>String<span style=color:#ff7b72;font-weight:700>,</span> Long<span style=color:#ff7b72;font-weight:700>&gt;</span> entry <span style=color:#ff7b72;font-weight:700>:</span> entries<span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic>//æŒ‡å®šç‰¹å®šç¼“å­˜ç©ºé—´å¯¹åº”çš„è¿‡æœŸæ—¶é—´
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>            map<span style=color:#ff7b72;font-weight:700>.</span>put<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;user&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> redisCacheConfiguration<span style=color:#ff7b72;font-weight:700>.</span>entryTtl<span style=color:#ff7b72;font-weight:700>(</span>Duration<span style=color:#ff7b72;font-weight:700>.</span>ofSeconds<span style=color:#ff7b72;font-weight:700>(</span>40<span style=color:#ff7b72;font-weight:700>)));</span>
</span></span><span style=display:flex><span>            map<span style=color:#ff7b72;font-weight:700>.</span>put<span style=color:#ff7b72;font-weight:700>(</span>entry<span style=color:#ff7b72;font-weight:700>.</span>getKey<span style=color:#ff7b72;font-weight:700>(),</span> redisCacheConfiguration<span style=color:#ff7b72;font-weight:700>.</span>entryTtl<span style=color:#ff7b72;font-weight:700>(</span>Duration<span style=color:#ff7b72;font-weight:700>.</span>ofSeconds<span style=color:#ff7b72;font-weight:700>(</span>entry<span style=color:#ff7b72;font-weight:700>.</span>getValue<span style=color:#ff7b72;font-weight:700>())));</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> RedisCacheManager
</span></span><span style=display:flex><span>                <span style=color:#ff7b72;font-weight:700>.</span>builder<span style=color:#ff7b72;font-weight:700>(</span>redisConnectionFactory<span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>                <span style=color:#ff7b72;font-weight:700>.</span>cacheDefaults<span style=color:#ff7b72;font-weight:700>(</span>redisCacheConfiguration<span style=color:#ff7b72;font-weight:700>)</span>  <span style=color:#8b949e;font-style:italic>//é»˜è®¤é…ç½®
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                <span style=color:#ff7b72;font-weight:700>.</span>withInitialCacheConfigurations<span style=color:#ff7b72;font-weight:700>(</span>map<span style=color:#ff7b72;font-weight:700>)</span>  <span style=color:#8b949e;font-style:italic>//æŸäº›ç¼“å­˜ç©ºé—´çš„ç‰¹å®šé…ç½®
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                <span style=color:#ff7b72;font-weight:700>.</span>build<span style=color:#ff7b72;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * è‡ªå®šä¹‰ç¼“å­˜çš„redisçš„KeyGeneratorã€keyç”Ÿæˆç­–ç•¥ã€‘
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * æ³¨æ„: è¯¥æ–¹æ³•åªæ˜¯å£°æ˜äº†keyçš„ç”Ÿæˆç­–ç•¥,éœ€åœ¨@Cacheableæ³¨è§£ä¸­é€šè¿‡keyGeneratorå±æ€§æŒ‡å®šå…·ä½“çš„keyç”Ÿæˆç­–ç•¥
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * å¯ä»¥æ ¹æ®ä¸šåŠ¡æƒ…å†µï¼Œé…ç½®å¤šä¸ªç”Ÿæˆç­–ç•¥
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * å¦‚: @Cacheable(value = &#34;key&#34;, keyGenerator = &#34;cacheKeyGenerator&#34;)
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>public</span> KeyGenerator <span style=color:#d2a8ff;font-weight:700>keyGenerator</span><span style=color:#ff7b72;font-weight:700>()</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>         * target: ç±»
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>         * method: æ–¹æ³•
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>         * params: æ–¹æ³•å‚æ•°
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>         */</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#ff7b72;font-weight:700>(</span>target<span style=color:#ff7b72;font-weight:700>,</span> method<span style=color:#ff7b72;font-weight:700>,</span> params<span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72;font-weight:700>-&gt;</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic>//è·å–ä»£ç†å¯¹è±¡çš„æœ€ç»ˆç›®æ ‡å¯¹è±¡
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>            StringBuilder sb <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> StringBuilder<span style=color:#ff7b72;font-weight:700>();</span>
</span></span><span style=display:flex><span>            sb<span style=color:#ff7b72;font-weight:700>.</span>append<span style=color:#ff7b72;font-weight:700>(</span>target<span style=color:#ff7b72;font-weight:700>.</span>getClass<span style=color:#ff7b72;font-weight:700>().</span>getSimpleName<span style=color:#ff7b72;font-weight:700>()).</span>append<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;:&#34;</span><span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>            sb<span style=color:#ff7b72;font-weight:700>.</span>append<span style=color:#ff7b72;font-weight:700>(</span>method<span style=color:#ff7b72;font-weight:700>.</span>getName<span style=color:#ff7b72;font-weight:700>()).</span>append<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;:&#34;</span><span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic>//è°ƒç”¨SimpleKeyçš„keyç”Ÿæˆå™¨
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>            Object key <span style=color:#ff7b72;font-weight:700>=</span> SimpleKeyGenerator<span style=color:#ff7b72;font-weight:700>.</span>generateKey<span style=color:#ff7b72;font-weight:700>(</span>params<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> sb<span style=color:#ff7b72;font-weight:700>.</span>append<span style=color:#ff7b72;font-weight:700>(</span>key<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72;font-weight:700>};</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * @param redisConnectionFactoryï¼šé…ç½®ä¸åŒçš„å®¢æˆ·ç«¯ï¼Œè¿™é‡Œæ³¨å…¥çš„redisè¿æ¥å·¥å‚ä¸åŒï¼š JedisConnectionFactoryã€LettuceConnectionFactory
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * @åŠŸèƒ½æè¿° ï¼šé…ç½®Redisåºåˆ—åŒ–ï¼ŒåŸå› å¦‚ä¸‹ï¼š
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * ï¼ˆ1ï¼‰ StringRedisTemplateçš„åºåˆ—åŒ–æ–¹å¼ä¸ºå­—ç¬¦ä¸²åºåˆ—åŒ–ï¼Œ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * RedisTemplateçš„åºåˆ—åŒ–æ–¹å¼é»˜ä¸ºjdkåºåˆ—åŒ–ï¼ˆå®ç°Serializableæ¥å£ï¼‰
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * ï¼ˆ2ï¼‰ RedisTemplateçš„jdkåºåˆ—åŒ–æ–¹å¼åœ¨Redisçš„å®¢æˆ·ç«¯ä¸­ä¸ºä¹±ç ï¼Œä¸æ–¹ä¾¿æŸ¥çœ‹ï¼Œ
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * å› æ­¤ä¸€èˆ¬ä¿®æ”¹RedisTemplateçš„åºåˆ—åŒ–ä¸ºæ–¹å¼ä¸ºJSONæ–¹å¼ã€å»ºè®®ä½¿ç”¨GenericJackson2JsonRedisSerializerã€‘
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>public</span> RedisTemplate<span style=color:#ff7b72;font-weight:700>&lt;</span>String<span style=color:#ff7b72;font-weight:700>,</span> Object<span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#d2a8ff;font-weight:700>redisTemplate</span><span style=color:#ff7b72;font-weight:700>(</span>RedisConnectionFactory redisConnectionFactory<span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>        GenericJackson2JsonRedisSerializer genericJackson2JsonRedisSerializer <span style=color:#ff7b72;font-weight:700>=</span> serializer<span style=color:#ff7b72;font-weight:700>();</span>
</span></span><span style=display:flex><span>        RedisTemplate<span style=color:#ff7b72;font-weight:700>&lt;</span>String<span style=color:#ff7b72;font-weight:700>,</span> Object<span style=color:#ff7b72;font-weight:700>&gt;</span> redisTemplate <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> RedisTemplate<span style=color:#ff7b72;font-weight:700>&lt;&gt;();</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// keyé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        redisTemplate<span style=color:#ff7b72;font-weight:700>.</span>setKeySerializer<span style=color:#ff7b72;font-weight:700>(</span>StringRedisSerializer<span style=color:#ff7b72;font-weight:700>.</span>UTF_8<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// valueåºåˆ—åŒ–æ–¹å¼é‡‡ç”¨jackson
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        redisTemplate<span style=color:#ff7b72;font-weight:700>.</span>setValueSerializer<span style=color:#ff7b72;font-weight:700>(</span>genericJackson2JsonRedisSerializer<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// hashçš„keyä¹Ÿé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        redisTemplate<span style=color:#ff7b72;font-weight:700>.</span>setHashKeySerializer<span style=color:#ff7b72;font-weight:700>(</span>StringRedisSerializer<span style=color:#ff7b72;font-weight:700>.</span>UTF_8<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>//hashçš„valueåºåˆ—åŒ–æ–¹å¼é‡‡ç”¨jackson
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        redisTemplate<span style=color:#ff7b72;font-weight:700>.</span>setHashValueSerializer<span style=color:#ff7b72;font-weight:700>(</span>genericJackson2JsonRedisSerializer<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        redisTemplate<span style=color:#ff7b72;font-weight:700>.</span>setConnectionFactory<span style=color:#ff7b72;font-weight:700>(</span>redisConnectionFactory<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> redisTemplate<span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * æ­¤æ–¹æ³•ä¸èƒ½ç”¨@Benæ³¨è§£ï¼Œé¿å…æ›¿æ¢Springå®¹å™¨ä¸­çš„åŒç±»å‹å¯¹è±¡
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>public</span> GenericJackson2JsonRedisSerializer <span style=color:#d2a8ff;font-weight:700>serializer</span><span style=color:#ff7b72;font-weight:700>()</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>new</span> GenericJackson2JsonRedisSerializer<span style=color:#ff7b72;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=43-å¼€å¯å¹¶ä½¿ç”¨>4.3 å¼€å¯å¹¶ä½¿ç”¨<a hidden class=anchor aria-hidden=true href=#43-å¼€å¯å¹¶ä½¿ç”¨>#</a></h2><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@EnableCaching</span>   <span style=color:#8b949e;font-style:italic>//å¼€å¯ç¼“å­˜çš„ä¸»é”®
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#d2a8ff;font-weight:700>@SpringBootApplication</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>public</span> <span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>RedisDemoApplication</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>public</span> <span style=color:#ff7b72>static</span> <span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>main</span><span style=color:#ff7b72;font-weight:700>(</span>String<span style=color:#ff7b72;font-weight:700>[]</span> args<span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>        SpringApplication<span style=color:#ff7b72;font-weight:700>.</span>run<span style=color:#ff7b72;font-weight:700>(</span>RedisDemoApplication<span style=color:#ff7b72;font-weight:700>.</span>class<span style=color:#ff7b72;font-weight:700>,</span> args<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@Service</span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@CacheConfig</span><span style=color:#ff7b72;font-weight:700>(</span>cacheNames <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;user&#34;</span><span style=color:#ff7b72;font-weight:700>,</span>keyGenerator <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;keyGenerator&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>public</span> <span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>RedisServiceImpl</span> <span style=color:#ff7b72>implements</span> RedisService <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@Cacheable</span><span style=color:#ff7b72;font-weight:700>(</span>value <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;user&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> key <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;&#39;list&#39;&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>public</span> List<span style=color:#ff7b72;font-weight:700>&lt;</span>User<span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#d2a8ff;font-weight:700>list</span><span style=color:#ff7b72;font-weight:700>()</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>        System<span style=color:#ff7b72;font-weight:700>.</span>out<span style=color:#ff7b72;font-weight:700>.</span>println<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;=========list&#34;</span><span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        List<span style=color:#ff7b72;font-weight:700>&lt;</span>User<span style=color:#ff7b72;font-weight:700>&gt;</span> users <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> ArrayList<span style=color:#ff7b72;font-weight:700>&lt;&gt;();</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> users<span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@CacheEvict</span><span style=color:#ff7b72;font-weight:700>(</span>value <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;user&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> key <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;&#39;list&#39;&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>public</span> <span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>del</span><span style=color:#ff7b72;font-weight:700>(</span>Integer id<span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>        System<span style=color:#ff7b72;font-weight:700>.</span>out<span style=color:#ff7b72;font-weight:700>.</span>println<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;************************************+id&#34;</span><span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@CachePut</span><span style=color:#ff7b72;font-weight:700>(</span>value <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;demo&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> key <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;#result==null&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>public</span> <span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>select</span><span style=color:#ff7b72;font-weight:700>(</span>Integer id<span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>        System<span style=color:#ff7b72;font-weight:700>.</span>out<span style=color:#ff7b72;font-weight:700>.</span>println<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;===============dddd================&#34;</span><span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=44-é…ç½®æ–‡ä»¶>4.4 é…ç½®æ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#44-é…ç½®æ–‡ä»¶>#</a></h2><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#7ee787>spring</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>	</span><span style=color:#7ee787>cache</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>type</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>redis  </span><span style=color:#6e7681> </span><span style=color:#8b949e;font-style:italic># æŒ‡å®šä½¿ç”¨çš„ç¼“å­˜ç±»å‹,ä¸ä¼ ä¼šè‡ªåŠ¨è¯†åˆ«</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>redis</span>:<span style=color:#6e7681>    </span><span style=color:#a5d6ff>å½“è‡ªå®šä¹‰ChacheManageræ—¶ï¼Œå°±è¿™é‡Œçš„é…ç½®ä¸éœ€è¦é…ç½®ï¼Œé…ç½®äº†ä¹Ÿä¸èµ·ä½œç”¨</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#7ee787>use-key-prefix</span>:<span style=color:#6e7681> </span><span style=color:#79c0ff>true</span><span style=color:#6e7681>  
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#7ee787>key-prefix</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;demo:&#34;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#7ee787>time-to-live</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>60000</span><span style=color:#6e7681>  </span><span style=color:#8b949e;font-style:italic>#ç¼“å­˜è¶…æ—¶æ—¶é—´ å•ä½ï¼šms</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#7ee787>cache-null-values</span>:<span style=color:#6e7681> </span><span style=color:#79c0ff>false</span><span style=color:#6e7681> </span><span style=color:#8b949e;font-style:italic>#æ˜¯å¦ç¼“å­˜ç©ºå€¼</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#7ee787>cache-names</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>user</span><span style=color:#6e7681> </span><span style=color:#8b949e;font-style:italic># åˆå§‹åŒ–ä¸€äº›ç¼“å­˜å</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#7ee787>ttl</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#39;{&#34;user&#34;:60,&#34;dept&#34;:30}&#39;</span><span style=color:#6e7681>  </span><span style=color:#8b949e;font-style:italic>#è‡ªå®šä¹‰æŸäº›ç¼“å­˜ç©ºé—´çš„è¿‡æœŸæ—¶é—´</span><span style=color:#6e7681>
</span></span></span></code></pre></div><p>ç½‘ä¸Šæœ‰äº›æ–‡ç« ä¼šä½¿ç”¨é…ç½®æ–‡ä»¶çš„æ–¹å¼, å…¶å®è¿™æ˜¯ <code>spring-boot-autoconfigure</code> è‡ªåŠ¨é…ç½®çš„èƒ½åŠ›, å®ƒä¼šæ ¹æ®ä½ å¼•å…¥çš„åŒ…(redis/caffeine), è‡ªåŠ¨æ³¨å…¥å¯¹åº”çš„ç¼“å­˜æœºåˆ¶ , æ¯”å¦‚redisçš„ <code>org.springframework.boot.autoconfigure.cache.RedisCacheConfiguration</code></p><p>å¦‚æœéœ€è¦è‡ªå®šä¹‰ä¸€äº›é…ç½®, å°±éœ€è¦æŒ‰<code>4.1</code>~<code>4.3</code>èŠ‚é‚£ç§é…ç½®</p><h1 id=5-æ³¨æ„äº‹é¡¹>5. æ³¨æ„äº‹é¡¹<a hidden class=anchor aria-hidden=true href=#5-æ³¨æ„äº‹é¡¹>#</a></h1><ol><li><p><code>@Cache</code>æ³¨è§£çš„æ–¹æ³•å¿…é¡»ä¸º <code>public</code></p></li><li><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>@CacheEvict</code>æ ‡æ³¨çš„æ–¹æ³•æ‰§è¡ŒæœŸé—´æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™ä¸ä¼šæ¸…ç©ºç¼“å­˜ã€‚</p></li><li><p>åŸºäº <code>proxy</code> çš„ <code>spring aop</code> å¸¦æ¥çš„å†…éƒ¨è°ƒç”¨é—®é¢˜(aopçš„é€šç”¨é—®é¢˜)</p></li><li><p>ä½¿ç”¨å†…å­˜æ—¶ä¸€å®šè¦è®¾ç½®è¿‡æœŸæ—¶é—´å’Œå…è®¸ä½¿ç”¨å†…å­˜å¤§å° ç­‰ç­‰, ä¸ç„¶åœ¨æç«¯æƒ…å†µä¸‹ä¼šæŠŠå†…å­˜åƒæ»¡</p><blockquote><p>é»˜è®¤çš„ ConcurrentHashMapä¸æ”¯æŒè®¾ç½®è¿‡æœŸæ—¶é—´å’Œå…è®¸ä½¿ç”¨çš„å†…å­˜å¤§å°</p><p>redisä¸æ”¯æŒå…è®¸ä½¿ç”¨çš„å†…å­˜å¤§å°</p><p>caffeineéƒ½èƒ½æ”¯æŒ(è¿™ä¹Ÿæ˜¯æ¨èä½¿ç”¨å®ƒçš„åŸå› ä¹‹ä¸€)</p></blockquote></li></ol><p><a href=https://juejin.cn/post/7157609002606526494#heading-5 target=_blank rel=noopener>Spring Cache æ•´åˆ Redis åšç¼“å­˜ä½¿ç”¨~ å¿«é€Ÿä¸Šæ‰‹~ - æ˜é‡‘ (juejin.cn)</a></p><p><a href=https://blog.csdn.net/user2025/article/details/106595257 target=_blank rel=noopener>SpringBootå®ç°Redisç¼“å­˜ï¼ˆSpringCache+Redisçš„æ•´åˆï¼‰_springboot redis cache_user2025çš„åšå®¢-CSDNåšå®¢</a></p><p><a href=https://zhuanlan.zhihu.com/p/266804094 target=_blank rel=noopener>Spring Cacheï¼Œkeyé‡å¤é—®é¢˜</a></p><p><a href=https://juejin.cn/post/7220292698854752313#heading-2 target=_blank rel=noopener>SpringBooté¡¹ç›®ä¸­ä½¿ç”¨ç¼“å­˜Cacheçš„æ­£ç¡®å§¿åŠ¿ï¼ï¼! - æ˜é‡‘ (juejin.cn)</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://xiaokunji.com/zh/tags/spring.html>Spring</a></li><li><a href=https://xiaokunji.com/zh/tags/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6.html>javaåŠå…¶æ¡†æ¶</a></li></ul><nav class=paginav><a class=prev href=https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/java%E5%9F%BA%E7%A1%80/spi.html><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>SPI</span></a>
<a class=next href=https://xiaokunji.com/zh/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/sql%E5%91%BD%E4%BB%A4%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3.html><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>sqlå‘½ä»¤å‚æ•°è¯¦è§£</span></a></nav></footer></article></main><footer class=footer><span>Copyright
&copy;
-2023
<a href=https://xiaokunji.com/zh/ style=color:#939393>ç±³äºŒ</a>
All Rights Reserved</span>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<span id=busuanzi_container><span class="fa fa-user">ç”¨æˆ·æ•°:</span><span id=busuanzi_value_site_uv></span>
<span class="fa fa-eye">è®¿é—®æ•°:</span><span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="å¤åˆ¶";function s(){t.innerHTML="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerHTML="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>