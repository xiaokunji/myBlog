<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>SpringCache | 米二</title><meta name=keywords content=" 1. 介绍, 2. 常用注解, 2.1 @EnableCaching, 2.2 @Cacheable, 2.3 @CachePut, 2.4 @CacheEvict, 2.5 @Caching, 2.6 @CacheConfig：, 3. 缓存具体实现, 4. 使用, 4.1 引入依赖, 4.2 配置类, 4.3 开启并使用, 4.4 配置文件, 5. 注意事项"><meta name=description content="     "><meta name=author content="xkj"><link rel=canonical href=https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/spring/springcache.html><link crossorigin=anonymous href=/assets/css/stylesheet.b3faf608c544858ba700943ffe182cb647f38432d29a07d73234965beacb26f6.css integrity="sha256-s/r2CMVEhYunAJQ//hgstkfzhDLSmgfXMjSWW+rLJvY=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://xiaokunji.com/img/Q.svg><link rel=icon type=image/png sizes=16x16 href=https://xiaokunji.com/img/Q.svg><link rel=icon type=image/png sizes=32x32 href=https://xiaokunji.com/img/Q.svg><link rel=apple-touch-icon href=https://xiaokunji.com/Q.svg><link rel=mask-icon href=https://xiaokunji.com/Q.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/spring/springcache.html><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="SpringCache"><meta property="og:description" content="     "><meta property="og:type" content="article"><meta property="og:url" content="https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/spring/springcache.html"><meta property="article:section" content="java及其框架"><meta property="article:published_time" content="2023-08-22T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-30T16:26:08+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="SpringCache"><meta name=twitter:description content="     "><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":4,"name":"SpringCache","item":"https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/spring/springcache.html"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"SpringCache","name":"SpringCache","description":"     ","keywords":[" 1. 介绍"," 2. 常用注解"," 2.1 @EnableCaching"," 2.2 @Cacheable"," 2.3 @CachePut"," 2.4 @CacheEvict"," 2.5 @Caching"," 2.6 @CacheConfig："," 3. 缓存具体实现"," 4. 使用"," 4.1 引入依赖"," 4.2 配置类"," 4.3 开启并使用"," 4.4 配置文件"," 5. 注意事项"],"articleBody":"[toc]\n1. 介绍 SpringCache提供基本的Cache抽象，并没有具体的缓存能力，需要配合具体的缓存实现来完成，目前SpringCache支持redis、ehcache、simple（基于内存,使用ConcurrentHashMap）等方式来实现缓存。\n因为spring的缓存机制会引入一些问题, 一些大型项目可能不适合, 比如并发场景下出现异常等等, 但大部分的项目还是可以适用的(毕竟中国没有多少具备高并发的公司)\n2. 常用注解 2.1 @EnableCaching 开启缓存功能，一般使用在springboot的启动类或配置类上\n2.2 @Cacheable 使用缓存。在方法执行前Spring先查看缓存中是否有数据，如果有数据，则直接返回缓存数据；没有则调用方法并将方法返回值放进缓存。\n**注解参数解释: **\n@Cacheable属性名 用途 备注 cacheNames/value 指定缓存空间的名称，不同缓存空间的数据是彼此隔离的 key 同一个cacheNames中通过key区别不同的缓存。如果指定要按照 SpEL 表达式编写，如果不指定，则缺省按照方法的所有参数进行组合，如：@CachePut(value = “demo”, key = “‘user’+#user.id”)，字符串中spring表达式意外的字符串部分需要用单引号 SpringCache提供了与缓存相关的专用元数据，如target、methodMame、result、方法参数等，如：@CachePut(value = “demo”, key = “#result==null”)\n当方法的参数和值一样时, 会导致重复; 如果是基本参数: 参数名+值 如果是对象参数: 参数的类名+对象的成员变量+值 (类似于toString的结果) keyGenrator key的生成策略，SpringCache默认使用SimpleKeyGenerator，默认情况下将参数值作为键，但是可能会导致key重复出现，因此一般需要自定义key的生成策略 和key参数二选一 cacheManager 指定缓存管理器(例如ConcurrentHashMap、Redis等)。 cacheResolver 和cacheManager作用一样，使用时二选一。 condition (指定缓存的条件（对参数判断，满足什么条件时才缓存）)\ncondition是在调用方法之前判断条件，满足条件才缓存, 支持spel语法 @Cacheable(cacheNames=“book”, condition=\"#name.length() \u003c 32\") unless (否定缓存的条件（对结果判断，满足什么条件时不缓存）)\nunless是在调用方法之后判断条件，如果SpEL条件成立，则不缓存【条件满足不缓存】,支持spel语法 @Cacheable(cacheNames = “hello”,unless=\"#result.id.contains(‘1’)\" ) sync 缓存过期之后，如果多个线程同时请求对某个数据的访问，会同时去到数据库，导致数据库瞬间负荷增高。Spring4.3为@Cacheable注解提供了一个新的参数“sync”（默认为false）。当设置它为true时，只有一个线程的请求会去到数据库，其他线程都会等待直到缓存可用。这个设置可以减少对数据库的瞬间并发访问。 2.3 @CachePut 更新缓存，将方法的返回值放到缓存中\n2.4 @CacheEvict 清空缓存\n2.5 @Caching @Caching是一个组注解，可以为一个方法定义提供基于@Cacheable、@CacheEvict或者@CachePut注解的数组。\n例如下面这个例子, 在方法上加 @caching并标注需要的逻辑, 这样调用这个方法时就能同时触发多个操作\n@Caching( put = { @CachePut(value = \"myCache\", key = \"#result.id\") }, evict = { @CacheEvict(value = \"otherCache\", key = \"#id\") }, cacheable = { @Cacheable(value = \"myFifthCache\", key = \"#result.id\") } ) public MyEntity saveData(Long id, String name) { MyEntity entity = new MyEntity(id, name); return entity; } 2.6 @CacheConfig： 一个类中可能会有多个缓存操作，而这些缓存操作可能是重复的。这个时候可以使用 @CacheConfig是一个类级别的注解.\n它可以存放该类中所有缓存的公有属性，比如设置缓存空间的名字cacheNames、key生成策略keyGenerator、缓存管理器cacheManager\n3. 缓存具体实现 支持多种缓存提供程序，包括 Caffeine、Hazelcast 、 Redis和ConcurrentHashMap(默认值)。\n也就是说支持本地缓存和第三方缓存框架, 如果是第三方的缓存就需要额外的pom坐标支持\n推荐caffeine这个本地缓存框架, 性能好,功能全, 只是需要额外引入caffeine这个框架,就有点小成本了\n其次推荐使用redis, 功能全,性能好(没有caffeine这种本地缓存快), 项目中反正都要引入redis的, 刚好顺便能用\n这里以redis为例\n4. 使用 4.1 引入依赖 org.springframework.boot spring-boot-starter-cache 2.3.0.RELEASE org.springframework.boot spring-boot-starter-data-redis 2.3.0.RELEASE 4.2 配置类 @Configuration public class RedisConfiguration { // ${cache} 获取配置文件的配置信息 #{}是spring表达式，获取Bean对象的属性 @Value(\"#{${cache}}\") private Map\u003cString, Long\u003e ttlParams; /** * @param redisConnectionFactory * @功能描述 redis作为缓存时配置缓存管理器CacheManager，主要配置序列化方式、自定义 * * 注意：配置缓存管理器CacheManager有两种方式： * 方式1：通过RedisCacheConfiguration.defaultCacheConfig()获取到默认的RedisCacheConfiguration对象， * 修改RedisCacheConfiguration对象的序列化方式等参数【这里就采用的这种方式】 * 方式2：通过继承CachingConfigurerSupport类自定义缓存管理器，覆写各方法，参考： * https://blog.csdn.net/echizao1839/article/details/102660649 * * 切记：在缓存配置类中配置以后，yaml配置文件中关于缓存的redis配置就不会生效，如果需要相关配置需要通过@value去读取 */ @Bean public CacheManager cacheManager(RedisConnectionFactory redisConnectionFactory) { RedisCacheConfiguration redisCacheConfiguration = RedisCacheConfiguration.defaultCacheConfig() // 设置key采用String的序列化方式 .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(StringRedisSerializer.UTF_8)) //设置value序列化方式采用jackson方式序列化 .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(serializer())) //当value为null时不进行缓存 .disableCachingNullValues() // 配置缓存空间名称的前缀 (这里会覆盖 @cacheable注解的vaule字段) .prefixCacheNameWith(\"demo:\") //全局配置缓存过期时间【可以不配置】 .entryTtl(Duration.ofMinutes(30L)); //专门指定某些缓存空间的配置，如果过期时间【主要这里的key为缓存空间名称】 Map\u003cString, RedisCacheConfiguration\u003e map = new HashMap\u003c\u003e(); Set\u003cMap.Entry\u003cString, Long\u003e\u003e entries = ttlParams.entrySet(); for (Map.Entry\u003cString, Long\u003e entry : entries) { //指定特定缓存空间对应的过期时间 map.put(\"user\", redisCacheConfiguration.entryTtl(Duration.ofSeconds(40))); map.put(entry.getKey(), redisCacheConfiguration.entryTtl(Duration.ofSeconds(entry.getValue()))); } return RedisCacheManager .builder(redisConnectionFactory) .cacheDefaults(redisCacheConfiguration) //默认配置 .withInitialCacheConfigurations(map) //某些缓存空间的特定配置 .build(); } /** * 自定义缓存的redis的KeyGenerator【key生成策略】 * 注意: 该方法只是声明了key的生成策略,需在@Cacheable注解中通过keyGenerator属性指定具体的key生成策略 * 可以根据业务情况，配置多个生成策略 * 如: @Cacheable(value = \"key\", keyGenerator = \"cacheKeyGenerator\") */ @Bean public KeyGenerator keyGenerator() { /** * target: 类 * method: 方法 * params: 方法参数 */ return (target, method, params) -\u003e { //获取代理对象的最终目标对象 StringBuilder sb = new StringBuilder(); sb.append(target.getClass().getSimpleName()).append(\":\"); sb.append(method.getName()).append(\":\"); //调用SimpleKey的key生成器 Object key = SimpleKeyGenerator.generateKey(params); return sb.append(key); }; } /** * @param redisConnectionFactory：配置不同的客户端，这里注入的redis连接工厂不同： JedisConnectionFactory、LettuceConnectionFactory * @功能描述 ：配置Redis序列化，原因如下： * （1） StringRedisTemplate的序列化方式为字符串序列化， * RedisTemplate的序列化方式默为jdk序列化（实现Serializable接口） * （2） RedisTemplate的jdk序列化方式在Redis的客户端中为乱码，不方便查看， * 因此一般修改RedisTemplate的序列化为方式为JSON方式【建议使用GenericJackson2JsonRedisSerializer】 */ @Bean public RedisTemplate\u003cString, Object\u003e redisTemplate(RedisConnectionFactory redisConnectionFactory) { GenericJackson2JsonRedisSerializer genericJackson2JsonRedisSerializer = serializer(); RedisTemplate\u003cString, Object\u003e redisTemplate = new RedisTemplate\u003c\u003e(); // key采用String的序列化方式 redisTemplate.setKeySerializer(StringRedisSerializer.UTF_8); // value序列化方式采用jackson redisTemplate.setValueSerializer(genericJackson2JsonRedisSerializer); // hash的key也采用String的序列化方式 redisTemplate.setHashKeySerializer(StringRedisSerializer.UTF_8); //hash的value序列化方式采用jackson redisTemplate.setHashValueSerializer(genericJackson2JsonRedisSerializer); redisTemplate.setConnectionFactory(redisConnectionFactory); return redisTemplate; } /** * 此方法不能用@Ben注解，避免替换Spring容器中的同类型对象 */ public GenericJackson2JsonRedisSerializer serializer() { return new GenericJackson2JsonRedisSerializer(); } } 4.3 开启并使用 @EnableCaching //开启缓存的主键 @SpringBootApplication public class RedisDemoApplication { public static void main(String[] args) { SpringApplication.run(RedisDemoApplication.class, args); } } @Service @CacheConfig(cacheNames = \"user\",keyGenerator = \"keyGenerator\") public class RedisServiceImpl implements RedisService { @Cacheable(value = \"user\", key = \"'list'\") @Override public List\u003cUser\u003e list() { System.out.println(\"=========list\"); List\u003cUser\u003e users = new ArrayList\u003c\u003e(); return users; } @CacheEvict(value = \"user\", key = \"'list'\") @Override public void del(Integer id) { System.out.println(\"************************************+id\"); } @CachePut(value = \"demo\", key = \"#result==null\") @Override public void select(Integer id) { System.out.println(\"===============dddd================\"); } } 4.4 配置文件 spring: cache: type: redis # 指定使用的缓存类型,不传会自动识别 redis: 当自定义ChacheManager时，就这里的配置不需要配置，配置了也不起作用 use-key-prefix: true key-prefix: \"demo:\" time-to-live: 60000 #缓存超时时间 单位：ms cache-null-values: false #是否缓存空值 cache-names: user # 初始化一些缓存名 ttl: '{\"user\":60,\"dept\":30}' #自定义某些缓存空间的过期时间 网上有些文章会使用配置文件的方式, 其实这是 spring-boot-autoconfigure 自动配置的能力, 它会根据你引入的包(redis/caffeine), 自动注入对应的缓存机制 , 比如redis的 org.springframework.boot.autoconfigure.cache.RedisCacheConfiguration\n如果需要自定义一些配置, 就需要按4.1~4.3节那种配置\n5. 注意事项 @Cache注解的方法必须为 public\n默认情况下，@CacheEvict标注的方法执行期间抛出异常，则不会清空缓存。\n基于 proxy 的 spring aop 带来的内部调用问题(aop的通用问题)\n使用内存时一定要设置过期时间和允许使用内存大小 等等, 不然在极端情况下会把内存吃满\n默认的 ConcurrentHashMap不支持设置过期时间和允许使用的内存大小\nredis不支持允许使用的内存大小\ncaffeine都能支持(这也是推荐使用它的原因之一)\nSpring Cache 整合 Redis 做缓存使用~ 快速上手~ - 掘金 (juejin.cn) SpringBoot实现Redis缓存（SpringCache+Redis的整合）_springboot redis cache_user2025的博客-CSDN博客 Spring Cache，key重复问题 SpringBoot项目中使用缓存Cache的正确姿势！！! - 掘金 (juejin.cn) ","wordCount":"3846","inLanguage":"zh","datePublished":"2023-08-22T00:00:00Z","dateModified":"2023-08-30T16:26:08.731846727Z","author":{"@type":"Person","name":"xkj"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/spring/springcache.html"},"publisher":{"@type":"Organization","name":"米二","logo":{"@type":"ImageObject","url":"https://xiaokunji.com/img/Q.svg"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://xiaokunji.com/zh/ accesskey=h title="米二 (Alt + H)"><img src=https://xiaokunji.com/img/Q.svg alt aria-label=logo height=35>米二</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://xiaokunji.com/en/ title=English aria-label=English>English</a></li></ul></div></div><ul id=menu><li><a href=https://xiaokunji.com/zh/ title=🏠主页><span>🏠主页</span></a></li><li><a href=https://xiaokunji.com/zh/search.html title="🔍搜索 (Alt + /)" accesskey=/><span>🔍搜索</span></a></li><li><a href=https://xiaokunji.com/zh/post.html title=📚文章><span>📚文章</span></a></li><li><a href=https://xiaokunji.com/zh/archives.html title=⏱时间轴><span>⏱时间轴</span></a></li><li><a href=https://xiaokunji.com/zh/tags.html title=🔖标签><span>🔖标签</span></a></li><li><a href=https://xiaokunji.com/zh/categories.html title=📖分类><span>📖分类</span></a></li><li><a href=https://xiaokunji.com/zh/links.html title=🤝友链><span>🤝友链</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><nav aria-label=breadcrumb><ul><a href=https://xiaokunji.com/zh/>🏠</a> <span>></span>
<a href=https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6.html>java及其框架</a> <span>></span>
<a href=https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/spring.html>spring</a> <span>></span></ul></nav><h1 class=post-title>SpringCache</h1><div class=post-description></div><div class=post-meta>创建:&nbsp;<span title='2023-08-22 00:00:00 +0000 UTC'>2023-08-22</span>&nbsp;·&nbsp;更新:&nbsp;2023-08-30&nbsp;·&nbsp;8 分钟&nbsp;·&nbsp;xkj
&nbsp;|&nbsp;分类: &nbsp;<ul class=post-categories-meta><a href=https://xiaokunji.com/zh/categories/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6.html>java及其框架</a></ul><span id=busuanzi_container_page_pv>&nbsp;| 访问: <span id=busuanzi_value_page_pv></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#1-%e4%bb%8b%e7%bb%8d aria-label="1. 介绍">1. 介绍</a></li><li><a href=#2-%e5%b8%b8%e7%94%a8%e6%b3%a8%e8%a7%a3 aria-label="2. 常用注解">2. 常用注解</a><ul><li><a href=#21-enablecaching aria-label="2.1 @EnableCaching">2.1 @EnableCaching</a></li><li><a href=#22-cacheable aria-label="2.2 @Cacheable">2.2 @Cacheable</a></li><li><a href=#23-cacheput aria-label="2.3 @CachePut">2.3 @CachePut</a></li><li><a href=#24-cacheevict aria-label="2.4 @CacheEvict">2.4 @CacheEvict</a></li><li><a href=#25-caching aria-label="2.5 @Caching">2.5 @Caching</a></li><li><a href=#26-cacheconfig aria-label="2.6 @CacheConfig：">2.6 @CacheConfig：</a></li></ul></li><li><a href=#3-%e7%bc%93%e5%ad%98%e5%85%b7%e4%bd%93%e5%ae%9e%e7%8e%b0 aria-label="3. 缓存具体实现">3. 缓存具体实现</a></li><li><a href=#4-%e4%bd%bf%e7%94%a8 aria-label="4. 使用">4. 使用</a><ul><li><a href=#41-%e5%bc%95%e5%85%a5%e4%be%9d%e8%b5%96 aria-label="4.1 引入依赖">4.1 引入依赖</a></li><li><a href=#42-%e9%85%8d%e7%bd%ae%e7%b1%bb aria-label="4.2 配置类">4.2 配置类</a></li><li><a href=#43-%e5%bc%80%e5%90%af%e5%b9%b6%e4%bd%bf%e7%94%a8 aria-label="4.3 开启并使用">4.3 开启并使用</a></li><li><a href=#44-%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label="4.4 配置文件">4.4 配置文件</a></li></ul></li><li><a href=#5-%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9 aria-label="5. 注意事项">5. 注意事项</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>[toc]</p><h1 id=1-介绍>1. 介绍<a hidden class=anchor aria-hidden=true href=#1-介绍>#</a></h1><p>SpringCache提供基本的Cache抽象，并没有具体的缓存能力，需要配合具体的缓存实现来完成，目前SpringCache支持redis、ehcache、simple（基于内存,使用<code>ConcurrentHashMap</code>）等方式来实现缓存。</p><blockquote><p>因为spring的缓存机制会引入一些问题, 一些大型项目可能不适合, 比如并发场景下出现异常等等, 但大部分的项目还是可以适用的(毕竟中国没有多少具备高并发的公司)</p></blockquote><h1 id=2-常用注解>2. 常用注解<a hidden class=anchor aria-hidden=true href=#2-常用注解>#</a></h1><h2 id=21-enablecaching>2.1 @EnableCaching<a hidden class=anchor aria-hidden=true href=#21-enablecaching>#</a></h2><p>开启缓存功能，一般使用在springboot的启动类或配置类上</p><h2 id=22-cacheable>2.2 @Cacheable<a hidden class=anchor aria-hidden=true href=#22-cacheable>#</a></h2><p>使用缓存。在方法执行前Spring先查看缓存中是否有数据，如果有数据，则直接返回缓存数据；没有则调用方法并将方法返回值放进缓存。</p><p>**注解参数解释: **</p><table><thead><tr><th>@Cacheable属性名</th><th>用途</th><th>备注</th></tr></thead><tbody><tr><td>cacheNames/value</td><td>指定缓存空间的名称，不同缓存空间的数据是彼此隔离的</td><td></td></tr><tr><td>key</td><td>同一个cacheNames中通过key区别不同的缓存。如果指定要按照 SpEL 表达式编写，如果不指定，则缺省按照方法的所有参数进行组合，如：@CachePut(value = “demo”, key = “‘user’+#user.id”)，字符串中spring表达式意外的字符串部分需要用单引号</td><td>SpringCache提供了与缓存相关的专用元数据，如target、methodMame、result、方法参数等，如：@CachePut(value = “demo”, key = “#result==null”)<br>当方法的参数和值一样时, 会导致重复;<br>如果是基本参数: 参数名+值<br>如果是对象参数: 参数的类名+对象的成员变量+值 (类似于toString的结果)</td></tr><tr><td>keyGenrator</td><td>key的生成策略，SpringCache默认使用SimpleKeyGenerator，默认情况下将参数值作为键，但是可能会导致key重复出现，因此一般需要自定义key的生成策略</td><td>和key参数二选一</td></tr><tr><td>cacheManager</td><td>指定缓存管理器(例如ConcurrentHashMap、Redis等)。</td><td></td></tr><tr><td>cacheResolver</td><td>和cacheManager作用一样，使用时二选一。</td><td></td></tr><tr><td>condition</td><td>(指定缓存的条件（对参数判断，满足什么条件时才缓存）)<br>condition是在调用方法之前判断条件，满足条件才缓存, 支持spel语法</td><td>@Cacheable(cacheNames=“book”, condition="#name.length() &lt; 32")</td></tr><tr><td>unless</td><td>(否定缓存的条件（对结果判断，满足什么条件时不缓存）)<br>unless是在调用方法之后判断条件，如果SpEL条件成立，则不缓存【条件满足不缓存】,支持spel语法</td><td>@Cacheable(cacheNames = “hello”,unless="#result.id.contains(‘1’)" )</td></tr><tr><td>sync</td><td>缓存过期之后，如果多个线程同时请求对某个数据的访问，会同时去到数据库，导致数据库瞬间负荷增高。Spring4.3为@Cacheable注解提供了一个新的参数“sync”（默认为false）。当设置它为true时，只有一个线程的请求会去到数据库，其他线程都会等待直到缓存可用。这个设置可以减少对数据库的瞬间并发访问。</td><td></td></tr></tbody></table><h2 id=23-cacheput>2.3 @CachePut<a hidden class=anchor aria-hidden=true href=#23-cacheput>#</a></h2><p>更新缓存，将方法的返回值放到缓存中</p><h2 id=24-cacheevict>2.4 @CacheEvict<a hidden class=anchor aria-hidden=true href=#24-cacheevict>#</a></h2><p>清空缓存</p><h2 id=25-caching>2.5 @Caching<a hidden class=anchor aria-hidden=true href=#25-caching>#</a></h2><p><code>@Caching</code>是一个组注解，可以为一个方法定义提供基于<code>@Cacheable</code>、<code>@CacheEvict</code>或者<code>@CachePut</code>注解的数组。</p><p>例如下面这个例子, 在方法上加 <code>@caching</code>并标注需要的逻辑, 这样调用这个方法时就能同时触发多个操作</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@Caching</span><span style=color:#ff7b72;font-weight:700>(</span>
</span></span><span style=display:flex><span>        put <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#d2a8ff;font-weight:700>@CachePut</span><span style=color:#ff7b72;font-weight:700>(</span>value <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;myCache&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> key <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;#result.id&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72;font-weight:700>},</span>
</span></span><span style=display:flex><span>        evict <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#d2a8ff;font-weight:700>@CacheEvict</span><span style=color:#ff7b72;font-weight:700>(</span>value <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;otherCache&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> key <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;#id&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72;font-weight:700>},</span>
</span></span><span style=display:flex><span>        cacheable <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#d2a8ff;font-weight:700>@Cacheable</span><span style=color:#ff7b72;font-weight:700>(</span>value <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;myFifthCache&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> key <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;#result.id&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>public</span> MyEntity <span style=color:#d2a8ff;font-weight:700>saveData</span><span style=color:#ff7b72;font-weight:700>(</span>Long id<span style=color:#ff7b72;font-weight:700>,</span> String name<span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>        MyEntity entity <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> MyEntity<span style=color:#ff7b72;font-weight:700>(</span>id<span style=color:#ff7b72;font-weight:700>,</span> name<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> entity<span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=26-cacheconfig>2.6 @CacheConfig：<a hidden class=anchor aria-hidden=true href=#26-cacheconfig>#</a></h2><p>一个类中可能会有多个缓存操作，而这些缓存操作可能是重复的。这个时候可以使用 <code>@CacheConfig</code>是一个类级别的注解.</p><p>它可以存放该类中所有缓存的公有属性，比如设置缓存空间的名字cacheNames、key生成策略keyGenerator、缓存管理器cacheManager</p><h1 id=3-缓存具体实现>3. 缓存具体实现<a hidden class=anchor aria-hidden=true href=#3-缓存具体实现>#</a></h1><p>支持多种缓存提供程序，包括 <code>Caffeine</code>、<code>Hazelcast</code> 、 <code>Redis</code>和<code>ConcurrentHashMap</code>(默认值)。</p><p>也就是说支持本地缓存和第三方缓存框架, 如果是第三方的缓存就需要额外的pom坐标支持</p><blockquote><p>推荐<code>caffeine</code>这个本地缓存框架, 性能好,功能全, 只是需要额外引入<code>caffeine</code>这个框架,就有点小成本了</p><p>其次推荐使用<code>redis</code>, 功能全,性能好(没有caffeine这种本地缓存快), 项目中反正都要引入redis的, 刚好顺便能用</p></blockquote><p>这里以redis为例</p><h1 id=4-使用>4. 使用<a hidden class=anchor aria-hidden=true href=#4-使用>#</a></h1><h2 id=41-引入依赖>4.1 引入依赖<a hidden class=anchor aria-hidden=true href=#41-引入依赖>#</a></h2><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span> <span style=color:#7ee787>&lt;dependencies&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>&lt;!--引入缓存--&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#7ee787>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#7ee787>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#7ee787>&lt;artifactId&gt;</span>spring-boot-starter-cache<span style=color:#7ee787>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#7ee787>&lt;version&gt;</span>2.3.0.RELEASE<span style=color:#7ee787>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>     	<span style=color:#8b949e;font-style:italic>&lt;!--引入redis--&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#7ee787>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#7ee787>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#7ee787>&lt;artifactId&gt;</span>spring-boot-starter-data-redis<span style=color:#7ee787>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#7ee787>&lt;version&gt;</span>2.3.0.RELEASE<span style=color:#7ee787>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#7ee787>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#7ee787>&lt;/dependencies&gt;</span>
</span></span></code></pre></div><h2 id=42-配置类>4.2 配置类<a hidden class=anchor aria-hidden=true href=#42-配置类>#</a></h2><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>public</span> <span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>RedisConfiguration</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>// ${cache} 获取配置文件的配置信息   #{}是spring表达式，获取Bean对象的属性
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>    <span style=color:#d2a8ff;font-weight:700>@Value</span><span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;#{${cache}}&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>private</span> Map<span style=color:#ff7b72;font-weight:700>&lt;</span>String<span style=color:#ff7b72;font-weight:700>,</span> Long<span style=color:#ff7b72;font-weight:700>&gt;</span> ttlParams<span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * @param redisConnectionFactory
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * @功能描述 redis作为缓存时配置缓存管理器CacheManager，主要配置序列化方式、自定义
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * 注意：配置缓存管理器CacheManager有两种方式：
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * 方式1：通过RedisCacheConfiguration.defaultCacheConfig()获取到默认的RedisCacheConfiguration对象，
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * 修改RedisCacheConfiguration对象的序列化方式等参数【这里就采用的这种方式】
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * 方式2：通过继承CachingConfigurerSupport类自定义缓存管理器，覆写各方法，参考：
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * https://blog.csdn.net/echizao1839/article/details/102660649
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * 切记：在缓存配置类中配置以后，yaml配置文件中关于缓存的redis配置就不会生效，如果需要相关配置需要通过@value去读取
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>public</span> CacheManager <span style=color:#d2a8ff;font-weight:700>cacheManager</span><span style=color:#ff7b72;font-weight:700>(</span>RedisConnectionFactory redisConnectionFactory<span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>        RedisCacheConfiguration redisCacheConfiguration <span style=color:#ff7b72;font-weight:700>=</span> RedisCacheConfiguration<span style=color:#ff7b72;font-weight:700>.</span>defaultCacheConfig<span style=color:#ff7b72;font-weight:700>()</span>
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic>// 设置key采用String的序列化方式
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>              <span style=color:#ff7b72;font-weight:700>.</span>serializeKeysWith<span style=color:#ff7b72;font-weight:700>(</span>RedisSerializationContext<span style=color:#ff7b72;font-weight:700>.</span>SerializationPair<span style=color:#ff7b72;font-weight:700>.</span>fromSerializer<span style=color:#ff7b72;font-weight:700>(</span>StringRedisSerializer<span style=color:#ff7b72;font-weight:700>.</span>UTF_8<span style=color:#ff7b72;font-weight:700>))</span>
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic>//设置value序列化方式采用jackson方式序列化
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                <span style=color:#ff7b72;font-weight:700>.</span>serializeValuesWith<span style=color:#ff7b72;font-weight:700>(</span>RedisSerializationContext<span style=color:#ff7b72;font-weight:700>.</span>SerializationPair<span style=color:#ff7b72;font-weight:700>.</span>fromSerializer<span style=color:#ff7b72;font-weight:700>(</span>serializer<span style=color:#ff7b72;font-weight:700>()))</span>
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic>//当value为null时不进行缓存
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                <span style=color:#ff7b72;font-weight:700>.</span>disableCachingNullValues<span style=color:#ff7b72;font-weight:700>()</span>
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic>// 配置缓存空间名称的前缀 (这里会覆盖 @cacheable注解的vaule字段)
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                <span style=color:#ff7b72;font-weight:700>.</span>prefixCacheNameWith<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;demo:&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>                <span style=color:#8b949e;font-style:italic>//全局配置缓存过期时间【可以不配置】
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                <span style=color:#ff7b72;font-weight:700>.</span>entryTtl<span style=color:#ff7b72;font-weight:700>(</span>Duration<span style=color:#ff7b72;font-weight:700>.</span>ofMinutes<span style=color:#ff7b72;font-weight:700>(</span>30L<span style=color:#ff7b72;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>//专门指定某些缓存空间的配置，如果过期时间【主要这里的key为缓存空间名称】
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        Map<span style=color:#ff7b72;font-weight:700>&lt;</span>String<span style=color:#ff7b72;font-weight:700>,</span> RedisCacheConfiguration<span style=color:#ff7b72;font-weight:700>&gt;</span> map <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> HashMap<span style=color:#ff7b72;font-weight:700>&lt;&gt;();</span>
</span></span><span style=display:flex><span>        Set<span style=color:#ff7b72;font-weight:700>&lt;</span>Map<span style=color:#ff7b72;font-weight:700>.</span>Entry<span style=color:#ff7b72;font-weight:700>&lt;</span>String<span style=color:#ff7b72;font-weight:700>,</span> Long<span style=color:#ff7b72;font-weight:700>&gt;&gt;</span> entries <span style=color:#ff7b72;font-weight:700>=</span> ttlParams<span style=color:#ff7b72;font-weight:700>.</span>entrySet<span style=color:#ff7b72;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>for</span> <span style=color:#ff7b72;font-weight:700>(</span>Map<span style=color:#ff7b72;font-weight:700>.</span>Entry<span style=color:#ff7b72;font-weight:700>&lt;</span>String<span style=color:#ff7b72;font-weight:700>,</span> Long<span style=color:#ff7b72;font-weight:700>&gt;</span> entry <span style=color:#ff7b72;font-weight:700>:</span> entries<span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic>//指定特定缓存空间对应的过期时间
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>            map<span style=color:#ff7b72;font-weight:700>.</span>put<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;user&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> redisCacheConfiguration<span style=color:#ff7b72;font-weight:700>.</span>entryTtl<span style=color:#ff7b72;font-weight:700>(</span>Duration<span style=color:#ff7b72;font-weight:700>.</span>ofSeconds<span style=color:#ff7b72;font-weight:700>(</span>40<span style=color:#ff7b72;font-weight:700>)));</span>
</span></span><span style=display:flex><span>            map<span style=color:#ff7b72;font-weight:700>.</span>put<span style=color:#ff7b72;font-weight:700>(</span>entry<span style=color:#ff7b72;font-weight:700>.</span>getKey<span style=color:#ff7b72;font-weight:700>(),</span> redisCacheConfiguration<span style=color:#ff7b72;font-weight:700>.</span>entryTtl<span style=color:#ff7b72;font-weight:700>(</span>Duration<span style=color:#ff7b72;font-weight:700>.</span>ofSeconds<span style=color:#ff7b72;font-weight:700>(</span>entry<span style=color:#ff7b72;font-weight:700>.</span>getValue<span style=color:#ff7b72;font-weight:700>())));</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> RedisCacheManager
</span></span><span style=display:flex><span>                <span style=color:#ff7b72;font-weight:700>.</span>builder<span style=color:#ff7b72;font-weight:700>(</span>redisConnectionFactory<span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>                <span style=color:#ff7b72;font-weight:700>.</span>cacheDefaults<span style=color:#ff7b72;font-weight:700>(</span>redisCacheConfiguration<span style=color:#ff7b72;font-weight:700>)</span>  <span style=color:#8b949e;font-style:italic>//默认配置
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                <span style=color:#ff7b72;font-weight:700>.</span>withInitialCacheConfigurations<span style=color:#ff7b72;font-weight:700>(</span>map<span style=color:#ff7b72;font-weight:700>)</span>  <span style=color:#8b949e;font-style:italic>//某些缓存空间的特定配置
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>                <span style=color:#ff7b72;font-weight:700>.</span>build<span style=color:#ff7b72;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * 自定义缓存的redis的KeyGenerator【key生成策略】
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * 注意: 该方法只是声明了key的生成策略,需在@Cacheable注解中通过keyGenerator属性指定具体的key生成策略
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * 可以根据业务情况，配置多个生成策略
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * 如: @Cacheable(value = &#34;key&#34;, keyGenerator = &#34;cacheKeyGenerator&#34;)
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>public</span> KeyGenerator <span style=color:#d2a8ff;font-weight:700>keyGenerator</span><span style=color:#ff7b72;font-weight:700>()</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>         * target: 类
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>         * method: 方法
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>         * params: 方法参数
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>         */</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#ff7b72;font-weight:700>(</span>target<span style=color:#ff7b72;font-weight:700>,</span> method<span style=color:#ff7b72;font-weight:700>,</span> params<span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72;font-weight:700>-&gt;</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic>//获取代理对象的最终目标对象
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>            StringBuilder sb <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> StringBuilder<span style=color:#ff7b72;font-weight:700>();</span>
</span></span><span style=display:flex><span>            sb<span style=color:#ff7b72;font-weight:700>.</span>append<span style=color:#ff7b72;font-weight:700>(</span>target<span style=color:#ff7b72;font-weight:700>.</span>getClass<span style=color:#ff7b72;font-weight:700>().</span>getSimpleName<span style=color:#ff7b72;font-weight:700>()).</span>append<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;:&#34;</span><span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>            sb<span style=color:#ff7b72;font-weight:700>.</span>append<span style=color:#ff7b72;font-weight:700>(</span>method<span style=color:#ff7b72;font-weight:700>.</span>getName<span style=color:#ff7b72;font-weight:700>()).</span>append<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;:&#34;</span><span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#8b949e;font-style:italic>//调用SimpleKey的key生成器
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>            Object key <span style=color:#ff7b72;font-weight:700>=</span> SimpleKeyGenerator<span style=color:#ff7b72;font-weight:700>.</span>generateKey<span style=color:#ff7b72;font-weight:700>(</span>params<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#ff7b72>return</span> sb<span style=color:#ff7b72;font-weight:700>.</span>append<span style=color:#ff7b72;font-weight:700>(</span>key<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72;font-weight:700>};</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * @param redisConnectionFactory：配置不同的客户端，这里注入的redis连接工厂不同： JedisConnectionFactory、LettuceConnectionFactory
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * @功能描述 ：配置Redis序列化，原因如下：
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * （1） StringRedisTemplate的序列化方式为字符串序列化，
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * RedisTemplate的序列化方式默为jdk序列化（实现Serializable接口）
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * （2） RedisTemplate的jdk序列化方式在Redis的客户端中为乱码，不方便查看，
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * 因此一般修改RedisTemplate的序列化为方式为JSON方式【建议使用GenericJackson2JsonRedisSerializer】
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>public</span> RedisTemplate<span style=color:#ff7b72;font-weight:700>&lt;</span>String<span style=color:#ff7b72;font-weight:700>,</span> Object<span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#d2a8ff;font-weight:700>redisTemplate</span><span style=color:#ff7b72;font-weight:700>(</span>RedisConnectionFactory redisConnectionFactory<span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>        GenericJackson2JsonRedisSerializer genericJackson2JsonRedisSerializer <span style=color:#ff7b72;font-weight:700>=</span> serializer<span style=color:#ff7b72;font-weight:700>();</span>
</span></span><span style=display:flex><span>        RedisTemplate<span style=color:#ff7b72;font-weight:700>&lt;</span>String<span style=color:#ff7b72;font-weight:700>,</span> Object<span style=color:#ff7b72;font-weight:700>&gt;</span> redisTemplate <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> RedisTemplate<span style=color:#ff7b72;font-weight:700>&lt;&gt;();</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// key采用String的序列化方式
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        redisTemplate<span style=color:#ff7b72;font-weight:700>.</span>setKeySerializer<span style=color:#ff7b72;font-weight:700>(</span>StringRedisSerializer<span style=color:#ff7b72;font-weight:700>.</span>UTF_8<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// value序列化方式采用jackson
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        redisTemplate<span style=color:#ff7b72;font-weight:700>.</span>setValueSerializer<span style=color:#ff7b72;font-weight:700>(</span>genericJackson2JsonRedisSerializer<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>// hash的key也采用String的序列化方式
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        redisTemplate<span style=color:#ff7b72;font-weight:700>.</span>setHashKeySerializer<span style=color:#ff7b72;font-weight:700>(</span>StringRedisSerializer<span style=color:#ff7b72;font-weight:700>.</span>UTF_8<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8b949e;font-style:italic>//hash的value序列化方式采用jackson
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span>        redisTemplate<span style=color:#ff7b72;font-weight:700>.</span>setHashValueSerializer<span style=color:#ff7b72;font-weight:700>(</span>genericJackson2JsonRedisSerializer<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        redisTemplate<span style=color:#ff7b72;font-weight:700>.</span>setConnectionFactory<span style=color:#ff7b72;font-weight:700>(</span>redisConnectionFactory<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> redisTemplate<span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8b949e;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     * 此方法不能用@Ben注解，避免替换Spring容器中的同类型对象
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>public</span> GenericJackson2JsonRedisSerializer <span style=color:#d2a8ff;font-weight:700>serializer</span><span style=color:#ff7b72;font-weight:700>()</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> <span style=color:#ff7b72>new</span> GenericJackson2JsonRedisSerializer<span style=color:#ff7b72;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=43-开启并使用>4.3 开启并使用<a hidden class=anchor aria-hidden=true href=#43-开启并使用>#</a></h2><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@EnableCaching</span>   <span style=color:#8b949e;font-style:italic>//开启缓存的主键
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic></span><span style=color:#d2a8ff;font-weight:700>@SpringBootApplication</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>public</span> <span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>RedisDemoApplication</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>public</span> <span style=color:#ff7b72>static</span> <span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>main</span><span style=color:#ff7b72;font-weight:700>(</span>String<span style=color:#ff7b72;font-weight:700>[]</span> args<span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>        SpringApplication<span style=color:#ff7b72;font-weight:700>.</span>run<span style=color:#ff7b72;font-weight:700>(</span>RedisDemoApplication<span style=color:#ff7b72;font-weight:700>.</span>class<span style=color:#ff7b72;font-weight:700>,</span> args<span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@Service</span>
</span></span><span style=display:flex><span><span style=color:#d2a8ff;font-weight:700>@CacheConfig</span><span style=color:#ff7b72;font-weight:700>(</span>cacheNames <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;user&#34;</span><span style=color:#ff7b72;font-weight:700>,</span>keyGenerator <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;keyGenerator&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>public</span> <span style=color:#ff7b72>class</span> <span style=color:#f0883e;font-weight:700>RedisServiceImpl</span> <span style=color:#ff7b72>implements</span> RedisService <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@Cacheable</span><span style=color:#ff7b72;font-weight:700>(</span>value <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;user&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> key <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;&#39;list&#39;&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>public</span> List<span style=color:#ff7b72;font-weight:700>&lt;</span>User<span style=color:#ff7b72;font-weight:700>&gt;</span> <span style=color:#d2a8ff;font-weight:700>list</span><span style=color:#ff7b72;font-weight:700>()</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>        System<span style=color:#ff7b72;font-weight:700>.</span>out<span style=color:#ff7b72;font-weight:700>.</span>println<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;=========list&#34;</span><span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>        List<span style=color:#ff7b72;font-weight:700>&lt;</span>User<span style=color:#ff7b72;font-weight:700>&gt;</span> users <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#ff7b72>new</span> ArrayList<span style=color:#ff7b72;font-weight:700>&lt;&gt;();</span>
</span></span><span style=display:flex><span>        <span style=color:#ff7b72>return</span> users<span style=color:#ff7b72;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@CacheEvict</span><span style=color:#ff7b72;font-weight:700>(</span>value <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;user&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> key <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;&#39;list&#39;&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>public</span> <span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>del</span><span style=color:#ff7b72;font-weight:700>(</span>Integer id<span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>        System<span style=color:#ff7b72;font-weight:700>.</span>out<span style=color:#ff7b72;font-weight:700>.</span>println<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;************************************+id&#34;</span><span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@CachePut</span><span style=color:#ff7b72;font-weight:700>(</span>value <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;demo&#34;</span><span style=color:#ff7b72;font-weight:700>,</span> key <span style=color:#ff7b72;font-weight:700>=</span> <span style=color:#a5d6ff>&#34;#result==null&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#d2a8ff;font-weight:700>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72>public</span> <span style=color:#ff7b72>void</span> <span style=color:#d2a8ff;font-weight:700>select</span><span style=color:#ff7b72;font-weight:700>(</span>Integer id<span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>        System<span style=color:#ff7b72;font-weight:700>.</span>out<span style=color:#ff7b72;font-weight:700>.</span>println<span style=color:#ff7b72;font-weight:700>(</span><span style=color:#a5d6ff>&#34;===============dddd================&#34;</span><span style=color:#ff7b72;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ff7b72;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=44-配置文件>4.4 配置文件<a hidden class=anchor aria-hidden=true href=#44-配置文件>#</a></h2><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#7ee787>spring</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>	</span><span style=color:#7ee787>cache</span>:<span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>type</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>redis  </span><span style=color:#6e7681> </span><span style=color:#8b949e;font-style:italic># 指定使用的缓存类型,不传会自动识别</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>        </span><span style=color:#7ee787>redis</span>:<span style=color:#6e7681>    </span><span style=color:#a5d6ff>当自定义ChacheManager时，就这里的配置不需要配置，配置了也不起作用</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#7ee787>use-key-prefix</span>:<span style=color:#6e7681> </span><span style=color:#79c0ff>true</span><span style=color:#6e7681>  
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#7ee787>key-prefix</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#34;demo:&#34;</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#7ee787>time-to-live</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>60000</span><span style=color:#6e7681>  </span><span style=color:#8b949e;font-style:italic>#缓存超时时间 单位：ms</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#7ee787>cache-null-values</span>:<span style=color:#6e7681> </span><span style=color:#79c0ff>false</span><span style=color:#6e7681> </span><span style=color:#8b949e;font-style:italic>#是否缓存空值</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#7ee787>cache-names</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>user</span><span style=color:#6e7681> </span><span style=color:#8b949e;font-style:italic># 初始化一些缓存名</span><span style=color:#6e7681>
</span></span></span><span style=display:flex><span><span style=color:#6e7681>            </span><span style=color:#7ee787>ttl</span>:<span style=color:#6e7681> </span><span style=color:#a5d6ff>&#39;{&#34;user&#34;:60,&#34;dept&#34;:30}&#39;</span><span style=color:#6e7681>  </span><span style=color:#8b949e;font-style:italic>#自定义某些缓存空间的过期时间</span><span style=color:#6e7681>
</span></span></span></code></pre></div><p>网上有些文章会使用配置文件的方式, 其实这是 <code>spring-boot-autoconfigure</code> 自动配置的能力, 它会根据你引入的包(redis/caffeine), 自动注入对应的缓存机制 , 比如redis的 <code>org.springframework.boot.autoconfigure.cache.RedisCacheConfiguration</code></p><p>如果需要自定义一些配置, 就需要按<code>4.1</code>~<code>4.3</code>节那种配置</p><h1 id=5-注意事项>5. 注意事项<a hidden class=anchor aria-hidden=true href=#5-注意事项>#</a></h1><ol><li><p><code>@Cache</code>注解的方法必须为 <code>public</code></p></li><li><p>默认情况下，<code>@CacheEvict</code>标注的方法执行期间抛出异常，则不会清空缓存。</p></li><li><p>基于 <code>proxy</code> 的 <code>spring aop</code> 带来的内部调用问题(aop的通用问题)</p></li><li><p>使用内存时一定要设置过期时间和允许使用内存大小 等等, 不然在极端情况下会把内存吃满</p><blockquote><p>默认的 ConcurrentHashMap不支持设置过期时间和允许使用的内存大小</p><p>redis不支持允许使用的内存大小</p><p>caffeine都能支持(这也是推荐使用它的原因之一)</p></blockquote></li></ol><p><a href=https://juejin.cn/post/7157609002606526494#heading-5 target=_blank rel=noopener>Spring Cache 整合 Redis 做缓存使用~ 快速上手~ - 掘金 (juejin.cn)</a></p><p><a href=https://blog.csdn.net/user2025/article/details/106595257 target=_blank rel=noopener>SpringBoot实现Redis缓存（SpringCache+Redis的整合）_springboot redis cache_user2025的博客-CSDN博客</a></p><p><a href=https://zhuanlan.zhihu.com/p/266804094 target=_blank rel=noopener>Spring Cache，key重复问题</a></p><p><a href=https://juejin.cn/post/7220292698854752313#heading-2 target=_blank rel=noopener>SpringBoot项目中使用缓存Cache的正确姿势！！! - 掘金 (juejin.cn)</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://xiaokunji.com/zh/tags/spring.html>Spring</a></li><li><a href=https://xiaokunji.com/zh/tags/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6.html>java及其框架</a></li></ul><nav class=paginav><a class=prev href=https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/java%E5%9F%BA%E7%A1%80/spi.html><span class=title>« 上一页</span><br><span>SPI</span></a>
<a class=next href=https://xiaokunji.com/zh/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/sql%E5%91%BD%E4%BB%A4%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3.html><span class=title>下一页 »</span><br><span>sql命令参数详解</span></a></nav></footer></article></main><footer class=footer><span>Copyright
&copy;
-2023
<a href=https://xiaokunji.com/zh/ style=color:#939393>米二</a>
All Rights Reserved</span>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<span id=busuanzi_container><span class="fa fa-user">用户数:</span><span id=busuanzi_value_site_uv></span>
<span class="fa fa-eye">访问数:</span><span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>