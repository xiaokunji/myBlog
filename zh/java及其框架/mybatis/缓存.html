<!DOCTYPE html>
<html dir="auto" lang="zh"><head><meta charset="utf-8"/><meta content="IE=edge" http-equiv="x-ua-compatible"/><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name="viewport"/><meta content="index, follow" name="robots"/><title>ç¼“å­˜ | ç±³äºŒ</title>
<meta content=" å‰è¨€, ä¸€çº§ç¼“å­˜, ä¸€çº§ç¼“å­˜å¤±æ•ˆçš„å››ç§æƒ…å†µ, ç¦ç”¨ä¸€çº§ç¼“å­˜, äºŒçº§ç¼“å­˜, ç¦ç”¨äºŒçº§ç¼“å­˜" name="keywords"/><meta content="mybatisçš„ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¯å¢ƒ" name="description"/><meta content="xkj" name="author"/><link href="https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/mybatis/%E7%BC%93%E5%AD%98.html" rel="canonical"/><link as="style" crossorigin="anonymous" href="/assets/css/stylesheet.dc6bd2c841ee388e899e13872ae986c0e847e8b957d6714ad6ddc628ef2d17ff.css" integrity="sha256-3GvSyEHuOI6JnhOHKumGwOhH6LlX1nFK1t3GKO8tF/8=" rel="preload stylesheet"/><script crossorigin="anonymous" defer="" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload="hljs.initHighlightingOnLoad()" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js"></script><link href="https://xiaokunji.com/img/Q.svg" rel="icon"/><link href="https://xiaokunji.com/img/Q.svg" rel="icon" sizes="16x16" type="image/png"/><link href="https://xiaokunji.com/img/Q.svg" rel="icon" sizes="32x32" type="image/png"/><link href="https://xiaokunji.com/Q.svg" rel="apple-touch-icon"/><link href="https://xiaokunji.com/Q.svg" rel="mask-icon"/><meta content="#2e2e33" name="theme-color"/><meta content="#2e2e33" name="msapplication-TileColor"/><link href="https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/mybatis/%E7%BC%93%E5%AD%98.html" hreflang="zh" rel="alternate"/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta content="ç¼“å­˜" property="og:title"/><meta content="mybatisçš„ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¯å¢ƒ" property="og:description"/><meta content="article" property="og:type"/><meta content="https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/mybatis/%E7%BC%93%E5%AD%98.html" property="og:url"/><meta content="javaåŠå…¶æ¡†æ¶" property="article:section"/><meta content="2023-08-22T00:00:00+00:00" property="article:published_time"/><meta content="2023-09-04T00:18:25+08:00" property="article:modified_time"/><meta content="summary" name="twitter:card"/><meta content="ç¼“å­˜" name="twitter:title"/><meta content="mybatisçš„ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¯å¢ƒ" name="twitter:description"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":4,"name":"ç¼“å­˜","item":"https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/mybatis/%E7%BC%93%E5%AD%98.html"}]}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"ç¼“å­˜","name":"ç¼“å­˜","description":"mybatisçš„ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¯å¢ƒ","keywords":[" å‰è¨€"," ä¸€çº§ç¼“å­˜"," ä¸€çº§ç¼“å­˜å¤±æ•ˆçš„å››ç§æƒ…å†µ"," ç¦ç”¨ä¸€çº§ç¼“å­˜"," äºŒçº§ç¼“å­˜"," ç¦ç”¨äºŒçº§ç¼“å­˜"],"articleBody":"[TOC]\nå‰è¨€ å’Œå¤§å¤šæ•°æŒä¹…åŒ–æ¡†æ¶ä¸€æ ·ï¼ŒMyBatis æä¾›äº†ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜çš„æ”¯æŒã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒMyBatis åªå¼€å¯ä¸€çº§ç¼“å­˜ã€‚\nMyBatisæä¾›äº†ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜\nä¸€çº§ç¼“å­˜ï¼šä¹Ÿç§°ä¸ºæœ¬åœ°ç¼“å­˜ï¼Œç”¨äºä¿å­˜ç”¨æˆ·åœ¨ä¸€æ¬¡ä¼šè¯è¿‡ç¨‹ä¸­æŸ¥è¯¢çš„ç»“æœï¼Œç”¨æˆ·ä¸€æ¬¡ä¼šè¯ä¸­åªèƒ½ä½¿ç”¨ä¸€ä¸ªsqlSessionï¼Œä¸€çº§ç¼“å­˜æ˜¯è‡ªåŠ¨å¼€å¯çš„ï¼Œä¸å…è®¸å…³é—­ã€‚ äºŒçº§ç¼“å­˜ï¼šä¹Ÿç§°ä¸ºå…¨å±€ç¼“å­˜ï¼Œæ˜¯mapperçº§åˆ«çš„ç¼“å­˜ï¼Œæ˜¯é’ˆå¯¹ä¸€ä¸ªè¡¨çš„æŸ¥ç»“æœçš„å­˜å‚¨ï¼Œå¯ä»¥å…±äº«ç»™æ‰€æœ‰é’ˆå¯¹è¿™å¼ è¡¨çš„æŸ¥è¯¢çš„ç”¨æˆ·ã€‚ä¹Ÿå°±æ˜¯è¯´å¯¹äºmapperçº§åˆ«çš„ç¼“å­˜ä¸åŒçš„sqlsessionæ˜¯å¯ä»¥å…±äº«çš„ã€‚ ä¸€çº§ç¼“å­˜ ä¸€çº§ç¼“å­˜æ˜¯åŸºäº PerpetualCacheï¼ˆMyBatisè‡ªå¸¦ï¼‰çš„ HashMap æœ¬åœ°ç¼“å­˜ï¼Œä½œç”¨èŒƒå›´ä¸º session åŸŸå†…,å®ƒå­˜å‚¨çš„SqlSessionä¸­çš„BaseExecutorä¹‹ä¸­ã€‚å½“ session flushï¼ˆåˆ·æ–°ï¼‰æˆ–è€… closeï¼ˆå…³é—­ï¼‰ä¹‹åï¼Œè¯¥ session ä¸­æ‰€æœ‰çš„ cacheï¼ˆç¼“å­˜ï¼‰å°±ä¼šè¢«æ¸…ç©ºã€‚\nåœ¨å‚æ•°å’Œ SQL å®Œå…¨ä¸€æ ·çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨åŒä¸€ä¸ª SqlSession å¯¹è±¡è°ƒç”¨åŒä¸€ä¸ª mapper çš„æ–¹æ³•ï¼Œå¾€å¾€åªæ‰§è¡Œä¸€æ¬¡ SQLã€‚å› ä¸ºä½¿ç”¨ SqlSession ç¬¬ä¸€æ¬¡æŸ¥è¯¢åï¼ŒMyBatis ä¼šå°†å…¶æ”¾åœ¨ç¼“å­˜ä¸­ï¼Œå†æ¬¡æŸ¥è¯¢æ—¶ï¼Œå¦‚æœæ²¡æœ‰åˆ·æ–°ï¼Œå¹¶ä¸”ç¼“å­˜æ²¡æœ‰è¶…æ—¶çš„æƒ…å†µä¸‹ï¼ŒSqlSession ä¼šå–å‡ºå½“å‰ç¼“å­˜çš„æ•°æ®ï¼Œè€Œä¸ä¼šå†æ¬¡å‘é€ SQL åˆ°æ•°æ®åº“ã€‚\nç”±äº SqlSession æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œæ‰€ä»¥å¦‚æœä½ ä½¿ç”¨ä¸åŒçš„ SqlSession å¯¹è±¡ï¼Œå³ä½¿è°ƒç”¨ç›¸åŒçš„ Mapperã€å‚æ•°å’Œæ–¹æ³•ï¼ŒMyBatis è¿˜æ˜¯ä¼šå†æ¬¡å‘é€ SQL åˆ°æ•°æ®åº“æ‰§è¡Œï¼Œè¿”å›ç»“æœã€‚\nç¤ºä¾‹:\npackage net.biancheng.test; import java.io.IOException; import java.io.InputStream; import java.util.List; import org.apache.ibatis.io.Resources; import org.apache.ibatis.session.SqlSession; import org.apache.ibatis.session.SqlSessionFactory; import org.apache.ibatis.session.SqlSessionFactoryBuilder; import org.apache.log4j.Logger; import net.biancheng.po.Website; public class Test { public static Logger logger = Logger.getLogger(Test.class); public static void main(String[] args) throws IOException { InputStream config = Resources.getResourceAsStream(\"mybatis-config.xml\"); // æ ¹æ®é…ç½®æ–‡ä»¶æ„å»º SqlSessionFactory ssf = new SqlSessionFactoryBuilder().build(config); SqlSession ss = ssf.openSession(); Website site = ss.selectOne(\"net.biancheng.mapper.WebsiteMapper.selectWebsiteById\", 1); logger.debug(\"ä½¿ç”¨åŒä¸€ä¸ªsqlsessionå†æ‰§è¡Œä¸€æ¬¡\"); Website site2 = ss.selectOne(\"net.biancheng.mapper.WebsiteMapper.selectWebsiteById\", 1); // è¯·æ³¨æ„ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨äºŒçº§ç¼“å­˜çš„æ—¶å€™ï¼ŒsqlSessionè°ƒç”¨äº† commitæ–¹æ³•åæ‰ä¼šç”Ÿæ•ˆ ss.commit(); logger.debug(\"ç°åœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„SqlSeesionå¯¹è±¡åœ¨æ‰§è¡Œä¸€æ¬¡\"); SqlSession ss2 = ssf.openSession(); Website site3 = ss2.selectOne(\"net.biancheng.mapper.WebsiteMapper.selectWebsiteById\", 1); // è¯·æ³¨æ„ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨äºŒçº§ç¼“å­˜çš„æ—¶å€™ï¼ŒsqlSessionè°ƒç”¨äº† commitæ–¹æ³•åæ‰ä¼šç”Ÿæ•ˆ ss2.commit(); } } ç»“æœå¦‚ä¸‹:\nDEBUG [main] - ==\u003e Preparing: SELECT * FROM website WHERE id=? DEBUG [main] - ==\u003e Parameters: 1(Integer) DEBUG [main] - \u003c== Total: 1 DEBUG [main] - ä½¿ç”¨åŒä¸€ä¸ªsqlsessionå†æ‰§è¡Œä¸€æ¬¡ DEBUG [main] - ç°åœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„SqlSeesionå¯¹è±¡åœ¨æ‰§è¡Œä¸€æ¬¡ DEBUG [main] - ==\u003e Preparing: SELECT * FROM website WHERE id=? DEBUG [main] - ==\u003e Parameters: 1(Integer) DEBUG [main] - \u003c== Total: 1 ä»è¿è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼Œç¬¬ä¸€ä¸ª SqlSession å®é™…åªå‘ç”Ÿè¿‡ä¸€æ¬¡æŸ¥è¯¢ï¼Œè€Œç¬¬äºŒæ¬¡æŸ¥è¯¢å°±ä»ç¼“å­˜ä¸­å–å‡ºäº†ï¼Œä¹Ÿå°±æ˜¯ SqlSession å±‚é¢çš„ä¸€çº§ç¼“å­˜ã€‚ä¸ºäº†å…‹æœè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦é…ç½®äºŒçº§ç¼“å­˜ï¼Œä½¿å¾—ç¼“å­˜åœ¨ SqlSessionFactory å±‚é¢ä¸Šèƒ½å¤Ÿæä¾›ç»™å„ä¸ª SqlSession å¯¹è±¡å…±äº«ã€‚\nä¸€çº§ç¼“å­˜å¤±æ•ˆçš„å››ç§æƒ…å†µ sqlsessionå˜äº† ç¼“å­˜å¤±æ•ˆ sqlsessionä¸å˜,æŸ¥è¯¢æ¡ä»¶ä¸åŒï¼Œä¸€çº§ç¼“å­˜å¤±æ•ˆ sqlsessionä¸å˜,ä¸­é—´å‘ç”Ÿäº†å¢åˆ æ”¹æ“ä½œï¼Œä¸€çº§ç¼“å­˜å¤±è´¥ sqlsessionä¸å˜,æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜ï¼Œä¸€çº§ç¼“å­˜å¤±è´¥ springç»“åˆmybatisåï¼Œä¸€çº§ç¼“å­˜ä½œç”¨ï¼š\nåœ¨æœªå¼€å¯äº‹åŠ¡çš„æƒ…å†µä¹‹ä¸‹ï¼Œæ¯æ¬¡æŸ¥è¯¢ï¼Œspringéƒ½ä¼šå…³é—­æ—§çš„sqlSessionè€Œåˆ›å»ºæ–°çš„sqlSession,å› æ­¤æ­¤æ—¶çš„ä¸€çº§ç¼“å­˜æ˜¯ä¸èµ·ä½œç”¨çš„\nåœ¨å¼€å¯äº‹åŠ¡çš„æƒ…å†µä¹‹ä¸‹ï¼Œspringä½¿ç”¨ThreadLocalè·å–å½“å‰èµ„æºç»‘å®šåŒä¸€ä¸ªsqlSessionï¼Œå› æ­¤æ­¤æ—¶ä¸€çº§ç¼“å­˜æ˜¯æœ‰æ•ˆçš„ã€‚\nç”±äºspringä½¿ç”¨äº†ä»£ç†, æ‰€ä»¥åœ¨ä»£ç†ç»“æŸæ—¶å°±å…³é—­äº†sqlsession, å¯¼è‡´ä¸€çº§ç¼“å­˜å¤±æ•ˆ\nSpringæ•´åˆMyBatisæ—¶ä¸€çº§ç¼“å­˜å¤±æ•ˆé—®é¢˜_xingze_Wçš„åšå®¢-CSDNåšå®¢_springæ•´åˆmybatisä¸€çº§ç¼“å­˜ mybatisä¸€çº§ç¼“å­˜å¤±æ•ˆçš„å››ç§æƒ…å†µ - ç®€ä¹¦ (jianshu.com) ç¦ç”¨ä¸€çº§ç¼“å­˜ mybatis: configuration: cache-enabled: false #ç¦ç”¨äºŒçº§ç¼“å­˜ local-cache-scope: statement #é»˜è®¤æŒ‡å®šä¸ºsessionçº§åˆ« æŒ‡å®šç¼“å­˜statementçº§åˆ«å, mybatisä¼šåˆ é™¤ç¼“å­˜\norg.apache.ibatis.executor.BaseExecutor#query(MappedStatement, Object, RowBounds, ResultHandler, CacheKey, BoundSql)\npublic \u003cE\u003e List\u003cE\u003e query(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql) throws SQLException { ErrorContext.instance().resource(ms.getResource()).activity(\"executing a query\").object(ms.getId()); if (closed) throw new ExecutorException(\"Executor was closed.\"); if (queryStack == 0 \u0026\u0026 ms.isFlushCacheRequired()) { clearLocalCache(); } List\u003cE\u003e list; try { queryStack++; list = resultHandler == null ? (List\u003cE\u003e) localCache.getObject(key) : null; if (list != null) { handleLocallyCachedOutputParameters(ms, key, parameter, boundSql); } else { list = queryFromDatabase(ms, parameter, rowBounds, resultHandler, key, boundSql); } } finally { queryStack--; } if (queryStack == 0) { for (DeferredLoad deferredLoad : deferredLoads) { deferredLoad.load(); } // æ­¤å¤„åšäº†åˆ é™¤ if (configuration.getLocalCacheScope() == LocalCacheScope.STATEMENT) { clearLocalCache(); // issue #482 } } return list; } äºŒçº§ç¼“å­˜ äºŒçº§ç¼“å­˜æ˜¯å…¨å±€ç¼“å­˜ï¼Œä½œç”¨åŸŸè¶…å‡º session èŒƒå›´ä¹‹å¤–ï¼Œå¯ä»¥è¢«æ‰€æœ‰ SqlSession å…±äº«ã€‚äºŒçº§ç¼“å­˜çš„ä½œç”¨åŸŸæ˜¯namespaceï¼Œä¹Ÿå°±æ˜¯ä½œç”¨èŒƒå›´æ˜¯åŒä¸€ä¸ªå‘½åç©ºé—´\nå¼€å¯äºŒçº§ç¼“å­˜åï¼Œä¼šä½¿ç”¨CachingExecutorè£…é¥°Executorï¼Œè¿›å…¥ä¸€çº§ç¼“å­˜çš„æŸ¥è¯¢æµç¨‹å‰ï¼Œå…ˆåœ¨CachingExecutorè¿›è¡ŒäºŒçº§ç¼“å­˜çš„æŸ¥è¯¢ï¼Œå…·ä½“çš„å·¥ä½œæµç¨‹å¦‚ä¸‹æ‰€ç¤ºã€‚\näºŒçº§ç¼“å­˜å¼€å¯åï¼ŒåŒä¸€ä¸ªnamespaceä¸‹çš„æ‰€æœ‰æ“ä½œè¯­å¥ï¼Œéƒ½å½±å“ç€åŒä¸€ä¸ªCacheï¼Œå³äºŒçº§ç¼“å­˜è¢«å¤šä¸ªSqlSessionå…±äº«ï¼Œæ˜¯ä¸€ä¸ªå…¨å±€çš„å˜é‡ã€‚ å½“å¼€å¯ç¼“å­˜åï¼Œæ•°æ®çš„æŸ¥è¯¢æ‰§è¡Œçš„æµç¨‹å°±æ˜¯ äºŒçº§ç¼“å­˜ -\u003e ä¸€çº§ç¼“å­˜ -\u003e æ•°æ®åº“ã€‚\nç¦ç”¨äºŒçº§ç¼“å­˜ mybatis: configuration: cache-enabled: false #ç¦ç”¨äºŒçº§ç¼“å­˜, é»˜è®¤ä¸ºtrue mybatisçš„äºŒçº§ç¼“å­˜æ˜¯æœ¬åœ°å®ç°çš„, åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­, å®¹æ˜“äº§ç”Ÿè„æ•°æ® , æ‰€ä»¥ä¸€èˆ¬ä¼šä½¿ç”¨redisè¿™ç§ç¬¬ä¸‰æ–¹å­˜å‚¨æ¥ä½¿ç”¨äºŒçº§ç¼“å­˜\nSpringBoot+Mybatisä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜è¯¦è§£ - éƒ‘æ™“é¾™ - åšå®¢å›­ (cnblogs.com) mybatis äºŒçº§ç¼“å­˜å¤±æ•ˆ_ç»™æˆ‘äº”åˆ†é’Ÿï¼Œå¸¦ä½ å½»åº•æŒæ¡MyBatisçš„ç¼“å­˜å·¥ä½œåŸç†_Tfiftheçš„åšå®¢-CSDNåšå®¢ MyBatisç¼“å­˜ï¼ˆä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ï¼‰ (biancheng.net) MyBatis|ç¼“å­˜æœºåˆ¶ - ç®€ä¹¦ (jianshu.com) springboot+mybatisä¸€çº§ç¼“å­˜å¯ç”¨/ç¦ç”¨é—®é¢˜_NongYetingçš„åšå®¢-CSDNåšå®¢_springbootå…³é—­mybatisç¼“å­˜ ","wordCount":"2174","inLanguage":"zh","datePublished":"2023-08-22T00:00:00Z","dateModified":"2023-09-04T00:18:25+08:00","author":{"@type":"Person","name":"xkj"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/mybatis/%E7%BC%93%E5%AD%98.html"},"publisher":{"@type":"Organization","name":"ç±³äºŒ","logo":{"@type":"ImageObject","url":"https://xiaokunji.com/img/Q.svg"}}}</script></head><body class="dark" id="top"><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class="header"><nav class="nav"><div class="logo"><a accesskey="h" href="https://xiaokunji.com/zh/" title="ç±³äºŒ (Alt + H)"><img alt="" aria-label="logo" height="35" src="https://xiaokunji.com/img/Q.svg"/>ç±³äºŒ</a><div class="logo-switches"><button accesskey="t" id="theme-toggle" title="(Alt + T)"><svg fill="none" height="18" id="moon" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path></svg><svg fill="none" height="18" id="sun" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="5"></circle><line x1="12" x2="12" y1="1" y2="3"></line><line x1="12" x2="12" y1="21" y2="23"></line><line x1="4.22" x2="5.64" y1="4.22" y2="5.64"></line><line x1="18.36" x2="19.78" y1="18.36" y2="19.78"></line><line x1="1" x2="3" y1="12" y2="12"></line><line x1="21" x2="23" y1="12" y2="12"></line><line x1="4.22" x2="5.64" y1="19.78" y2="18.36"></line><line x1="18.36" x2="19.78" y1="5.64" y2="4.22"></line></svg></button><ul class="lang-switch"><li>|</li><li><a aria-label="English" href="https://xiaokunji.com/en/" title="English">English</a></li></ul></div></div><ul id="menu"><li><a href="https://xiaokunji.com/zh/" title="ğŸ ä¸»é¡µ"><span>ğŸ ä¸»é¡µ</span></a></li><li><a accesskey="/" href="https://xiaokunji.com/zh/search" title="ğŸ”æœç´¢ (Alt + /)"><span>ğŸ”æœç´¢</span></a></li><li><a href="https://xiaokunji.com/zh/post.html" title="ğŸ“šæ–‡ç« "><span>ğŸ“šæ–‡ç« </span></a></li><li><a href="https://xiaokunji.com/zh/archives.html" title="â±æ—¶é—´è½´"><span>â±æ—¶é—´è½´</span></a></li><li><a href="https://xiaokunji.com/zh/tags.html" title="ğŸ”–æ ‡ç­¾"><span>ğŸ”–æ ‡ç­¾</span></a></li><li><a href="https://xiaokunji.com/zh/categories.html" title="ğŸ“–åˆ†ç±»"><span>ğŸ“–åˆ†ç±»</span></a></li><li><a href="https://xiaokunji.com/zh/links.html" title="ğŸ¤å‹é“¾"><span>ğŸ¤å‹é“¾</span></a></li></ul></nav></header><main class="main"><article class="post-single"><header class="post-header"><nav aria-label="breadcrumb"><ul><a href="https://xiaokunji.com/zh/">ğŸ </a> <span>&gt;</span>
<a href="https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6.html">javaåŠå…¶æ¡†æ¶</a> <span>&gt;</span>
<a href="https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/mybatis.html">mybatis</a> <span>&gt;</span></ul></nav><h1 class="post-title">ç¼“å­˜</h1><div class="post-description">mybatisçš„ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¯å¢ƒ</div><div class="post-meta">åˆ›å»º:&amp;nbsp;&lt;span title='2023-08-22 00:00:00 +0000 UTC'&gt;2023-08-22&lt;/span&gt;&amp;nbsp;Â·&amp;nbsp;æ›´æ–°:&amp;nbsp;2023-09-04&amp;nbsp;Â·&amp;nbsp;xkj
Â |Â åˆ†ç±»: Â <ul class="post-categories-meta" style="display:inline"><a href="https://xiaokunji.com/zh/categories/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6.html">javaåŠå…¶æ¡†æ¶</a></ul><span id="busuanzi_container_page_pv">Â | è®¿é—®: <span id="busuanzi_value_page_pv">1</span></span></div></header><aside class="toc-container wide" id="toc-container"><div class="toc"><details open=""><summary accesskey="c" title="(Alt + C)"><span class="details">ç›®å½•</span></summary><div class="inner"><ul><li><a aria-label="å‰è¨€" href="#%e5%89%8d%e8%a8%80">å‰è¨€</a></li><li><a aria-label="ä¸€çº§ç¼“å­˜" href="#%e4%b8%80%e7%ba%a7%e7%bc%93%e5%ad%98">ä¸€çº§ç¼“å­˜</a><ul><li><a aria-label="ä¸€çº§ç¼“å­˜å¤±æ•ˆçš„å››ç§æƒ…å†µ" href="#%e4%b8%80%e7%ba%a7%e7%bc%93%e5%ad%98%e5%a4%b1%e6%95%88%e7%9a%84%e5%9b%9b%e7%a7%8d%e6%83%85%e5%86%b5">ä¸€çº§ç¼“å­˜å¤±æ•ˆçš„å››ç§æƒ…å†µ</a></li><li><a aria-label="ç¦ç”¨ä¸€çº§ç¼“å­˜" href="#%e7%a6%81%e7%94%a8%e4%b8%80%e7%ba%a7%e7%bc%93%e5%ad%98">ç¦ç”¨ä¸€çº§ç¼“å­˜</a></li></ul></li><li><a aria-label="äºŒçº§ç¼“å­˜" href="#%e4%ba%8c%e7%ba%a7%e7%bc%93%e5%ad%98">äºŒçº§ç¼“å­˜</a><ul><li><a aria-label="ç¦ç”¨äºŒçº§ç¼“å­˜" href="#%e7%a6%81%e7%94%a8%e4%ba%8c%e7%ba%a7%e7%bc%93%e5%ad%98">ç¦ç”¨äºŒçº§ç¼“å­˜</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class="post-content"><p>[TOC]</p><h1 id="å‰è¨€">å‰è¨€<a aria-hidden="true" class="anchor" hidden="" href="#å‰è¨€">#</a></h1><p>å’Œå¤§å¤šæ•°æŒä¹…åŒ–æ¡†æ¶ä¸€æ ·ï¼ŒMyBatis æä¾›äº†ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜çš„æ”¯æŒã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒMyBatis åªå¼€å¯ä¸€çº§ç¼“å­˜ã€‚</p><p>MyBatisæä¾›äº†ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜</p><ul><li>ä¸€çº§ç¼“å­˜ï¼šä¹Ÿç§°ä¸ºæœ¬åœ°ç¼“å­˜ï¼Œç”¨äºä¿å­˜ç”¨æˆ·åœ¨ä¸€æ¬¡ä¼šè¯è¿‡ç¨‹ä¸­æŸ¥è¯¢çš„ç»“æœï¼Œç”¨æˆ·ä¸€æ¬¡ä¼šè¯ä¸­åªèƒ½ä½¿ç”¨ä¸€ä¸ªsqlSessionï¼Œä¸€çº§ç¼“å­˜æ˜¯è‡ªåŠ¨å¼€å¯çš„ï¼Œä¸å…è®¸å…³é—­ã€‚</li><li>äºŒçº§ç¼“å­˜ï¼šä¹Ÿç§°ä¸ºå…¨å±€ç¼“å­˜ï¼Œæ˜¯mapperçº§åˆ«çš„ç¼“å­˜ï¼Œæ˜¯é’ˆå¯¹ä¸€ä¸ªè¡¨çš„æŸ¥ç»“æœçš„å­˜å‚¨ï¼Œå¯ä»¥å…±äº«ç»™æ‰€æœ‰é’ˆå¯¹è¿™å¼ è¡¨çš„æŸ¥è¯¢çš„ç”¨æˆ·ã€‚ä¹Ÿå°±æ˜¯è¯´å¯¹äºmapperçº§åˆ«çš„ç¼“å­˜ä¸åŒçš„sqlsessionæ˜¯å¯ä»¥å…±äº«çš„ã€‚</li></ul><h1 id="ä¸€çº§ç¼“å­˜">ä¸€çº§ç¼“å­˜<a aria-hidden="true" class="anchor" hidden="" href="#ä¸€çº§ç¼“å­˜">#</a></h1><p>ä¸€çº§ç¼“å­˜æ˜¯åŸºäº PerpetualCacheï¼ˆMyBatisè‡ªå¸¦ï¼‰çš„ HashMap æœ¬åœ°ç¼“å­˜ï¼Œä½œç”¨èŒƒå›´ä¸º session åŸŸå†…,å®ƒå­˜å‚¨çš„SqlSessionä¸­çš„BaseExecutorä¹‹ä¸­ã€‚å½“ session flushï¼ˆåˆ·æ–°ï¼‰æˆ–è€… closeï¼ˆå…³é—­ï¼‰ä¹‹åï¼Œè¯¥ session ä¸­æ‰€æœ‰çš„ cacheï¼ˆç¼“å­˜ï¼‰å°±ä¼šè¢«æ¸…ç©ºã€‚</p><p>åœ¨å‚æ•°å’Œ SQL å®Œå…¨ä¸€æ ·çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨åŒä¸€ä¸ª SqlSession å¯¹è±¡è°ƒç”¨åŒä¸€ä¸ª mapper çš„æ–¹æ³•ï¼Œå¾€å¾€åªæ‰§è¡Œä¸€æ¬¡ SQLã€‚å› ä¸ºä½¿ç”¨ SqlSession ç¬¬ä¸€æ¬¡æŸ¥è¯¢åï¼ŒMyBatis ä¼šå°†å…¶æ”¾åœ¨ç¼“å­˜ä¸­ï¼Œå†æ¬¡æŸ¥è¯¢æ—¶ï¼Œå¦‚æœæ²¡æœ‰åˆ·æ–°ï¼Œå¹¶ä¸”ç¼“å­˜æ²¡æœ‰è¶…æ—¶çš„æƒ…å†µä¸‹ï¼ŒSqlSession ä¼šå–å‡ºå½“å‰ç¼“å­˜çš„æ•°æ®ï¼Œè€Œä¸ä¼šå†æ¬¡å‘é€ SQL åˆ°æ•°æ®åº“ã€‚</p><p>ç”±äº SqlSession æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œæ‰€ä»¥å¦‚æœä½ ä½¿ç”¨ä¸åŒçš„ SqlSession å¯¹è±¡ï¼Œå³ä½¿è°ƒç”¨ç›¸åŒçš„ Mapperã€å‚æ•°å’Œæ–¹æ³•ï¼ŒMyBatis è¿˜æ˜¯ä¼šå†æ¬¡å‘é€ SQL åˆ°æ•°æ®åº“æ‰§è¡Œï¼Œè¿”å›ç»“æœã€‚</p><p>ç¤ºä¾‹:</p><div class="highlight"><pre style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-java" data-lang="java"><span style="display:flex"><span><span style="color:#ff7b72">package</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">net.biancheng.test</span>;<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681"></span><span style="color:#ff7b72">import</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">java.io.IOException</span>;<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681"></span><span style="color:#ff7b72">import</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">java.io.InputStream</span>;<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681"></span><span style="color:#ff7b72">import</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">java.util.List</span>;<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681"></span><span style="color:#ff7b72">import</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">org.apache.ibatis.io.Resources</span>;<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681"></span><span style="color:#ff7b72">import</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">org.apache.ibatis.session.SqlSession</span>;<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681"></span><span style="color:#ff7b72">import</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">org.apache.ibatis.session.SqlSessionFactory</span>;<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681"></span><span style="color:#ff7b72">import</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">org.apache.ibatis.session.SqlSessionFactoryBuilder</span>;<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681"></span><span style="color:#ff7b72">import</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">org.apache.log4j.Logger</span>;<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681"></span><span style="color:#ff7b72">import</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">net.biancheng.po.Website</span>;<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681"></span><span style="color:#ff7b72">public</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">class</span> <span style="color:#f0883e;font-weight:700">Test</span><span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">public</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">static</span><span style="color:#6e7681"> </span>Logger<span style="color:#6e7681"> </span>logger<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:700">=</span><span style="color:#6e7681"> </span>Logger.getLogger(Test.class);<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">public</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">static</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">void</span><span style="color:#6e7681"> </span><span style="color:#d2a8ff;font-weight:700">main</span>(String<span style="color:#ff7b72;font-weight:700">[]</span><span style="color:#6e7681"> </span>args)<span style="color:#6e7681"> </span><span style="color:#ff7b72">throws</span><span style="color:#6e7681"> </span>IOException<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">        </span>InputStream<span style="color:#6e7681"> </span>config<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:700">=</span><span style="color:#6e7681"> </span>Resources.getResourceAsStream(<span style="color:#a5d6ff">"mybatis-config.xml"</span>);<span style="color:#6e7681"> </span><span style="color:#8b949e;font-style:italic">// æ ¹æ®é…ç½®æ–‡ä»¶æ„å»º</span><span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">        </span>SqlSessionFactory<span style="color:#6e7681"> </span>ssf<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:700">=</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">new</span><span style="color:#6e7681"> </span>SqlSessionFactoryBuilder().build(config);<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">        </span>SqlSession<span style="color:#6e7681"> </span>ss<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:700">=</span><span style="color:#6e7681"> </span>ssf.openSession();<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">        </span>Website<span style="color:#6e7681"> </span>site<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:700">=</span><span style="color:#6e7681"> </span>ss.selectOne(<span style="color:#a5d6ff">"net.biancheng.mapper.WebsiteMapper.selectWebsiteById"</span>,<span style="color:#6e7681"> </span>1);<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">        </span>logger.debug(<span style="color:#a5d6ff">"ä½¿ç”¨åŒä¸€ä¸ªsqlsessionå†æ‰§è¡Œä¸€æ¬¡"</span>);<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">        </span>Website<span style="color:#6e7681"> </span>site2<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:700">=</span><span style="color:#6e7681"> </span>ss.selectOne(<span style="color:#a5d6ff">"net.biancheng.mapper.WebsiteMapper.selectWebsiteById"</span>,<span style="color:#6e7681"> </span>1);<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">        </span><span style="color:#8b949e;font-style:italic">// è¯·æ³¨æ„ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨äºŒçº§ç¼“å­˜çš„æ—¶å€™ï¼ŒsqlSessionè°ƒç”¨äº† commitæ–¹æ³•åæ‰ä¼šç”Ÿæ•ˆ</span><span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">        </span>ss.commit();<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">        </span>logger.debug(<span style="color:#a5d6ff">"ç°åœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„SqlSeesionå¯¹è±¡åœ¨æ‰§è¡Œä¸€æ¬¡"</span>);<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">        </span>SqlSession<span style="color:#6e7681"> </span>ss2<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:700">=</span><span style="color:#6e7681"> </span>ssf.openSession();<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">        </span>Website<span style="color:#6e7681"> </span>site3<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:700">=</span><span style="color:#6e7681"> </span>ss2.selectOne(<span style="color:#a5d6ff">"net.biancheng.mapper.WebsiteMapper.selectWebsiteById"</span>,<span style="color:#6e7681"> </span>1);<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">        </span><span style="color:#8b949e;font-style:italic">// è¯·æ³¨æ„ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨äºŒçº§ç¼“å­˜çš„æ—¶å€™ï¼ŒsqlSessionè°ƒç”¨äº† commitæ–¹æ³•åæ‰ä¼šç”Ÿæ•ˆ</span><span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">        </span>ss2.commit();<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">    </span>}<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681"></span>}<span style="color:#6e7681">
</span></span></span></code></pre></div><p>ç»“æœå¦‚ä¸‹:</p><div class="highlight"><pre style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-fallback" data-lang="fallback"><span style="display:flex"><span>DEBUG [main] - ==&gt;  Preparing: SELECT * FROM website WHERE id=?
</span></span><span style="display:flex"><span>DEBUG [main] - ==&gt; Parameters: 1(Integer)
</span></span><span style="display:flex"><span>DEBUG [main] - &lt;==      Total: 1
</span></span><span style="display:flex"><span>DEBUG [main] - ä½¿ç”¨åŒä¸€ä¸ªsqlsessionå†æ‰§è¡Œä¸€æ¬¡
</span></span><span style="display:flex"><span>DEBUG [main] - ç°åœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„SqlSeesionå¯¹è±¡åœ¨æ‰§è¡Œä¸€æ¬¡
</span></span><span style="display:flex"><span>DEBUG [main] - ==&gt;  Preparing: SELECT * FROM website WHERE id=?
</span></span><span style="display:flex"><span>DEBUG [main] - ==&gt; Parameters: 1(Integer)
</span></span><span style="display:flex"><span>DEBUG [main] - &lt;==      Total: 1
</span></span></code></pre></div><p>ä»è¿è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼Œç¬¬ä¸€ä¸ª SqlSession å®é™…åªå‘ç”Ÿè¿‡ä¸€æ¬¡æŸ¥è¯¢ï¼Œè€Œç¬¬äºŒæ¬¡æŸ¥è¯¢å°±ä»ç¼“å­˜ä¸­å–å‡ºäº†ï¼Œä¹Ÿå°±æ˜¯ SqlSession å±‚é¢çš„ä¸€çº§ç¼“å­˜ã€‚ä¸ºäº†å…‹æœè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦é…ç½®äºŒçº§ç¼“å­˜ï¼Œä½¿å¾—ç¼“å­˜åœ¨ SqlSessionFactory å±‚é¢ä¸Šèƒ½å¤Ÿæä¾›ç»™å„ä¸ª SqlSession å¯¹è±¡å…±äº«ã€‚</p><h2 id="ä¸€çº§ç¼“å­˜å¤±æ•ˆçš„å››ç§æƒ…å†µ">ä¸€çº§ç¼“å­˜å¤±æ•ˆçš„å››ç§æƒ…å†µ<a aria-hidden="true" class="anchor" hidden="" href="#ä¸€çº§ç¼“å­˜å¤±æ•ˆçš„å››ç§æƒ…å†µ">#</a></h2><ol><li>sqlsessionå˜äº† ç¼“å­˜å¤±æ•ˆ</li><li>sqlsessionä¸å˜,æŸ¥è¯¢æ¡ä»¶ä¸åŒï¼Œä¸€çº§ç¼“å­˜å¤±æ•ˆ</li><li>sqlsessionä¸å˜,ä¸­é—´å‘ç”Ÿäº†å¢åˆ æ”¹æ“ä½œï¼Œä¸€çº§ç¼“å­˜å¤±è´¥</li><li>sqlsessionä¸å˜,æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜ï¼Œä¸€çº§ç¼“å­˜å¤±è´¥</li></ol><blockquote><p>springç»“åˆmybatisåï¼Œä¸€çº§ç¼“å­˜ä½œç”¨ï¼š</p><ul><li><p>åœ¨æœªå¼€å¯äº‹åŠ¡çš„æƒ…å†µä¹‹ä¸‹ï¼Œæ¯æ¬¡æŸ¥è¯¢ï¼Œspringéƒ½ä¼šå…³é—­æ—§çš„sqlSessionè€Œåˆ›å»ºæ–°çš„sqlSession,å› æ­¤æ­¤æ—¶çš„ä¸€çº§ç¼“å­˜æ˜¯ä¸èµ·ä½œç”¨çš„</p></li><li><p>åœ¨å¼€å¯äº‹åŠ¡çš„æƒ…å†µä¹‹ä¸‹ï¼Œspringä½¿ç”¨ThreadLocalè·å–å½“å‰èµ„æºç»‘å®šåŒä¸€ä¸ªsqlSessionï¼Œå› æ­¤æ­¤æ—¶ä¸€çº§ç¼“å­˜æ˜¯æœ‰æ•ˆçš„ã€‚</p><p>ç”±äºspringä½¿ç”¨äº†ä»£ç†, æ‰€ä»¥åœ¨ä»£ç†ç»“æŸæ—¶å°±å…³é—­äº†sqlsession, å¯¼è‡´ä¸€çº§ç¼“å­˜å¤±æ•ˆ</p></li></ul></blockquote><p><a href="https://blog.csdn.net/qq_42220174/article/details/102993338" rel="noopener" target="_blank">Springæ•´åˆMyBatisæ—¶ä¸€çº§ç¼“å­˜å¤±æ•ˆé—®é¢˜_xingze_Wçš„åšå®¢-CSDNåšå®¢_springæ•´åˆmybatisä¸€çº§ç¼“å­˜</a></p><p><a href="https://www.jianshu.com/p/2521ccc7a7df" rel="noopener" target="_blank">mybatisä¸€çº§ç¼“å­˜å¤±æ•ˆçš„å››ç§æƒ…å†µ - ç®€ä¹¦ (jianshu.com)</a></p><h2 id="ç¦ç”¨ä¸€çº§ç¼“å­˜">ç¦ç”¨ä¸€çº§ç¼“å­˜<a aria-hidden="true" class="anchor" hidden="" href="#ç¦ç”¨ä¸€çº§ç¼“å­˜">#</a></h2><div class="highlight"><pre style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#7ee787">mybatis</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">  </span><span style="color:#7ee787">configuration</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">    </span><span style="color:#7ee787">cache-enabled</span>:<span style="color:#6e7681"> </span><span style="color:#79c0ff">false</span><span style="color:#6e7681">  </span><span style="color:#8b949e;font-style:italic">#ç¦ç”¨äºŒçº§ç¼“å­˜</span><span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">    </span><span style="color:#7ee787">local-cache-scope</span>:<span style="color:#6e7681"> </span><span style="color:#a5d6ff">statement </span><span style="color:#6e7681"> </span><span style="color:#8b949e;font-style:italic">#é»˜è®¤æŒ‡å®šä¸ºsessionçº§åˆ«</span><span style="color:#6e7681">
</span></span></span></code></pre></div><p>æŒ‡å®šç¼“å­˜statementçº§åˆ«å, mybatisä¼šåˆ é™¤ç¼“å­˜</p><p><code>org.apache.ibatis.executor.BaseExecutor#query(MappedStatement, Object, RowBounds, ResultHandler, CacheKey, BoundSql)</code></p><div class="highlight"><pre style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-java" data-lang="java"><span style="display:flex"><span><span style="color:#ff7b72">public</span><span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:700">&lt;</span>E<span style="color:#ff7b72;font-weight:700">&gt;</span><span style="color:#6e7681"> </span>List<span style="color:#ff7b72;font-weight:700">&lt;</span>E<span style="color:#ff7b72;font-weight:700">&gt;</span><span style="color:#6e7681"> </span><span style="color:#d2a8ff;font-weight:700">query</span>(MappedStatement<span style="color:#6e7681"> </span>ms,<span style="color:#6e7681"> </span>Object<span style="color:#6e7681"> </span>parameter,<span style="color:#6e7681"> </span>RowBounds<span style="color:#6e7681"> </span>rowBounds,<span style="color:#6e7681"> </span>ResultHandler<span style="color:#6e7681"> </span>resultHandler,<span style="color:#6e7681"> </span>CacheKey<span style="color:#6e7681"> </span>key,<span style="color:#6e7681"> </span>BoundSql<span style="color:#6e7681"> </span>boundSql)<span style="color:#6e7681"> </span><span style="color:#ff7b72">throws</span><span style="color:#6e7681"> </span>SQLException<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">    </span>ErrorContext.instance().resource(ms.getResource()).activity(<span style="color:#a5d6ff">"executing a query"</span>).object(ms.getId());<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">if</span><span style="color:#6e7681"> </span>(closed)<span style="color:#6e7681"> </span><span style="color:#ff7b72">throw</span><span style="color:#6e7681"> </span><span style="color:#ff7b72">new</span><span style="color:#6e7681"> </span>ExecutorException(<span style="color:#a5d6ff">"Executor was closed."</span>);<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">if</span><span style="color:#6e7681"> </span>(queryStack<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:700">==</span><span style="color:#6e7681"> </span>0<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:700">&amp;&amp;</span><span style="color:#6e7681"> </span>ms.isFlushCacheRequired())<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">      </span>clearLocalCache();<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">    </span>}<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">    </span>List<span style="color:#ff7b72;font-weight:700">&lt;</span>E<span style="color:#ff7b72;font-weight:700">&gt;</span><span style="color:#6e7681"> </span>list;<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">try</span><span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">      </span>queryStack<span style="color:#ff7b72;font-weight:700">++</span>;<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">      </span>list<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:700">=</span><span style="color:#6e7681"> </span>resultHandler<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:700">==</span><span style="color:#6e7681"> </span><span style="color:#79c0ff">null</span><span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:700">?</span><span style="color:#6e7681"> </span>(List<span style="color:#ff7b72;font-weight:700">&lt;</span>E<span style="color:#ff7b72;font-weight:700">&gt;</span>)<span style="color:#6e7681"> </span>localCache.getObject(key)<span style="color:#6e7681"> </span>:<span style="color:#6e7681"> </span><span style="color:#79c0ff">null</span>;<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">      </span><span style="color:#ff7b72">if</span><span style="color:#6e7681"> </span>(list<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:700">!=</span><span style="color:#6e7681"> </span><span style="color:#79c0ff">null</span>)<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">        </span>handleLocallyCachedOutputParameters(ms,<span style="color:#6e7681"> </span>key,<span style="color:#6e7681"> </span>parameter,<span style="color:#6e7681"> </span>boundSql);<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">      </span>}<span style="color:#6e7681"> </span><span style="color:#ff7b72">else</span><span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">        </span>list<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:700">=</span><span style="color:#6e7681"> </span>queryFromDatabase(ms,<span style="color:#6e7681"> </span>parameter,<span style="color:#6e7681"> </span>rowBounds,<span style="color:#6e7681"> </span>resultHandler,<span style="color:#6e7681"> </span>key,<span style="color:#6e7681"> </span>boundSql);<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">      </span>}<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">    </span>}<span style="color:#6e7681"> </span><span style="color:#ff7b72">finally</span><span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">      </span>queryStack<span style="color:#ff7b72;font-weight:700">--</span>;<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">    </span>}<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">if</span><span style="color:#6e7681"> </span>(queryStack<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:700">==</span><span style="color:#6e7681"> </span>0)<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">      </span><span style="color:#ff7b72">for</span><span style="color:#6e7681"> </span>(DeferredLoad<span style="color:#6e7681"> </span>deferredLoad<span style="color:#6e7681"> </span>:<span style="color:#6e7681"> </span>deferredLoads)<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">        </span>deferredLoad.load();<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">      </span>}<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">        </span><span style="color:#8b949e;font-style:italic">// æ­¤å¤„åšäº†åˆ é™¤</span><span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">      </span><span style="color:#ff7b72">if</span><span style="color:#6e7681"> </span>(configuration.getLocalCacheScope()<span style="color:#6e7681"> </span><span style="color:#ff7b72;font-weight:700">==</span><span style="color:#6e7681"> </span>LocalCacheScope.STATEMENT)<span style="color:#6e7681"> </span>{<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">        </span>clearLocalCache();<span style="color:#6e7681"> </span><span style="color:#8b949e;font-style:italic">// issue #482</span><span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">      </span>}<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">    </span>}<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">    </span><span style="color:#ff7b72">return</span><span style="color:#6e7681"> </span>list;<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">  </span>}<span style="color:#6e7681">
</span></span></span></code></pre></div><h1 id="äºŒçº§ç¼“å­˜">äºŒçº§ç¼“å­˜<a aria-hidden="true" class="anchor" hidden="" href="#äºŒçº§ç¼“å­˜">#</a></h1><p>äºŒçº§ç¼“å­˜æ˜¯å…¨å±€ç¼“å­˜ï¼Œä½œç”¨åŸŸè¶…å‡º session èŒƒå›´ä¹‹å¤–ï¼Œå¯ä»¥è¢«æ‰€æœ‰ SqlSession å…±äº«ã€‚äºŒçº§ç¼“å­˜çš„ä½œç”¨åŸŸæ˜¯namespaceï¼Œä¹Ÿå°±æ˜¯ä½œç”¨èŒƒå›´æ˜¯åŒä¸€ä¸ªå‘½åç©ºé—´</p><p>å¼€å¯äºŒçº§ç¼“å­˜åï¼Œä¼šä½¿ç”¨CachingExecutorè£…é¥°Executorï¼Œè¿›å…¥ä¸€çº§ç¼“å­˜çš„æŸ¥è¯¢æµç¨‹å‰ï¼Œå…ˆåœ¨CachingExecutorè¿›è¡ŒäºŒçº§ç¼“å­˜çš„æŸ¥è¯¢ï¼Œå…·ä½“çš„å·¥ä½œæµç¨‹å¦‚ä¸‹æ‰€ç¤ºã€‚</p><p><img alt="img" loading="lazy" src="%E7%BC%93%E5%AD%98.assets/15083002-cfdb77a351f8fc73.webp"/></p><p>äºŒçº§ç¼“å­˜å¼€å¯åï¼ŒåŒä¸€ä¸ªnamespaceä¸‹çš„æ‰€æœ‰æ“ä½œè¯­å¥ï¼Œéƒ½å½±å“ç€åŒä¸€ä¸ªCacheï¼Œå³äºŒçº§ç¼“å­˜è¢«å¤šä¸ªSqlSessionå…±äº«ï¼Œæ˜¯ä¸€ä¸ªå…¨å±€çš„å˜é‡ã€‚
å½“å¼€å¯ç¼“å­˜åï¼Œæ•°æ®çš„æŸ¥è¯¢æ‰§è¡Œçš„æµç¨‹å°±æ˜¯ äºŒçº§ç¼“å­˜ -&gt; ä¸€çº§ç¼“å­˜ -&gt; æ•°æ®åº“ã€‚</p><h2 id="ç¦ç”¨äºŒçº§ç¼“å­˜">ç¦ç”¨äºŒçº§ç¼“å­˜<a aria-hidden="true" class="anchor" hidden="" href="#ç¦ç”¨äºŒçº§ç¼“å­˜">#</a></h2><div class="highlight"><pre style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-yaml" data-lang="yaml"><span style="display:flex"><span><span style="color:#7ee787">mybatis</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">  </span><span style="color:#7ee787">configuration</span>:<span style="color:#6e7681">
</span></span></span><span style="display:flex"><span><span style="color:#6e7681">    </span><span style="color:#7ee787">cache-enabled</span>:<span style="color:#6e7681"> </span><span style="color:#79c0ff">false</span><span style="color:#6e7681"> </span><span style="color:#8b949e;font-style:italic">#ç¦ç”¨äºŒçº§ç¼“å­˜, é»˜è®¤ä¸ºtrue</span><span style="color:#6e7681">
</span></span></span></code></pre></div><p><strong>mybatisçš„äºŒçº§ç¼“å­˜æ˜¯æœ¬åœ°å®ç°çš„, åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­, å®¹æ˜“äº§ç”Ÿè„æ•°æ® , æ‰€ä»¥ä¸€èˆ¬ä¼šä½¿ç”¨redisè¿™ç§ç¬¬ä¸‰æ–¹å­˜å‚¨æ¥ä½¿ç”¨äºŒçº§ç¼“å­˜</strong></p><p><a href="https://www.cnblogs.com/zhengxl5566/p/11868656.html" rel="noopener" target="_blank">SpringBoot+Mybatisä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜è¯¦è§£ - éƒ‘æ™“é¾™ - åšå®¢å›­ (cnblogs.com)</a></p><p><a href="https://blog.csdn.net/weixin_28689507/article/details/112337488" rel="noopener" target="_blank">mybatis äºŒçº§ç¼“å­˜å¤±æ•ˆ_ç»™æˆ‘äº”åˆ†é’Ÿï¼Œå¸¦ä½ å½»åº•æŒæ¡MyBatisçš„ç¼“å­˜å·¥ä½œåŸç†_Tfiftheçš„åšå®¢-CSDNåšå®¢</a></p><p><a href="http://c.biancheng.net/mybatis/cache.html" rel="noopener" target="_blank">MyBatisç¼“å­˜ï¼ˆä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ï¼‰ (biancheng.net)</a></p><p><a href="https://www.jianshu.com/p/b4522c9212fb" rel="noopener" target="_blank">MyBatis|ç¼“å­˜æœºåˆ¶ - ç®€ä¹¦ (jianshu.com)</a></p><p><a href="https://blog.csdn.net/NongYeting/article/details/106408985" rel="noopener" target="_blank">springboot+mybatisä¸€çº§ç¼“å­˜å¯ç”¨/ç¦ç”¨é—®é¢˜_NongYetingçš„åšå®¢-CSDNåšå®¢_springbootå…³é—­mybatisç¼“å­˜</a></p></div><footer class="post-footer"><ul class="post-tags"><li><a href="https://xiaokunji.com/zh/tags/Mybatis.html">Mybatis</a></li><li><a href="https://xiaokunji.com/zh/tags/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6.html">javaåŠå…¶æ¡†æ¶</a></li></ul><nav class="paginav"><a class="prev" href="https://xiaokunji.com/zh/%E7%BB%BC%E5%90%88/%E7%AE%97%E6%B3%95/%E7%BA%A2%E9%BB%91%E6%A0%91.html"><span class="title">Â« ä¸Šä¸€é¡µ</span><br/><span>çº¢é»‘æ ‘</span>
</a><a class="next" href="https://xiaokunji.com/zh/java%E5%8F%8A%E5%85%B6%E6%A1%86%E6%9E%B6/java%E5%9F%BA%E7%A1%80/JVM/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/%E5%9B%9E%E6%94%B6%E5%89%8D%E6%8F%90.html"><span class="title">ä¸‹ä¸€é¡µ Â»</span><br/><span>å›æ”¶å‰æ</span></a></nav></footer></article></main><script async="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><footer class="footer"><span>Copyright
Â©
-2023
<a href="https://xiaokunji.com/zh/" style="color:#939393">ç±³äºŒ</a>
All Rights Reserved
</span><span id="busuanzi_container"><span class="fa fa-user">ç”¨æˆ·æ•°:</span><span id="busuanzi_value_site_uv"></span>
<span class="fa fa-eye">è®¿é—®æ•°:</span><span id="busuanzi_value_site_pv"></span></span></footer><a accesskey="g" aria-label="go to top" class="top-link" href="#top" id="top-link" title="Go to Top (Alt + G)"><svg fill="currentcolor" viewbox="0 0 12 6" xmlns="http://www.w3.org/2000/svg"><path d="M12 6H0l6-6z"></path></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="å¤åˆ¶";function s(){t.innerHTML="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerHTML="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>